import{S as Fi,J as Ko,a as ae,M as Zo,O as Qo,W as ts,p as un,C as qn,E as Ee,b as Jt,m as Xn,c as Qe,I as es,d as dn,e as ns,g as is,f as nt,o as os,h as ss,U as Yn,N as rs,r as as,i as Bi,j as ls,A as cs,k as us,l as ds,n as hs,q as ps}from"./Login-nPSyZeSz.js";class fs extends Fi{constructor(e,n,i){super(e,n,i||{id:e}),this.jobStorage=i.jobStorage??{}}async getJobFromId(e){let n=this.jobStorage[e];return n||(n=new Ko({id:e}),this.jobStorage[e]=n,await this.app.sendSystemMessage(n.id,"omni/job",{commands:[{title:"🛑 Stop",id:"stop",args:[n.id],classes:"rounded",ctx:{job:n},show:r=>r.job.state===ae.RUNNING||r.job.state===ae.READY}]}),n)}getJobsforWorkflow(e){return Object.values(this.jobStorage).filter(n=>n.workflowId===e)}removeJob(e){delete this.jobStorage[e]}async handleMessages(e){var m;const n=(m=e==null?void 0:e.body)==null?void 0:m.jobId;if(!n){this.error("no jobId in job message");return}const{state:i,workflowId:r,meta:l,errors:u}=e.body,s=await this.getJobFromId(n);s.state=i,s.workflowId=r,s._meta??(s._meta=l),s.errors=u;const c=e,{activeNode:p,activeNodeName:f}=c.body;switch(s._activeNodeName=f,s._activeNode=p,p.length>0&&f&&s.setNodeName(p[0],f),i){case ae.RUNNING:s._activity="Running...";break;case ae.ERROR:s._activity="Failed";break;case ae.FORCESTOP:s._activity="Stopping...";break;default:s._activity=`${i.charAt(0).toUpperCase()}${i.slice(1)}`;break}}create(){return this.info(`${this.id} create`),!0}async load(){return this.info(`${this.id} load`),!0}async start(){return this.info(`${this.id} start`),!0}async stop(){return this.info(`${this.id} stop`),!0}}class gs extends Fi{constructor(e,n,i){super(e,n,i||{id:e})}create(){return this.info(`${this.id} create`),!0}async load(){return this.info(`${this.id} load`),!0}async start(){return this.info(`${this.id} start`),!0}async stop(){return this.info(`${this.id} stop`),!0}async runServerScript(e,n){const i="/api/v1/mercenaries/runscript/"+e;return this.debug("executing server script",i,n),await(await fetch(i,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).json()}}async function vs(t,e){const n=t.getReader();let i;for(;!(i=await n.read()).done;)e(i.value)}function ms(t){let e,n,i,r=!1;return function(u){e===void 0?(e=u,n=0,i=-1):e=ys(e,u);const s=e.length;let c=0;for(;n<s;){r&&(e[n]===10&&(c=++n),r=!1);let p=-1;for(;n<s&&p===-1;++n)switch(e[n]){case 58:i===-1&&(i=n-c);break;case 13:r=!0;case 10:p=n;break}if(p===-1)break;t(e.subarray(c,p),i),c=n,i=-1}c===s?e=void 0:c!==0&&(e=e.subarray(c),n-=c)}}function ws(t,e,n){let i=Jn();const r=new TextDecoder;return function(u,s){if(u.length===0)n==null||n(i),i=Jn();else if(s>0){const c=r.decode(u.subarray(0,s)),p=s+(u[s+1]===32?2:1),f=r.decode(u.subarray(p));switch(c){case"data":i.data=i.data?i.data+`
`+f:f;break;case"event":i.event=f;break;case"id":t(i.id=f);break;case"retry":const m=parseInt(f,10);isNaN(m)||e(i.retry=m);break}}}}function ys(t,e){const n=new Uint8Array(t.length+e.length);return n.set(t),n.set(e,t.length),n}function Jn(){return{data:"",event:"",id:"",retry:void 0}}var bs=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};const Re="text/event-stream",xs=1e3,Gn="last-event-id";function _s(t,e){var{signal:n,headers:i,onopen:r,onmessage:l,onclose:u,onerror:s,openWhenHidden:c,fetch:p}=e,f=bs(e,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((m,O)=>{const k=Object.assign({},i);k.accept||(k.accept=Re);let E;function D(){E.abort(),document.hidden||_()}c||document.addEventListener("visibilitychange",D);let N=xs,v=0;function x(){document.removeEventListener("visibilitychange",D),window.clearTimeout(v),E.abort()}n==null||n.addEventListener("abort",()=>{x(),m()});const b=p??window.fetch,g=r??Ts;async function _(){var y;E=new AbortController;try{const S=await b(t,Object.assign(Object.assign({},f),{headers:k,signal:E.signal}));await g(S),await vs(S.body,ms(ws(I=>{I?k[Gn]=I:delete k[Gn]},I=>{N=I},l))),u==null||u(),x(),m()}catch(S){if(!E.signal.aborted)try{const I=(y=s==null?void 0:s(S))!==null&&y!==void 0?y:N;window.clearTimeout(v),v=window.setTimeout(_,I)}catch(I){x(),O(I)}}}_()})}function Ts(t){const e=t.headers.get("content-type");if(!(e!=null&&e.startsWith(Re)))throw new Error(`Expected content-type to be ${Re}, Actual: ${e}`)}class Kn extends Error{}class tn extends Error{}class ks extends Zo{constructor(e,n,i){super(e,n,i||{id:"messaging"}),this._hadConnection=!1,this._isConnected=!1,this._isFatal=!1,this.abortController=new AbortController,this.messageHandlers=new Map,this.config=i}get isConnected(){return this._isConnected}async setConnectionState(e,n,i){this._hadConnection=this._hadConnection||e,(e!==this._isConnected||this._isFatal!==n&&n===!0)&&(this._isConnected=e,this._isFatal=n??!1,this.info("SSE Connection state changed to ",e?"connected":"disconnected",n?" (fatal)":e?"":"(retrying...) "),await this.emit(this._isConnected?"connected":"disconnected",{fatal:n===!0,reason:(i==null?void 0:i.toString())??""}))}get serviceConfig(){return this.config}async load(){this.subscribeToGlobalEvent("registerMessageHandler",this.registerMessageHandler.bind(this)),this.subscribeToGlobalEvent("send:message",this.onMessage.bind(this))}async start(){return!0}registerMessageHandler(e){if(!this.messageHandlers.has(e.type))this.messageHandlers.set(e.type,e.handler);else throw new Error(`A message handler for type '${e.type}' is already registered.`)}decodeServerMessage(e){try{const n=this.app.parse(e);return n.flags&&(n.flags=new Set(n.flags)),n}catch(n){return omnilog.error("Error decoding server message",n,e),null}}stopSSE(){this.abortController.abort()}async onMessage(e){const n=this;let i;if(e.data&&e.data.length>0?i=this.decodeServerMessage(e.data):e.type!=null&&(i=e),i){if(i.type==="close"){n.warn("SSE Connection closed by server, not retrying. Reason: ",i.body),await n.setConnectionState(!1,!0,i.body.message),n.abortController.abort();return}let r;try{if(i.type&&n.messageHandlers.has(i.type)){const u=n.messageHandlers.get(i.type);u!=null?(r="handler:"+i.type,u.call(this,i)):(r="event:"+i.type,await n.emit(i.type,i))}const l={...i.body};r="legacy:"+JSON.stringify(l),await n.emitGlobalEvent("sse_message",l)}catch(l){n.error("Error invoking SSE message handling",r,l)}}else n.warn("SSE Message was not a valid message and will be ignored",e)}async startSSE(e){if(this.isConnected)return this.warn("SSE connection is already running. Ignoring double start."),!1;const n=this;return this.info("Connecting to SSE EventSource at ",e+"/api/v1/mercenaries/listen"),(async()=>{await _s(e+`/api/v1/mercenaries/listen?reconnect=${n._hadConnection}`,{signal:n.abortController.signal,openWhenHidden:!0,async onopen(r){var l;if(r.ok&&((l=r.headers.get("content-type"))!=null&&l.startsWith(Re)))n.info("SSE Connection opened"),await n.setConnectionState(!0);else if(r.status>=400&&r.status<500&&r.status!==429){n.error("SSE Client Error - fataling",r.status);let u="A connection to the server could not be established (Error "+r.status+"). Please try again in a few minutes.";switch(r.status){case 401:u="The server responded with an authorisation error (401). The most likely reason is that your session has expired or the server was restarted. Please refresh the page to re-authenticate.";break;case 403:u="The server responded with an authentication error (403). The most likely reason is that your session has expired or the server was restarted. Please refresh the page to re-authenticate.";break;case 500:u="The server responded with an internal server error (500). Please try again in a few minutes.";break;case 502:u="The server responded with a bad gateway error (502). The most likely reason is that the server is restarting. Please refresh the page to re-authenticate.";break}throw await n.setConnectionState(!1,!0,u),new tn}else throw n.error("SSE Client Issue - retrying",r.status,r.headers),await n.setConnectionState(!1,!1),new Kn},onmessage(r){if(r.event==="FatalError")throw new tn(r.data);n.info("SSE Message",r),n.onMessage(r)},onclose(){throw n.warn("onClose() retryable"),n.setConnectionState(!1,!1),new Kn},onerror(r){if(r instanceof tn)throw n.setConnectionState(!1,!0,r.message),n.error("SSE Fatal Error",r),r;n.setConnectionState(!1,!1),n.error("SSE Retryable Error",r)}})})(),!0}}class Ht{constructor(){this.loaded=!1,this.components=new Map,this.clientComponents=new Map,this.ctors=new Map}registerCtor(e,n){this.ctors.set(e,n)}create(e,n){let i=[];return i=e.map(r=>r instanceof Qo?r:(r.type??(r.type="OAIBaseComponent"),this.ctors.has(r.type)?this.ctors.get(r.type).fromJSON(r):null)).filter(r=>r!==null),i}add(e){return this.create(e).forEach(n=>{this.components.set(n.name,n)}),this}registerClientComponent(e,n){this.clientComponents.set(e,n)}hasClientComponent(e){return this.clientComponents.has(e)}getClientComponent(e){return this.clientComponents.get(e)}get(e){return this.components.get(e)}has(e){return this.components.has(e)}getComponents(e){let n=Array.from(this.components.values());return e||(n=n.filter(i=>i.tags.includes("default"))),n}getControlRegistry(){return ts.getInstance()}static getSingleton(){return Ht.instance??(Ht.instance=new Ht),Ht.instance}}function Cs(t){t.directive("intersect",(e,{value:n,expression:i,modifiers:r},{evaluateLater:l,cleanup:u})=>{let s=l(i),c={rootMargin:Ss(r),threshold:Es(r)},p=new IntersectionObserver(f=>{f.forEach(m=>{m.isIntersecting!==(n==="leave")&&(s(),r.includes("once")&&p.disconnect())})},c);p.observe(e),u(()=>{p.disconnect()})})}function Es(t){if(t.includes("full"))return .99;if(t.includes("half"))return .5;if(!t.includes("threshold"))return 0;let e=t[t.indexOf("threshold")+1];return e==="100"?1:e==="0"?0:+`.${e}`}function Os(t){let e=t.match(/^(-?[0-9]+)(px|%)?$/);return e?e[1]+(e[2]||"px"):void 0}function Ss(t){const e="margin",n="0px 0px 0px 0px",i=t.indexOf(e);if(i===-1)return n;let r=[];for(let l=1;l<5;l++)r.push(Os(t[i+l]||""));return r=r.filter(l=>l!==void 0),r.length?r.join(" ").trim():n}var As=Cs,ji=["input","select","textarea","a[href]","button","[tabindex]:not(slot)","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details"],Pe=ji.join(","),Hi=typeof Element>"u",Wt=Hi?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,hn=!Hi&&Element.prototype.getRootNode?function(t){return t.getRootNode()}:function(t){return t.ownerDocument},Vi=function(e,n,i){var r=Array.prototype.slice.apply(e.querySelectorAll(Pe));return n&&Wt.call(e,Pe)&&r.unshift(e),r=r.filter(i),r},Wi=function t(e,n,i){for(var r=[],l=Array.from(e);l.length;){var u=l.shift();if(u.tagName==="SLOT"){var s=u.assignedElements(),c=s.length?s:u.children,p=t(c,!0,i);i.flatten?r.push.apply(r,p):r.push({scope:u,candidates:p})}else{var f=Wt.call(u,Pe);f&&i.filter(u)&&(n||!e.includes(u))&&r.push(u);var m=u.shadowRoot||typeof i.getShadowRoot=="function"&&i.getShadowRoot(u),O=!i.shadowRootFilter||i.shadowRootFilter(u);if(m&&O){var k=t(m===!0?u.children:m.children,!0,i);i.flatten?r.push.apply(r,k):r.push({scope:u,candidates:k})}else l.unshift.apply(l,u.children)}}return r},Ui=function(e,n){return e.tabIndex<0&&(n||/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||e.isContentEditable)&&isNaN(parseInt(e.getAttribute("tabindex"),10))?0:e.tabIndex},Ms=function(e,n){return e.tabIndex===n.tabIndex?e.documentOrder-n.documentOrder:e.tabIndex-n.tabIndex},zi=function(e){return e.tagName==="INPUT"},Ds=function(e){return zi(e)&&e.type==="hidden"},Ns=function(e){var n=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(i){return i.tagName==="SUMMARY"});return n},Is=function(e,n){for(var i=0;i<e.length;i++)if(e[i].checked&&e[i].form===n)return e[i]},Ls=function(e){if(!e.name)return!0;var n=e.form||hn(e),i=function(s){return n.querySelectorAll('input[type="radio"][name="'+s+'"]')},r;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")r=i(window.CSS.escape(e.name));else try{r=i(e.name)}catch(u){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",u.message),!1}var l=Is(r,e.form);return!l||l===e},Rs=function(e){return zi(e)&&e.type==="radio"},Ps=function(e){return Rs(e)&&!Ls(e)},Zn=function(e){var n=e.getBoundingClientRect(),i=n.width,r=n.height;return i===0&&r===0},$s=function(e,n){var i=n.displayCheck,r=n.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var l=Wt.call(e,"details>summary:first-of-type"),u=l?e.parentElement:e;if(Wt.call(u,"details:not([open]) *"))return!0;var s=hn(e).host,c=(s==null?void 0:s.ownerDocument.contains(s))||e.ownerDocument.contains(e);if(!i||i==="full"){if(typeof r=="function"){for(var p=e;e;){var f=e.parentElement,m=hn(e);if(f&&!f.shadowRoot&&r(f)===!0)return Zn(e);e.assignedSlot?e=e.assignedSlot:!f&&m!==e.ownerDocument?e=m.host:e=f}e=p}if(c)return!e.getClientRects().length}else if(i==="non-zero-area")return Zn(e);return!1},Fs=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var n=e.parentElement;n;){if(n.tagName==="FIELDSET"&&n.disabled){for(var i=0;i<n.children.length;i++){var r=n.children.item(i);if(r.tagName==="LEGEND")return Wt.call(n,"fieldset[disabled] *")?!0:!r.contains(e)}return!0}n=n.parentElement}return!1},$e=function(e,n){return!(n.disabled||Ds(n)||$s(n,e)||Ns(n)||Fs(n))},pn=function(e,n){return!(Ps(n)||Ui(n)<0||!$e(e,n))},Bs=function(e){var n=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(n)||n>=0)},js=function t(e){var n=[],i=[];return e.forEach(function(r,l){var u=!!r.scope,s=u?r.scope:r,c=Ui(s,u),p=u?t(r.candidates):s;c===0?u?n.push.apply(n,p):n.push(s):i.push({documentOrder:l,tabIndex:c,item:r,isScope:u,content:p})}),i.sort(Ms).reduce(function(r,l){return l.isScope?r.push.apply(r,l.content):r.push(l.content),r},[]).concat(n)},Hs=function(e,n){n=n||{};var i;return n.getShadowRoot?i=Wi([e],n.includeContainer,{filter:pn.bind(null,n),flatten:!1,getShadowRoot:n.getShadowRoot,shadowRootFilter:Bs}):i=Vi(e,n.includeContainer,pn.bind(null,n)),js(i)},qi=function(e,n){n=n||{};var i;return n.getShadowRoot?i=Wi([e],n.includeContainer,{filter:$e.bind(null,n),flatten:!0,getShadowRoot:n.getShadowRoot}):i=Vi(e,n.includeContainer,$e.bind(null,n)),i},Oe=function(e,n){if(n=n||{},!e)throw new Error("No node provided");return Wt.call(e,Pe)===!1?!1:pn(n,e)},Vs=ji.concat("iframe").join(","),Ie=function(e,n){if(n=n||{},!e)throw new Error("No node provided");return Wt.call(e,Vs)===!1?!1:$e(n,e)};function Qn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ti(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Qn(Object(n),!0).forEach(function(i){Ws(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Qn(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Ws(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ei=function(){var t=[];return{activateTrap:function(n){if(t.length>0){var i=t[t.length-1];i!==n&&i.pause()}var r=t.indexOf(n);r===-1||t.splice(r,1),t.push(n)},deactivateTrap:function(n){var i=t.indexOf(n);i!==-1&&t.splice(i,1),t.length>0&&t[t.length-1].unpause()}}}(),Us=function(e){return e.tagName&&e.tagName.toLowerCase()==="input"&&typeof e.select=="function"},zs=function(e){return e.key==="Escape"||e.key==="Esc"||e.keyCode===27},qs=function(e){return e.key==="Tab"||e.keyCode===9},ni=function(e){return setTimeout(e,0)},ii=function(e,n){var i=-1;return e.every(function(r,l){return n(r)?(i=l,!1):!0}),i},le=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return typeof e=="function"?e.apply(void 0,i):e},Se=function(e){return e.target.shadowRoot&&typeof e.composedPath=="function"?e.composedPath()[0]:e.target},Xs=function(e,n){var i=(n==null?void 0:n.document)||document,r=ti({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0},n),l={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0},u,s=function(y,S,I){return y&&y[S]!==void 0?y[S]:r[I||S]},c=function(y){return l.containerGroups.findIndex(function(S){var I=S.container,$=S.tabbableNodes;return I.contains(y)||$.find(function(F){return F===y})})},p=function(y){var S=r[y];if(typeof S=="function"){for(var I=arguments.length,$=new Array(I>1?I-1:0),F=1;F<I;F++)$[F-1]=arguments[F];S=S.apply(void 0,$)}if(S===!0&&(S=void 0),!S){if(S===void 0||S===!1)return S;throw new Error("`".concat(y,"` was specified but was not a node, or did not return a node"))}var B=S;if(typeof S=="string"&&(B=i.querySelector(S),!B))throw new Error("`".concat(y,"` as selector refers to no known node"));return B},f=function(){var y=p("initialFocus");if(y===!1)return!1;if(y===void 0)if(c(i.activeElement)>=0)y=i.activeElement;else{var S=l.tabbableGroups[0],I=S&&S.firstTabbableNode;y=I||p("fallbackFocus")}if(!y)throw new Error("Your focus-trap needs to have at least one focusable element");return y},m=function(){if(l.containerGroups=l.containers.map(function(y){var S=Hs(y,r.tabbableOptions),I=qi(y,r.tabbableOptions);return{container:y,tabbableNodes:S,focusableNodes:I,firstTabbableNode:S.length>0?S[0]:null,lastTabbableNode:S.length>0?S[S.length-1]:null,nextTabbableNode:function(F){var B=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,L=I.findIndex(function(P){return P===F});if(!(L<0))return B?I.slice(L+1).find(function(P){return Oe(P,r.tabbableOptions)}):I.slice(0,L).reverse().find(function(P){return Oe(P,r.tabbableOptions)})}}}),l.tabbableGroups=l.containerGroups.filter(function(y){return y.tabbableNodes.length>0}),l.tabbableGroups.length<=0&&!p("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times")},O=function _(y){if(y!==!1&&y!==i.activeElement){if(!y||!y.focus){_(f());return}y.focus({preventScroll:!!r.preventScroll}),l.mostRecentlyFocusedNode=y,Us(y)&&y.select()}},k=function(y){var S=p("setReturnFocus",y);return S||(S===!1?!1:y)},E=function(y){var S=Se(y);if(!(c(S)>=0)){if(le(r.clickOutsideDeactivates,y)){u.deactivate({returnFocus:r.returnFocusOnDeactivate&&!Ie(S,r.tabbableOptions)});return}le(r.allowOutsideClick,y)||y.preventDefault()}},D=function(y){var S=Se(y),I=c(S)>=0;I||S instanceof Document?I&&(l.mostRecentlyFocusedNode=S):(y.stopImmediatePropagation(),O(l.mostRecentlyFocusedNode||f()))},N=function(y){var S=Se(y);m();var I=null;if(l.tabbableGroups.length>0){var $=c(S),F=$>=0?l.containerGroups[$]:void 0;if($<0)y.shiftKey?I=l.tabbableGroups[l.tabbableGroups.length-1].lastTabbableNode:I=l.tabbableGroups[0].firstTabbableNode;else if(y.shiftKey){var B=ii(l.tabbableGroups,function(o){var a=o.firstTabbableNode;return S===a});if(B<0&&(F.container===S||Ie(S,r.tabbableOptions)&&!Oe(S,r.tabbableOptions)&&!F.nextTabbableNode(S,!1))&&(B=$),B>=0){var L=B===0?l.tabbableGroups.length-1:B-1,P=l.tabbableGroups[L];I=P.lastTabbableNode}}else{var U=ii(l.tabbableGroups,function(o){var a=o.lastTabbableNode;return S===a});if(U<0&&(F.container===S||Ie(S,r.tabbableOptions)&&!Oe(S,r.tabbableOptions)&&!F.nextTabbableNode(S))&&(U=$),U>=0){var Z=U===l.tabbableGroups.length-1?0:U+1,Y=l.tabbableGroups[Z];I=Y.firstTabbableNode}}}else I=p("fallbackFocus");I&&(y.preventDefault(),O(I))},v=function(y){if(zs(y)&&le(r.escapeDeactivates,y)!==!1){y.preventDefault(),u.deactivate();return}if(qs(y)){N(y);return}},x=function(y){var S=Se(y);c(S)>=0||le(r.clickOutsideDeactivates,y)||le(r.allowOutsideClick,y)||(y.preventDefault(),y.stopImmediatePropagation())},b=function(){if(l.active)return ei.activateTrap(u),l.delayInitialFocusTimer=r.delayInitialFocus?ni(function(){O(f())}):O(f()),i.addEventListener("focusin",D,!0),i.addEventListener("mousedown",E,{capture:!0,passive:!1}),i.addEventListener("touchstart",E,{capture:!0,passive:!1}),i.addEventListener("click",x,{capture:!0,passive:!1}),i.addEventListener("keydown",v,{capture:!0,passive:!1}),u},g=function(){if(l.active)return i.removeEventListener("focusin",D,!0),i.removeEventListener("mousedown",E,!0),i.removeEventListener("touchstart",E,!0),i.removeEventListener("click",x,!0),i.removeEventListener("keydown",v,!0),u};return u={get active(){return l.active},get paused(){return l.paused},activate:function(y){if(l.active)return this;var S=s(y,"onActivate"),I=s(y,"onPostActivate"),$=s(y,"checkCanFocusTrap");$||m(),l.active=!0,l.paused=!1,l.nodeFocusedBeforeActivation=i.activeElement,S&&S();var F=function(){$&&m(),b(),I&&I()};return $?($(l.containers.concat()).then(F,F),this):(F(),this)},deactivate:function(y){if(!l.active)return this;var S=ti({onDeactivate:r.onDeactivate,onPostDeactivate:r.onPostDeactivate,checkCanReturnFocus:r.checkCanReturnFocus},y);clearTimeout(l.delayInitialFocusTimer),l.delayInitialFocusTimer=void 0,g(),l.active=!1,l.paused=!1,ei.deactivateTrap(u);var I=s(S,"onDeactivate"),$=s(S,"onPostDeactivate"),F=s(S,"checkCanReturnFocus"),B=s(S,"returnFocus","returnFocusOnDeactivate");I&&I();var L=function(){ni(function(){B&&O(k(l.nodeFocusedBeforeActivation)),$&&$()})};return B&&F?(F(k(l.nodeFocusedBeforeActivation)).then(L,L),this):(L(),this)},pause:function(){return l.paused||!l.active?this:(l.paused=!0,g(),this)},unpause:function(){return!l.paused||!l.active?this:(l.paused=!1,m(),b(),this)},updateContainerElements:function(y){var S=[].concat(y).filter(Boolean);return l.containers=S.map(function(I){return typeof I=="string"?i.querySelector(I):I}),l.active&&m(),this}},u.updateContainerElements(e),u};function Ys(t){let e,n;window.addEventListener("focusin",()=>{e=n,n=document.activeElement}),t.magic("focus",i=>{let r=i;return{__noscroll:!1,__wrapAround:!1,within(l){return r=l,this},withoutScrolling(){return this.__noscroll=!0,this},noscroll(){return this.__noscroll=!0,this},withWrapAround(){return this.__wrapAround=!0,this},wrap(){return this.withWrapAround()},focusable(l){return Ie(l)},previouslyFocused(){return e},lastFocused(){return e},focused(){return n},focusables(){return Array.isArray(r)?r:qi(r,{displayCheck:"none"})},all(){return this.focusables()},isFirst(l){let u=this.all();return u[0]&&u[0].isSameNode(l)},isLast(l){let u=this.all();return u.length&&u.slice(-1)[0].isSameNode(l)},getFirst(){return this.all()[0]},getLast(){return this.all().slice(-1)[0]},getNext(){let l=this.all(),u=document.activeElement;if(l.indexOf(u)!==-1)return this.__wrapAround&&l.indexOf(u)===l.length-1?l[0]:l[l.indexOf(u)+1]},getPrevious(){let l=this.all(),u=document.activeElement;if(l.indexOf(u)!==-1)return this.__wrapAround&&l.indexOf(u)===0?l.slice(-1)[0]:l[l.indexOf(u)-1]},first(){this.focus(this.getFirst())},last(){this.focus(this.getLast())},next(){this.focus(this.getNext())},previous(){this.focus(this.getPrevious())},prev(){return this.previous()},focus(l){l&&setTimeout(()=>{l.hasAttribute("tabindex")||l.setAttribute("tabindex","0"),l.focus({preventScroll:this._noscroll})})}}}),t.directive("trap",t.skipDuringClone((i,{expression:r,modifiers:l},{effect:u,evaluateLater:s,cleanup:c})=>{let p=s(r),f=!1,m={escapeDeactivates:!1,allowOutsideClick:!0,fallbackFocus:()=>i},O=i.querySelector("[autofocus]");O&&(m.initialFocus=O);let k=Xs(i,m),E=()=>{},D=()=>{};const N=()=>{E(),E=()=>{},D(),D=()=>{},k.deactivate({returnFocus:!l.includes("noreturn")})};u(()=>p(v=>{f!==v&&(v&&!f&&(l.includes("noscroll")&&(D=Js()),l.includes("inert")&&(E=oi(i)),setTimeout(()=>{k.activate()},15)),!v&&f&&N(),f=!!v)})),c(N)},(i,{expression:r,modifiers:l},{evaluate:u})=>{l.includes("inert")&&u(r)&&oi(i)}))}function oi(t){let e=[];return Xi(t,n=>{let i=n.hasAttribute("aria-hidden");n.setAttribute("aria-hidden","true"),e.push(()=>i||n.removeAttribute("aria-hidden"))}),()=>{for(;e.length;)e.pop()()}}function Xi(t,e){t.isSameNode(document.body)||!t.parentNode||Array.from(t.parentNode.children).forEach(n=>{n.isSameNode(t)?Xi(t.parentNode,e):e(n)})}function Js(){let t=document.documentElement.style.overflow,e=document.documentElement.style.paddingRight,n=window.innerWidth-document.documentElement.clientWidth;return document.documentElement.style.overflow="hidden",document.documentElement.style.paddingRight=`${n}px`,()=>{document.documentElement.style.overflow=t,document.documentElement.style.paddingRight=e}}var Gs=Ys;/*! Bundled license information:

tabbable/dist/index.esm.js:
  (*!
  * tabbable 5.3.3
  * @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
  *)

focus-trap/dist/focus-trap.esm.js:
  (*!
  * focus-trap 6.9.4
  * @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
  *)
*/var dt="top",yt="bottom",bt="right",ht="left",Cn="auto",me=[dt,yt,bt,ht],Kt="start",ge="end",Ks="clippingParents",Yi="viewport",ce="popper",Zs="reference",si=me.reduce(function(t,e){return t.concat([e+"-"+Kt,e+"-"+ge])},[]),Ji=[].concat(me,[Cn]).reduce(function(t,e){return t.concat([e,e+"-"+Kt,e+"-"+ge])},[]),Qs="beforeRead",tr="read",er="afterRead",nr="beforeMain",ir="main",or="afterMain",sr="beforeWrite",rr="write",ar="afterWrite",lr=[Qs,tr,er,nr,ir,or,sr,rr,ar];function Ct(t){return t?(t.nodeName||"").toLowerCase():null}function ft(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function Ut(t){var e=ft(t).Element;return t instanceof e||t instanceof Element}function wt(t){var e=ft(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function En(t){if(typeof ShadowRoot>"u")return!1;var e=ft(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function cr(t){var e=t.state;Object.keys(e.elements).forEach(function(n){var i=e.styles[n]||{},r=e.attributes[n]||{},l=e.elements[n];!wt(l)||!Ct(l)||(Object.assign(l.style,i),Object.keys(r).forEach(function(u){var s=r[u];s===!1?l.removeAttribute(u):l.setAttribute(u,s===!0?"":s)}))})}function ur(t){var e=t.state,n={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,n.popper),e.styles=n,e.elements.arrow&&Object.assign(e.elements.arrow.style,n.arrow),function(){Object.keys(e.elements).forEach(function(i){var r=e.elements[i],l=e.attributes[i]||{},u=Object.keys(e.styles.hasOwnProperty(i)?e.styles[i]:n[i]),s=u.reduce(function(c,p){return c[p]="",c},{});!wt(r)||!Ct(r)||(Object.assign(r.style,s),Object.keys(l).forEach(function(c){r.removeAttribute(c)}))})}}const Gi={name:"applyStyles",enabled:!0,phase:"write",fn:cr,effect:ur,requires:["computeStyles"]};function kt(t){return t.split("-")[0]}var Vt=Math.max,Fe=Math.min,Zt=Math.round;function fn(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Ki(){return!/^((?!chrome|android).)*safari/i.test(fn())}function Qt(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!1);var i=t.getBoundingClientRect(),r=1,l=1;e&&wt(t)&&(r=t.offsetWidth>0&&Zt(i.width)/t.offsetWidth||1,l=t.offsetHeight>0&&Zt(i.height)/t.offsetHeight||1);var u=Ut(t)?ft(t):window,s=u.visualViewport,c=!Ki()&&n,p=(i.left+(c&&s?s.offsetLeft:0))/r,f=(i.top+(c&&s?s.offsetTop:0))/l,m=i.width/r,O=i.height/l;return{width:m,height:O,top:f,right:p+m,bottom:f+O,left:p,x:p,y:f}}function On(t){var e=Qt(t),n=t.offsetWidth,i=t.offsetHeight;return Math.abs(e.width-n)<=1&&(n=e.width),Math.abs(e.height-i)<=1&&(i=e.height),{x:t.offsetLeft,y:t.offsetTop,width:n,height:i}}function Zi(t,e){var n=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(n&&En(n)){var i=e;do{if(i&&t.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function St(t){return ft(t).getComputedStyle(t)}function dr(t){return["table","td","th"].indexOf(Ct(t))>=0}function It(t){return((Ut(t)?t.ownerDocument:t.document)||window.document).documentElement}function ze(t){return Ct(t)==="html"?t:t.assignedSlot||t.parentNode||(En(t)?t.host:null)||It(t)}function ri(t){return!wt(t)||St(t).position==="fixed"?null:t.offsetParent}function hr(t){var e=/firefox/i.test(fn()),n=/Trident/i.test(fn());if(n&&wt(t)){var i=St(t);if(i.position==="fixed")return null}var r=ze(t);for(En(r)&&(r=r.host);wt(r)&&["html","body"].indexOf(Ct(r))<0;){var l=St(r);if(l.transform!=="none"||l.perspective!=="none"||l.contain==="paint"||["transform","perspective"].indexOf(l.willChange)!==-1||e&&l.willChange==="filter"||e&&l.filter&&l.filter!=="none")return r;r=r.parentNode}return null}function we(t){for(var e=ft(t),n=ri(t);n&&dr(n)&&St(n).position==="static";)n=ri(n);return n&&(Ct(n)==="html"||Ct(n)==="body"&&St(n).position==="static")?e:n||hr(t)||e}function Sn(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function he(t,e,n){return Vt(t,Fe(e,n))}function pr(t,e,n){var i=he(t,e,n);return i>n?n:i}function Qi(){return{top:0,right:0,bottom:0,left:0}}function to(t){return Object.assign({},Qi(),t)}function eo(t,e){return e.reduce(function(n,i){return n[i]=t,n},{})}var fr=function(e,n){return e=typeof e=="function"?e(Object.assign({},n.rects,{placement:n.placement})):e,to(typeof e!="number"?e:eo(e,me))};function gr(t){var e,n=t.state,i=t.name,r=t.options,l=n.elements.arrow,u=n.modifiersData.popperOffsets,s=kt(n.placement),c=Sn(s),p=[ht,bt].indexOf(s)>=0,f=p?"height":"width";if(!(!l||!u)){var m=fr(r.padding,n),O=On(l),k=c==="y"?dt:ht,E=c==="y"?yt:bt,D=n.rects.reference[f]+n.rects.reference[c]-u[c]-n.rects.popper[f],N=u[c]-n.rects.reference[c],v=we(l),x=v?c==="y"?v.clientHeight||0:v.clientWidth||0:0,b=D/2-N/2,g=m[k],_=x-O[f]-m[E],y=x/2-O[f]/2+b,S=he(g,y,_),I=c;n.modifiersData[i]=(e={},e[I]=S,e.centerOffset=S-y,e)}}function vr(t){var e=t.state,n=t.options,i=n.element,r=i===void 0?"[data-popper-arrow]":i;r!=null&&(typeof r=="string"&&(r=e.elements.popper.querySelector(r),!r)||Zi(e.elements.popper,r)&&(e.elements.arrow=r))}const mr={name:"arrow",enabled:!0,phase:"main",fn:gr,effect:vr,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function te(t){return t.split("-")[1]}var wr={top:"auto",right:"auto",bottom:"auto",left:"auto"};function yr(t,e){var n=t.x,i=t.y,r=e.devicePixelRatio||1;return{x:Zt(n*r)/r||0,y:Zt(i*r)/r||0}}function ai(t){var e,n=t.popper,i=t.popperRect,r=t.placement,l=t.variation,u=t.offsets,s=t.position,c=t.gpuAcceleration,p=t.adaptive,f=t.roundOffsets,m=t.isFixed,O=u.x,k=O===void 0?0:O,E=u.y,D=E===void 0?0:E,N=typeof f=="function"?f({x:k,y:D}):{x:k,y:D};k=N.x,D=N.y;var v=u.hasOwnProperty("x"),x=u.hasOwnProperty("y"),b=ht,g=dt,_=window;if(p){var y=we(n),S="clientHeight",I="clientWidth";if(y===ft(n)&&(y=It(n),St(y).position!=="static"&&s==="absolute"&&(S="scrollHeight",I="scrollWidth")),y=y,r===dt||(r===ht||r===bt)&&l===ge){g=yt;var $=m&&y===_&&_.visualViewport?_.visualViewport.height:y[S];D-=$-i.height,D*=c?1:-1}if(r===ht||(r===dt||r===yt)&&l===ge){b=bt;var F=m&&y===_&&_.visualViewport?_.visualViewport.width:y[I];k-=F-i.width,k*=c?1:-1}}var B=Object.assign({position:s},p&&wr),L=f===!0?yr({x:k,y:D},ft(n)):{x:k,y:D};if(k=L.x,D=L.y,c){var P;return Object.assign({},B,(P={},P[g]=x?"0":"",P[b]=v?"0":"",P.transform=(_.devicePixelRatio||1)<=1?"translate("+k+"px, "+D+"px)":"translate3d("+k+"px, "+D+"px, 0)",P))}return Object.assign({},B,(e={},e[g]=x?D+"px":"",e[b]=v?k+"px":"",e.transform="",e))}function br(t){var e=t.state,n=t.options,i=n.gpuAcceleration,r=i===void 0?!0:i,l=n.adaptive,u=l===void 0?!0:l,s=n.roundOffsets,c=s===void 0?!0:s,p={placement:kt(e.placement),variation:te(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:r,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,ai(Object.assign({},p,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:u,roundOffsets:c})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,ai(Object.assign({},p,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const xr={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:br,data:{}};var Ae={passive:!0};function _r(t){var e=t.state,n=t.instance,i=t.options,r=i.scroll,l=r===void 0?!0:r,u=i.resize,s=u===void 0?!0:u,c=ft(e.elements.popper),p=[].concat(e.scrollParents.reference,e.scrollParents.popper);return l&&p.forEach(function(f){f.addEventListener("scroll",n.update,Ae)}),s&&c.addEventListener("resize",n.update,Ae),function(){l&&p.forEach(function(f){f.removeEventListener("scroll",n.update,Ae)}),s&&c.removeEventListener("resize",n.update,Ae)}}const Tr={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:_r,data:{}};var kr={left:"right",right:"left",bottom:"top",top:"bottom"};function Le(t){return t.replace(/left|right|bottom|top/g,function(e){return kr[e]})}var Cr={start:"end",end:"start"};function li(t){return t.replace(/start|end/g,function(e){return Cr[e]})}function An(t){var e=ft(t),n=e.pageXOffset,i=e.pageYOffset;return{scrollLeft:n,scrollTop:i}}function Mn(t){return Qt(It(t)).left+An(t).scrollLeft}function Er(t,e){var n=ft(t),i=It(t),r=n.visualViewport,l=i.clientWidth,u=i.clientHeight,s=0,c=0;if(r){l=r.width,u=r.height;var p=Ki();(p||!p&&e==="fixed")&&(s=r.offsetLeft,c=r.offsetTop)}return{width:l,height:u,x:s+Mn(t),y:c}}function Or(t){var e,n=It(t),i=An(t),r=(e=t.ownerDocument)==null?void 0:e.body,l=Vt(n.scrollWidth,n.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),u=Vt(n.scrollHeight,n.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),s=-i.scrollLeft+Mn(t),c=-i.scrollTop;return St(r||n).direction==="rtl"&&(s+=Vt(n.clientWidth,r?r.clientWidth:0)-l),{width:l,height:u,x:s,y:c}}function Dn(t){var e=St(t),n=e.overflow,i=e.overflowX,r=e.overflowY;return/auto|scroll|overlay|hidden/.test(n+r+i)}function no(t){return["html","body","#document"].indexOf(Ct(t))>=0?t.ownerDocument.body:wt(t)&&Dn(t)?t:no(ze(t))}function pe(t,e){var n;e===void 0&&(e=[]);var i=no(t),r=i===((n=t.ownerDocument)==null?void 0:n.body),l=ft(i),u=r?[l].concat(l.visualViewport||[],Dn(i)?i:[]):i,s=e.concat(u);return r?s:s.concat(pe(ze(u)))}function gn(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function Sr(t,e){var n=Qt(t,!1,e==="fixed");return n.top=n.top+t.clientTop,n.left=n.left+t.clientLeft,n.bottom=n.top+t.clientHeight,n.right=n.left+t.clientWidth,n.width=t.clientWidth,n.height=t.clientHeight,n.x=n.left,n.y=n.top,n}function ci(t,e,n){return e===Yi?gn(Er(t,n)):Ut(e)?Sr(e,n):gn(Or(It(t)))}function Ar(t){var e=pe(ze(t)),n=["absolute","fixed"].indexOf(St(t).position)>=0,i=n&&wt(t)?we(t):t;return Ut(i)?e.filter(function(r){return Ut(r)&&Zi(r,i)&&Ct(r)!=="body"}):[]}function Mr(t,e,n,i){var r=e==="clippingParents"?Ar(t):[].concat(e),l=[].concat(r,[n]),u=l[0],s=l.reduce(function(c,p){var f=ci(t,p,i);return c.top=Vt(f.top,c.top),c.right=Fe(f.right,c.right),c.bottom=Fe(f.bottom,c.bottom),c.left=Vt(f.left,c.left),c},ci(t,u,i));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function io(t){var e=t.reference,n=t.element,i=t.placement,r=i?kt(i):null,l=i?te(i):null,u=e.x+e.width/2-n.width/2,s=e.y+e.height/2-n.height/2,c;switch(r){case dt:c={x:u,y:e.y-n.height};break;case yt:c={x:u,y:e.y+e.height};break;case bt:c={x:e.x+e.width,y:s};break;case ht:c={x:e.x-n.width,y:s};break;default:c={x:e.x,y:e.y}}var p=r?Sn(r):null;if(p!=null){var f=p==="y"?"height":"width";switch(l){case Kt:c[p]=c[p]-(e[f]/2-n[f]/2);break;case ge:c[p]=c[p]+(e[f]/2-n[f]/2);break}}return c}function ve(t,e){e===void 0&&(e={});var n=e,i=n.placement,r=i===void 0?t.placement:i,l=n.strategy,u=l===void 0?t.strategy:l,s=n.boundary,c=s===void 0?Ks:s,p=n.rootBoundary,f=p===void 0?Yi:p,m=n.elementContext,O=m===void 0?ce:m,k=n.altBoundary,E=k===void 0?!1:k,D=n.padding,N=D===void 0?0:D,v=to(typeof N!="number"?N:eo(N,me)),x=O===ce?Zs:ce,b=t.rects.popper,g=t.elements[E?x:O],_=Mr(Ut(g)?g:g.contextElement||It(t.elements.popper),c,f,u),y=Qt(t.elements.reference),S=io({reference:y,element:b,strategy:"absolute",placement:r}),I=gn(Object.assign({},b,S)),$=O===ce?I:y,F={top:_.top-$.top+v.top,bottom:$.bottom-_.bottom+v.bottom,left:_.left-$.left+v.left,right:$.right-_.right+v.right},B=t.modifiersData.offset;if(O===ce&&B){var L=B[r];Object.keys(F).forEach(function(P){var U=[bt,yt].indexOf(P)>=0?1:-1,Z=[dt,yt].indexOf(P)>=0?"y":"x";F[P]+=L[Z]*U})}return F}function Dr(t,e){e===void 0&&(e={});var n=e,i=n.placement,r=n.boundary,l=n.rootBoundary,u=n.padding,s=n.flipVariations,c=n.allowedAutoPlacements,p=c===void 0?Ji:c,f=te(i),m=f?s?si:si.filter(function(E){return te(E)===f}):me,O=m.filter(function(E){return p.indexOf(E)>=0});O.length===0&&(O=m);var k=O.reduce(function(E,D){return E[D]=ve(t,{placement:D,boundary:r,rootBoundary:l,padding:u})[kt(D)],E},{});return Object.keys(k).sort(function(E,D){return k[E]-k[D]})}function Nr(t){if(kt(t)===Cn)return[];var e=Le(t);return[li(t),e,li(e)]}function Ir(t){var e=t.state,n=t.options,i=t.name;if(!e.modifiersData[i]._skip){for(var r=n.mainAxis,l=r===void 0?!0:r,u=n.altAxis,s=u===void 0?!0:u,c=n.fallbackPlacements,p=n.padding,f=n.boundary,m=n.rootBoundary,O=n.altBoundary,k=n.flipVariations,E=k===void 0?!0:k,D=n.allowedAutoPlacements,N=e.options.placement,v=kt(N),x=v===N,b=c||(x||!E?[Le(N)]:Nr(N)),g=[N].concat(b).reduce(function(A,R){return A.concat(kt(R)===Cn?Dr(e,{placement:R,boundary:f,rootBoundary:m,padding:p,flipVariations:E,allowedAutoPlacements:D}):R)},[]),_=e.rects.reference,y=e.rects.popper,S=new Map,I=!0,$=g[0],F=0;F<g.length;F++){var B=g[F],L=kt(B),P=te(B)===Kt,U=[dt,yt].indexOf(L)>=0,Z=U?"width":"height",Y=ve(e,{placement:B,boundary:f,rootBoundary:m,altBoundary:O,padding:p}),o=U?P?bt:ht:P?yt:dt;_[Z]>y[Z]&&(o=Le(o));var a=Le(o),h=[];if(l&&h.push(Y[L]<=0),s&&h.push(Y[o]<=0,Y[a]<=0),h.every(function(A){return A})){$=B,I=!1;break}S.set(B,h)}if(I)for(var d=E?3:1,w=function(R){var j=g.find(function(V){var W=S.get(V);if(W)return W.slice(0,R).every(function(X){return X})});if(j)return $=j,"break"},C=d;C>0;C--){var T=w(C);if(T==="break")break}e.placement!==$&&(e.modifiersData[i]._skip=!0,e.placement=$,e.reset=!0)}}const Lr={name:"flip",enabled:!0,phase:"main",fn:Ir,requiresIfExists:["offset"],data:{_skip:!1}};function ui(t,e,n){return n===void 0&&(n={x:0,y:0}),{top:t.top-e.height-n.y,right:t.right-e.width+n.x,bottom:t.bottom-e.height+n.y,left:t.left-e.width-n.x}}function di(t){return[dt,bt,yt,ht].some(function(e){return t[e]>=0})}function Rr(t){var e=t.state,n=t.name,i=e.rects.reference,r=e.rects.popper,l=e.modifiersData.preventOverflow,u=ve(e,{elementContext:"reference"}),s=ve(e,{altBoundary:!0}),c=ui(u,i),p=ui(s,r,l),f=di(c),m=di(p);e.modifiersData[n]={referenceClippingOffsets:c,popperEscapeOffsets:p,isReferenceHidden:f,hasPopperEscaped:m},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":f,"data-popper-escaped":m})}const Pr={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Rr};function $r(t,e,n){var i=kt(t),r=[ht,dt].indexOf(i)>=0?-1:1,l=typeof n=="function"?n(Object.assign({},e,{placement:t})):n,u=l[0],s=l[1];return u=u||0,s=(s||0)*r,[ht,bt].indexOf(i)>=0?{x:s,y:u}:{x:u,y:s}}function Fr(t){var e=t.state,n=t.options,i=t.name,r=n.offset,l=r===void 0?[0,0]:r,u=Ji.reduce(function(f,m){return f[m]=$r(m,e.rects,l),f},{}),s=u[e.placement],c=s.x,p=s.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=c,e.modifiersData.popperOffsets.y+=p),e.modifiersData[i]=u}const Br={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Fr};function jr(t){var e=t.state,n=t.name;e.modifiersData[n]=io({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const Hr={name:"popperOffsets",enabled:!0,phase:"read",fn:jr,data:{}};function Vr(t){return t==="x"?"y":"x"}function Wr(t){var e=t.state,n=t.options,i=t.name,r=n.mainAxis,l=r===void 0?!0:r,u=n.altAxis,s=u===void 0?!1:u,c=n.boundary,p=n.rootBoundary,f=n.altBoundary,m=n.padding,O=n.tether,k=O===void 0?!0:O,E=n.tetherOffset,D=E===void 0?0:E,N=ve(e,{boundary:c,rootBoundary:p,padding:m,altBoundary:f}),v=kt(e.placement),x=te(e.placement),b=!x,g=Sn(v),_=Vr(g),y=e.modifiersData.popperOffsets,S=e.rects.reference,I=e.rects.popper,$=typeof D=="function"?D(Object.assign({},e.rects,{placement:e.placement})):D,F=typeof $=="number"?{mainAxis:$,altAxis:$}:Object.assign({mainAxis:0,altAxis:0},$),B=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,L={x:0,y:0};if(y){if(l){var P,U=g==="y"?dt:ht,Z=g==="y"?yt:bt,Y=g==="y"?"height":"width",o=y[g],a=o+N[U],h=o-N[Z],d=k?-I[Y]/2:0,w=x===Kt?S[Y]:I[Y],C=x===Kt?-I[Y]:-S[Y],T=e.elements.arrow,A=k&&T?On(T):{width:0,height:0},R=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Qi(),j=R[U],V=R[Z],W=he(0,S[Y],A[Y]),X=b?S[Y]/2-d-W-j-F.mainAxis:w-W-j-F.mainAxis,z=b?-S[Y]/2+d+W+V+F.mainAxis:C+W+V+F.mainAxis,et=e.elements.arrow&&we(e.elements.arrow),Q=et?g==="y"?et.clientTop||0:et.clientLeft||0:0,G=(P=B==null?void 0:B[g])!=null?P:0,ot=o+X-G-Q,it=o+z-G,ct=he(k?Fe(a,ot):a,o,k?Vt(h,it):h);y[g]=ct,L[g]=ct-o}if(s){var st,Et=g==="x"?dt:ht,ye=g==="x"?yt:bt,Ot=y[_],At=_==="y"?"height":"width",se=Ot+N[Et],Lt=Ot-N[ye],re=[dt,ht].indexOf(v)!==-1,be=(st=B==null?void 0:B[_])!=null?st:0,xe=re?se:Ot-S[At]-I[At]-be+F.altAxis,_e=re?Ot+S[At]+I[At]-be-F.altAxis:Lt,Te=k&&re?pr(xe,Ot,_e):he(k?xe:se,Ot,k?_e:Lt);y[_]=Te,L[_]=Te-Ot}e.modifiersData[i]=L}}const Ur={name:"preventOverflow",enabled:!0,phase:"main",fn:Wr,requiresIfExists:["offset"]};function zr(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function qr(t){return t===ft(t)||!wt(t)?An(t):zr(t)}function Xr(t){var e=t.getBoundingClientRect(),n=Zt(e.width)/t.offsetWidth||1,i=Zt(e.height)/t.offsetHeight||1;return n!==1||i!==1}function Yr(t,e,n){n===void 0&&(n=!1);var i=wt(e),r=wt(e)&&Xr(e),l=It(e),u=Qt(t,r,n),s={scrollLeft:0,scrollTop:0},c={x:0,y:0};return(i||!i&&!n)&&((Ct(e)!=="body"||Dn(l))&&(s=qr(e)),wt(e)?(c=Qt(e,!0),c.x+=e.clientLeft,c.y+=e.clientTop):l&&(c.x=Mn(l))),{x:u.left+s.scrollLeft-c.x,y:u.top+s.scrollTop-c.y,width:u.width,height:u.height}}function Jr(t){var e=new Map,n=new Set,i=[];t.forEach(function(l){e.set(l.name,l)});function r(l){n.add(l.name);var u=[].concat(l.requires||[],l.requiresIfExists||[]);u.forEach(function(s){if(!n.has(s)){var c=e.get(s);c&&r(c)}}),i.push(l)}return t.forEach(function(l){n.has(l.name)||r(l)}),i}function Gr(t){var e=Jr(t);return lr.reduce(function(n,i){return n.concat(e.filter(function(r){return r.phase===i}))},[])}function Kr(t){var e;return function(){return e||(e=new Promise(function(n){Promise.resolve().then(function(){e=void 0,n(t())})})),e}}function Zr(t){var e=t.reduce(function(n,i){var r=n[i.name];return n[i.name]=r?Object.assign({},r,i,{options:Object.assign({},r.options,i.options),data:Object.assign({},r.data,i.data)}):i,n},{});return Object.keys(e).map(function(n){return e[n]})}var hi={placement:"bottom",modifiers:[],strategy:"absolute"};function pi(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return!e.some(function(i){return!(i&&typeof i.getBoundingClientRect=="function")})}function Qr(t){t===void 0&&(t={});var e=t,n=e.defaultModifiers,i=n===void 0?[]:n,r=e.defaultOptions,l=r===void 0?hi:r;return function(s,c,p){p===void 0&&(p=l);var f={placement:"bottom",orderedModifiers:[],options:Object.assign({},hi,l),modifiersData:{},elements:{reference:s,popper:c},attributes:{},styles:{}},m=[],O=!1,k={state:f,setOptions:function(v){var x=typeof v=="function"?v(f.options):v;D(),f.options=Object.assign({},l,f.options,x),f.scrollParents={reference:Ut(s)?pe(s):s.contextElement?pe(s.contextElement):[],popper:pe(c)};var b=Gr(Zr([].concat(i,f.options.modifiers)));return f.orderedModifiers=b.filter(function(g){return g.enabled}),E(),k.update()},forceUpdate:function(){if(!O){var v=f.elements,x=v.reference,b=v.popper;if(pi(x,b)){f.rects={reference:Yr(x,we(b),f.options.strategy==="fixed"),popper:On(b)},f.reset=!1,f.placement=f.options.placement,f.orderedModifiers.forEach(function(F){return f.modifiersData[F.name]=Object.assign({},F.data)});for(var g=0;g<f.orderedModifiers.length;g++){if(f.reset===!0){f.reset=!1,g=-1;continue}var _=f.orderedModifiers[g],y=_.fn,S=_.options,I=S===void 0?{}:S,$=_.name;typeof y=="function"&&(f=y({state:f,options:I,name:$,instance:k})||f)}}}},update:Kr(function(){return new Promise(function(N){k.forceUpdate(),N(f)})}),destroy:function(){D(),O=!0}};if(!pi(s,c))return k;k.setOptions(p).then(function(N){!O&&p.onFirstUpdate&&p.onFirstUpdate(N)});function E(){f.orderedModifiers.forEach(function(N){var v=N.name,x=N.options,b=x===void 0?{}:x,g=N.effect;if(typeof g=="function"){var _=g({state:f,name:v,instance:k,options:b}),y=function(){};m.push(_||y)}})}function D(){m.forEach(function(N){return N()}),m=[]}return k}}var ta=[Tr,Hr,xr,Gi,Br,Lr,Ur,mr,Pr],ea=Qr({defaultModifiers:ta}),na="tippy-box",oo="tippy-content",ia="tippy-backdrop",so="tippy-arrow",ro="tippy-svg-arrow",Bt={passive:!0,capture:!0},ao=function(){return document.body};function en(t,e,n){if(Array.isArray(t)){var i=t[e];return i??(Array.isArray(n)?n[e]:n)}return t}function Nn(t,e){var n={}.toString.call(t);return n.indexOf("[object")===0&&n.indexOf(e+"]")>-1}function lo(t,e){return typeof t=="function"?t.apply(void 0,e):t}function fi(t,e){if(e===0)return t;var n;return function(i){clearTimeout(n),n=setTimeout(function(){t(i)},e)}}function oa(t){return t.split(/\s+/).filter(Boolean)}function Xt(t){return[].concat(t)}function gi(t,e){t.indexOf(e)===-1&&t.push(e)}function sa(t){return t.filter(function(e,n){return t.indexOf(e)===n})}function ra(t){return t.split("-")[0]}function Be(t){return[].slice.call(t)}function vi(t){return Object.keys(t).reduce(function(e,n){return t[n]!==void 0&&(e[n]=t[n]),e},{})}function fe(){return document.createElement("div")}function qe(t){return["Element","Fragment"].some(function(e){return Nn(t,e)})}function aa(t){return Nn(t,"NodeList")}function la(t){return Nn(t,"MouseEvent")}function ca(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function ua(t){return qe(t)?[t]:aa(t)?Be(t):Array.isArray(t)?t:Be(document.querySelectorAll(t))}function nn(t,e){t.forEach(function(n){n&&(n.style.transitionDuration=e+"ms")})}function mi(t,e){t.forEach(function(n){n&&n.setAttribute("data-state",e)})}function da(t){var e,n=Xt(t),i=n[0];return i!=null&&(e=i.ownerDocument)!=null&&e.body?i.ownerDocument:document}function ha(t,e){var n=e.clientX,i=e.clientY;return t.every(function(r){var l=r.popperRect,u=r.popperState,s=r.props,c=s.interactiveBorder,p=ra(u.placement),f=u.modifiersData.offset;if(!f)return!0;var m=p==="bottom"?f.top.y:0,O=p==="top"?f.bottom.y:0,k=p==="right"?f.left.x:0,E=p==="left"?f.right.x:0,D=l.top-i+m>c,N=i-l.bottom-O>c,v=l.left-n+k>c,x=n-l.right-E>c;return D||N||v||x})}function on(t,e,n){var i=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(r){t[i](r,n)})}function wi(t,e){for(var n=e;n;){var i;if(t.contains(n))return!0;n=n.getRootNode==null||(i=n.getRootNode())==null?void 0:i.host}return!1}var Tt={isTouch:!1},yi=0;function pa(){Tt.isTouch||(Tt.isTouch=!0,window.performance&&document.addEventListener("mousemove",co))}function co(){var t=performance.now();t-yi<20&&(Tt.isTouch=!1,document.removeEventListener("mousemove",co)),yi=t}function fa(){var t=document.activeElement;if(ca(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function ga(){document.addEventListener("touchstart",pa,Bt),window.addEventListener("blur",fa)}var va=typeof window<"u"&&typeof document<"u",ma=va?!!window.msCrypto:!1,wa={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},ya={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},xt=Object.assign({appendTo:ao,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},wa,ya),ba=Object.keys(xt),xa=function(e){var n=Object.keys(e);n.forEach(function(i){xt[i]=e[i]})};function uo(t){var e=t.plugins||[],n=e.reduce(function(i,r){var l=r.name,u=r.defaultValue;if(l){var s;i[l]=t[l]!==void 0?t[l]:(s=xt[l])!=null?s:u}return i},{});return Object.assign({},t,n)}function _a(t,e){var n=e?Object.keys(uo(Object.assign({},xt,{plugins:e}))):ba,i=n.reduce(function(r,l){var u=(t.getAttribute("data-tippy-"+l)||"").trim();if(!u)return r;if(l==="content")r[l]=u;else try{r[l]=JSON.parse(u)}catch{r[l]=u}return r},{});return i}function bi(t,e){var n=Object.assign({},e,{content:lo(e.content,[t])},e.ignoreAttributes?{}:_a(t,e.plugins));return n.aria=Object.assign({},xt.aria,n.aria),n.aria={expanded:n.aria.expanded==="auto"?e.interactive:n.aria.expanded,content:n.aria.content==="auto"?e.interactive?null:"describedby":n.aria.content},n}var Ta=function(){return"innerHTML"};function vn(t,e){t[Ta()]=e}function xi(t){var e=fe();return t===!0?e.className=so:(e.className=ro,qe(t)?e.appendChild(t):vn(e,t)),e}function _i(t,e){qe(e.content)?(vn(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?vn(t,e.content):t.textContent=e.content)}function mn(t){var e=t.firstElementChild,n=Be(e.children);return{box:e,content:n.find(function(i){return i.classList.contains(oo)}),arrow:n.find(function(i){return i.classList.contains(so)||i.classList.contains(ro)}),backdrop:n.find(function(i){return i.classList.contains(ia)})}}function ho(t){var e=fe(),n=fe();n.className=na,n.setAttribute("data-state","hidden"),n.setAttribute("tabindex","-1");var i=fe();i.className=oo,i.setAttribute("data-state","hidden"),_i(i,t.props),e.appendChild(n),n.appendChild(i),r(t.props,t.props);function r(l,u){var s=mn(e),c=s.box,p=s.content,f=s.arrow;u.theme?c.setAttribute("data-theme",u.theme):c.removeAttribute("data-theme"),typeof u.animation=="string"?c.setAttribute("data-animation",u.animation):c.removeAttribute("data-animation"),u.inertia?c.setAttribute("data-inertia",""):c.removeAttribute("data-inertia"),c.style.maxWidth=typeof u.maxWidth=="number"?u.maxWidth+"px":u.maxWidth,u.role?c.setAttribute("role",u.role):c.removeAttribute("role"),(l.content!==u.content||l.allowHTML!==u.allowHTML)&&_i(p,t.props),u.arrow?f?l.arrow!==u.arrow&&(c.removeChild(f),c.appendChild(xi(u.arrow))):c.appendChild(xi(u.arrow)):f&&c.removeChild(f)}return{popper:e,onUpdate:r}}ho.$$tippy=!0;var ka=1,Me=[],sn=[];function Ca(t,e){var n=bi(t,Object.assign({},xt,uo(vi(e)))),i,r,l,u=!1,s=!1,c=!1,p=!1,f,m,O,k=[],E=fi(ot,n.interactiveDebounce),D,N=ka++,v=null,x=sa(n.plugins),b={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},g={id:N,reference:t,popper:fe(),popperInstance:v,props:n,state:b,plugins:x,clearDelayTimeouts:xe,setProps:_e,setContent:Te,show:zo,hide:qo,hideWithInteractivity:Xo,enable:re,disable:be,unmount:Yo,destroy:Jo};if(!n.render)return g;var _=n.render(g),y=_.popper,S=_.onUpdate;y.setAttribute("data-tippy-root",""),y.id="tippy-"+g.id,g.popper=y,t._tippy=g,y._tippy=g;var I=x.map(function(M){return M.fn(g)}),$=t.hasAttribute("aria-expanded");return et(),d(),o(),a("onCreate",[g]),n.showOnCreate&&se(),y.addEventListener("mouseenter",function(){g.props.interactive&&g.state.isVisible&&g.clearDelayTimeouts()}),y.addEventListener("mouseleave",function(){g.props.interactive&&g.props.trigger.indexOf("mouseenter")>=0&&U().addEventListener("mousemove",E)}),g;function F(){var M=g.props.touch;return Array.isArray(M)?M:[M,0]}function B(){return F()[0]==="hold"}function L(){var M;return!!((M=g.props.render)!=null&&M.$$tippy)}function P(){return D||t}function U(){var M=P().parentNode;return M?da(M):document}function Z(){return mn(y)}function Y(M){return g.state.isMounted&&!g.state.isVisible||Tt.isTouch||f&&f.type==="focus"?0:en(g.props.delay,M?0:1,xt.delay)}function o(M){M===void 0&&(M=!1),y.style.pointerEvents=g.props.interactive&&!M?"":"none",y.style.zIndex=""+g.props.zIndex}function a(M,H,q){if(q===void 0&&(q=!0),I.forEach(function(K){K[M]&&K[M].apply(K,H)}),q){var tt;(tt=g.props)[M].apply(tt,H)}}function h(){var M=g.props.aria;if(M.content){var H="aria-"+M.content,q=y.id,tt=Xt(g.props.triggerTarget||t);tt.forEach(function(K){var ut=K.getAttribute(H);if(g.state.isVisible)K.setAttribute(H,ut?ut+" "+q:q);else{var gt=ut&&ut.replace(q,"").trim();gt?K.setAttribute(H,gt):K.removeAttribute(H)}})}}function d(){if(!($||!g.props.aria.expanded)){var M=Xt(g.props.triggerTarget||t);M.forEach(function(H){g.props.interactive?H.setAttribute("aria-expanded",g.state.isVisible&&H===P()?"true":"false"):H.removeAttribute("aria-expanded")})}}function w(){U().removeEventListener("mousemove",E),Me=Me.filter(function(M){return M!==E})}function C(M){if(!(Tt.isTouch&&(c||M.type==="mousedown"))){var H=M.composedPath&&M.composedPath()[0]||M.target;if(!(g.props.interactive&&wi(y,H))){if(Xt(g.props.triggerTarget||t).some(function(q){return wi(q,H)})){if(Tt.isTouch||g.state.isVisible&&g.props.trigger.indexOf("click")>=0)return}else a("onClickOutside",[g,M]);g.props.hideOnClick===!0&&(g.clearDelayTimeouts(),g.hide(),s=!0,setTimeout(function(){s=!1}),g.state.isMounted||j())}}}function T(){c=!0}function A(){c=!1}function R(){var M=U();M.addEventListener("mousedown",C,!0),M.addEventListener("touchend",C,Bt),M.addEventListener("touchstart",A,Bt),M.addEventListener("touchmove",T,Bt)}function j(){var M=U();M.removeEventListener("mousedown",C,!0),M.removeEventListener("touchend",C,Bt),M.removeEventListener("touchstart",A,Bt),M.removeEventListener("touchmove",T,Bt)}function V(M,H){X(M,function(){!g.state.isVisible&&y.parentNode&&y.parentNode.contains(y)&&H()})}function W(M,H){X(M,H)}function X(M,H){var q=Z().box;function tt(K){K.target===q&&(on(q,"remove",tt),H())}if(M===0)return H();on(q,"remove",m),on(q,"add",tt),m=tt}function z(M,H,q){q===void 0&&(q=!1);var tt=Xt(g.props.triggerTarget||t);tt.forEach(function(K){K.addEventListener(M,H,q),k.push({node:K,eventType:M,handler:H,options:q})})}function et(){B()&&(z("touchstart",G,{passive:!0}),z("touchend",it,{passive:!0})),oa(g.props.trigger).forEach(function(M){if(M!=="manual")switch(z(M,G),M){case"mouseenter":z("mouseleave",it);break;case"focus":z(ma?"focusout":"blur",ct);break;case"focusin":z("focusout",ct);break}})}function Q(){k.forEach(function(M){var H=M.node,q=M.eventType,tt=M.handler,K=M.options;H.removeEventListener(q,tt,K)}),k=[]}function G(M){var H,q=!1;if(!(!g.state.isEnabled||st(M)||s)){var tt=((H=f)==null?void 0:H.type)==="focus";f=M,D=M.currentTarget,d(),!g.state.isVisible&&la(M)&&Me.forEach(function(K){return K(M)}),M.type==="click"&&(g.props.trigger.indexOf("mouseenter")<0||u)&&g.props.hideOnClick!==!1&&g.state.isVisible?q=!0:se(M),M.type==="click"&&(u=!q),q&&!tt&&Lt(M)}}function ot(M){var H=M.target,q=P().contains(H)||y.contains(H);if(!(M.type==="mousemove"&&q)){var tt=At().concat(y).map(function(K){var ut,gt=K._tippy,zt=(ut=gt.popperInstance)==null?void 0:ut.state;return zt?{popperRect:K.getBoundingClientRect(),popperState:zt,props:n}:null}).filter(Boolean);ha(tt,M)&&(w(),Lt(M))}}function it(M){var H=st(M)||g.props.trigger.indexOf("click")>=0&&u;if(!H){if(g.props.interactive){g.hideWithInteractivity(M);return}Lt(M)}}function ct(M){g.props.trigger.indexOf("focusin")<0&&M.target!==P()||g.props.interactive&&M.relatedTarget&&y.contains(M.relatedTarget)||Lt(M)}function st(M){return Tt.isTouch?B()!==M.type.indexOf("touch")>=0:!1}function Et(){ye();var M=g.props,H=M.popperOptions,q=M.placement,tt=M.offset,K=M.getReferenceClientRect,ut=M.moveTransition,gt=L()?mn(y).arrow:null,zt=K?{getBoundingClientRect:K,contextElement:K.contextElement||P()}:t,zn={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(ke){var qt=ke.state;if(L()){var Go=Z(),Ze=Go.box;["placement","reference-hidden","escaped"].forEach(function(Ce){Ce==="placement"?Ze.setAttribute("data-placement",qt.placement):qt.attributes.popper["data-popper-"+Ce]?Ze.setAttribute("data-"+Ce,""):Ze.removeAttribute("data-"+Ce)}),qt.attributes.popper={}}}},Rt=[{name:"offset",options:{offset:tt}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!ut}},zn];L()&&gt&&Rt.push({name:"arrow",options:{element:gt,padding:3}}),Rt.push.apply(Rt,(H==null?void 0:H.modifiers)||[]),g.popperInstance=ea(zt,y,Object.assign({},H,{placement:q,onFirstUpdate:O,modifiers:Rt}))}function ye(){g.popperInstance&&(g.popperInstance.destroy(),g.popperInstance=null)}function Ot(){var M=g.props.appendTo,H,q=P();g.props.interactive&&M===ao||M==="parent"?H=q.parentNode:H=lo(M,[q]),H.contains(y)||H.appendChild(y),g.state.isMounted=!0,Et()}function At(){return Be(y.querySelectorAll("[data-tippy-root]"))}function se(M){g.clearDelayTimeouts(),M&&a("onTrigger",[g,M]),R();var H=Y(!0),q=F(),tt=q[0],K=q[1];Tt.isTouch&&tt==="hold"&&K&&(H=K),H?i=setTimeout(function(){g.show()},H):g.show()}function Lt(M){if(g.clearDelayTimeouts(),a("onUntrigger",[g,M]),!g.state.isVisible){j();return}if(!(g.props.trigger.indexOf("mouseenter")>=0&&g.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(M.type)>=0&&u)){var H=Y(!1);H?r=setTimeout(function(){g.state.isVisible&&g.hide()},H):l=requestAnimationFrame(function(){g.hide()})}}function re(){g.state.isEnabled=!0}function be(){g.hide(),g.state.isEnabled=!1}function xe(){clearTimeout(i),clearTimeout(r),cancelAnimationFrame(l)}function _e(M){if(!g.state.isDestroyed){a("onBeforeUpdate",[g,M]),Q();var H=g.props,q=bi(t,Object.assign({},H,vi(M),{ignoreAttributes:!0}));g.props=q,et(),H.interactiveDebounce!==q.interactiveDebounce&&(w(),E=fi(ot,q.interactiveDebounce)),H.triggerTarget&&!q.triggerTarget?Xt(H.triggerTarget).forEach(function(tt){tt.removeAttribute("aria-expanded")}):q.triggerTarget&&t.removeAttribute("aria-expanded"),d(),o(),S&&S(H,q),g.popperInstance&&(Et(),At().forEach(function(tt){requestAnimationFrame(tt._tippy.popperInstance.forceUpdate)})),a("onAfterUpdate",[g,M])}}function Te(M){g.setProps({content:M})}function zo(){var M=g.state.isVisible,H=g.state.isDestroyed,q=!g.state.isEnabled,tt=Tt.isTouch&&!g.props.touch,K=en(g.props.duration,0,xt.duration);if(!(M||H||q||tt)&&!P().hasAttribute("disabled")&&(a("onShow",[g],!1),g.props.onShow(g)!==!1)){if(g.state.isVisible=!0,L()&&(y.style.visibility="visible"),o(),R(),g.state.isMounted||(y.style.transition="none"),L()){var ut=Z(),gt=ut.box,zt=ut.content;nn([gt,zt],0)}O=function(){var Rt;if(!(!g.state.isVisible||p)){if(p=!0,y.offsetHeight,y.style.transition=g.props.moveTransition,L()&&g.props.animation){var Ke=Z(),ke=Ke.box,qt=Ke.content;nn([ke,qt],K),mi([ke,qt],"visible")}h(),d(),gi(sn,g),(Rt=g.popperInstance)==null||Rt.forceUpdate(),a("onMount",[g]),g.props.animation&&L()&&W(K,function(){g.state.isShown=!0,a("onShown",[g])})}},Ot()}}function qo(){var M=!g.state.isVisible,H=g.state.isDestroyed,q=!g.state.isEnabled,tt=en(g.props.duration,1,xt.duration);if(!(M||H||q)&&(a("onHide",[g],!1),g.props.onHide(g)!==!1)){if(g.state.isVisible=!1,g.state.isShown=!1,p=!1,u=!1,L()&&(y.style.visibility="hidden"),w(),j(),o(!0),L()){var K=Z(),ut=K.box,gt=K.content;g.props.animation&&(nn([ut,gt],tt),mi([ut,gt],"hidden"))}h(),d(),g.props.animation?L()&&V(tt,g.unmount):g.unmount()}}function Xo(M){U().addEventListener("mousemove",E),gi(Me,E),E(M)}function Yo(){g.state.isVisible&&g.hide(),g.state.isMounted&&(ye(),At().forEach(function(M){M._tippy.unmount()}),y.parentNode&&y.parentNode.removeChild(y),sn=sn.filter(function(M){return M!==g}),g.state.isMounted=!1,a("onHidden",[g]))}function Jo(){g.state.isDestroyed||(g.clearDelayTimeouts(),g.unmount(),Q(),delete t._tippy,g.state.isDestroyed=!0,a("onDestroy",[g]))}}function ee(t,e){e===void 0&&(e={});var n=xt.plugins.concat(e.plugins||[]);ga();var i=Object.assign({},e,{plugins:n}),r=ua(t),l=r.reduce(function(u,s){var c=s&&Ca(s,i);return c&&u.push(c),u},[]);return qe(t)?l[0]:l}ee.defaultProps=xt;ee.setDefaultProps=xa;ee.currentInput=Tt;Object.assign({},Gi,{effect:function(e){var n=e.state,i={popper:{position:n.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(n.elements.popper.style,i.popper),n.styles=i,n.elements.arrow&&Object.assign(n.elements.arrow.style,i.arrow)}});ee.setDefaultProps({render:ho});const Ea=function(){return{skip:1,atBeginning:!1,atEnd:!1,next(){this.to((t,e)=>t+e*this.skip)},prev(){this.to((t,e)=>t-e*this.skip)},to(t){const e=this.$refs.slider,n=e.scrollLeft,i=e.getBoundingClientRect().width;e.scrollTo({left:t(n,i),behavior:"smooth"})},focusableWhenVisible:{"x-intersect:enter"(){this.$el.removeAttribute("tabindex")},"x-intersect:leave"(){this.$el.setAttribute("tabindex","-1")}},disableNextAndPreviousButtons:{"x-intersect:enter.threshold.05"(){var e,n;if(!((n=(e=this.$el)==null?void 0:e.parentElement)!=null&&n.children)){this.atBeginning=!0,this.atEnd=!0;return}const t=this.$el.parentElement.children;t[0]===this.$el?this.atBeginning=!0:t[t.length-1]===this.$el&&(this.atEnd=!0)},"x-intersect:leave.threshold.05"(){var e,n;if(!((n=(e=this.$el)==null?void 0:e.parentElement)!=null&&n.children)){this.atBeginning=!0,this.atEnd=!0;return}const t=this.$el.parentElement.children;t[0]===this.$el?this.atBeginning=!1:t[t.length-1]===this.$el&&(this.atEnd=!1)}}}},Oa=function(){return{playlist:null,setPlaylist(t){this.playlist=t}}};function Sa(t){t.data("inputUtils",()=>({textareaAutoResize(e){e.style.height="auto",e.style.height=Math.min(e.scrollHeight,400)+"px"},scrollBottom(e){e.scrollTop=e.scrollHeight}})),t.data("gallery",()=>Ea()),t.data("audioPlayer",()=>Oa()),t.magic("tooltip",e=>n=>{const i=ee(e,{content:n,trigger:"manual"});i.show(),setTimeout(()=>{i.hide(),setTimeout(()=>i.destroy(),150)},2e3)}),t.directive("tooltip",(e,{value:n,expression:i},{evaluate:r})=>{let l=i;n==="reactive"&&(l=r(i)),ee(e,{content:un.sanitize(l,{ALLOWED_TAGS:[]})})})}const Aa=function(t){const e=window.client,n=window.client.chat.state,i=()=>new Intl.DateTimeFormat("en-US",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date),r=async v=>{const x=escapeHtmlSpecialChars(v),b=un.sanitize(x);return Xn.parse(b,{mangle:!1,headerIds:!1})},l=v=>{const x=/(?:[^\s"]+|"[^"]*")+/g,b=v.match(x),[g,..._]=b.map(y=>y.replace(/^"(.+(?="$))"$/,"$1"));return[g,_]},u=({message:v,sender:x,embeds:b,workflowId:g})=>{var _,y,S,I;if(b??(b={}),b.audio??(b.audio=[]),b.commands??(b.commands=[]),b.images??(b.images=[]),b.object??(b.object=[]),b.videos??(b.videos=[]),v||((_=b==null?void 0:b.images)==null?void 0:_.length)>0||((y=b==null?void 0:b.audio)==null?void 0:y.length)>0||((S=b==null?void 0:b.videos)==null?void 0:S.length)>0||b.object){v??(v="");const $=typeof v=="object"?"```  \n"+JSON.stringify(v,null,2)+"  \n```":v,F=Xn.parse($,{mangle:!1,headerIds:!1}),B={sender:x||"omni",text:F,whenText:i(),attachments:0,workflowId:g??((I=t.activeWorkflow)==null?void 0:I.id)};let L=0;return b&&(b.audio=b.audio.filter(P=>P.expires===Number.MAX_SAFE_INTEGER||P.expires>Date.now()),b.images=b.images.map(P=>(P.expires===Number.MAX_SAFE_INTEGER||P.expires>Date.now()||(P.url="/expired.png"),P)),b.audio&&b.audio.length>0&&(B.audio=b.audio,L+=b.audio.length),b.images&&b.images.length>0&&(B.images=b.images,L+=b.images.length),b.videos&&b.videos.length>0&&(B.videos=b.videos,L+=b.videos.length),b.commands&&b.commands.length>0&&(B.commands=b.commands,L+=b.commands.length),b.object&&b.object.length>0&&(B.objects=b.object,L+=b.object.length)),B.attachments=L,n.messages.push(B),B}else return console.warn("empty message",{message:v,sender:x}),null},s=(v,x)=>{},c=async({message:v,sender:x,embeds:b})=>{u({message:v,sender:x,embeds:b})!==null&&t!==null&&t.activeWorkflow!==null&&await e.chat.updateChatServer({message:v,sender:x,embeds:b},Date.now())},p=async()=>{let v=n.inputText.trim();if(n.inputText="",(v==null?void 0:v.length)>0){await c({message:v,sender:"me"}),v==="?"&&(v="/help");try{if(v[0]!=="/"&&v[0]!=="@"){if(!e.workbench.canExecute){window.client.sendSystemMessage("Please load a recipe first.","text/plain");return}v="@omni "+v}let x="console",b={input:v},g=!1;if(v[0]==="/"||v[0]==="@"){v.length<=1&&(v="/help");const[y,S]=l(v);if(x=y.substring(1).replace(/[\W_]+/g,""),b=S||[],v[0]==="@"){const I=x;x="run",b=b.join(" "),b=[I,b],g=!0}}console.log("script",x,"args",b);let _;if(x==="run"){const[y,S]=b;let I=S.length?{text:S}:void 0;if(g)if(S.length>0)_=await t.executeByName(y,I);else{if(n.messages.length>2){I={};const $=n.messages[n.messages.length-2];I={text:$.text||$.html,images:$.images,audio:$.audio}}_=await t.executeByName(y,I)}else{const $=JSON.parse(y);_=await t.executeById($.id,I)}}else _=await window.client.runScript(x,b,{fromChatWindow:!0});if(console.log(JSON.stringify(_)),!_)return;if(_!=null&&_.error)throw _.error;_.response&&!_.hide&&await c({message:_.response,sender:_.sender||"omni",embeds:_.embeds})}catch(x){typeof x=="object"?x=x.message??JSON.stringify(x,null,2):console.error(x),await c({message:'<div class="w-full text-red-500font-semibold">❌ Error</div><div>'+x+"</div>",sender:"omni"})}}};let f=!1;const m=()=>{f=!0},O=()=>{f=!1},k=async v=>{n.messages.length=0;const x=`/api/v1/chat/${e.chat.activeContextId}`,g=(await Jt.get(x,{withCredentials:!0})).data.result.result;for(let _=0;_<g.length;++_){const y=g[_];if(y.version===0)switch(qn.GetMessageStorageType(y.msgstore)){case Qe.User:u(y.msgstore);break;case Qe.Omni:e.chat._onChatMessage(y.msgstore);break;case Qe.AsyncJob:{const S={sender:"omni",text:y.msgstore.message,whenText:y.msgstore.ts,attachments:0,flags:new Set,workflowId:y.msgstore.workflowId};n.messages.push(S);break}}}t!==null&&!t.canEdit&&t.activeWorkflow&&e.sendSystemMessage("ℹ️  This recipe is a **read-only** template. Use the remix button below to create a copy you can edit freely.",void 0,{commands:[{title:"Remix Recipe",id:"clone",args:[],classes:["btn btn-secondary"]}]})};e.subscribeToGlobalEvent("workbench_workflow_loaded",async v=>{await k()}),e.registerClientScript("clear",async function(v){return n.messages.length=0,await e.chat.clearChat(),{response:"Chat history cleared."}}),e.subscribeToGlobalEvent("sse_message",async v=>{if(v.type==="chat_message"){await c(v);return}v.type==="error"&&await c({message:"<div class='w-full'><span class='text-red-500 font-bold'>Error!</span> "+(v.componentKey?`A block returned an error with <span class='font-mono'>componentKey:&nbsp;"`+v.componentKey+'"</span>':"A block with a missing componentKey returned an error.")+"</div><div>Details: <pre class='font-mono' style='white-space: pre-wrap;'>"+N(v.error)+"</pre></div>"})});const E=window.SpeechRecognition||window.webkitSpeechRecognition;E?(n.recognition=new E,n.recognition.continuous=!0,n.recognition.interimResults=!0,n.recognition.lang="en-US",n.recognition.onresult=v=>{let x="";for(let b=v.resultIndex;b<v.results.length;++b)v.results[b].isFinal||(x+=v.results[b][0].transcript);x&&(n.inputText=x)},n.recognitionAvailable=!0):console.log("Speech recognition is not supported in this browser. Please try using Google Chrome.");const D=function(v){const x=document.createElement("div");return x.innerHTML=v,x.innerText.trim()},N=function(v){let x=v;if(typeof v=="string")try{x=JSON.parse(v)}catch{}else typeof v=="object"&&(x=v);return JSON.stringify(x,null,2)};return{isDraggingOver:!1,openCameraModal:!1,loadCameraModal:!1,streaming:!1,state:n,workbench:t,onChatMessage:c,onAsyncJobStatusEffectHandler:s,sendMessage:p,handleCompositionStart:m,handleCompositionEnd:O,renderMarkdown:r,ChatUtils:qn,onClickCopy(v){const x=un.sanitize(D(v.text));navigator.clipboard.writeText(x).then(function(){},function(g){console.error("Could not copy text: ",g)}),this.copyNotification=!0;const b=this;setTimeout(function(){b.copyNotification=!1},3e3)},async startMicrophoneInput(){n.recognition&&(n.recognition.start(),n.recognitionRecording=!0)},async stopMicrophoneInput(){n.recognition&&(n.recognitionRecording=!1,n.recognition.stop())},showViewerExtension(v){var x;v.fileType==="document"||v.mimeType==="application/pdf"||(x=v.mimeType)!=null&&x.startsWith("text/")?v.mimeType==="application/pdf"?t.showExtension("omni-core-viewers",{file:v},"pdf",{winbox:{title:v.fileName}}):t.showExtension("omni-core-viewers",{file:v},"markdown",{winbox:{title:v.fileName}}):v.fileType==="image"||v.mimeType.startsWith("image")?t.showExtension("omni-core-filemanager",{focusedObject:v},void 0,{winbox:{title:v.fileName}}):(v.fileType==="audio"||v.mimeType.startsWith("audio")||v.mimeType==="application/ogg")&&t.showExtension("omni-core-filemanager",{focusedObject:v},void 0,{winbox:{title:v.fileName}})},async startCamera(){console.log("startCamera"),this.loadCameraModal=!0;const v=document.getElementById("video"),x=await navigator.mediaDevices.getUserMedia({video:!0});v.srcObject=x,await new Promise(b=>{v.onloadedmetadata=b}),v.play(),this.loadCameraModal=!1,this.openCameraModal=!0,this.streaming=!0},takePhoto(){const v=document.getElementById("video"),x=document.getElementById("canvas"),b=x.getContext("2d"),g=Math.min(v.videoWidth,v.videoHeight),_=(v.videoWidth-g)/2,y=(v.videoHeight-g)/2;b.drawImage(v,_,y,g,g,0,0,x.width,x.height),x.toBlob(async S=>{var F;const I=new File([S],"photo.jpg",{type:"image/jpeg",lastModified:Date.now()}),$=await this.uploadFiles([I]);e.clipboard??(e.clipboard={}),(F=e.clipboard).images??(F.images=[]),e.clipboard.images=e.clipboard.images.concat($),e.sdkHost.sendChatMessage("Files uploaded: "+$.length,"text/plain",{images:$}),this.stopCamera()},"image/jpeg")},stopCamera(){const v=document.getElementById("video");v==null||v.srcObject.getTracks().forEach(x=>x.stop()),this.streaming=!1,this.openCameraModal=!1},async resendMessage(v){n.inputText=D(v.text),await this.sendMessage()},chatDragOver(){this.isDraggingOver=!0},chatDragLeave(){this.isDraggingOver=!1},async chatHandlePaste(v){const x=(v.clipboardData||v.originalEvent.clipboardData).items;x[0].kind==="string"||x[0].kind==="number"||await this.genericFileUpload(Array.from(x).filter(b=>b.kind==="file").map(b=>b.getAsFile()))},async chatEnterKeydown(v){v.shiftKey||!v.shiftKey&&!f&&(v.preventDefault(),v.target.value.trim()!==""&&(v.target.blur(),await p(),v.target.focus()))},async chatDrop(v){var x,b;this.isDraggingOver=!1,await this.genericFileUpload(((x=v==null?void 0:v.dataTransfer)==null?void 0:x.files)||((b=v==null?void 0:v.target)==null?void 0:b.files),v)},async onUploadFileChange(v){var x,b;await this.genericFileUpload(((x=v==null?void 0:v.dataTransfer)==null?void 0:x.files)||((b=v==null?void 0:v.target)==null?void 0:b.files),v)},async genericFileUpload(v,x){var F,B,L,P;await c({message:"Uploading files...",sender:"omni"});const b=await this.uploadFiles(v),g=b.filter(U=>U.fileType===Ee.audio),_=b.filter(U=>U.fileType===Ee.image),y=b.filter(U=>U.fileType===Ee.video),S=b.filter(U=>U.fileType===Ee.document);e.clipboard??(e.clipboard={}),(F=e.clipboard).images??(F.images=[]),(B=e.clipboard).audio??(B.audio=[]),(L=e.clipboard).video??(L.video=[]),(P=e.clipboard).documents??(P.documents=[]),e.clipboard.audio=e.clipboard.audio.concat(g),e.clipboard.images=e.clipboard.images.concat(_),e.clipboard.documents=e.clipboard.documents.concat(S),e.clipboard.videos=e.clipboard.video.concat(y);let I="Files uploaded: "+b.length;if(b.length>0)for(let U=0;U<b.length;U++)I+=`
`+b[U].url;const $=[...e.clipboard.images,...e.clipboard.videos,...e.clipboard.documents,...e.clipboard.audio].filter(U=>U);e.sdkHost.sendChatMessage(I,"text/markdown",{audio:g,images:_,documents:S,commands:[{id:"run",title:"Run",args:[null,$]}]},["no-picture"]),x.target&&(x.target.value="")},async fileToDataUrl(v){return await new Promise(function(x,b){const g=new FileReader;g.onload=_=>{x(_.target.result)},g.readAsDataURL(v)})},async uploadFiles(v){if((v==null?void 0:v.length)>0){let x=await Promise.all(Array.from(v).map(async b=>{const g=new FormData;g.append("file",b,b.name||Date.now().toString()),this.imageUrl=await this.fileToDataUrl(b);const _=await Jt.post("/fid",g,{responseType:"json",headers:{"content-type":"multipart/form-data"}});return _.data&&_.data.length>0&&_.data[0].ticket&&_.data[0].fid?_.data[0]:(console.warn("Failed to upload file",{result:_,file:b}),null)}));return x=x.filter(b=>b),x}return[]}}};var wn=Math.PI,yn=2*wn,jt=1e-6,Ma=yn-jt;function bn(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function oe(){return new bn}bn.prototype=oe.prototype={constructor:bn,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,i){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(t,e,n,i,r,l){this._+="C"+ +t+","+ +e+","+ +n+","+ +i+","+(this._x1=+r)+","+(this._y1=+l)},arcTo:function(t,e,n,i,r){t=+t,e=+e,n=+n,i=+i,r=+r;var l=this._x1,u=this._y1,s=n-t,c=i-e,p=l-t,f=u-e,m=p*p+f*f;if(r<0)throw new Error("negative radius: "+r);if(this._x1===null)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(m>jt)if(!(Math.abs(f*s-c*p)>jt)||!r)this._+="L"+(this._x1=t)+","+(this._y1=e);else{var O=n-l,k=i-u,E=s*s+c*c,D=O*O+k*k,N=Math.sqrt(E),v=Math.sqrt(m),x=r*Math.tan((wn-Math.acos((E+m-D)/(2*N*v)))/2),b=x/v,g=x/N;Math.abs(b-1)>jt&&(this._+="L"+(t+b*p)+","+(e+b*f)),this._+="A"+r+","+r+",0,0,"+ +(f*O>p*k)+","+(this._x1=t+g*s)+","+(this._y1=e+g*c)}},arc:function(t,e,n,i,r,l){t=+t,e=+e,n=+n,l=!!l;var u=n*Math.cos(i),s=n*Math.sin(i),c=t+u,p=e+s,f=1^l,m=l?i-r:r-i;if(n<0)throw new Error("negative radius: "+n);this._x1===null?this._+="M"+c+","+p:(Math.abs(this._x1-c)>jt||Math.abs(this._y1-p)>jt)&&(this._+="L"+c+","+p),n&&(m<0&&(m=m%yn+yn),m>Ma?this._+="A"+n+","+n+",0,1,"+f+","+(t-u)+","+(e-s)+"A"+n+","+n+",0,1,"+f+","+(this._x1=c)+","+(this._y1=p):m>jt&&(this._+="A"+n+","+n+",0,"+ +(m>=wn)+","+f+","+(this._x1=t+n*Math.cos(r))+","+(this._y1=e+n*Math.sin(r))))},rect:function(t,e,n,i){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}};function J(t){return function(){return t}}var Ti=Math.abs,rt=Math.atan2,Pt=Math.cos,Da=Math.max,rn=Math.min,_t=Math.sin,Yt=Math.sqrt,at=1e-12,Dt=Math.PI,je=Dt/2,Mt=2*Dt;function Na(t){return t>1?0:t<-1?Dt:Math.acos(t)}function ki(t){return t>=1?je:t<=-1?-je:Math.asin(t)}function Ia(t){return t.innerRadius}function La(t){return t.outerRadius}function Ra(t){return t.startAngle}function Pa(t){return t.endAngle}function $a(t){return t&&t.padAngle}function Fa(t,e,n,i,r,l,u,s){var c=n-t,p=i-e,f=u-r,m=s-l,O=m*c-f*p;if(!(O*O<at))return O=(f*(e-l)-m*(t-r))/O,[t+O*c,e+O*p]}function De(t,e,n,i,r,l,u){var s=t-n,c=e-i,p=(u?l:-l)/Yt(s*s+c*c),f=p*c,m=-p*s,O=t+f,k=e+m,E=n+f,D=i+m,N=(O+E)/2,v=(k+D)/2,x=E-O,b=D-k,g=x*x+b*b,_=r-l,y=O*D-E*k,S=(b<0?-1:1)*Yt(Da(0,_*_*g-y*y)),I=(y*b-x*S)/g,$=(-y*x-b*S)/g,F=(y*b+x*S)/g,B=(-y*x+b*S)/g,L=I-N,P=$-v,U=F-N,Z=B-v;return L*L+P*P>U*U+Z*Z&&(I=F,$=B),{cx:I,cy:$,x01:-f,y01:-m,x11:I*(r/_-1),y11:$*(r/_-1)}}function Ba(){var t=Ia,e=La,n=J(0),i=null,r=Ra,l=Pa,u=$a,s=null;function c(){var p,f,m=+t.apply(this,arguments),O=+e.apply(this,arguments),k=r.apply(this,arguments)-je,E=l.apply(this,arguments)-je,D=Ti(E-k),N=E>k;if(s||(s=p=oe()),O<m&&(f=O,O=m,m=f),!(O>at))s.moveTo(0,0);else if(D>Mt-at)s.moveTo(O*Pt(k),O*_t(k)),s.arc(0,0,O,k,E,!N),m>at&&(s.moveTo(m*Pt(E),m*_t(E)),s.arc(0,0,m,E,k,N));else{var v=k,x=E,b=k,g=E,_=D,y=D,S=u.apply(this,arguments)/2,I=S>at&&(i?+i.apply(this,arguments):Yt(m*m+O*O)),$=rn(Ti(O-m)/2,+n.apply(this,arguments)),F=$,B=$,L,P;if(I>at){var U=ki(I/m*_t(S)),Z=ki(I/O*_t(S));(_-=U*2)>at?(U*=N?1:-1,b+=U,g-=U):(_=0,b=g=(k+E)/2),(y-=Z*2)>at?(Z*=N?1:-1,v+=Z,x-=Z):(y=0,v=x=(k+E)/2)}var Y=O*Pt(v),o=O*_t(v),a=m*Pt(g),h=m*_t(g);if($>at){var d=O*Pt(x),w=O*_t(x),C=m*Pt(b),T=m*_t(b),A;if(D<Dt&&(A=Fa(Y,o,C,T,d,w,a,h))){var R=Y-A[0],j=o-A[1],V=d-A[0],W=w-A[1],X=1/_t(Na((R*V+j*W)/(Yt(R*R+j*j)*Yt(V*V+W*W)))/2),z=Yt(A[0]*A[0]+A[1]*A[1]);F=rn($,(m-z)/(X-1)),B=rn($,(O-z)/(X+1))}}y>at?B>at?(L=De(C,T,Y,o,O,B,N),P=De(d,w,a,h,O,B,N),s.moveTo(L.cx+L.x01,L.cy+L.y01),B<$?s.arc(L.cx,L.cy,B,rt(L.y01,L.x01),rt(P.y01,P.x01),!N):(s.arc(L.cx,L.cy,B,rt(L.y01,L.x01),rt(L.y11,L.x11),!N),s.arc(0,0,O,rt(L.cy+L.y11,L.cx+L.x11),rt(P.cy+P.y11,P.cx+P.x11),!N),s.arc(P.cx,P.cy,B,rt(P.y11,P.x11),rt(P.y01,P.x01),!N))):(s.moveTo(Y,o),s.arc(0,0,O,v,x,!N)):s.moveTo(Y,o),!(m>at)||!(_>at)?s.lineTo(a,h):F>at?(L=De(a,h,d,w,m,-F,N),P=De(Y,o,C,T,m,-F,N),s.lineTo(L.cx+L.x01,L.cy+L.y01),F<$?s.arc(L.cx,L.cy,F,rt(L.y01,L.x01),rt(P.y01,P.x01),!N):(s.arc(L.cx,L.cy,F,rt(L.y01,L.x01),rt(L.y11,L.x11),!N),s.arc(0,0,m,rt(L.cy+L.y11,L.cx+L.x11),rt(P.cy+P.y11,P.cx+P.x11),N),s.arc(P.cx,P.cy,F,rt(P.y11,P.x11),rt(P.y01,P.x01),!N))):s.arc(0,0,m,g,b,N)}if(s.closePath(),p)return s=null,p+""||null}return c.centroid=function(){var p=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,f=(+r.apply(this,arguments)+ +l.apply(this,arguments))/2-Dt/2;return[Pt(f)*p,_t(f)*p]},c.innerRadius=function(p){return arguments.length?(t=typeof p=="function"?p:J(+p),c):t},c.outerRadius=function(p){return arguments.length?(e=typeof p=="function"?p:J(+p),c):e},c.cornerRadius=function(p){return arguments.length?(n=typeof p=="function"?p:J(+p),c):n},c.padRadius=function(p){return arguments.length?(i=p==null?null:typeof p=="function"?p:J(+p),c):i},c.startAngle=function(p){return arguments.length?(r=typeof p=="function"?p:J(+p),c):r},c.endAngle=function(p){return arguments.length?(l=typeof p=="function"?p:J(+p),c):l},c.padAngle=function(p){return arguments.length?(u=typeof p=="function"?p:J(+p),c):u},c.context=function(p){return arguments.length?(s=p??null,c):s},c}function po(t){this._context=t}po.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e);break}}};function Xe(t){return new po(t)}function In(t){return t[0]}function Ln(t){return t[1]}function Ye(){var t=In,e=Ln,n=J(!0),i=null,r=Xe,l=null;function u(s){var c,p=s.length,f,m=!1,O;for(i==null&&(l=r(O=oe())),c=0;c<=p;++c)!(c<p&&n(f=s[c],c,s))===m&&((m=!m)?l.lineStart():l.lineEnd()),m&&l.point(+t(f,c,s),+e(f,c,s));if(O)return l=null,O+""||null}return u.x=function(s){return arguments.length?(t=typeof s=="function"?s:J(+s),u):t},u.y=function(s){return arguments.length?(e=typeof s=="function"?s:J(+s),u):e},u.defined=function(s){return arguments.length?(n=typeof s=="function"?s:J(!!s),u):n},u.curve=function(s){return arguments.length?(r=s,i!=null&&(l=r(i)),u):r},u.context=function(s){return arguments.length?(s==null?i=l=null:l=r(i=s),u):i},u}function fo(){var t=In,e=null,n=J(0),i=Ln,r=J(!0),l=null,u=Xe,s=null;function c(f){var m,O,k,E=f.length,D,N=!1,v,x=new Array(E),b=new Array(E);for(l==null&&(s=u(v=oe())),m=0;m<=E;++m){if(!(m<E&&r(D=f[m],m,f))===N)if(N=!N)O=m,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),k=m-1;k>=O;--k)s.point(x[k],b[k]);s.lineEnd(),s.areaEnd()}N&&(x[m]=+t(D,m,f),b[m]=+n(D,m,f),s.point(e?+e(D,m,f):x[m],i?+i(D,m,f):b[m]))}if(v)return s=null,v+""||null}function p(){return Ye().defined(r).curve(u).context(l)}return c.x=function(f){return arguments.length?(t=typeof f=="function"?f:J(+f),e=null,c):t},c.x0=function(f){return arguments.length?(t=typeof f=="function"?f:J(+f),c):t},c.x1=function(f){return arguments.length?(e=f==null?null:typeof f=="function"?f:J(+f),c):e},c.y=function(f){return arguments.length?(n=typeof f=="function"?f:J(+f),i=null,c):n},c.y0=function(f){return arguments.length?(n=typeof f=="function"?f:J(+f),c):n},c.y1=function(f){return arguments.length?(i=f==null?null:typeof f=="function"?f:J(+f),c):i},c.lineX0=c.lineY0=function(){return p().x(t).y(n)},c.lineY1=function(){return p().x(t).y(i)},c.lineX1=function(){return p().x(e).y(n)},c.defined=function(f){return arguments.length?(r=typeof f=="function"?f:J(!!f),c):r},c.curve=function(f){return arguments.length?(u=f,l!=null&&(s=u(l)),c):u},c.context=function(f){return arguments.length?(f==null?l=s=null:s=u(l=f),c):l},c}function ja(t,e){return e<t?-1:e>t?1:e>=t?0:NaN}function Ha(t){return t}function Va(){var t=Ha,e=ja,n=null,i=J(0),r=J(Mt),l=J(0);function u(s){var c,p=s.length,f,m,O=0,k=new Array(p),E=new Array(p),D=+i.apply(this,arguments),N=Math.min(Mt,Math.max(-Mt,r.apply(this,arguments)-D)),v,x=Math.min(Math.abs(N)/p,l.apply(this,arguments)),b=x*(N<0?-1:1),g;for(c=0;c<p;++c)(g=E[k[c]=c]=+t(s[c],c,s))>0&&(O+=g);for(e!=null?k.sort(function(_,y){return e(E[_],E[y])}):n!=null&&k.sort(function(_,y){return n(s[_],s[y])}),c=0,m=O?(N-p*b)/O:0;c<p;++c,D=v)f=k[c],g=E[f],v=D+(g>0?g*m:0)+b,E[f]={data:s[f],index:c,value:g,startAngle:D,endAngle:v,padAngle:x};return E}return u.value=function(s){return arguments.length?(t=typeof s=="function"?s:J(+s),u):t},u.sortValues=function(s){return arguments.length?(e=s,n=null,u):e},u.sort=function(s){return arguments.length?(n=s,e=null,u):n},u.startAngle=function(s){return arguments.length?(i=typeof s=="function"?s:J(+s),u):i},u.endAngle=function(s){return arguments.length?(r=typeof s=="function"?s:J(+s),u):r},u.padAngle=function(s){return arguments.length?(l=typeof s=="function"?s:J(+s),u):l},u}var go=Rn(Xe);function vo(t){this._curve=t}vo.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(t,e){this._curve.point(e*Math.sin(t),e*-Math.cos(t))}};function Rn(t){function e(n){return new vo(t(n))}return e._curve=t,e}function ue(t){var e=t.curve;return t.angle=t.x,delete t.x,t.radius=t.y,delete t.y,t.curve=function(n){return arguments.length?e(Rn(n)):e()._curve},t}function Ci(){return ue(Ye().curve(go))}function Ei(){var t=fo().curve(go),e=t.curve,n=t.lineX0,i=t.lineX1,r=t.lineY0,l=t.lineY1;return t.angle=t.x,delete t.x,t.startAngle=t.x0,delete t.x0,t.endAngle=t.x1,delete t.x1,t.radius=t.y,delete t.y,t.innerRadius=t.y0,delete t.y0,t.outerRadius=t.y1,delete t.y1,t.lineStartAngle=function(){return ue(n())},delete t.lineX0,t.lineEndAngle=function(){return ue(i())},delete t.lineX1,t.lineInnerRadius=function(){return ue(r())},delete t.lineY0,t.lineOuterRadius=function(){return ue(l())},delete t.lineY1,t.curve=function(u){return arguments.length?e(Rn(u)):e()._curve},t}function de(t,e){return[(e=+e)*Math.cos(t-=Math.PI/2),e*Math.sin(t)]}var xn=Array.prototype.slice;function Wa(t){return t.source}function Ua(t){return t.target}function Pn(t){var e=Wa,n=Ua,i=In,r=Ln,l=null;function u(){var s,c=xn.call(arguments),p=e.apply(this,c),f=n.apply(this,c);if(l||(l=s=oe()),t(l,+i.apply(this,(c[0]=p,c)),+r.apply(this,c),+i.apply(this,(c[0]=f,c)),+r.apply(this,c)),s)return l=null,s+""||null}return u.source=function(s){return arguments.length?(e=s,u):e},u.target=function(s){return arguments.length?(n=s,u):n},u.x=function(s){return arguments.length?(i=typeof s=="function"?s:J(+s),u):i},u.y=function(s){return arguments.length?(r=typeof s=="function"?s:J(+s),u):r},u.context=function(s){return arguments.length?(l=s??null,u):l},u}function za(t,e,n,i,r){t.moveTo(e,n),t.bezierCurveTo(e=(e+i)/2,n,e,r,i,r)}function qa(t,e,n,i,r){t.moveTo(e,n),t.bezierCurveTo(e,n=(n+r)/2,i,n,i,r)}function Xa(t,e,n,i,r){var l=de(e,n),u=de(e,n=(n+r)/2),s=de(i,n),c=de(i,r);t.moveTo(l[0],l[1]),t.bezierCurveTo(u[0],u[1],s[0],s[1],c[0],c[1])}function Ya(){return Pn(za)}function Ja(){return Pn(qa)}function Ga(){var t=Pn(Xa);return t.angle=t.x,delete t.x,t.radius=t.y,delete t.y,t}const $n={draw:function(t,e){var n=Math.sqrt(e/Dt);t.moveTo(n,0),t.arc(0,0,n,0,Mt)}},mo={draw:function(t,e){var n=Math.sqrt(e/5)/2;t.moveTo(-3*n,-n),t.lineTo(-n,-n),t.lineTo(-n,-3*n),t.lineTo(n,-3*n),t.lineTo(n,-n),t.lineTo(3*n,-n),t.lineTo(3*n,n),t.lineTo(n,n),t.lineTo(n,3*n),t.lineTo(-n,3*n),t.lineTo(-n,n),t.lineTo(-3*n,n),t.closePath()}};var wo=Math.sqrt(1/3),Ka=wo*2;const yo={draw:function(t,e){var n=Math.sqrt(e/Ka),i=n*wo;t.moveTo(0,-n),t.lineTo(i,0),t.lineTo(0,n),t.lineTo(-i,0),t.closePath()}};var Za=.8908130915292852,bo=Math.sin(Dt/10)/Math.sin(7*Dt/10),Qa=Math.sin(Mt/10)*bo,tl=-Math.cos(Mt/10)*bo;const xo={draw:function(t,e){var n=Math.sqrt(e*Za),i=Qa*n,r=tl*n;t.moveTo(0,-n),t.lineTo(i,r);for(var l=1;l<5;++l){var u=Mt*l/5,s=Math.cos(u),c=Math.sin(u);t.lineTo(c*n,-s*n),t.lineTo(s*i-c*r,c*i+s*r)}t.closePath()}},_o={draw:function(t,e){var n=Math.sqrt(e),i=-n/2;t.rect(i,i,n,n)}};var an=Math.sqrt(3);const To={draw:function(t,e){var n=-Math.sqrt(e/(an*3));t.moveTo(0,n*2),t.lineTo(-an*n,-n),t.lineTo(an*n,-n),t.closePath()}};var vt=-.5,mt=Math.sqrt(3)/2,_n=1/Math.sqrt(12),el=(_n/2+1)*3;const ko={draw:function(t,e){var n=Math.sqrt(e/el),i=n/2,r=n*_n,l=i,u=n*_n+n,s=-l,c=u;t.moveTo(i,r),t.lineTo(l,u),t.lineTo(s,c),t.lineTo(vt*i-mt*r,mt*i+vt*r),t.lineTo(vt*l-mt*u,mt*l+vt*u),t.lineTo(vt*s-mt*c,mt*s+vt*c),t.lineTo(vt*i+mt*r,vt*r-mt*i),t.lineTo(vt*l+mt*u,vt*u-mt*l),t.lineTo(vt*s+mt*c,vt*c-mt*s),t.closePath()}};var nl=[$n,mo,yo,_o,xo,To,ko];function il(){var t=J($n),e=J(64),n=null;function i(){var r;if(n||(n=r=oe()),t.apply(this,arguments).draw(n,+e.apply(this,arguments)),r)return n=null,r+""||null}return i.type=function(r){return arguments.length?(t=typeof r=="function"?r:J(r),i):t},i.size=function(r){return arguments.length?(e=typeof r=="function"?r:J(+r),i):e},i.context=function(r){return arguments.length?(n=r??null,i):n},i}function Nt(){}function He(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function Je(t){this._context=t}Je.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:He(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:He(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function Co(t){return new Je(t)}function Eo(t){this._context=t}Eo.prototype={areaStart:Nt,areaEnd:Nt,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:He(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function ol(t){return new Eo(t)}function Oo(t){this._context=t}Oo.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+t)/6,i=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 3:this._point=4;default:He(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function sl(t){return new Oo(t)}function So(t,e){this._basis=new Je(t),this._beta=e}So.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,n=t.length-1;if(n>0)for(var i=t[0],r=e[0],l=t[n]-i,u=e[n]-r,s=-1,c;++s<=n;)c=s/n,this._basis.point(this._beta*t[s]+(1-this._beta)*(i+c*l),this._beta*e[s]+(1-this._beta)*(r+c*u));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}};const rl=function t(e){function n(i){return e===1?new Je(i):new So(i,e)}return n.beta=function(i){return t(+i)},n}(.85);function Ve(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function Fn(t,e){this._context=t,this._k=(1-e)/6}Fn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Ve(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:Ve(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const al=function t(e){function n(i){return new Fn(i,e)}return n.tension=function(i){return t(+i)},n}(0);function Bn(t,e){this._context=t,this._k=(1-e)/6}Bn.prototype={areaStart:Nt,areaEnd:Nt,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:Ve(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const ll=function t(e){function n(i){return new Bn(i,e)}return n.tension=function(i){return t(+i)},n}(0);function jn(t,e){this._context=t,this._k=(1-e)/6}jn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Ve(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const cl=function t(e){function n(i){return new jn(i,e)}return n.tension=function(i){return t(+i)},n}(0);function Hn(t,e,n){var i=t._x1,r=t._y1,l=t._x2,u=t._y2;if(t._l01_a>at){var s=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,c=3*t._l01_a*(t._l01_a+t._l12_a);i=(i*s-t._x0*t._l12_2a+t._x2*t._l01_2a)/c,r=(r*s-t._y0*t._l12_2a+t._y2*t._l01_2a)/c}if(t._l23_a>at){var p=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,f=3*t._l23_a*(t._l23_a+t._l12_a);l=(l*p+t._x1*t._l23_2a-e*t._l12_2a)/f,u=(u*p+t._y1*t._l23_2a-n*t._l12_2a)/f}t._context.bezierCurveTo(i,r,l,u,t._x2,t._y2)}function Ao(t,e){this._context=t,this._alpha=e}Ao.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:Hn(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const ul=function t(e){function n(i){return e?new Ao(i,e):new Fn(i,0)}return n.alpha=function(i){return t(+i)},n}(.5);function Mo(t,e){this._context=t,this._alpha=e}Mo.prototype={areaStart:Nt,areaEnd:Nt,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:Hn(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const dl=function t(e){function n(i){return e?new Mo(i,e):new Bn(i,0)}return n.alpha=function(i){return t(+i)},n}(.5);function Do(t,e){this._context=t,this._alpha=e}Do.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Hn(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const hl=function t(e){function n(i){return e?new Do(i,e):new jn(i,0)}return n.alpha=function(i){return t(+i)},n}(.5);function No(t){this._context=t}No.prototype={areaStart:Nt,areaEnd:Nt,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}};function pl(t){return new No(t)}function Oi(t){return t<0?-1:1}function Si(t,e,n){var i=t._x1-t._x0,r=e-t._x1,l=(t._y1-t._y0)/(i||r<0&&-0),u=(n-t._y1)/(r||i<0&&-0),s=(l*r+u*i)/(i+r);return(Oi(l)+Oi(u))*Math.min(Math.abs(l),Math.abs(u),.5*Math.abs(s))||0}function Ai(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function ln(t,e,n){var i=t._x0,r=t._y0,l=t._x1,u=t._y1,s=(l-i)/3;t._context.bezierCurveTo(i+s,r+s*e,l-s,u-s*n,l,u)}function We(t){this._context=t}We.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:ln(this,this._t0,Ai(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(t=+t,e=+e,!(t===this._x1&&e===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,ln(this,Ai(this,n=Si(this,t,e)),n);break;default:ln(this,this._t0,n=Si(this,t,e));break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}};function Io(t){this._context=new Lo(t)}(Io.prototype=Object.create(We.prototype)).point=function(t,e){We.prototype.point.call(this,e,t)};function Lo(t){this._context=t}Lo.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,i,r,l){this._context.bezierCurveTo(e,t,i,n,l,r)}};function fl(t){return new We(t)}function gl(t){return new Io(t)}function Ro(t){this._context=t}Ro.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,n=t.length;if(n)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),n===2)this._context.lineTo(t[1],e[1]);else for(var i=Mi(t),r=Mi(e),l=0,u=1;u<n;++l,++u)this._context.bezierCurveTo(i[0][l],r[0][l],i[1][l],r[1][l],t[u],e[u]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}};function Mi(t){var e,n=t.length-1,i,r=new Array(n),l=new Array(n),u=new Array(n);for(r[0]=0,l[0]=2,u[0]=t[0]+2*t[1],e=1;e<n-1;++e)r[e]=1,l[e]=4,u[e]=4*t[e]+2*t[e+1];for(r[n-1]=2,l[n-1]=7,u[n-1]=8*t[n-1]+t[n],e=1;e<n;++e)i=r[e]/l[e-1],l[e]-=i,u[e]-=i*u[e-1];for(r[n-1]=u[n-1]/l[n-1],e=n-2;e>=0;--e)r[e]=(u[e]-r[e+1])/l[e];for(l[n-1]=(t[n]+r[n-1])/2,e=0;e<n-1;++e)l[e]=2*t[e+1]-r[e+1];return[r,l]}function vl(t){return new Ro(t)}function Ge(t,e){this._context=t,this._t=e}Ge.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}break}}this._x=t,this._y=e}};function ml(t){return new Ge(t,.5)}function wl(t){return new Ge(t,0)}function yl(t){return new Ge(t,1)}function ne(t,e){if((u=t.length)>1)for(var n=1,i,r,l=t[e[0]],u,s=l.length;n<u;++n)for(r=l,l=t[e[n]],i=0;i<s;++i)l[i][1]+=l[i][0]=isNaN(r[i][1])?r[i][0]:r[i][1]}function ie(t){for(var e=t.length,n=new Array(e);--e>=0;)n[e]=e;return n}function bl(t,e){return t[e]}function xl(){var t=J([]),e=ie,n=ne,i=bl;function r(l){var u=t.apply(this,arguments),s,c=l.length,p=u.length,f=new Array(p),m;for(s=0;s<p;++s){for(var O=u[s],k=f[s]=new Array(c),E=0,D;E<c;++E)k[E]=D=[0,+i(l[E],O,E,l)],D.data=l[E];k.key=O}for(s=0,m=e(f);s<p;++s)f[m[s]].index=s;return n(f,m),f}return r.keys=function(l){return arguments.length?(t=typeof l=="function"?l:J(xn.call(l)),r):t},r.value=function(l){return arguments.length?(i=typeof l=="function"?l:J(+l),r):i},r.order=function(l){return arguments.length?(e=l==null?ie:typeof l=="function"?l:J(xn.call(l)),r):e},r.offset=function(l){return arguments.length?(n=l??ne,r):n},r}function _l(t,e){if((i=t.length)>0){for(var n,i,r=0,l=t[0].length,u;r<l;++r){for(u=n=0;n<i;++n)u+=t[n][r][1]||0;if(u)for(n=0;n<i;++n)t[n][r][1]/=u}ne(t,e)}}function Tl(t,e){if((c=t.length)>0)for(var n,i=0,r,l,u,s,c,p=t[e[0]].length;i<p;++i)for(u=s=0,n=0;n<c;++n)(l=(r=t[e[n]][i])[1]-r[0])>0?(r[0]=u,r[1]=u+=l):l<0?(r[1]=s,r[0]=s+=l):(r[0]=0,r[1]=l)}function kl(t,e){if((r=t.length)>0){for(var n=0,i=t[e[0]],r,l=i.length;n<l;++n){for(var u=0,s=0;u<r;++u)s+=t[u][n][1]||0;i[n][1]+=i[n][0]=-s/2}ne(t,e)}}function Cl(t,e){if(!(!((u=t.length)>0)||!((l=(r=t[e[0]]).length)>0))){for(var n=0,i=1,r,l,u;i<l;++i){for(var s=0,c=0,p=0;s<u;++s){for(var f=t[e[s]],m=f[i][1]||0,O=f[i-1][1]||0,k=(m-O)/2,E=0;E<s;++E){var D=t[e[E]],N=D[i][1]||0,v=D[i-1][1]||0;k+=N-v}c+=m,p+=k*m}r[i-1][1]+=r[i-1][0]=n,c&&(n-=p/c)}r[i-1][1]+=r[i-1][0]=n,ne(t,e)}}function Po(t){var e=t.map(El);return ie(t).sort(function(n,i){return e[n]-e[i]})}function El(t){for(var e=-1,n=0,i=t.length,r,l=-1/0;++e<i;)(r=+t[e][1])>l&&(l=r,n=e);return n}function $o(t){var e=t.map(Fo);return ie(t).sort(function(n,i){return e[n]-e[i]})}function Fo(t){for(var e=0,n=-1,i=t.length,r;++n<i;)(r=+t[n][1])&&(e+=r);return e}function Ol(t){return $o(t).reverse()}function Sl(t){var e=t.length,n,i,r=t.map(Fo),l=Po(t),u=0,s=0,c=[],p=[];for(n=0;n<e;++n)i=l[n],u<s?(u+=r[i],c.push(i)):(s+=r[i],p.push(i));return p.reverse().concat(c)}function Al(t){return ie(t).reverse()}const Ml=Object.freeze(Object.defineProperty({__proto__:null,arc:Ba,area:fo,areaRadial:Ei,curveBasis:Co,curveBasisClosed:ol,curveBasisOpen:sl,curveBundle:rl,curveCardinal:al,curveCardinalClosed:ll,curveCardinalOpen:cl,curveCatmullRom:ul,curveCatmullRomClosed:dl,curveCatmullRomOpen:hl,curveLinear:Xe,curveLinearClosed:pl,curveMonotoneX:fl,curveMonotoneY:gl,curveNatural:vl,curveStep:ml,curveStepAfter:yl,curveStepBefore:wl,line:Ye,lineRadial:Ci,linkHorizontal:Ya,linkRadial:Ga,linkVertical:Ja,pie:Va,pointRadial:de,radialArea:Ei,radialLine:Ci,stack:xl,stackOffsetDiverging:Tl,stackOffsetExpand:_l,stackOffsetNone:ne,stackOffsetSilhouette:kl,stackOffsetWiggle:Cl,stackOrderAppearance:Po,stackOrderAscending:$o,stackOrderDescending:Ol,stackOrderInsideOut:Sl,stackOrderNone:ie,stackOrderReverse:Al,symbol:il,symbolCircle:$n,symbolCross:mo,symbolDiamond:yo,symbolSquare:_o,symbolStar:xo,symbolTriangle:To,symbolWye:ko,symbols:nl},Symbol.toStringTag,{value:"Module"}));/*!
* rete-connection-path-plugin v0.3.1 
* (c) 2019 Vitaliy Stoliarov 
* Released under the MIT license.
*/function Dl(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Di(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Nl(t,e,n){return e&&Di(t.prototype,e),n&&Di(t,n),t}function Il(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ll(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{},i=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable}))),i.forEach(function(r){Il(t,r,n[r])})}return t}function Ni(t,e){return Rl(t)||Pl(t,e)||$l()}function Rl(t){if(Array.isArray(t))return t}function Pl(t,e){var n=[],i=!0,r=!1,l=void 0;try{for(var u=t[Symbol.iterator](),s;!(i=(s=u.next()).done)&&(n.push(s.value),!(e&&n.length===e));i=!0);}catch(c){r=!0,l=c}finally{try{!i&&u.return!=null&&u.return()}finally{if(r)throw l}}return n}function $l(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var Fl=function(){function t(e,n){Dl(this,t),this.points=e,this.curve=n}return Nl(t,[{key:"line",value:function(n){var i=n(this.points);return Ye().x(function(r){return r[0]}).y(function(r){return r[1]}).curve(this.curve)(i)}},{key:"getData",value:function(n,i){return this.line(n(i))}}]),t}(),Ii={LINEAR:function(){return function(e){var n=Ni(e,4),i=n[0],r=n[1],l=n[2],u=n[3];return[[i,r],[l,u]]}},DEFAULT:function(e){var n=e.vertical,i=n===void 0?!1:n,r=e.curvature,l=r===void 0?.4:r;return function(u){var s=Ni(u,4),c=s[0],p=s[1],f=s[2],m=s[3],O=[c,p],k=[f,m];if(i){var E=[p,c];c=E[0],p=E[1];var D=[m,f];f=D[0],m=D[1]}var N=c+Math.abs(f-c)*l,v=f-Math.abs(f-c)*l,x=i?[p,N]:[N,p],b=i?[m,v]:[v,m];return[O,x,b,k]}}},Bo={DEFAULT:"DEFAULT",LINEAR:"LINEAR"};function Bl(t,e){var n=t.x,i=t.y,r=e.x,l=e.y,u=n-r,s=i-l;return 180*Math.atan2(s,u)/Math.PI}function Li(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,r=t.getTotalLength()*n,l=t.getPointAtLength(r+e),u=t.getPointAtLength(r),s=180+(i?Bl(l,u):0);return"translate(".concat(l.x,", ").concat(l.y,") rotate(").concat(s,")")}function jl(t,e){var n=e.type,i=e.transformer,r=e.arrow,l=e.curve,u=e.options,s=u===void 0?{}:u;if(n=n||Bo.DEFAULT,l=l||Co,i&&typeof i!="function")throw new Error("transformer property must be a function");if(!Ii[n])throw new Error("transformer with type ".concat(n," doesn't exist"));t.on("connectionpath",function(c){var p=c.points,f=new Fl(p,l);c.d=f.getData(i||Ii[n],s)}),r&&(t.on("renderconnection",function(c){var p=c.el,f=p.querySelector("path"),m=document.createElementNS("http://www.w3.org/2000/svg","path");p.querySelector("svg").appendChild(m),m.classList.add("marker"),m.setAttribute("fill",r.color||"steelblue"),m.setAttribute("d",r.marker||"M-5,-10 L-5,10 L20,0 z"),m.setAttribute("transform",Li(f,-25))}),t.on("updateconnection",function(c){var p=c.el,f=p.querySelector("path"),m=p.querySelector(".marker");m.setAttribute("transform",Li(f,-25))}))}var cn=Ll({install:jl},Ml,Bo);/*!
* rete-connection-plugin v0.9.0 
* (c) 2019 Vitaliy Stoliarov 
* Released under the MIT license.
*/function Hl(t){if(t&&!(typeof window>"u")){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}function Vn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ri(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Wn(t,e,n){return e&&Ri(t.prototype,e),n&&Ri(t,n),t}function Gt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function jo(t,e){return Vl(t)||Wl(t,e)||Ul()}function Vl(t){if(Array.isArray(t))return t}function Wl(t,e){var n=[],i=!0,r=!1,l=void 0;try{for(var u=t[Symbol.iterator](),s;!(i=(s=u.next()).done)&&(n.push(s.value),!(e&&n.length===e));i=!0);}catch(c){r=!0,l=c}finally{try{!i&&u.return!=null&&u.return()}finally{if(r)throw l}}return n}function Ul(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function Ne(t){return t.toLowerCase().replace(/ /g,"-")}function Ho(t,e){return t.get(e)||(e.parentElement?Ho(t,e.parentElement):null)}function zl(t,e){var n=jo(t,4),i=n[0],r=n[1],l=n[2],u=n[3],s=i+Math.abs(l-i)*e,c=l-Math.abs(l-i)*e;return"M ".concat(i," ").concat(r," C ").concat(s," ").concat(r," ").concat(c," ").concat(u," ").concat(l," ").concat(u)}function Ue(t,e,n){var i={points:e,connection:n,d:""};return t.trigger("connectionpath",i),i.d||zl(e,.4)}function Un(t){var e=t.el,n=t.d,i=e.querySelector(".connection path");if(!i)throw new Error("Path of connection was broken");i.setAttribute("d",n)}function Vo(t){var e,n=t.el,i=t.d,r=t.connection,l=r?["input-"+Ne(r.input.name),"output-"+Ne(r.output.name),"socket-input-"+Ne(r.input.socket.name),"socket-output-"+Ne(r.output.socket.name)]:[],u=document.createElementNS("http://www.w3.org/2000/svg","svg"),s=document.createElementNS("http://www.w3.org/2000/svg","path");(e=u.classList).add.apply(e,["connection"].concat(l)),s.classList.add("main-path"),s.setAttribute("d",i),u.appendChild(s),n.appendChild(u),Un({el:n,d:i})}var ql=function(){function t(e,n){Vn(this,t),this.emitter=e,this.editorView=n,Gt(this,"el",void 0),this.el=document.createElement("div"),this.el.style.position="absolute",this.editorView.area.appendChild(this.el)}return Wn(t,[{key:"updatePseudoConnection",value:function(n){n!==null?this.renderConnection(n):this.el.parentElement&&(this.el.innerHTML="")}},{key:"getPoints",value:function(n){var i=this.editorView.area.mouse;if(!n.node)throw new Error("Node in output/input not found");var r=this.editorView.nodes.get(n.node);if(!r)throw new Error("Node view not found");var l=r.getSocketPosition(n),u=jo(l,2),s=u[0],c=u[1];return n instanceof dn?[s,c,i.x,i.y]:[i.x,i.y,s,c]}},{key:"updateConnection",value:function(n){var i=Ue(this.emitter,this.getPoints(n));Un({el:this.el,d:i})}},{key:"renderConnection",value:function(n){var i=Ue(this.emitter,this.getPoints(n));Vo({el:this.el,d:i})}}]),t}(),Xl=function(){function t(e){var n=this;Vn(this,t),Gt(this,"editor",void 0),Gt(this,"_io",null),Gt(this,"view",void 0),this.editor=e,this.view=new ql(e,e.view),e.on("mousemove",function(){return n.io&&n.view.updateConnection(n.io)})}return Wn(t,[{key:"reset",value:function(){this.io=null}},{key:"pickOutput",value:function(n){if(this.editor.trigger("connectionpick",n)){if(this.io instanceof es){!n.multipleConnections&&n.hasConnection()&&this.editor.removeConnection(n.connections[0]),this.editor.connect(n,this.io),this.reset();return}this.io&&this.reset(),this.io=n}}},{key:"pickInput",value:function(n){var i=this;if(this.editor.trigger("connectionpick",n)){if(this.io===null)return n.hasConnection()?(this.io=n.connections[0].output,this.editor.removeConnection(n.connections[0])):this.io=n,!0;if(!n.multipleConnections&&n.hasConnection()&&this.editor.removeConnection(n.connections[0]),!this.io.multipleConnections&&this.io.hasConnection()&&this.editor.removeConnection(this.io.connections[0]),this.io instanceof dn&&this.io.connectedTo(n)){var r=n.connections.find(function(l){return l.output===i.io});r&&this.editor.removeConnection(r)}this.io instanceof dn&&(this.editor.connect(this.io,n),this.reset())}}},{key:"pickConnection",value:function(n){var i=n.output;this.editor.removeConnection(n),this.io=i}},{key:"io",get:function(){return this._io},set:function(n){this._io=n,this.view.updatePseudoConnection(n)}}]),t}(),Yl=function(){function t(e){Vn(this,t),Gt(this,"picker",void 0),Gt(this,"target",void 0),this.picker=e,this.target=null}return Wn(t,[{key:"act",value:function(n){var i=n.input,r=n.output;this.unlock(i||r)||(i?this.picker.pickInput(i):r?this.picker.pickOutput(r):this.picker.reset())}},{key:"start",value:function(n,i){this.act(n),this.target=i}},{key:"complete",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.act(n)}},{key:"hasTarget",value:function(){return!!this.target}},{key:"unlock",value:function(n){var i=this.target;return this.target=null,i&&i===n}}]),t}();Hl(`.connection {
  overflow: visible !important;
  position: absolute;
  z-index: -1;
  pointer-events: none; }
  .connection > * {
    pointer-events: all; }
  .connection .main-path {
    fill: none;
    stroke-width: 5px;
    stroke: steelblue; }
`);function Jl(t){t.bind("connectionpath"),t.bind("connectiondrop"),t.bind("connectionpick"),t.bind("resetconnection");var e=new Xl(t),n=new Yl(e),i=new WeakMap;function r(u){var s=i.get(this);if(s){var c=s.input,p=s.output;t.view.container.dispatchEvent(new PointerEvent("pointermove",u)),u.preventDefault(),u.stopPropagation(),n.start({input:c,output:p},c||p)}}function l(u){var s=document.elementFromPoint(u.clientX,u.clientY);e.io&&t.trigger("connectiondrop",e.io),s&&n.complete(Ho(i,s)||{})}t.on("resetconnection",function(){return n.complete()}),t.on("rendersocket",function(u){var s=u.el,c=u.input,p=u.output;i.set(s,{input:c,output:p}),s.removeEventListener("pointerdown",r),s.addEventListener("pointerdown",r)}),window.addEventListener("pointerup",l),t.on("renderconnection",function(u){var s=u.el,c=u.connection,p=u.points,f=Ue(t,p,c);Vo({el:s,d:f,connection:c})}),t.on("updateconnection",function(u){var s=u.el,c=u.connection,p=u.points,f=Ue(t,p,c);Un({el:s,d:f})}),t.on("destroy",function(){window.removeEventListener("pointerup",l)})}var Gl={name:"connection",install:Jl};const Kl=`<div class="input-control-div" x-tooltip:reactive="control.description">
  <input
    type="checkbox"
    :style="opts.readonly ? 'background-color: #ccc; color: white;' : 'color:black;'"
    :disabled="opts.readonly"
    x-model="value"
    @change="change"
    @dblclick.stop
    @wheel.stop
    @pointerdown.stop
    @pointermove.stop
  />
  <label
    x-show="name"
    class="input-control-label"
    x-text="title + ': ' + (value ? 'yes' : 'no')"
  ></label>
</div>`,Zl=`<div class="input-control-div p-2" x-tooltip:reactive="control.description">
  <button
    type="button"
    class="btn btn-primary p-2 w-full"
    :disabled="opts.readonly"
    @click="runButtonAction(custom('buttonValue'), custom('buttonArgs'))"
    @dblclick.stop
    @wheel.stop
    @pointerdown.stopbtn
    @pointermove.stop
    x-text="title"
  >
</button>
</div>`,Ql=`<div
  class="input-control-div"
  x-tooltip:reactive="tooltip"
>
  <div
    x-show="error"
    x-text="error"
    class="flex text-white bg-red-500 w-full text-xs"
  ></div>
  <label
    :for="controlUid"
    class="sr-only text-xs text-gray-500"
    x-text="title"
  ></label>
  <textarea
    x-data="inputUtils"
    x-init="textareaAutoResize($el)"
    @input="textareaAutoResize($el)"
    :id="controlUid"
    :disabled="opts.readonly"
    :value="value && typeof(value) !== 'string'? JSON.stringify(value, null, 2).trim() : null"
    :placeholder="opts.placeholder || title"
    @blur="change($event)"
    @dblclick.stop="$event"
    @pointerdown.stop="$event"
    @pointermove.stop="$event"
    class="h-7 min-h-7 w-full font-mono text-xs rounded-md border-gray-300 shadow-sm focus:border-primary-400 focus:ring-opacity-50 disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500"
    :class="{
          'ring-red-300 ring-2': required && !hasValue(),
         } "
  />

</div>`,tc=`<div class="input-control-div">
  <label
    :for="controlUid"
    class="sr-only text-xs text-gray-400"
    x-text="title"
  ></label>
  <div class="flex flex-grow flex-nowrap h-5">
  <div
    class="w-10 h-5 cursor-default rounded-l-md"
    x-tooltip="Color Preview"
    :style="{
      'background-color': value,
    }"
    >
    </div>

  <textarea
    x-data="inputUtils"
    x-init="textareaAutoResize($el)"
    @input="textareaAutoResize($el)"
    :id="controlUid"
    :disabled="opts.readonly"
    :value="value"
    :placeholder="opts.placeholder || title"
    maxlength="20"
    aria-multiline="false"
    cols="1"
    rows="1"
    res
    @blur="change($event)"
    @dblclick.stop="$event"
    @pointerdown.stop="$event"
    @pointermove.stop="$event"
    class="h-6 min-h-7 resize-none w-full text-xs rounded-md rounded-l-none border-gray-300 shadow-sm focus:border-primary-400 focus:ring-opacity-50 disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500"
    :class="{
         'ring-red-300 ring-2': required && !hasValue(),
        } "

  />
  </div>

</div>`,ec=`<div
  class="input-control-div"
  x-tooltip:reactive="tooltip"
>
  <div
    x-show="error"
    x-text="error"
    class="flex text-white bg-red-500 w-full text-xs"
  ></div>
  <label
    :for="controlUid"
    class="sr-only text-xs text-gray-500"
    x-text="title"
  ></label>
  <textarea
    x-data="inputUtils"
    x-init="textareaAutoResize($el)"
    @input="textareaAutoResize($el)"
    :id="controlUid"
    :disabled="opts.readonly"
    :value="value && typeof(value) !== 'string'? JSON.stringify(value, null, 2).trim() : null"
    :placeholder="opts.placeholder || title"
    @blur="change($event)"
    @dblclick.stop="$event"
    @pointerdown.stop="$event"
    @pointermove.stop="$event"
    class="h-7 min-h-7 w-full font-mono text-xs rounded-md border-gray-300 shadow-sm focus:border-primary-400 focus:ring-opacity-50 disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500"
  />

</div>`,nc=`<div class="relative flex"><div
    x-data="gallery"
    class="flex w-full justify-center"
  >
    <div
      x-show="value?.length > 0"
      x-on:keydown.right="next"
      x-on:keydown.left="prev"
      tabindex="0"
      role="region"
      aria-labelledby="carousel-label"
      class="flex"
    >
      <h2 id="carousel-label" class="sr-only" hidden>Carousel</h2>
      <div class="flex justify-center items-center">
        <!-- Prev Button -->
        <button
          x-on:click="prev"
          x-show="value?.length > 1"
          class="absolute left-0 top-1/2 transform -translate-y-1/2 text-6xl"
          :aria-disabled="atBeginning"
          :tabindex="atEnd ? -1 : 0"
          :class="{ 'opacity-50 cursor-not-allowed': atBeginning }"
        >
          <span aria-hidden="true">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-8 w-8 text-gray-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="3"
            ><path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M15 19l-7-7 7-7"
              /></svg>
          </span>
          <span class="sr-only">Skip to previous slide page</span>
        </button>
        <!-- Next Button -->
        <button
          x-on:click="next"
          x-show="value?.length > 1"
          class="absolute right-0 top-1/2 transform -translate-y-1/2 text-6xl"
          :aria-disabled="atEnd"
          :tabindex="atEnd ? -1 : 0"
          :class="{ 'opacity-50 cursor-not-allowed': atEnd }"
        >
          <span aria-hidden="true">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-8 w-8 text-gray-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="3"
            ><path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9 5l7 7-7 7"
              /></svg>
          </span>
          <span class="sr-only">Skip to next slide page</span>
        </button>

        <span id="carousel-content-label" class="sr-only" hidden>Carousel</span>
        <ul
          x-ref="slider"
          tabindex="0"
          role="listbox"
          aria-labelledby="carousel-content-label"
          class="flex w-full snap-x snap-mandatory overflow-x-scroll"
        >
          <template x-for="(image, index) in value" :key="index">
            <li
              x-bind="disableNextAndPreviousButtons"
              class="flex w-full shrink-0 snap-start flex-col items-center justify-center"
              role="option"
              @click="workbench.showExtension('omni-core-filemanager',{focusedObject:image})"
            >

              <img
                class="w-full"
                :src="'/fid/'+(image.fid || image.ticket?.fid) + '?width=256&height=256&fit=contain'"
                x-show="'/fid/'+(image.fid)"
                @error="$event.target.dataset.failedOnce ? console.error('missing error.jpg') : ($event.target.dataset.failedOnce = true, $event.target.src = 'error.jpg')"
              />
              <button x-bind="focusableWhenVisible" class="text-sm"></button>
            </li>
          </template>
        </ul>
      </div>
    </div>
  </div>
</div>`,ic=`<div class="input-control-div text-xs" x-tooltip:reactive="control.description">
  <span
    x-text="title"
    class="input-title"
  ></span>
</div>`,oc=`<div class="input-control-div">
  <div
    class="input-control-label"
    x-tooltip:reactive="tooltip"
  >
    <label
      :for="controlUid"
      x-text="title"
    ></label>
  </div>

  <input
    type="number"
    :id="controlUid"
    :id="controlUid"
    :disabled="opts.readonly"
    :placeholder="opts.placeholder"
    :value="value"
    @input="change($event)"
    @dblclick.stop="$event"
    @pointerdown.stop="$event"
    @pointermove.stop="$event"
    class="w-full text-xs text-right focus:text-center rounded-md border-gray-300 focus:border-primary-400 focus:ring-opacity-50 disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500"
    :class="{
        'ring-red-300 ring-2': required && !hasValue(),
        } "
  />
</div>`,sc=`<div class="input-control-div" 
>
  <div class="input-control-label">
  <label
    :for="controlUid"
    x-text="title" x-tooltip:reactive="tooltip"
  ></label>
  </div>
  <div class="flex flex-grow-0 w-full items-center justify-between">
    <input
      type="range"
      :id="controlUid"
      :disabled="opts.readonly"
      @blur="change($event)"
      @pointerdown.stop="change($event)"
      @pointermove.stop="$event"
      x-model.number="value"
      class="h-2 cursor-pointer appearance-none rounded-full bg-gray-100 flex-shrink-0"
      :min="opts.minimum"
      :max="opts.maximum"
      :step="opts.step"
    />
  <input
    :placeholder="opts.placeholder"
    type="number"
    @blur="change($event)"
    :step="opts.step"
    class="w-16 border text-right text-xs pl-18 rounded-md"
    x-model.number="value"
  />
  </div>
  </div>`,rc=`<div class="input-control-div">
  <label
    :for="controlUid"
    class="sr-only text-xs text-gray-400"
    x-text="title"
  ></label>
</div>
<div class="input-control-div" x-tooltip:reactive="tooltip">
  <input
    type="password"
    x-data="inputUtils"
    :id="controlUid"
    :disabled="opts.readonly"
    :value="value"
    :placeholder="opts.placeholder ?? title"
    @blur="change($event)"
    @dblclick.stop="$event"
    @pointerdown.stop="$event"
    @pointermove.stop="$event"
    @paste.stop="$event"
    class="text-sm bg-white border rounded-md border-neutral-300 w-full ring-offset-background placeholder:text-neutral-500 focus:border-neutral-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-neutral-400 disabled:cursor-not-allowed disabled:opacity-50"
    :class="{
         'ring-red-300 ring-2': required && !hasValue(),
        }"
  />
</div>
`,ac=`<div class="input-control-div" >
  <div
    class="input-control-label"
  >
  <label x-tooltip:reactive="description"
    :for="controlUid"
    class="text-xs select-none pointer-events-none"
    x-text="title"
  ></label>
  </div>
  <div class="input-control-div">
  <input
    class="w-full rounded-md text-xs bg-white border-gray-300 shadow-sm disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500 mr-1"
    :name="controlUid"
    :id="controlUid"
    :disabled="opts.readonly"
    type="text"
    :placeholder="opts.placeholder"
    x-data="{}"
    x-init="tagify($el)"
    x-model="value"
  />
</div>
</div>`,lc=`<div
  class="input-control-div"
  x-tooltip:reactive="tooltip"
>
  <div
    class="input-control-label"
  >
    <label
      :for="controlUid"
      x-text="title"
    ></label>
  </div>
  <select
    :id="controlUid"
    :disabled="opts.readonly"
    x-model="value"
    :placeholder="opts.placeholder"
    @input="change($event)"
    @dblclick.stop="$event"
    @pointerdown.stop="$event"
    @pointermove.stop="$event"
    class="peer flex w-full text-xs text-right rounded-md border-gray-300 shadow-sm disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500"
  >
    <template x-for="option, index in (opts.choices)" :key="index">
      <option
        class="text-black"
        :value="option.value"
        x-title="option.title"
        x-text="option.title + (opts.default === option.value ? ' (Default)' : '')"
        :selected="value === option.value.toString()"
      ></option>
    </template>
  </select>
  <div
    class="visible z-50 has-tt wrap cursor-help"
    x-show="selectedChoice()?.description"
  >&nbsp;ⓘ<div
      class="float-right absolute inline-block w-32 text-xs bg-yellow-100 p-1 tt drop-shadow-md"
      text="selectedChoice()?.title + ': ' + selectedChoice()?.description"
    />
  </div>
</div>`,cc=`<div class="input-control-div">
  <label
    :for="controlUid"
    class="sr-only text-xs text-gray-400"
    x-text="title"
  ></label>

</div>
<div class="input-control-div" x-tooltip:reactive="tooltip">
  <textarea
    x-data="inputUtils"
    x-init="textareaAutoResize($el)"
    @input="textareaAutoResize($el)"
    :id="controlUid"
    :disabled="opts.readonly"
    :value="value"
    :placeholder="opts.placeholder || title"
    @blur="change($event)"
    @dblclick.stop="$event"
    @pointerdown.stop="$event"
    @pointermove.stop="$event"
    @paste.stop="$event"
    class="text-sm bg-white border rounded-md border-neutral-300 ring-offset-background placeholder:text-neutral-500 focus:border-neutral-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-neutral-400 disabled:cursor-not-allowed disabled:opacity-50    "
    :class="{
         'ring-red-300 ring-2': required && !hasValue(),
        } "
  />
</div>`,uc=`<div class="text-left max-w-sm">
  <label
    :for="controlUid"
    class="relative inline-flex cursor-pointer items-center align-middle"
  >
   <span
      class=" input-control-label"
      x-text="title"
      x-tooltip:reactive="tooltip"
    ></span>
    <input
      type="checkbox"
      :id="controlUid"
      :checked="value"
      class="peer sr-only"
      :disabled="opts.readonly"
      @change="change"
    />
    <div
      class="relative h-6 w-11 rounded-full bg-gray-300 after:absolute after:top-0.5 after:left-0.5 after:h-5 after:w-5 after:rounded-full after:bg-white after:shadow after:transition-all after:content-[''] hover:bg-gray-300 peer-checked:bg-gray-500 peer-checked:after:translate-x-full peer-checked:after:border-white peer-focus:ring-1 peer-focus:ring-neutral-200 peer-disabled:cursor-not-allowed peer-disabled:bg-gray-100 peer-disabled:after:bg-gray-50"
    ></div>

  </label>
</div>`;var Wo={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(ns,function(){function n(o,a){var h=Object.keys(o);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(o);a&&(d=d.filter(function(w){return Object.getOwnPropertyDescriptor(o,w).enumerable})),h.push.apply(h,d)}return h}function i(o){for(var a=1;a<arguments.length;a++){var h=arguments[a]!=null?arguments[a]:{};a%2?n(Object(h),!0).forEach(function(d){r(o,d,h[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(h)):n(Object(h)).forEach(function(d){Object.defineProperty(o,d,Object.getOwnPropertyDescriptor(h,d))})}return o}function r(o,a,h){return(a=function(d){var w=function(C,T){if(typeof C!="object"||C===null)return C;var A=C[Symbol.toPrimitive];if(A!==void 0){var R=A.call(C,T||"default");if(typeof R!="object")return R;throw new TypeError("@@toPrimitive must return a primitive value.")}return(T==="string"?String:Number)(C)}(d,"string");return typeof w=="symbol"?w:String(w)}(a))in o?Object.defineProperty(o,a,{value:h,enumerable:!0,configurable:!0,writable:!0}):o[a]=h,o}var l="​";const u=(o,a,h,d)=>(o=""+o,a=""+a,d&&(o=o.trim(),a=a.trim()),h?o==a:o.toLowerCase()==a.toLowerCase()),s=(o,a)=>o&&Array.isArray(o)&&o.map(h=>c(h,a));function c(o,a){var h,d={};for(h in o)a.indexOf(h)<0&&(d[h]=o[h]);return d}function p(o){var a=document.createElement("div");return o.replace(/\&#?[0-9a-z]+;/gi,function(h){return a.innerHTML=h,a.innerText})}function f(o){return new DOMParser().parseFromString(o.trim(),"text/html").body.firstElementChild}function m(o,a){for(a=a||"previous";o=o[a+"Sibling"];)if(o.nodeType==3)return o}function O(o){return typeof o=="string"?o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/`|'/g,"&#039;"):o}function k(o){var a=Object.prototype.toString.call(o).split(" ")[1].slice(0,-1);return o===Object(o)&&a!="Array"&&a!="Function"&&a!="RegExp"&&a!="HTMLUnknownElement"}function E(o,a,h){function d(w,C){for(var T in C)if(C.hasOwnProperty(T)){if(k(C[T])){k(w[T])?d(w[T],C[T]):w[T]=Object.assign({},C[T]);continue}if(Array.isArray(C[T])){w[T]=Object.assign([],C[T]);continue}w[T]=C[T]}}return o instanceof Object||(o={}),d(o,a),h&&d(o,h),o}function D(){const o=[],a={};for(let h of arguments)for(let d of h)k(d)?a[d.value]||(o.push(d),a[d.value]=1):o.includes(d)||o.push(d);return o}function N(o){return String.prototype.normalize?typeof o=="string"?o.normalize("NFD").replace(/[\u0300-\u036f]/g,""):void 0:o}var v=()=>/(?=.*chrome)(?=.*android)/i.test(navigator.userAgent);function x(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,o=>(o^crypto.getRandomValues(new Uint8Array(1))[0]&15>>o/4).toString(16))}function b(o){return o&&o.classList&&o.classList.contains(this.settings.classNames.tag)}function g(o,a){var h=window.getSelection();return a=a||h.getRangeAt(0),typeof o=="string"&&(o=document.createTextNode(o)),a&&(a.deleteContents(),a.insertNode(o)),o}function _(o,a,h){return o?(a&&(o.__tagifyTagData=h?a:E({},o.__tagifyTagData||{},a)),o.__tagifyTagData):(console.warn("tag element doesn't exist",o,a),a)}function y(o){if(o&&o.parentNode){var a=o,h=window.getSelection(),d=h.getRangeAt(0);h.rangeCount&&(d.setStartAfter(a),d.collapse(!0),h.removeAllRanges(),h.addRange(d))}}function S(o,a){o.forEach(h=>{if(_(h.previousSibling)||!h.previousSibling){var d=document.createTextNode(l);h.before(d),a&&y(d)}})}var I={delimiters:",",pattern:null,tagTextProp:"value",maxTags:1/0,callbacks:{},addTagOnBlur:!0,onChangeAfterBlur:!0,duplicates:!1,whitelist:[],blacklist:[],enforceWhitelist:!1,userInput:!0,keepInvalidTags:!1,createInvalidTags:!0,mixTagsAllowedAfter:/,|\.|\:|\s/,mixTagsInterpolator:["[[","]]"],backspace:!0,skipInvalid:!1,pasteAsTags:!0,editTags:{clicks:2,keepInvalid:!0},transformTag:()=>{},trim:!0,a11y:{focusableTags:!1},mixMode:{insertAfterTag:" "},autoComplete:{enabled:!0,rightKey:!1},classNames:{namespace:"tagify",mixMode:"tagify--mix",selectMode:"tagify--select",input:"tagify__input",focus:"tagify--focus",tagNoAnimation:"tagify--noAnim",tagInvalid:"tagify--invalid",tagNotAllowed:"tagify--notAllowed",scopeLoading:"tagify--loading",hasMaxTags:"tagify--hasMaxTags",hasNoTags:"tagify--noTags",empty:"tagify--empty",inputInvalid:"tagify__input--invalid",dropdown:"tagify__dropdown",dropdownWrapper:"tagify__dropdown__wrapper",dropdownHeader:"tagify__dropdown__header",dropdownFooter:"tagify__dropdown__footer",dropdownItem:"tagify__dropdown__item",dropdownItemActive:"tagify__dropdown__item--active",dropdownItemHidden:"tagify__dropdown__item--hidden",dropdownInital:"tagify__dropdown--initial",tag:"tagify__tag",tagText:"tagify__tag-text",tagX:"tagify__tag__removeBtn",tagLoading:"tagify__tag--loading",tagEditing:"tagify__tag--editable",tagFlash:"tagify__tag--flash",tagHide:"tagify__tag--hide"},dropdown:{classname:"",enabled:2,maxItems:10,searchKeys:["value","searchBy"],fuzzySearch:!0,caseSensitive:!1,accentedSearch:!0,includeSelectedTags:!1,highlightFirst:!1,closeOnSelect:!0,clearOnSelect:!0,position:"all",appendTarget:null},hooks:{beforeRemoveTag:()=>Promise.resolve(),beforePaste:()=>Promise.resolve(),suggestionClick:()=>Promise.resolve()}};function $(){this.dropdown={};for(let o in this._dropdown)this.dropdown[o]=typeof this._dropdown[o]=="function"?this._dropdown[o].bind(this):this._dropdown[o];this.dropdown.refs()}var F={refs(){this.DOM.dropdown=this.parseTemplate("dropdown",[this.settings]),this.DOM.dropdown.content=this.DOM.dropdown.querySelector("[data-selector='tagify-suggestions-wrapper']")},getHeaderRef(){return this.DOM.dropdown.querySelector("[data-selector='tagify-suggestions-header']")},getFooterRef(){return this.DOM.dropdown.querySelector("[data-selector='tagify-suggestions-footer']")},getAllSuggestionsRefs(){return[...this.DOM.dropdown.content.querySelectorAll(this.settings.classNames.dropdownItemSelector)]},show(o){var a,h,d,w=this.settings,C=w.mode=="mix"&&!w.enforceWhitelist,T=!w.whitelist||!w.whitelist.length,A=w.dropdown.position=="manual";if(o=o===void 0?this.state.inputText:o,!(T&&!C&&!w.templates.dropdownItemNoMatch||w.dropdown.enable===!1||this.state.isLoading||this.settings.readonly)){if(clearTimeout(this.dropdownHide__bindEventsTimeout),this.suggestedListItems=this.dropdown.filterListItems(o),o&&!this.suggestedListItems.length&&(this.trigger("dropdown:noMatch",o),w.templates.dropdownItemNoMatch&&(d=w.templates.dropdownItemNoMatch.call(this,{value:o}))),!d){if(this.suggestedListItems.length)o&&C&&!this.state.editing.scope&&!u(this.suggestedListItems[0].value,o)&&this.suggestedListItems.unshift({value:o});else{if(!o||!C||this.state.editing.scope)return this.input.autocomplete.suggest.call(this),void this.dropdown.hide();this.suggestedListItems=[{value:o}]}h=""+(k(a=this.suggestedListItems[0])?a.value:a),w.autoComplete&&h&&h.indexOf(o)==0&&this.input.autocomplete.suggest.call(this,a)}this.dropdown.fill(d),w.dropdown.highlightFirst&&this.dropdown.highlightOption(this.DOM.dropdown.content.querySelector(w.classNames.dropdownItemSelector)),this.state.dropdown.visible||setTimeout(this.dropdown.events.binding.bind(this)),this.state.dropdown.visible=o||!0,this.state.dropdown.query=o,this.setStateSelection(),A||setTimeout(()=>{this.dropdown.position(),this.dropdown.render()}),setTimeout(()=>{this.trigger("dropdown:show",this.DOM.dropdown)})}},hide(o){var a=this.DOM,h=a.scope,d=a.dropdown,w=this.settings.dropdown.position=="manual"&&!o;if(d&&document.body.contains(d)&&!w)return window.removeEventListener("resize",this.dropdown.position),this.dropdown.events.binding.call(this,!1),h.setAttribute("aria-expanded",!1),d.parentNode.removeChild(d),setTimeout(()=>{this.state.dropdown.visible=!1},100),this.state.dropdown.query=this.state.ddItemData=this.state.ddItemElm=this.state.selection=null,this.state.tag&&this.state.tag.value.length&&(this.state.flaggedTags[this.state.tag.baseOffset]=this.state.tag),this.trigger("dropdown:hide",d),this},toggle(o){this.dropdown[this.state.dropdown.visible&&!o?"hide":"show"]()},render(){var o,a,h,d=(o=this.DOM.dropdown,(h=o.cloneNode(!0)).style.cssText="position:fixed; top:-9999px; opacity:0",document.body.appendChild(h),a=h.clientHeight,h.parentNode.removeChild(h),a),w=this.settings;return typeof w.dropdown.enabled=="number"&&w.dropdown.enabled>=0?(this.DOM.scope.setAttribute("aria-expanded",!0),document.body.contains(this.DOM.dropdown)||(this.DOM.dropdown.classList.add(w.classNames.dropdownInital),this.dropdown.position(d),w.dropdown.appendTarget.appendChild(this.DOM.dropdown),setTimeout(()=>this.DOM.dropdown.classList.remove(w.classNames.dropdownInital))),this):this},fill(o){o=typeof o=="string"?o:this.dropdown.createListHTML(o||this.suggestedListItems);var a,h=this.settings.templates.dropdownContent.call(this,o);this.DOM.dropdown.content.innerHTML=(a=h)?a.replace(/\>[\r\n ]+\</g,"><").split(/>\s+</).join("><").trim():""},fillHeaderFooter(){var o=this.dropdown.filterListItems(this.state.dropdown.query),a=this.parseTemplate("dropdownHeader",[o]),h=this.parseTemplate("dropdownFooter",[o]),d=this.dropdown.getHeaderRef(),w=this.dropdown.getFooterRef();a&&(d==null||d.parentNode.replaceChild(a,d)),h&&(w==null||w.parentNode.replaceChild(h,w))},refilter(o){o=o||this.state.dropdown.query||"",this.suggestedListItems=this.dropdown.filterListItems(o),this.dropdown.fill(),this.suggestedListItems.length||this.dropdown.hide(),this.trigger("dropdown:updated",this.DOM.dropdown)},position(o){var a=this.settings.dropdown;if(a.position!="manual"){var h,d,w,C,T,A,R=this.DOM.dropdown,j=a.placeAbove,V=a.appendTarget===document.body,W=V?window.pageYOffset:a.appendTarget.scrollTop,X=document.fullscreenElement||document.webkitFullscreenElement||document.documentElement,z=X.clientHeight,et=Math.max(X.clientWidth||0,window.innerWidth||0)>480?a.position:"all",Q=this.DOM[et=="input"?"input":"scope"];if(o=o||R.clientHeight,this.state.dropdown.visible){if(et=="text"?(w=(h=function(){const G=document.getSelection();if(G.rangeCount){const ot=G.getRangeAt(0),it=ot.startContainer,ct=ot.startOffset;let st,Et;if(ct>0)return Et=document.createRange(),Et.setStart(it,ct-1),Et.setEnd(it,ct),st=Et.getBoundingClientRect(),{left:st.right,top:st.top,bottom:st.bottom};if(it.getBoundingClientRect)return it.getBoundingClientRect()}return{left:-9999,top:-9999}}()).bottom,d=h.top,C=h.left,T="auto"):(A=function(G){for(var ot=0,it=0;G&&G!=X;)ot+=G.offsetLeft||0,it+=G.offsetTop||0,G=G.parentNode;return{left:ot,top:it}}(a.appendTarget),d=(h=Q.getBoundingClientRect()).top-A.top,w=h.bottom-1-A.top,C=h.left-A.left,T=h.width+"px"),!V){let G=function(){for(var ot=0,it=a.appendTarget.parentNode;it;)ot+=it.scrollTop||0,it=it.parentNode;return ot}();d+=G,w+=G}d=Math.floor(d),w=Math.ceil(w),j=j===void 0?z-h.bottom<o:j,R.style.cssText="left:"+(C+window.pageXOffset)+"px; width:"+T+";"+(j?"top: "+(d+W)+"px":"top: "+(w+W)+"px"),R.setAttribute("placement",j?"top":"bottom"),R.setAttribute("position",et)}}},events:{binding(){let o=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];var a=this.dropdown.events.callbacks,h=this.listeners.dropdown=this.listeners.dropdown||{position:this.dropdown.position.bind(this,null),onKeyDown:a.onKeyDown.bind(this),onMouseOver:a.onMouseOver.bind(this),onMouseLeave:a.onMouseLeave.bind(this),onClick:a.onClick.bind(this),onScroll:a.onScroll.bind(this)},d=o?"addEventListener":"removeEventListener";this.settings.dropdown.position!="manual"&&(document[d]("scroll",h.position,!0),window[d]("resize",h.position),window[d]("keydown",h.onKeyDown)),this.DOM.dropdown[d]("mouseover",h.onMouseOver),this.DOM.dropdown[d]("mouseleave",h.onMouseLeave),this.DOM.dropdown[d]("mousedown",h.onClick),this.DOM.dropdown.content[d]("scroll",h.onScroll)},callbacks:{onKeyDown(o){if(this.state.hasFocus&&!this.state.composing){var a=this.DOM.dropdown.querySelector(this.settings.classNames.dropdownItemActiveSelector),h=this.dropdown.getSuggestionDataByNode(a);switch(o.key){case"ArrowDown":case"ArrowUp":case"Down":case"Up":o.preventDefault();var d=this.dropdown.getAllSuggestionsRefs(),w=o.key=="ArrowUp"||o.key=="Up";a&&(a=this.dropdown.getNextOrPrevOption(a,!w)),a&&a.matches(this.settings.classNames.dropdownItemSelector)||(a=d[w?d.length-1:0]),this.dropdown.highlightOption(a,!0);break;case"Escape":case"Esc":this.dropdown.hide();break;case"ArrowRight":if(this.state.actions.ArrowLeft)return;case"Tab":if(this.settings.mode!="mix"&&a&&!this.settings.autoComplete.rightKey&&!this.state.editing){o.preventDefault();var C=this.dropdown.getMappedValue(h);return this.input.autocomplete.set.call(this,C),!1}return!0;case"Enter":o.preventDefault(),this.settings.hooks.suggestionClick(o,{tagify:this,tagData:h,suggestionElm:a}).then(()=>{if(a)return this.dropdown.selectOption(a),a=this.dropdown.getNextOrPrevOption(a,!w),void this.dropdown.highlightOption(a);this.dropdown.hide(),this.settings.mode!="mix"&&this.addTags(this.state.inputText.trim(),!0)}).catch(T=>T);break;case"Backspace":{if(this.settings.mode=="mix"||this.state.editing.scope)return;const T=this.input.raw.call(this);T!=""&&T.charCodeAt(0)!=8203||(this.settings.backspace===!0?this.removeTags():this.settings.backspace=="edit"&&setTimeout(this.editTag.bind(this),0))}}}},onMouseOver(o){var a=o.target.closest(this.settings.classNames.dropdownItemSelector);a&&this.dropdown.highlightOption(a)},onMouseLeave(o){this.dropdown.highlightOption()},onClick(o){if(o.button==0&&o.target!=this.DOM.dropdown&&o.target!=this.DOM.dropdown.content){var a=o.target.closest(this.settings.classNames.dropdownItemSelector),h=this.dropdown.getSuggestionDataByNode(a);this.state.actions.selectOption=!0,setTimeout(()=>this.state.actions.selectOption=!1,50),this.settings.hooks.suggestionClick(o,{tagify:this,tagData:h,suggestionElm:a}).then(()=>{a?this.dropdown.selectOption(a,o):this.dropdown.hide()}).catch(d=>console.warn(d))}},onScroll(o){var a=o.target,h=a.scrollTop/(a.scrollHeight-a.parentNode.clientHeight)*100;this.trigger("dropdown:scroll",{percentage:Math.round(h)})}}},getSuggestionDataByNode(o){var a=o&&o.getAttribute("value");return this.suggestedListItems.find(h=>h.value==a)||null},getNextOrPrevOption(o){let a=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];var h=this.dropdown.getAllSuggestionsRefs(),d=h.findIndex(w=>w===o);return a?h[d+1]:h[d-1]},highlightOption(o,a){var h,d=this.settings.classNames.dropdownItemActive;if(this.state.ddItemElm&&(this.state.ddItemElm.classList.remove(d),this.state.ddItemElm.removeAttribute("aria-selected")),!o)return this.state.ddItemData=null,this.state.ddItemElm=null,void this.input.autocomplete.suggest.call(this);h=this.dropdown.getSuggestionDataByNode(o),this.state.ddItemData=h,this.state.ddItemElm=o,o.classList.add(d),o.setAttribute("aria-selected",!0),a&&(o.parentNode.scrollTop=o.clientHeight+o.offsetTop-o.parentNode.clientHeight),this.settings.autoComplete&&(this.input.autocomplete.suggest.call(this,h),this.dropdown.position())},selectOption(o,a){var h=this.settings.dropdown,d=h.clearOnSelect,w=h.closeOnSelect;if(!o)return this.addTags(this.state.inputText,!0),void(w&&this.dropdown.hide());a=a||{};var C=o.getAttribute("value"),T=C=="noMatch",A=this.suggestedListItems.find(R=>(R.value??R)==C);this.trigger("dropdown:select",{data:A,elm:o,event:a}),C&&(A||T)?(this.state.editing?this.onEditTagDone(null,E({__isValid:!0},this.normalizeTags([A])[0])):this[this.settings.mode=="mix"?"addMixTags":"addTags"]([A||this.input.raw.call(this)],d),this.DOM.input.parentNode&&(setTimeout(()=>{this.DOM.input.focus(),this.toggleFocusClass(!0)}),w&&setTimeout(this.dropdown.hide.bind(this)),o.addEventListener("transitionend",()=>{this.dropdown.fillHeaderFooter(),setTimeout(()=>o.remove(),100)},{once:!0}),o.classList.add(this.settings.classNames.dropdownItemHidden))):w&&setTimeout(this.dropdown.hide.bind(this))},selectAll(o){this.suggestedListItems.length=0,this.dropdown.hide(),this.dropdown.filterListItems("");var a=this.dropdown.filterListItems("");return o||(a=this.state.dropdown.suggestions),this.addTags(a,!0),this},filterListItems(o,a){var h,d,w,C,T,A=this.settings,R=A.dropdown,j=(a=a||{},[]),V=[],W=A.whitelist,X=R.maxItems>=0?R.maxItems:1/0,z=R.searchKeys,et=0;if(!(o=A.mode=="select"&&this.value.length&&this.value[0][A.tagTextProp]==o?"":o)||!z.length)return j=R.includeSelectedTags?W:W.filter(G=>!this.isTagDuplicate(k(G)?G.value:G)),this.state.dropdown.suggestions=j,j.slice(0,X);function Q(G,ot){return ot.toLowerCase().split(" ").every(it=>G.includes(it.toLowerCase()))}for(T=R.caseSensitive?""+o:(""+o).toLowerCase();et<W.length;et++){let G,ot;h=W[et]instanceof Object?W[et]:{value:W[et]};let it=Object.keys(h).some(ct=>z.includes(ct))?z:["value"];R.fuzzySearch&&!a.exact?(w=it.reduce((ct,st)=>ct+" "+(h[st]||""),"").toLowerCase().trim(),R.accentedSearch&&(w=N(w),T=N(T)),G=w.indexOf(T)==0,ot=w===T,d=Q(w,T)):(G=!0,d=it.some(ct=>{var st=""+(h[ct]||"");return R.accentedSearch&&(st=N(st),T=N(T)),R.caseSensitive||(st=st.toLowerCase()),ot=st===T,a.exact?st===T:st.indexOf(T)==0})),C=!R.includeSelectedTags&&this.isTagDuplicate(k(h)?h.value:h),d&&!C&&(ot&&G?V.push(h):R.sortby=="startsWith"&&G?j.unshift(h):j.push(h))}return this.state.dropdown.suggestions=V.concat(j),typeof R.sortby=="function"?R.sortby(V.concat(j),T):V.concat(j).slice(0,X)},getMappedValue(o){var a=this.settings.dropdown.mapValueTo;return a?typeof a=="function"?a(o):o[a]||o.value:o.value},createListHTML(o){return E([],o).map((a,h)=>{typeof a!="string"&&typeof a!="number"||(a={value:a});var d=this.dropdown.getMappedValue(a);return d=typeof d=="string"?O(d):d,this.settings.templates.dropdownItem.apply(this,[i(i({},a),{},{mappedValue:d}),this])}).join("")}};const B="@yaireo/tagify/";var L,P={empty:"empty",exceed:"number of tags exceeded",pattern:"pattern mismatch",duplicate:"already exists",notAllowed:"not allowed"},U={wrapper:(o,a)=>`<tags class="${a.classNames.namespace} ${a.mode?`${a.classNames[a.mode+"Mode"]}`:""} ${o.className}"
                    ${a.readonly?"readonly":""}
                    ${a.disabled?"disabled":""}
                    ${a.required?"required":""}
                    ${a.mode==="select"?"spellcheck='false'":""}
                    tabIndex="-1">
            <span ${!a.readonly&&a.userInput?"contenteditable":""} tabIndex="0" data-placeholder="${a.placeholder||"&#8203;"}" aria-placeholder="${a.placeholder||""}"
                class="${a.classNames.input}"
                role="textbox"
                aria-autocomplete="both"
                aria-multiline="${a.mode=="mix"}"></span>
                &#8203;
        </tags>`,tag(o,a){let h=a.settings;return`<tag title="${o.title||o.value}"
                    contenteditable='false'
                    spellcheck='false'
                    tabIndex="${h.a11y.focusableTags?0:-1}"
                    class="${h.classNames.tag} ${o.class||""}"
                    ${this.getAttributes(o)}>
            <x title='' class="${h.classNames.tagX}" role='button' aria-label='remove tag'></x>
            <div>
                <span class="${h.classNames.tagText}">${o[h.tagTextProp]||o.value}</span>
            </div>
        </tag>`},dropdown(o){var a=o.dropdown,h=a.position=="manual",d=`${o.classNames.dropdown}`;return`<div class="${h?"":d} ${a.classname}" role="listbox" aria-labelledby="dropdown">
                    <div data-selector='tagify-suggestions-wrapper' class="${o.classNames.dropdownWrapper}"></div>
                </div>`},dropdownContent(o){var a=this.settings,h=this.state.dropdown.suggestions;return`
            ${a.templates.dropdownHeader.call(this,h)}
            ${o}
            ${a.templates.dropdownFooter.call(this,h)}
        `},dropdownItem(o){return`<div ${this.getAttributes(o)}
                    class='${this.settings.classNames.dropdownItem} ${o.class?o.class:""}'
                    tabindex="0"
                    role="option">${o.mappedValue||o.value}</div>`},dropdownHeader(o){return`<header data-selector='tagify-suggestions-header' class="${this.settings.classNames.dropdownHeader}"></header>`},dropdownFooter(o){var a=o.length-this.settings.dropdown.maxItems;return a>0?`<footer data-selector='tagify-suggestions-footer' class="${this.settings.classNames.dropdownFooter}">
                ${a} more items. Refine your search.
            </footer>`:""},dropdownItemNoMatch:null},Z={customBinding(){this.customEventsList.forEach(o=>{this.on(o,this.settings.callbacks[o])})},binding(){let o=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];var a,h=this.events.callbacks,d=o?"addEventListener":"removeEventListener";if(!this.state.mainEvents||!o){for(var w in this.state.mainEvents=o,o&&!this.listeners.main&&(this.events.bindGlobal.call(this),this.settings.isJQueryPlugin&&jQuery(this.DOM.originalInput).on("tagify.removeAllTags",this.removeAllTags.bind(this))),a=this.listeners.main=this.listeners.main||{focus:["input",h.onFocusBlur.bind(this)],keydown:["input",h.onKeydown.bind(this)],click:["scope",h.onClickScope.bind(this)],dblclick:["scope",h.onDoubleClickScope.bind(this)],paste:["input",h.onPaste.bind(this)],drop:["input",h.onDrop.bind(this)],compositionstart:["input",h.onCompositionStart.bind(this)],compositionend:["input",h.onCompositionEnd.bind(this)]})this.DOM[a[w][0]][d](w,a[w][1]);clearInterval(this.listeners.main.originalInputValueObserverInterval),this.listeners.main.originalInputValueObserverInterval=setInterval(h.observeOriginalInputValue.bind(this),500);var C=this.listeners.main.inputMutationObserver||new MutationObserver(h.onInputDOMChange.bind(this));C.disconnect(),this.settings.mode=="mix"&&C.observe(this.DOM.input,{childList:!0})}},bindGlobal(o){var a,h=this.events.callbacks,d=o?"removeEventListener":"addEventListener";if(this.listeners&&(o||!this.listeners.global))for(a of(this.listeners.global=this.listeners.global||[{type:this.isIE?"keydown":"input",target:this.DOM.input,cb:h[this.isIE?"onInputIE":"onInput"].bind(this)},{type:"keydown",target:window,cb:h.onWindowKeyDown.bind(this)},{type:"blur",target:this.DOM.input,cb:h.onFocusBlur.bind(this)},{type:"click",target:document,cb:h.onClickAnywhere.bind(this)}],this.listeners.global))a.target[d](a.type,a.cb)},unbindGlobal(){this.events.bindGlobal.call(this,!0)},callbacks:{onFocusBlur(o){var V,W;var a=this.settings,h=o.target?this.trim(o.target.textContent):"",d=(W=(V=this.value)==null?void 0:V[0])==null?void 0:W[a.tagTextProp],w=o.type,C=a.dropdown.enabled>=0,T={relatedTarget:o.relatedTarget},A=this.state.actions.selectOption&&(C||!a.dropdown.closeOnSelect),R=this.state.actions.addNew&&C,j=o.relatedTarget&&b.call(this,o.relatedTarget)&&this.DOM.scope.contains(o.relatedTarget);if(w=="blur"){if(o.relatedTarget===this.DOM.scope)return this.dropdown.hide(),void this.DOM.input.focus();this.postUpdate(),a.onChangeAfterBlur&&this.triggerChangeEvent()}if(!A&&!R)if(this.state.hasFocus=w=="focus"&&+new Date,this.toggleFocusClass(this.state.hasFocus),a.mode!="mix"){if(w=="focus")return this.trigger("focus",T),void(a.dropdown.enabled!==0&&a.userInput||this.dropdown.show(this.value.length?"":void 0));w=="blur"&&(this.trigger("blur",T),this.loading(!1),a.mode=="select"&&(j&&(this.removeTags(),h=""),d===h&&(h="")),h&&!this.state.actions.selectOption&&a.addTagOnBlur&&this.addTags(h,!0)),this.DOM.input.removeAttribute("style"),this.dropdown.hide()}else w=="focus"?this.trigger("focus",T):o.type=="blur"&&(this.trigger("blur",T),this.loading(!1),this.dropdown.hide(),this.state.dropdown.visible=void 0,this.setStateSelection())},onCompositionStart(o){this.state.composing=!0},onCompositionEnd(o){this.state.composing=!1},onWindowKeyDown(o){var a,h=document.activeElement,d=b.call(this,h)&&this.DOM.scope.contains(document.activeElement),w=d&&h.hasAttribute("readonly");if(d&&!w)switch(a=h.nextElementSibling,o.key){case"Backspace":this.settings.readonly||(this.removeTags(h),(a||this.DOM.input).focus());break;case"Enter":setTimeout(this.editTag.bind(this),0,h)}},onKeydown(o){var a=this.settings;if(!this.state.composing&&a.userInput){a.mode=="select"&&a.enforceWhitelist&&this.value.length&&o.key!="Tab"&&o.preventDefault();var h=this.trim(o.target.textContent);if(this.trigger("keydown",{event:o}),a.mode=="mix"){switch(o.key){case"Left":case"ArrowLeft":this.state.actions.ArrowLeft=!0;break;case"Delete":case"Backspace":if(this.state.editing)return;var d=document.getSelection(),w=o.key=="Delete"&&d.anchorOffset==(d.anchorNode.length||0),C=d.anchorNode.previousSibling,T=d.anchorNode.nodeType==1||!d.anchorOffset&&C&&C.nodeType==1&&d.anchorNode.previousSibling;p(this.DOM.input.innerHTML);var A,R,j,V=this.getTagElms(),W=d.anchorNode.length===1&&d.anchorNode.nodeValue=="​";if(a.backspace=="edit"&&T)return A=d.anchorNode.nodeType==1?null:d.anchorNode.previousElementSibling,setTimeout(this.editTag.bind(this),0,A),void o.preventDefault();if(v()&&T instanceof Element)return j=m(T),T.hasAttribute("readonly")||T.remove(),this.DOM.input.focus(),void setTimeout(()=>{y(j),this.DOM.input.click()});if(d.anchorNode.nodeName=="BR")return;if((w||T)&&d.anchorNode.nodeType==1?R=d.anchorOffset==0?w?V[0]:null:V[Math.min(V.length,d.anchorOffset)-1]:w?R=d.anchorNode.nextElementSibling:T instanceof Element&&(R=T),d.anchorNode.nodeType==3&&!d.anchorNode.nodeValue&&d.anchorNode.previousElementSibling&&o.preventDefault(),(T||w)&&!a.backspace||d.type!="Range"&&!d.anchorOffset&&d.anchorNode==this.DOM.input&&o.key!="Delete")return void o.preventDefault();if(d.type!="Range"&&R&&R.hasAttribute("readonly"))return void y(m(R));o.key=="Delete"&&W&&_(d.anchorNode.nextSibling)&&this.removeTags(d.anchorNode.nextSibling),clearTimeout(L),L=setTimeout(()=>{var X=document.getSelection();p(this.DOM.input.innerHTML),!w&&X.anchorNode.previousSibling,this.value=[].map.call(V,(z,et)=>{var Q=_(z);if(z.parentNode||Q.readonly)return Q;this.trigger("remove",{tag:z,index:et,data:Q})}).filter(z=>z)},20)}return!0}switch(o.key){case"Backspace":a.mode=="select"&&a.enforceWhitelist&&this.value.length?this.removeTags():this.state.dropdown.visible&&a.dropdown.position!="manual"||o.target.textContent!=""&&h.charCodeAt(0)!=8203||(a.backspace===!0?this.removeTags():a.backspace=="edit"&&setTimeout(this.editTag.bind(this),0));break;case"Esc":case"Escape":if(this.state.dropdown.visible)return;o.target.blur();break;case"Down":case"ArrowDown":this.state.dropdown.visible||this.dropdown.show();break;case"ArrowRight":{let X=this.state.inputSuggestion||this.state.ddItemData;if(X&&a.autoComplete.rightKey)return void this.addTags([X],!0);break}case"Tab":{let X=a.mode=="select";if(!h||X)return!0;o.preventDefault()}case"Enter":if(this.state.dropdown.visible&&a.dropdown.position!="manual")return;o.preventDefault(),setTimeout(()=>{this.state.dropdown.visible||this.state.actions.selectOption||this.addTags(h,!0)})}}},onInput(o){this.postUpdate();var a=this.settings;if(a.mode=="mix")return this.events.callbacks.onMixTagsInput.call(this,o);var h=this.input.normalize.call(this),d=h.length>=a.dropdown.enabled,w={value:h,inputElm:this.DOM.input},C=this.validateTag({value:h});a.mode=="select"&&this.toggleScopeValidation(C),w.isValid=C,this.state.inputText!=h&&(this.input.set.call(this,h,!1),h.search(a.delimiters)!=-1?this.addTags(h)&&this.input.set.call(this):a.dropdown.enabled>=0&&this.dropdown[d?"show":"hide"](h),this.trigger("input",w))},onMixTagsInput(o){var a,h,d,w,C,T,A,R,j=this.settings,V=this.value.length,W=this.getTagElms(),X=document.createDocumentFragment(),z=window.getSelection().getRangeAt(0),et=[].map.call(W,Q=>_(Q).value);if(o.inputType=="deleteContentBackward"&&v()&&this.events.callbacks.onKeydown.call(this,{target:o.target,key:"Backspace"}),S(this.getTagElms()),this.value.slice().forEach(Q=>{Q.readonly&&!et.includes(Q.value)&&X.appendChild(this.createTagElem(Q))}),X.childNodes.length&&(z.insertNode(X),this.setRangeAtStartEnd(!1,X.lastChild)),W.length!=V)return this.value=[].map.call(this.getTagElms(),Q=>_(Q)),void this.update({withoutChangeEvent:!0});if(this.hasMaxTags())return!0;if(window.getSelection&&(T=window.getSelection()).rangeCount>0&&T.anchorNode.nodeType==3){if((z=T.getRangeAt(0).cloneRange()).collapse(!0),z.setStart(T.focusNode,0),d=(a=z.toString().slice(0,z.endOffset)).split(j.pattern).length-1,(h=a.match(j.pattern))&&(w=a.slice(a.lastIndexOf(h[h.length-1]))),w){if(this.state.actions.ArrowLeft=!1,this.state.tag={prefix:w.match(j.pattern)[0],value:w.replace(j.pattern,"")},this.state.tag.baseOffset=T.baseOffset-this.state.tag.value.length,R=this.state.tag.value.match(j.delimiters))return this.state.tag.value=this.state.tag.value.replace(j.delimiters,""),this.state.tag.delimiters=R[0],this.addTags(this.state.tag.value,j.dropdown.clearOnSelect),void this.dropdown.hide();C=this.state.tag.value.length>=j.dropdown.enabled;try{A=(A=this.state.flaggedTags[this.state.tag.baseOffset]).prefix==this.state.tag.prefix&&A.value[0]==this.state.tag.value[0],this.state.flaggedTags[this.state.tag.baseOffset]&&!this.state.tag.value&&delete this.state.flaggedTags[this.state.tag.baseOffset]}catch{}(A||d<this.state.mixMode.matchedPatternCount)&&(C=!1)}else this.state.flaggedTags={};this.state.mixMode.matchedPatternCount=d}setTimeout(()=>{this.update({withoutChangeEvent:!0}),this.trigger("input",E({},this.state.tag,{textContent:this.DOM.input.textContent})),this.state.tag&&this.dropdown[C?"show":"hide"](this.state.tag.value)},10)},onInputIE(o){var a=this;setTimeout(function(){a.events.callbacks.onInput.call(a,o)})},observeOriginalInputValue(){this.DOM.originalInput.parentNode||this.destroy(),this.DOM.originalInput.value!=this.DOM.originalInput.tagifyValue&&this.loadOriginalValues()},onClickAnywhere(o){o.target==this.DOM.scope||this.DOM.scope.contains(o.target)||(this.toggleFocusClass(!1),this.state.hasFocus=!1)},onClickScope(o){var a=this.settings,h=o.target.closest("."+a.classNames.tag),d=+new Date-this.state.hasFocus;if(o.target!=this.DOM.scope){if(!o.target.classList.contains(a.classNames.tagX))return h?(this.trigger("click",{tag:h,index:this.getNodeIndex(h),data:_(h),event:o}),void(a.editTags!==1&&a.editTags.clicks!==1||this.events.callbacks.onDoubleClickScope.call(this,o))):void(o.target==this.DOM.input&&(a.mode=="mix"&&this.fixFirefoxLastTagNoCaret(),d>500)?this.state.dropdown.visible?this.dropdown.hide():a.dropdown.enabled===0&&a.mode!="mix"&&this.dropdown.show(this.value.length?"":void 0):a.mode!="select"||a.dropdown.enabled!==0||this.state.dropdown.visible||this.dropdown.show());this.removeTags(o.target.parentNode)}else this.DOM.input.focus()},onPaste(o){o.preventDefault();var a,h,d=this.settings;if(d.mode=="select"&&d.enforceWhitelist||!d.userInput)return!1;d.readonly||(a=o.clipboardData||window.clipboardData,h=a.getData("Text"),d.hooks.beforePaste(o,{tagify:this,pastedText:h,clipboardData:a}).then(w=>{w===void 0&&(w=h),w&&(this.injectAtCaret(w,window.getSelection().getRangeAt(0)),this.settings.mode=="mix"?this.events.callbacks.onMixTagsInput.call(this,o):this.settings.pasteAsTags?this.addTags(this.state.inputText+w,!0):this.state.inputText=w)}).catch(w=>w))},onDrop(o){o.preventDefault()},onEditTagInput(o,a){var h=o.closest("."+this.settings.classNames.tag),d=this.getNodeIndex(h),w=_(h),C=this.input.normalize.call(this,o),T={[this.settings.tagTextProp]:C,__tagId:w.__tagId},A=this.validateTag(T);this.editTagChangeDetected(E(w,T))||o.originalIsValid!==!0||(A=!0),h.classList.toggle(this.settings.classNames.tagInvalid,A!==!0),w.__isValid=A,h.title=A===!0?w.title||w.value:A,C.length>=this.settings.dropdown.enabled&&(this.state.editing&&(this.state.editing.value=C),this.dropdown.show(C)),this.trigger("edit:input",{tag:h,index:d,data:E({},this.value[d],{newValue:C}),event:a})},onEditTagPaste(o,a){var h=(a.clipboardData||window.clipboardData).getData("Text");a.preventDefault();var d=g(h);this.setRangeAtStartEnd(!1,d)},onEditTagFocus(o){this.state.editing={scope:o,input:o.querySelector("[contenteditable]")}},onEditTagBlur(o){if(this.state.hasFocus||this.toggleFocusClass(),this.DOM.scope.contains(o)){var a,h,d=this.settings,w=o.closest("."+d.classNames.tag),C=_(w),T=this.input.normalize.call(this,o),A={[d.tagTextProp]:T,__tagId:C.__tagId},R=C.__originalData,j=this.editTagChangeDetected(E(C,A)),V=this.validateTag(A);if(T)if(j){if(a=this.hasMaxTags(),h=E({},R,{[d.tagTextProp]:this.trim(T),__isValid:V}),d.transformTag.call(this,h,R),(V=(!a||R.__isValid===!0)&&this.validateTag(h))!==!0){if(this.trigger("invalid",{data:h,tag:w,message:V}),d.editTags.keepInvalid)return;d.keepInvalidTags?h.__isValid=V:h=R}else d.keepInvalidTags&&(delete h.title,delete h["aria-invalid"],delete h.class);this.onEditTagDone(w,h)}else this.onEditTagDone(w,R);else this.onEditTagDone(w)}},onEditTagkeydown(o,a){if(!this.state.composing)switch(this.trigger("edit:keydown",{event:o}),o.key){case"Esc":case"Escape":a.parentNode.replaceChild(a.__tagifyTagData.__originalHTML,a),this.state.editing=!1;case"Enter":case"Tab":o.preventDefault(),o.target.blur()}},onDoubleClickScope(o){var a,h,d=o.target.closest("."+this.settings.classNames.tag),w=_(d),C=this.settings;d&&C.userInput&&w.editable!==!1&&(a=d.classList.contains(this.settings.classNames.tagEditing),h=d.hasAttribute("readonly"),C.mode=="select"||C.readonly||a||h||!this.settings.editTags||this.editTag(d),this.toggleFocusClass(!0),this.trigger("dblclick",{tag:d,index:this.getNodeIndex(d),data:_(d)}))},onInputDOMChange(o){o.forEach(h=>{h.addedNodes.forEach(d=>{var w;if(d.outerHTML=="<div><br></div>")d.replaceWith(document.createElement("br"));else if(d.nodeType==1&&d.querySelector(this.settings.classNames.tagSelector)){let C=document.createTextNode("");d.childNodes[0].nodeType==3&&d.previousSibling.nodeName!="BR"&&(C=document.createTextNode(`
`)),d.replaceWith(C,...[...d.childNodes].slice(0,-1)),y(C)}else if(b.call(this,d))if(((w=d.previousSibling)==null?void 0:w.nodeType)!=3||d.previousSibling.textContent||d.previousSibling.remove(),d.previousSibling&&d.previousSibling.nodeName=="BR"){d.previousSibling.replaceWith(`
`+l);let C=d.nextSibling,T="";for(;C;)T+=C.textContent,C=C.nextSibling;T.trim()&&y(d.previousSibling)}else d.previousSibling&&!_(d.previousSibling)||d.before(l)}),h.removedNodes.forEach(d=>{d&&d.nodeName=="BR"&&b.call(this,a)&&(this.removeTags(a),this.fixFirefoxLastTagNoCaret())})});var a=this.DOM.input.lastChild;a&&a.nodeValue==""&&a.remove(),a&&a.nodeName=="BR"||this.DOM.input.appendChild(document.createElement("br"))}}};function Y(o,a){if(!o){console.warn("Tagify:","input element not found",o);const d=new Proxy(this,{get:()=>()=>d});return d}if(o.__tagify)return console.warn("Tagify: ","input element is already Tagified - Same instance is returned.",o),o.__tagify;var h;E(this,function(d){var w=document.createTextNode("");function C(T,A,R){R&&A.split(/\s+/g).forEach(j=>w[T+"EventListener"].call(w,j,R))}return{off(T,A){return C("remove",T,A),this},on(T,A){return A&&typeof A=="function"&&C("add",T,A),this},trigger(T,A,R){var j;if(R=R||{cloneData:!0},T)if(d.settings.isJQueryPlugin)T=="remove"&&(T="removeTag"),jQuery(d.DOM.originalInput).triggerHandler(T,[A]);else{try{var V=typeof A=="object"?A:{value:A};if((V=R.cloneData?E({},V):V).tagify=this,A.event&&(V.event=this.cloneEvent(A.event)),A instanceof Object)for(var W in A)A[W]instanceof HTMLElement&&(V[W]=A[W]);j=new CustomEvent(T,{detail:V})}catch(X){console.warn(X)}w.dispatchEvent(j)}}}}(this)),this.isFirefox=/firefox|fxios/i.test(navigator.userAgent)&&!/seamonkey/i.test(navigator.userAgent),this.isIE=window.document.documentMode,a=a||{},this.getPersistedData=(h=a.id,d=>{let w,C="/"+d;if(localStorage.getItem(B+h+"/v",1)==1)try{w=JSON.parse(localStorage[B+h+C])}catch{}return w}),this.setPersistedData=(d=>d?(localStorage.setItem(B+d+"/v",1),(w,C)=>{let T="/"+C,A=JSON.stringify(w);w&&C&&(localStorage.setItem(B+d+T,A),dispatchEvent(new Event("storage")))}):()=>{})(a.id),this.clearPersistedData=(d=>w=>{const C=B+"/"+d+"/";if(w)localStorage.removeItem(C+w);else for(let T in localStorage)T.includes(C)&&localStorage.removeItem(T)})(a.id),this.applySettings(o,a),this.state={inputText:"",editing:!1,composing:!1,actions:{},mixMode:{},dropdown:{},flaggedTags:{}},this.value=[],this.listeners={},this.DOM={},this.build(o),$.call(this),this.getCSSVars(),this.loadOriginalValues(),this.events.customBinding.call(this),this.events.binding.call(this),o.autofocus&&this.DOM.input.focus(),o.__tagify=this}return Y.prototype={_dropdown:F,getSetTagData:_,helpers:{sameStr:u,removeCollectionProp:s,omit:c,isObject:k,parseHTML:f,escapeHTML:O,extend:E,concatWithoutDups:D,getUID:x,isNodeTag:b},customEventsList:["change","add","remove","invalid","input","click","keydown","focus","blur","edit:input","edit:beforeUpdate","edit:updated","edit:start","edit:keydown","dropdown:show","dropdown:hide","dropdown:select","dropdown:updated","dropdown:noMatch","dropdown:scroll"],dataProps:["__isValid","__removed","__originalData","__originalHTML","__tagId"],trim(o){return this.settings.trim&&o&&typeof o=="string"?o.trim():o},parseHTML:f,templates:U,parseTemplate(o,a){return f((o=this.settings.templates[o]||o).apply(this,a))},set whitelist(o){const a=o&&Array.isArray(o);this.settings.whitelist=a?o:[],this.setPersistedData(a?o:[],"whitelist")},get whitelist(){return this.settings.whitelist},generateClassSelectors(o){for(let a in o){let h=a;Object.defineProperty(o,h+"Selector",{get(){return"."+this[h].split(" ")[0]}})}},applySettings(o,a){var C,T;I.templates=this.templates;var h=E({},I,a.mode=="mix"?{dropdown:{position:"text"}}:{}),d=this.settings=E({},h,a);if(d.disabled=o.hasAttribute("disabled"),d.readonly=d.readonly||o.hasAttribute("readonly"),d.placeholder=O(o.getAttribute("placeholder")||d.placeholder||""),d.required=o.hasAttribute("required"),this.generateClassSelectors(d.classNames),d.dropdown.includeSelectedTags===void 0&&(d.dropdown.includeSelectedTags=d.duplicates),this.isIE&&(d.autoComplete=!1),["whitelist","blacklist"].forEach(A=>{var R=o.getAttribute("data-"+A);R&&(R=R.split(d.delimiters))instanceof Array&&(d[A]=R)}),"autoComplete"in a&&!k(a.autoComplete)&&(d.autoComplete=I.autoComplete,d.autoComplete.enabled=a.autoComplete),d.mode=="mix"&&(d.pattern=d.pattern||/@/,d.autoComplete.rightKey=!0,d.delimiters=a.delimiters||null,d.tagTextProp&&!d.dropdown.searchKeys.includes(d.tagTextProp)&&d.dropdown.searchKeys.push(d.tagTextProp)),o.pattern)try{d.pattern=new RegExp(o.pattern)}catch{}if(d.delimiters){d._delimiters=d.delimiters;try{d.delimiters=new RegExp(this.settings.delimiters,"g")}catch{}}d.disabled&&(d.userInput=!1),this.TEXTS=i(i({},P),d.texts||{}),(d.mode!="select"||(C=a.dropdown)!=null&&C.enabled)&&d.userInput||(d.dropdown.enabled=0),d.dropdown.appendTarget=((T=a.dropdown)==null?void 0:T.appendTarget)||document.body;let w=this.getPersistedData("whitelist");Array.isArray(w)&&(this.whitelist=Array.isArray(d.whitelist)?D(d.whitelist,w):w)},getAttributes(o){var a,h=this.getCustomAttributes(o),d="";for(a in h)d+=" "+a+(o[a]!==void 0?`="${h[a]}"`:"");return d},getCustomAttributes(o){if(!k(o))return"";var a,h={};for(a in o)a.slice(0,2)!="__"&&a!="class"&&o.hasOwnProperty(a)&&o[a]!==void 0&&(h[a]=O(o[a]));return h},setStateSelection(){var o=window.getSelection(),a={anchorOffset:o.anchorOffset,anchorNode:o.anchorNode,range:o.getRangeAt&&o.rangeCount&&o.getRangeAt(0)};return this.state.selection=a,a},getCSSVars(){var o=getComputedStyle(this.DOM.scope,null),a;this.CSSVars={tagHideTransition:(h=>{let d=h.value;return h.unit=="s"?1e3*d:d})(function(h){if(!h)return{};var d=(h=h.trim().split(" ")[0]).split(/\d+/g).filter(w=>w).pop().trim();return{value:+h.split(d).filter(w=>w)[0].trim(),unit:d}}((a="tag-hide-transition",o.getPropertyValue("--"+a))))}},build(o){var a=this.DOM;this.settings.mixMode.integrated?(a.originalInput=null,a.scope=o,a.input=o):(a.originalInput=o,a.originalInput_tabIndex=o.tabIndex,a.scope=this.parseTemplate("wrapper",[o,this.settings]),a.input=a.scope.querySelector(this.settings.classNames.inputSelector),o.parentNode.insertBefore(a.scope,o),o.tabIndex=-1)},destroy(){this.events.unbindGlobal.call(this),this.DOM.scope.parentNode.removeChild(this.DOM.scope),this.DOM.originalInput.tabIndex=this.DOM.originalInput_tabIndex,delete this.DOM.originalInput.__tagify,this.dropdown.hide(!0),clearTimeout(this.dropdownHide__bindEventsTimeout),clearInterval(this.listeners.main.originalInputValueObserverInterval)},loadOriginalValues(o){var a,h=this.settings;if(this.state.blockChangeEvent=!0,o===void 0){const d=this.getPersistedData("value");o=d&&!this.DOM.originalInput.value?d:h.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value}if(this.removeAllTags(),o)if(h.mode=="mix")this.parseMixTags(o),(a=this.DOM.input.lastChild)&&a.tagName=="BR"||this.DOM.input.insertAdjacentHTML("beforeend","<br>");else{try{JSON.parse(o)instanceof Array&&(o=JSON.parse(o))}catch{}this.addTags(o,!0).forEach(d=>d&&d.classList.add(h.classNames.tagNoAnimation))}else this.postUpdate();this.state.lastOriginalValueReported=h.mixMode.integrated?"":this.DOM.originalInput.value},cloneEvent(o){var a={};for(var h in o)h!="path"&&(a[h]=o[h]);return a},loading(o){return this.state.isLoading=o,this.DOM.scope.classList[o?"add":"remove"](this.settings.classNames.scopeLoading),this},tagLoading(o,a){return o&&o.classList[a?"add":"remove"](this.settings.classNames.tagLoading),this},toggleClass(o,a){typeof o=="string"&&this.DOM.scope.classList.toggle(o,a)},toggleScopeValidation(o){var a=o===!0||o===void 0;!this.settings.required&&o&&o===this.TEXTS.empty&&(a=!0),this.toggleClass(this.settings.classNames.tagInvalid,!a),this.DOM.scope.title=a?"":o},toggleFocusClass(o){this.toggleClass(this.settings.classNames.focus,!!o)},triggerChangeEvent:function(){if(!this.settings.mixMode.integrated){var o=this.DOM.originalInput,a=this.state.lastOriginalValueReported!==o.value,h=new CustomEvent("change",{bubbles:!0});a&&(this.state.lastOriginalValueReported=o.value,h.simulated=!0,o._valueTracker&&o._valueTracker.setValue(Math.random()),o.dispatchEvent(h),this.trigger("change",this.state.lastOriginalValueReported),o.value=this.state.lastOriginalValueReported)}},events:Z,fixFirefoxLastTagNoCaret(){},setRangeAtStartEnd(o,a){if(a){o=typeof o=="number"?o:!!o,a=a.lastChild||a;var h=document.getSelection();if(h.focusNode instanceof Element&&!this.DOM.input.contains(h.focusNode))return!0;try{h.rangeCount>=1&&["Start","End"].forEach(d=>h.getRangeAt(0)["set"+d](a,o||a.length))}catch{}}},insertAfterTag(o,a){if(a=a||this.settings.mixMode.insertAfterTag,o&&o.parentNode&&a)return a=typeof a=="string"?document.createTextNode(a):a,o.parentNode.insertBefore(a,o.nextSibling),a},editTagChangeDetected(o){var a=o.__originalData;for(var h in a)if(!this.dataProps.includes(h)&&o[h]!=a[h])return!0;return!1},getTagTextNode(o){return o.querySelector(this.settings.classNames.tagTextSelector)},setTagTextNode(o,a){this.getTagTextNode(o).innerHTML=O(a)},editTag(o,a){o=o||this.getLastTag(),a=a||{},this.dropdown.hide();var h=this.settings,d=this.getTagTextNode(o),w=this.getNodeIndex(o),C=_(o),T=this.events.callbacks,A=this,R=!0;if(d){if(!(C instanceof Object&&"editable"in C)||C.editable)return C=_(o,{__originalData:E({},C),__originalHTML:o.cloneNode(!0)}),_(C.__originalHTML,C.__originalData),d.setAttribute("contenteditable",!0),o.classList.add(h.classNames.tagEditing),d.addEventListener("focus",T.onEditTagFocus.bind(this,o)),d.addEventListener("blur",function(){setTimeout(()=>T.onEditTagBlur.call(A,A.getTagTextNode(o)))}),d.addEventListener("input",T.onEditTagInput.bind(this,d)),d.addEventListener("paste",T.onEditTagPaste.bind(this,d)),d.addEventListener("keydown",j=>T.onEditTagkeydown.call(this,j,o)),d.addEventListener("compositionstart",T.onCompositionStart.bind(this)),d.addEventListener("compositionend",T.onCompositionEnd.bind(this)),a.skipValidation||(R=this.editTagToggleValidity(o)),d.originalIsValid=R,this.trigger("edit:start",{tag:o,index:w,data:C,isValid:R}),d.focus(),this.setRangeAtStartEnd(!1,d),this}else console.warn("Cannot find element in Tag template: .",h.classNames.tagTextSelector)},editTagToggleValidity(o,a){var h;if(a=a||_(o))return(h=!("__isValid"in a)||a.__isValid===!0)||this.removeTagsFromValue(o),this.update(),o.classList.toggle(this.settings.classNames.tagNotAllowed,!h),a.__isValid=h,a.__isValid;console.warn("tag has no data: ",o,a)},onEditTagDone(o,a){a=a||{};var h={tag:o=o||this.state.editing.scope,index:this.getNodeIndex(o),previousData:_(o),data:a};this.trigger("edit:beforeUpdate",h,{cloneData:!1}),this.state.editing=!1,delete a.__originalData,delete a.__originalHTML,o&&a[this.settings.tagTextProp]?(o=this.replaceTag(o,a),this.editTagToggleValidity(o,a),this.settings.a11y.focusableTags?o.focus():y(o)):o&&this.removeTags(o),this.trigger("edit:updated",h),this.dropdown.hide(),this.settings.keepInvalidTags&&this.reCheckInvalidTags()},replaceTag(o,a){a&&a.value||(a=o.__tagifyTagData),a.__isValid&&a.__isValid!=1&&E(a,this.getInvalidTagAttrs(a,a.__isValid));var h=this.createTagElem(a);return o.parentNode.replaceChild(h,o),this.updateValueByDOMTags(),h},updateValueByDOMTags(){this.value.length=0,[].forEach.call(this.getTagElms(),o=>{o.classList.contains(this.settings.classNames.tagNotAllowed.split(" ")[0])||this.value.push(_(o))}),this.update()},injectAtCaret(o,a){var h;return!(a=a||((h=this.state.selection)==null?void 0:h.range))&&o?(this.appendMixTags(o),this):(g(o,a),this.setRangeAtStartEnd(!1,o),this.updateValueByDOMTags(),this.update(),this)},input:{set(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",a=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];var h=this.settings.dropdown.closeOnSelect;this.state.inputText=o,a&&(this.DOM.input.innerHTML=O(""+o)),!o&&h&&this.dropdown.hide.bind(this),this.input.autocomplete.suggest.call(this),this.input.validate.call(this)},raw(){return this.DOM.input.textContent},validate(){var o=!this.state.inputText||this.validateTag({value:this.state.inputText})===!0;return this.DOM.input.classList.toggle(this.settings.classNames.inputInvalid,!o),o},normalize(o){var a=o||this.DOM.input,h=[];a.childNodes.forEach(d=>d.nodeType==3&&h.push(d.nodeValue)),h=h.join(`
`);try{h=h.replace(/(?:\r\n|\r|\n)/g,this.settings.delimiters.source.charAt(0))}catch{}return h=h.replace(/\s/g," "),this.trim(h)},autocomplete:{suggest(o){if(this.settings.autoComplete.enabled){typeof(o=o||{value:""})=="string"&&(o={value:o});var a=this.dropdown.getMappedValue(o);if(typeof a!="number"){var h=a.substr(0,this.state.inputText.length).toLowerCase(),d=a.substring(this.state.inputText.length);a&&this.state.inputText&&h==this.state.inputText.toLowerCase()?(this.DOM.input.setAttribute("data-suggest",d),this.state.inputSuggestion=o):(this.DOM.input.removeAttribute("data-suggest"),delete this.state.inputSuggestion)}}},set(o){var a=this.DOM.input.getAttribute("data-suggest"),h=o||(a?this.state.inputText+a:null);return!!h&&(this.settings.mode=="mix"?this.replaceTextWithNode(document.createTextNode(this.state.tag.prefix+h)):(this.input.set.call(this,h),this.setRangeAtStartEnd(!1,this.DOM.input)),this.input.autocomplete.suggest.call(this),this.dropdown.hide(),!0)}}},getTagIdx(o){return this.value.findIndex(a=>a.__tagId==(o||{}).__tagId)},getNodeIndex(o){var a=0;if(o)for(;o=o.previousElementSibling;)a++;return a},getTagElms(){for(var o=arguments.length,a=new Array(o),h=0;h<o;h++)a[h]=arguments[h];var d="."+[...this.settings.classNames.tag.split(" "),...a].join(".");return[].slice.call(this.DOM.scope.querySelectorAll(d))},getLastTag(){var o=this.DOM.scope.querySelectorAll(`${this.settings.classNames.tagSelector}:not(.${this.settings.classNames.tagHide}):not([readonly])`);return o[o.length-1]},isTagDuplicate(o,a,h){var d=0;if(this.settings.mode=="select")return!1;for(let w of this.value)u(this.trim(""+o),w.value,a)&&h!=w.__tagId&&d++;return d},getTagIndexByValue(o){var a=[],h=this.settings.dropdown.caseSensitive;return this.getTagElms().forEach((d,w)=>{d.__tagifyTagData&&u(this.trim(d.__tagifyTagData.value),o,h)&&a.push(w)}),a},getTagElmByValue(o){var a=this.getTagIndexByValue(o)[0];return this.getTagElms()[a]},flashTag(o){o&&(o.classList.add(this.settings.classNames.tagFlash),setTimeout(()=>{o.classList.remove(this.settings.classNames.tagFlash)},100))},isTagBlacklisted(o){return o=this.trim(o.toLowerCase()),this.settings.blacklist.filter(a=>(""+a).toLowerCase()==o).length},isTagWhitelisted(o){return!!this.getWhitelistItem(o)},getWhitelistItem(o,a,h){a=a||"value";var d,w=this.settings;return(h=h||w.whitelist).some(C=>{var T=typeof C=="string"?C:C[a]||C.value;if(u(T,o,w.dropdown.caseSensitive,w.trim))return d=typeof C=="string"?{value:C}:C,!0}),d||a!="value"||w.tagTextProp=="value"||(d=this.getWhitelistItem(o,w.tagTextProp,h)),d},validateTag(o){var a=this.settings,h="value"in o?"value":a.tagTextProp,d=this.trim(o[h]+"");return(o[h]+"").trim()?a.mode!="mix"&&a.pattern&&a.pattern instanceof RegExp&&!a.pattern.test(d)?this.TEXTS.pattern:!a.duplicates&&this.isTagDuplicate(d,a.dropdown.caseSensitive,o.__tagId)?this.TEXTS.duplicate:this.isTagBlacklisted(d)||a.enforceWhitelist&&!this.isTagWhitelisted(d)?this.TEXTS.notAllowed:!a.validate||a.validate(o):this.TEXTS.empty},getInvalidTagAttrs(o,a){return{"aria-invalid":!0,class:`${o.class||""} ${this.settings.classNames.tagNotAllowed}`.trim(),title:a}},hasMaxTags(){return this.value.length>=this.settings.maxTags&&this.TEXTS.exceed},setReadonly(o,a){var h=this.settings;document.activeElement.blur(),h[a||"readonly"]=o,this.DOM.scope[(o?"set":"remove")+"Attribute"](a||"readonly",!0),this.settings.userInput=!0,this.setContentEditable(!o)},setContentEditable(o){this.settings.userInput&&(this.DOM.input.contentEditable=o,this.DOM.input.tabIndex=o?0:-1)},setDisabled(o){this.setReadonly(o,"disabled")},normalizeTags(o){var a=this.settings,h=a.whitelist,d=a.delimiters,w=a.mode,C=a.tagTextProp,T=[],A=!!h&&h[0]instanceof Object,R=Array.isArray(o),j=R&&o[0].value,V=W=>(W+"").split(d).filter(X=>X).map(X=>({[C]:this.trim(X),value:this.trim(X)}));if(typeof o=="number"&&(o=o.toString()),typeof o=="string"){if(!o.trim())return[];o=V(o)}else R&&(o=[].concat(...o.map(W=>W.value!=null?W:V(W))));return A&&!j&&(o.forEach(W=>{var X=T.map(Q=>Q.value),z=this.dropdown.filterListItems.call(this,W[C],{exact:!0});this.settings.duplicates||(z=z.filter(Q=>!X.includes(Q.value)));var et=z.length>1?this.getWhitelistItem(W[C],C,z):z[0];et&&et instanceof Object?T.push(et):w!="mix"&&(W.value==null&&(W.value=W[C]),T.push(W))}),T.length&&(o=T)),o},parseMixTags(o){var a=this.settings,h=a.mixTagsInterpolator,d=a.duplicates,w=a.transformTag,C=a.enforceWhitelist,T=a.maxTags,A=a.tagTextProp,R=[];o=o.split(h[0]).map((V,W)=>{var X,z,et,Q=V.split(h[1]),G=Q[0],ot=R.length==T;try{if(G==+G)throw Error;z=JSON.parse(G)}catch{z=this.normalizeTags(G)[0]||{value:G}}if(w.call(this,z),ot||!(Q.length>1)||C&&!this.isTagWhitelisted(z.value)||!d&&this.isTagDuplicate(z.value)){if(V)return W?h[0]+V:V}else z[X=z[A]?A:"value"]=this.trim(z[X]),et=this.createTagElem(z),R.push(z),et.classList.add(this.settings.classNames.tagNoAnimation),Q[0]=et.outerHTML,this.value.push(z);return Q.join("")}).join(""),this.DOM.input.innerHTML=o,this.DOM.input.appendChild(document.createTextNode("")),this.DOM.input.normalize();var j=this.getTagElms();return j.forEach((V,W)=>_(V,R[W])),this.update({withoutChangeEvent:!0}),S(j,this.state.hasFocus),o},replaceTextWithNode(o,a){if(this.state.tag||a){a=a||this.state.tag.prefix+this.state.tag.value;var h,d,w=this.state.selection||window.getSelection(),C=w.anchorNode,T=this.state.tag.delimiters?this.state.tag.delimiters.length:0;return C.splitText(w.anchorOffset-T),(h=C.nodeValue.lastIndexOf(a))==-1||(d=C.splitText(h),o&&C.parentNode.replaceChild(o,d)),!0}},selectTag(o,a){var h=this.settings;if(!h.enforceWhitelist||this.isTagWhitelisted(a.value)){this.input.set.call(this,a[h.tagTextProp]||a.value,!0),this.state.actions.selectOption&&setTimeout(()=>this.setRangeAtStartEnd(!1,this.DOM.input));var d=this.getLastTag();return d?this.replaceTag(d,a):this.appendTag(o),this.value[0]=a,this.update(),this.trigger("add",{tag:o,data:a}),[o]}},addEmptyTag(o){var a=E({value:""},o||{}),h=this.createTagElem(a);_(h,a),this.appendTag(h),this.editTag(h,{skipValidation:!0})},addTags(o,a,h){var d=[],w=this.settings,C=[],T=document.createDocumentFragment();if(h=h||w.skipInvalid,!o||o.length==0)return d;switch(o=this.normalizeTags(o),w.mode){case"mix":return this.addMixTags(o);case"select":a=!1,this.removeAllTags()}return this.DOM.input.removeAttribute("style"),o.forEach(A=>{var R,j={},V=Object.assign({},A,{value:A.value+""});if(A=Object.assign({},V),w.transformTag.call(this,A),A.__isValid=this.hasMaxTags()||this.validateTag(A),A.__isValid!==!0){if(h)return;if(E(j,this.getInvalidTagAttrs(A,A.__isValid),{__preInvalidData:V}),A.__isValid==this.TEXTS.duplicate&&this.flashTag(this.getTagElmByValue(A.value)),!w.createInvalidTags)return void C.push(A.value)}if("readonly"in A&&(A.readonly?j["aria-readonly"]=!0:delete A.readonly),R=this.createTagElem(A,j),d.push(R),w.mode=="select")return this.selectTag(R,A);T.appendChild(R),A.__isValid&&A.__isValid===!0?(this.value.push(A),this.trigger("add",{tag:R,index:this.value.length-1,data:A})):(this.trigger("invalid",{data:A,index:this.value.length,tag:R,message:A.__isValid}),w.keepInvalidTags||setTimeout(()=>this.removeTags(R,!0),1e3)),this.dropdown.position()}),this.appendTag(T),this.update(),o.length&&a&&(this.input.set.call(this,w.createInvalidTags?"":C.join(w._delimiters)),this.setRangeAtStartEnd(!1,this.DOM.input)),w.dropdown.enabled&&this.dropdown.refilter(),d},addMixTags(o){if((o=this.normalizeTags(o))[0].prefix||this.state.tag)return this.prefixedTextToTag(o[0]);var a=document.createDocumentFragment();return o.forEach(h=>{var d=this.createTagElem(h);a.appendChild(d)}),this.appendMixTags(a),a},appendMixTags(o){var a=!!this.state.selection;a?this.injectAtCaret(o):(this.DOM.input.focus(),(a=this.setStateSelection()).range.setStart(this.DOM.input,a.range.endOffset),a.range.setEnd(this.DOM.input,a.range.endOffset),this.DOM.input.appendChild(o),this.updateValueByDOMTags(),this.update())},prefixedTextToTag(o){var a,h=this.settings,d=this.state.tag.delimiters;if(h.transformTag.call(this,o),o.prefix=o.prefix||this.state.tag?this.state.tag.prefix:(h.pattern.source||h.pattern)[0],a=this.createTagElem(o),this.replaceTextWithNode(a)||this.DOM.input.appendChild(a),setTimeout(()=>a.classList.add(this.settings.classNames.tagNoAnimation),300),this.value.push(o),this.update(),!d){var w=this.insertAfterTag(a)||a;setTimeout(y,0,w)}return this.state.tag=null,this.trigger("add",E({},{tag:a},{data:o})),a},appendTag(o){var a=this.DOM,h=a.input;a.scope.insertBefore(o,h)},createTagElem(o,a){o.__tagId=x();var h,d=E({},o,i({value:O(o.value+"")},a));return function(w){for(var C,T=document.createNodeIterator(w,NodeFilter.SHOW_TEXT,null,!1);C=T.nextNode();)C.textContent.trim()||C.parentNode.removeChild(C)}(h=this.parseTemplate("tag",[d,this])),_(h,o),h},reCheckInvalidTags(){var o=this.settings;this.getTagElms(o.classNames.tagNotAllowed).forEach((a,h)=>{var d=_(a),w=this.hasMaxTags(),C=this.validateTag(d),T=C===!0&&!w;if(o.mode=="select"&&this.toggleScopeValidation(C),T)return d=d.__preInvalidData?d.__preInvalidData:{value:d.value},this.replaceTag(a,d);a.title=w||C})},removeTags(o,a,h){var d,w=this.settings;if(o=o&&o instanceof HTMLElement?[o]:o instanceof Array?o:o?[o]:[this.getLastTag()],d=o.reduce((C,T)=>{T&&typeof T=="string"&&(T=this.getTagElmByValue(T));var A=_(T);return T&&A&&!A.readonly&&C.push({node:T,idx:this.getTagIdx(A),data:_(T,{__removed:!0})}),C},[]),h=typeof h=="number"?h:this.CSSVars.tagHideTransition,w.mode=="select"&&(h=0,this.input.set.call(this)),d.length==1&&w.mode!="select"&&d[0].node.classList.contains(w.classNames.tagNotAllowed)&&(a=!0),d.length)return w.hooks.beforeRemoveTag(d,{tagify:this}).then(()=>{function C(T){T.node.parentNode&&(T.node.parentNode.removeChild(T.node),a?w.keepInvalidTags&&this.trigger("remove",{tag:T.node,index:T.idx}):(this.trigger("remove",{tag:T.node,index:T.idx,data:T.data}),this.dropdown.refilter(),this.dropdown.position(),this.DOM.input.normalize(),w.keepInvalidTags&&this.reCheckInvalidTags()))}h&&h>10&&d.length==1?(function(T){T.node.style.width=parseFloat(window.getComputedStyle(T.node).width)+"px",document.body.clientTop,T.node.classList.add(w.classNames.tagHide),setTimeout(C.bind(this),h,T)}).call(this,d[0]):d.forEach(C.bind(this)),a||(this.removeTagsFromValue(d.map(T=>T.node)),this.update(),w.mode=="select"&&this.setContentEditable(!0))}).catch(C=>{})},removeTagsFromDOM(){[].slice.call(this.getTagElms()).forEach(o=>o.parentNode.removeChild(o))},removeTagsFromValue(o){(o=Array.isArray(o)?o:[o]).forEach(a=>{var h=_(a),d=this.getTagIdx(h);d>-1&&this.value.splice(d,1)})},removeAllTags(o){o=o||{},this.value=[],this.settings.mode=="mix"?this.DOM.input.innerHTML="":this.removeTagsFromDOM(),this.dropdown.refilter(),this.dropdown.position(),this.state.dropdown.visible&&setTimeout(()=>{this.DOM.input.focus()}),this.settings.mode=="select"&&(this.input.set.call(this),this.setContentEditable(!0)),this.update(o)},postUpdate(){var d,w;this.state.blockChangeEvent=!1;var o=this.settings,a=o.classNames,h=o.mode=="mix"?o.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value.trim():this.value.length+this.input.raw.call(this).length;this.toggleClass(a.hasMaxTags,this.value.length>=o.maxTags),this.toggleClass(a.hasNoTags,!this.value.length),this.toggleClass(a.empty,!h),o.mode=="select"&&this.toggleScopeValidation((w=(d=this.value)==null?void 0:d[0])==null?void 0:w.__isValid)},setOriginalInputValue(o){var a=this.DOM.originalInput;this.settings.mixMode.integrated||(a.value=o,a.tagifyValue=a.value,this.setPersistedData(o,"value"))},update(o){clearTimeout(this.debouncedUpdateTimeout),this.debouncedUpdateTimeout=setTimeout((function(){var a=this.getInputValue();this.setOriginalInputValue(a),this.settings.onChangeAfterBlur&&(o||{}).withoutChangeEvent||this.state.blockChangeEvent||this.triggerChangeEvent(),this.postUpdate()}).bind(this),100)},getInputValue(){var o=this.getCleanValue();return this.settings.mode=="mix"?this.getMixedTagsAsString(o):o.length?this.settings.originalInputValueFormat?this.settings.originalInputValueFormat(o):JSON.stringify(o):""},getCleanValue(o){return s(o||this.value,this.dataProps)},getMixedTagsAsString(){var o="",a=this,h=this.settings,d=h.originalInputValueFormat||JSON.stringify,w=h.mixTagsInterpolator;return function C(T){T.childNodes.forEach(A=>{if(A.nodeType==1){const R=_(A);if(A.tagName=="BR"&&(o+=`\r
`),R&&b.call(a,A)){if(R.__removed)return;o+=w[0]+d(c(R,a.dataProps))+w[1]}else A.getAttribute("style")||["B","I","U"].includes(A.tagName)?o+=A.textContent:A.tagName!="DIV"&&A.tagName!="P"||(o+=`\r
`,C(A))}else o+=A.textContent})}(this.DOM.input),o}},Y.prototype.removeTag=Y.prototype.removeTags,Y})})(Wo);var dc=Wo.exports;const hc=is(dc),pc=Object.assign({"./BoolControl.hbs":Kl,"./ButtonControl.hbs":Zl,"./CodeMirrorControl.hbs":Ql,"./ColorControl.hbs":tc,"./DynamicInputControl.hbs":ec,"./ImageGalleryControl.hbs":nc,"./LabelControl.hbs":ic,"./NumControl.hbs":oc,"./NumWithSliderControl.hbs":sc,"./PasswordControl.hbs":rc,"./Select2TagControl.hbs":ac,"./SelectControl.hbs":lc,"./TextControl.hbs":cc,"./ToggleControl.hbs":uc});function pt(t,e,n,i){return{value:t,previousValue:t,key:"",title:"",opts:{readonly:!1,placeholder:t,default:t,choices:["(default)"]},control:null,error:null,controlUid:"",required:!1,tooltip:"",change(r){let l=r.target.value;if(typeof this.value=="number"&&(l=+r.target.value,console.log("changeNumber",Date.now(),r,l)),i&&this.value!=null)try{l=i(l)}catch(u){this.error="Error: "+u.message,console.warn("Formatter failed to parse value",l,this.value);return}this.error=null,this.value=l},updateConstraints(){this.value==="(Default)"&&(this.value=this.opts.default??t),typeof t=="number"&&(this.opts.minimum!==void 0&&this.value<this.opts.minimum&&(this.value=this.opts.minimum),this.opts.maximum!==void 0&&this.value>this.opts.maximum&&(this.value=this.opts.maximum)),typeof t=="string"&&(this.value=typeof this.value=="string"?this.value.trim():"")},update(){this.updateConstraints(),this.key&&(this.control.putData(this.key,this.value),this.previousValue!==this.value&&(this.previousValue=this.value,this.emitter.trigger("nodeupdated",this)))},async getInputTemplate(){const r=pc[n];return r===void 0?n:r},hasValue(){var r;return this.value!==null&&this.value!==void 0&&this.value!==""&&((r=this.value)==null?void 0:r.length)!==0},custom(r){return this.control.custom(r)},init(){var r;this.control=e,this.required=this.control.required,this.key=this.control.key,this.title=this.control.title,this.description=this.control.description??this.control.summary,this.tooltip=this.title!==this.description?(this.title??"")+": "+(this.description??""):this.title??"",this.controlUid=this.key+Date.now(),this.opts=this.control.opts,this.opts.readonly=this.control.opts.readonly||!client.workbench.canEdit,this.value=this.control.getData(this.key)??this.control.opts.default??t,this.previousValue=this.value,this.emitter=this.control.emitter,this.error=null,(r=this._customInit)==null||r.call(this),this.update()}}}const fc=t=>({...pt(t.opts.default==="inf"?1/0:t.opts.default,t,"./NumControl.hbs",parseFloat)}),gc=t=>({...pt(t.opts.default||"",t,"./TextControl.hbs")}),vc=t=>({...pt(t.opts.default||"",t,"./PasswordControl.hbs")}),mc=t=>({...pt(t.opts.default||"",t,"./ButtonControl.hbs"),runButtonAction(e,n){this.custom("buttonAction")==="script"?window.client.runScript(e,n):alert("Button action "+this.custom("buttonAction")+"not implemented")}}),wc=t=>({...pt("",t,"./ColorControl.hbs")}),yc=t=>({_customInit(){this.choices??(this.choices=[])},...pt("",t,"./SelectControl.hbs"),selectedChoice(){var e,n;return this.choices?(n=(e=this.choices).find)==null?void 0:n.call(e,i=>i.toString()===this.value.toString()):{value:this.default,title:"(default)",description:null}}}),bc=t=>({...pt([],t,"./Select2TagControl.hbs"),tagify(e){e.value=this.value,new hc(e,{callbacks:{add:n=>{this.updateTag(n)},remove:n=>{this.updateTag(n)}}})},updateTag(e){const n=e.detail.tagify.value.map(i=>i.value[0]==="#"?i.value:"#"+i.value);this.value=n,console.log("updateTag",n,this.value)}}),xc=t=>pt(!1,t,"./BoolControl.hbs",e=>!!e),_c=t=>({...pt(!1,t,"./ToggleControl.hbs"),change(e){this.value=e.target.checked}}),Tc=t=>({...pt(0,t,"./NumWithSliderControl.hbs",parseFloat)}),kc=t=>pt("",t,"./LabelControl.hbs"),Cc=t=>({...pt(null,t,"./CodeMirrorControl.hbs",e=>{if(e!=null){let n;return typeof e=="string"?n=JSON.parse(e):typeof e=="object"?n=window.Alpine.raw(e):n=null,n}})}),Ec=t=>({doChange(e){const n=this,i=n.control.parent.id;this.change(e),window.Alpine.nextTick(()=>{n.emitter.trigger("node_dynamic_update",{nodeId:i,key:n.key,value:n.value})})},...pt(null,t,"./DynamicInputControl.hbs",e=>{if(e!=null){let n;return typeof e=="string"?n=JSON.parse(e):typeof e=="object"?n=window.Alpine.raw(e):n=null,n}})}),Oc=t=>({...pt([],t,"./ImageGalleryControl.hbs"),hasValidImage(){},update(){this.key&&(this.value=this.control.getData(this.key))}}),Sc=Object.freeze(Object.defineProperty({__proto__:null,AlpineBoolComponent:xc,AlpineButtonComponent:mc,AlpineCodeMirrorComponent:Cc,AlpineColorComponent:wc,AlpineDynamicInputComponent:Ec,AlpineImageGalleryComponent:Oc,AlpineLabelComponent:kc,AlpineNumComponent:fc,AlpineNumWithSliderComponent:Tc,AlpinePasswordComponent:vc,AlpineSelect2TagComponent:bc,AlpineSelectComponent:yc,AlpineTextComponent:gc,AlpineToggleComponent:_c},Symbol.toStringTag,{value:"Module"})),Ac=`<div class="flex">
  <div class="flex flex-col h-full bg-opacity-0 border-0" >
    <div class="rete-block">
    <div class='block-header flex flex-row h-8 p-2 ' :class="
      {
        '!bg-blue-500 animate-pulse progress-bar': node.active,
          'blur-xs': !node.data.xOmniEnabled
      }
      ">
      <!-- Copy button -->
      <div class="relative z-20 flex items-center" x-tooltip='Copy' x-show='client.workbench.canEdit'>
        <div x-show="copyNotification" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-x-2" x-transition:enter-end="opacity-100 translate-x-0" x-transition:leave="transition ease-in duration-300" x-transition:leave-start="opacity-100 translate-x-0" x-transition:leave-end="opacity-0 translate-x-2" class="absolute left-0" x-cloak>
        <div class="px-3 h-7 -ml-1.5 items-center flex text-xs bg-black border-r border-black -translate-x-full text-white rounded">
            <span>Copied!</span>
            <div class="absolute right-0 inline-block h-full -mt-px overflow-hidden translate-x-3 -translate-y-2 top-1/2">
                <div class="w-3 h-3 origin-top-left transform rotate-45 bg-black border border-transparent"></div>
            </div>
        </div>
    </div>
    <button @click.stop="onClickCopy(node);" class="flex items-center justify-center w-5 h-5 py-1 text-xs rounded-md cursor-pointer focus:outline-none hover:animate-pulse group">
        <svg x-show="!copyNotification" class="w-5 h-5 stroke-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="white" class="w-5 h-5"><path stroke="white"  stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" /></svg>
        <svg x-show="copyNotification" class="pl-2 w-5 h-5 stroke-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="white" x-cloak><path stroke="white"  stroke-linecap="round" stroke-linejoin="round" d="M11.35 3.836c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m8.9-4.414c.376.023.75.05 1.124.08 1.131.094 1.976 1.057 1.976 2.192V16.5A2.25 2.25 0 0118 18.75h-2.25m-7.5-10.5H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V18.75m-7.5-10.5h6.375c.621 0 1.125.504 1.125 1.125v9.375m-8.25-3l1.5 1.5 3-3.75" /></svg>
    </button>

</div>
      <div class='block-title flex-grow p-1 mx-1' x-text='getTitle()' x-tooltip="Right-Click to rename" @contextmenu.stop.prevent='if (await rename()){workbench.activeRecipe.setDirty()}'></div>
      <!-- close button -->
      <button class='pr-2 text-lg cursor-pointer text-white hover:stroke-red-500 stroke-white' x-tooltip="Restore Defaults Values" @click.stop.prevent='window.confirm("Restore Block default values?") ? (node.data = { xOmniEnabled: true}) && node.update() : null ;'>
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"  stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash">
          <polyline xmlns="http://www.w3.org/2000/svg" points="23 4 23 10 17 10"/><polyline xmlns="http://www.w3.org/2000/svg" points="1 20 1 14 7 14"/><path xmlns="http://www.w3.org/2000/svg" d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
          </button>
      <div x-show='workbench.canEdit' class='hover:animate-pulse  ' @click.stop.prevent='onClickClose(node);' x-tooltip='Remove'>
        <svg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='1.5' stroke='currentColor' class='h-5 w-5'>
          <path stroke='#ffffff' stroke-linecap='round' stroke-linejoin='round' d='M6 18L18 6M6 6l12 12' />
        </svg>
      </div>

    </div>
    <div id='block-content'
    class='relative flex items-center justify-center w-full h-full text-xs text-gray-400 content '>
      <div class='block_content' :class='classNameString' :title='node.title'>
        <div :class="
        {
          'blur-xs grayscale': !node.data.xOmniEnabled
        }">

          <!-- Inputs -->
          <template x-for='(input, index) in (inputs(node)||[])' :key='input.name'>
            <div class='input' x-show='client.workbench.canEdit || input?.connections?.length' x-id="['input-socket']">
              <div x-socket:input='input' :id="$id('input-socket')" class='socket input relative' type='input' :title='input.socket.name'></div>
              <div x-show='!input.showControl()' class='input-title' x-text='input.name.charAt(0).toUpperCase() + input.name.slice(1)  ' :for="$id('input-socket')"></div>
              <div x-show='input.showControl()' class='input-control' :for="$id('input-socket')" type='input.control.controlType' :value='value' x-control='input.control' x-data='input.control.component(input.control)' x-html='getInputTemplate()' x-effect="$watch('value', (value) => update())"></div>
            </div>
          </template>
          <template x-for='(control, index) in controls(node)'>
            <div class='control' :key='index' :value='value' x-control='control' x-data='control.component(control)' x-html='getInputTemplate()' x-effect="$watch('value', (value) => update())"></div>
          </template>
          <!-- Outputs -->
          <template x-for='(output) in (outputs(node)||[])'>
            <div class='output' x-show='client.workbench.canEdit || output.connections?.length' :key='output.name' x-id="['output-socket']">
              <div class='output-title' x-text='output.name.charAt(0).toUpperCase() + output.name.slice(1)' :for="$id('output-socket')"></div>
              <div x-socket:output='output' :id="$id('output-socket')" class='socket output' type='output.control.controlType' :title='output.socket.name'></div>
            </div>
          </template>
        </div>
        <div class="flex-grow"></div>
        <div class='block-footer'>
          <div x-show="!client.workbench.readOnly" x-id="['node.data.xOmniEnabled']" class="flex justify-center" x-tooltip="Enable/Disable" @change="client.workbench.activeRecipe.setDirty()">
            <label :for="$id('node.data.xOmniEnabled')" class="relative h-6 w-10 cursor-pointer">
              <input x-model="node.data.xOmniEnabled" type="checkbox" :id="$id('node.data.xOmniEnabled')" class="peer sr-only" />
              <span :class="{ 'bg-gray-400': !node.data.xOmniEnabled, 'bg-gray-400': node.data.xOmniEnabled }" class="absolute inset-0 rounded-full transition"></span>
              <span :class="{ 'text-red-600 start-0': !node.data.xOmniEnabled, 'start-4 text-green-600': node.data.xOmniEnabled }" class="absolute inset-y-0 m-1 inline-flex h-4 w-4 items-center justify-center rounded-full bg-white transition-all">
                <svg xmlns="http://www.w3.org/2000/svg" x-show="!node.data.xOmniEnabled" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" x-show="node.data.xOmniEnabled" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                </svg>
              </span>
            </label>
          </div>
          <div class="flex-grow"></div>
          <!-- info button -->
          <div class='block-footer block-category-color'
           x-text='node.namespace' x-show='node.namespace' x-tooltip='Show all blocks in this package.' @click.stop.prevent='workbench.showExtension("omni-core-collectionmanager", {type:"block", filter: node.namespace})'>
          </div>
          <div class='block-footer block-category-color' x-tooltip='Show all blocks in this category.' x-text='node.category' x-show='node.category' :class="node.category?.toLowerCase().replace(/ /g,'-') !== 'input' ? node.category?.toLowerCase().replace(/ /g,'-') : ''" @click.stop.prevent='workbench.showExtension("omni-core-collectionmanager", {type:"block", filter: node.category})'>
          </div>
          <div class='text-lg cursor-pointer text-white' x-tooltip="Show Help" @click.stop.prevent='toggleInfo(node);' :class="{
      'stroke-yellow-500 fill-yellow-500': showHelp,
      'stroke-green-800 fill-green-900': !showHelp
    }">
            <svg class='w-5 h-5 ' stroke="current" fill='current' viewBox='0 0 56 56' xmlns='http://www.w3.org/2000/svg'>
              <path d='M 27.9999 51.9063 C 41.0546 51.9063 51.9063 41.0781 51.9063 28 C 51.9063 14.9453 41.0312 4.0937 27.9765 4.0937 C 14.8983 4.0937 4.0937 14.9453 4.0937 28 C 4.0937 41.0781 14.9218 51.9063 27.9999 51.9063 Z M 27.9999 47.9219 C 16.9374 47.9219 8.1014 39.0625 8.1014 28 C 8.1014 16.9609 16.9140 8.0781 27.9765 8.0781 C 39.0155 8.0781 47.8983 16.9609 47.9219 28 C 47.9454 39.0625 39.0390 47.9219 27.9999 47.9219 Z M 27.7890 19.6563 C 29.4999 19.6563 30.8358 18.2968 30.8358 16.6094 C 30.8358 14.8984 29.4999 13.5390 27.7890 13.5390 C 26.0780 13.5390 24.7421 14.8984 24.7421 16.6094 C 24.7421 18.2968 26.0780 19.6563 27.7890 19.6563 Z M 23.8749 40.8906 L 33.4374 40.8906 C 34.3983 40.8906 35.1483 40.2109 35.1483 39.25 C 35.1483 38.3359 34.3983 37.6094 33.4374 37.6094 L 30.5312 37.6094 L 30.5312 25.6797 C 30.5312 24.4141 29.8749 23.5703 28.7030 23.5703 L 24.2733 23.5703 C 23.3358 23.5703 22.5858 24.2968 22.5858 25.2109 C 22.5858 26.1719 23.3358 26.8516 24.2733 26.8516 L 26.8046 26.8516 L 26.8046 37.6094 L 23.8749 37.6094 C 22.9374 37.6094 22.1874 38.3359 22.1874 39.25 C 22.1874 40.2109 22.9374 40.8906 23.8749 40.8906 Z'>
              </path>
            </svg>
          </div>




        </div>
      </div>
    </div>
    </div>
    <div x-show='showHelp' x-data="{editComment: false}" style="min-height: 100px; min-width: 350px"
    class="mt-3 rounded-md bg-yellow-100 drop-shadow-lg border-gray-400 bg-opacity-50 hover:bg-opacity-95 h-full"
    :class="
        {
          'blur-xs grayscale': !node.data.xOmniEnabled
        }">


      <div class="flex flex-row float-right absolute right-2 top-2 ">
        <svg x-show="!editComment" class='w-3 h-3 cursor-pointer mt-0.5 border-0' x-tooltip='Edit'
        @click="editComment=true;await startEditComment($el) " viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
          </svg>
          <svg x-show="editComment" class='w-3 h-3 mt-0.5 cursor-pointer ' x-tooltip='Accept'
          @click="if (await setComment($el)){client.workbench.activeRecipe.setDirty()};editComment=false" viewBox="0 0 24 24" fill="none" stroke="darkgreen" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 11 12 14 22 4" />
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
            <polyline points="9 11 12 14 22 4" />
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
      </svg>
      <div @click.stop.prevent="toggleInfo(node);"  class="cursor-pointer "> <svg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='1.5' stroke='currentColor' class='h-4 w-4'>
          <path stroke='black' stroke-linecap='round' stroke-linejoin='round' d='M6 18L18 6M6 6l12 12' />
        </svg></div>

      </div>
      <h3 class="p-2 pr-4 first-letter:h-full w-full font-semibold">
        <span x-text="node.title"></span>
      </h3>
      <div :id="'comment_'+node.id"
            @paste.stop.prevent="document.execCommand('insertText', false, ($event.originalEvent || $event).clipboardData.getData('text/plain'))"
       class="p-2 h-full"  x-html="getHelpText(node)" :contenteditable="editComment" :class="{
        'bg-white border-2': editComment,
      }"></div>
    </div>
  </div>

</div>`,Mc=`<div class="block-header flex flex-row h-8 p-2" >
  <!-- Copy button -->

  <!-- close button -->
  <div class="block-title flex-grow" x-text="node.title"></div>
  <div x-show="workbench.canEdit" class=" hover:animate-pulse" @click.stop.prevent="onClickClose(node);" x-tooltip="Remove">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6">
      <path stroke="#ffffff" stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
    </svg>
  </div>
</div>

<div id='block-content' class="relative flex items-center justify-center w-full text-xs content   bg-gray-100 bg-opacity-100 text-center p-4" style="min-height: 200px;">
  <div x-html="node.summary" class="text-red-500"></div>

</div>
`,Dc=`<div class="flex ">
  <div class="flex  h-full bg-opacity-0 border-0 flex-row" >
    <div class="rete-block">
    <div class='block-header flex flex-row h-8 !bg-slate-500'>
      <!-- close button -->
      <div class='block-title flex-grow mx-1 p-1' x-text='getTitle()' x-tooltip='Right-Click to rename' @contextmenu.prevent='if (await rename()){workbench.activeRecipe.setDirty()}'></div>
      <div x-show='workbench.canEdit ' class='hover:animate-pulse mr-1' @click.stop.prevent='onClickClose(node);' x-tooltip='Remove'>
        <svg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='1.5' stroke='currentColor' class='h-5 w-5'>
          <path stroke='#ffffff' stroke-linecap='round' stroke-linejoin='round' d='M6 18L18 6M6 6l12 12' />
        </svg>
      </div>
    </div>
    <div>
      <div id='block-content ' class='relative flex items-center justify-center flex-grow  w-full text-xs text-gray-400 content h-full bg-transparent'>
        <div class='block_content flex-row h-full' :class='classNameString' :title='node.title'>
          <div>
            <!-- Inputs -->
            <template x-for='(input, index) in (inputs(node))'>
              <div class='input' :key='input.key' x-show='client.workbench.canEdit || input?.connections?.length' x-id="['input-socket']">
                <div x-socket:input='input' :id="$id('input-socket')" class='socket input relative' type='input' :title='input.socket.name'></div>
                <div x-show='!input.showControl()' class='input-title' x-text='input.title | input.name' :for="$id('input-socket')"></div>
                <div x-show='input.showControl()' class='input-control' :for="$id('input-socket')" type='input.control.controlType' :value='value' x-control='input.control' x-data='input.control.component(input.control)' x-html='getInputTemplate()' x-effect="$watch('value', (value) => update())"></div>
              </div>
            </template>
            <!-- Outputs -->
            <template x-for='(output) in (outputs(node)||[])'>
              <div class='output' :key='output.key' x-id="['output-socket']">
                <div class='output-title' x-text='output.name' :for="$id('output-socket')"></div>
                <div x-socket:output='output' :id="$id('output-socket')" class='socket output' type='output.control.controlType' :title='output.socket.name'></div>
              </div>
            </template>
            <div class="flex flex-grow"> </div>
            <template x-for='(control, index) in controls(node)'>
              <div class='control' :key='index' :value='value' x-control='control' x-data='control.component(control)' x-html='getInputTemplate()' x-effect="$watch('value', (value) => update())"></div>
            </template>
          </div>
        </div>

      </div>
      <div class='bg-slate-500 rounded-b-md p-1 flex flex-row'>
        <div class="flex-grow"></div>

                <div class='text-lg cursor-pointer text-white ' x-tooltip="Show Help" @click.stop.prevent='toggleInfo(node);' :class="{
      'stroke-yellow-500 fill-yellow-500': showHelp,
      'stroke-white fill-white': !showHelp
    }">
            <svg class='w-5 h-5 ' stroke="current" fill='current' viewBox='0 0 56 56' xmlns='http://www.w3.org/2000/svg'>
              <path d='M 27.9999 51.9063 C 41.0546 51.9063 51.9063 41.0781 51.9063 28 C 51.9063 14.9453 41.0312 4.0937 27.9765 4.0937 C 14.8983 4.0937 4.0937 14.9453 4.0937 28 C 4.0937 41.0781 14.9218 51.9063 27.9999 51.9063 Z M 27.9999 47.9219 C 16.9374 47.9219 8.1014 39.0625 8.1014 28 C 8.1014 16.9609 16.9140 8.0781 27.9765 8.0781 C 39.0155 8.0781 47.8983 16.9609 47.9219 28 C 47.9454 39.0625 39.0390 47.9219 27.9999 47.9219 Z M 27.7890 19.6563 C 29.4999 19.6563 30.8358 18.2968 30.8358 16.6094 C 30.8358 14.8984 29.4999 13.5390 27.7890 13.5390 C 26.0780 13.5390 24.7421 14.8984 24.7421 16.6094 C 24.7421 18.2968 26.0780 19.6563 27.7890 19.6563 Z M 23.8749 40.8906 L 33.4374 40.8906 C 34.3983 40.8906 35.1483 40.2109 35.1483 39.25 C 35.1483 38.3359 34.3983 37.6094 33.4374 37.6094 L 30.5312 37.6094 L 30.5312 25.6797 C 30.5312 24.4141 29.8749 23.5703 28.7030 23.5703 L 24.2733 23.5703 C 23.3358 23.5703 22.5858 24.2968 22.5858 25.2109 C 22.5858 26.1719 23.3358 26.8516 24.2733 26.8516 L 26.8046 26.8516 L 26.8046 37.6094 L 23.8749 37.6094 C 22.9374 37.6094 22.1874 38.3359 22.1874 39.25 C 22.1874 40.2109 22.9374 40.8906 23.8749 40.8906 Z'>
              </path>
            </svg>
          </div>
          </div>
    </div>
  </div>
  </div>

  </div>
  <div x-show='showHelp' x-data="{editComment: false}" style="min-height: 100px; min-width: 350px"
    class="mt-3 rounded-md bg-yellow-100 drop-shadow-lg border-gray-400 bg-opacity-50 hover:bg-opacity-95 h-full"  >

      <div class="flex flex-row float-right absolute right-2 top-2 ">
        <svg x-show="!editComment" class='w-3 h-3 cursor-pointer mt-0.5 border-0' x-tooltip='Edit'
        @click="editComment=true;await startEditComment($el) " viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
          </svg>
          <svg x-show="editComment" class='w-3 h-3 mt-0.5 cursor-pointer ' x-tooltip='Accept'
          @click="if (await setComment($el)){client.workbench.activeRecipe.setDirty()};editComment=false" viewBox="0 0 24 24" fill="none" stroke="darkgreen" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 11 12 14 22 4" />
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
            <polyline points="9 11 12 14 22 4" />
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
      </svg>
      <div @click.stop.prevent="toggleInfo(node);"  class="cursor-pointer "> <svg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='1.5' stroke='currentColor' class='h-4 w-4'>
          <path stroke='black' stroke-linecap='round' stroke-linejoin='round' d='M6 18L18 6M6 6l12 12' />
        </svg></div>

      </div>
      <h3 class="p-2 pr-4 first-letter:h-full w-full font-semibold">
        <span x-text="node.title"></span>
      </h3>
      <div :id="'comment_'+node.id"
        @paste.stop.prevent="document.execCommand('insertText', false, ($event.originalEvent || $event).clipboardData.getData('text/plain'))"
      class="p-2 h-full"  x-html="getHelpText(node)" :contenteditable="editComment" :class="{
        'bg-white border-2': editComment,
      }"></div>
    </div>
</div>`,Uo=Object.assign({"./default.hbs":Ac,"./error.hbs":Mc,"./simple.hbs":Dc});Uo["./default.hbs"];const Pi=t=>Uo[`./${t}.hbs`];window.Alpine=nt;function Nc(t){const e=n=>n.toLowerCase().replace(/ /g,"-");return Array.isArray(t)?t.map(e):e(t)}class Ic{constructor(e={}){this.name="alpine-render",this.options=e,this.editor=null}setupAlpineNode(e,n,i,r){if(n==null)throw new Error("Invalid Rete Node (null)");n._alpine=e;const l="retenode"+n.id;e.setAttribute("x-data",l),e.setAttribute("id",l),new ResizeObserver(()=>{this.onNodeResize(n)}).observe(e),n.update=async s=>await this.update(n,s);const u=this.editor;nt.data(l,()=>({node:null,editor:null,bindSocket:null,bindControl:null,showEditor:!1,classNameString:"",tabButtonsClassString:"",showHelp:!0,copyNotification:!1,getTitle(){return this.node.title||this.node.name},selected(s){var c;return(c=this.editor)!=null&&c.selected.contains(s)?"selected":""},className(s){return Nc(["rete-block",this.selected(s),s.name,s.errors.length?"error":"",s.active?"active":""])},async rename(){const s=prompt("New Name",this.node.title)||"";if(s===this.title){delete this.node.data["x-omni-title"];return}const c=this.node.data["x-omni-title"]||"";return this.node.data["x-omni-title"]=s||void 0,this.node.title=this.node.data["x-omni-title"]||this.title,c!==s},async startEditComment(s){const c=document.getElementById(`comment_${this.node.id}`);c.innerText=this.node.data["x-omni-comment"]||this.node.summary},async getHelpText(s){return window.client.markdownEngine.render(this.node.data["x-omni-comment"]||this.node.summary)},async setComment(s){const c=document.getElementById(`comment_${this.node.id}`),p=c.innerText.trim(),f=this.node.data["x-omni-comment"]||"";return p?this.node.data["x-omni-comment"]=p:delete this.node.data["x-omni-comment"],c.innerHTML=await window.client.markdownEngine.render(this.node.data["x-omni-comment"]||this.node.summary),f!==p},outputs(s){var c,p;return!s||!s.outputs?[]:Array.from(((p=(c=s==null?void 0:s.outputs)==null?void 0:c.values)==null?void 0:p.call(c))||[])},inputs(s){var c,p;return!s||!s.inputs?[]:Array.from(((p=(c=s==null?void 0:s.inputs)==null?void 0:c.values)==null?void 0:p.call(c))||[]).filter(f=>f!=null)},controls(s){var c,p;return Array.from(((p=(c=s==null?void 0:s.controls)==null?void 0:c.values)==null?void 0:p.call(c))||[]).filter(f=>f==null?(console.warn("Null control for node - skipping render",s),!1):f.component==null?(console.warn("Invalid component for control - skipping render",nt.raw(s),nt.raw(f)),!1):!0)},onClickClose(s){this.editor.removeNode(s)},toggleInfo(s){var c;this.showHelp=!this.showHelp,this.showHelp?window.localStorage.removeItem("omni/workbench/help_seen_"+s.name):window.localStorage.setItem("omni/workbench/help_seen_"+s.name,1),window.client.sendSystemMessage(Object.assign({name:s.name,title:s.title},s.meta||{},((c=s.patch)==null?void 0:c.meta)||{}),"omni/component-meta",{commands:[{title:"Add to Workbench",id:"add",args:[s.name]}]},["no-picture"])},onClickCopy(s){const c={data:s.data,name:s.name},p=JSON.stringify(c);navigator.clipboard.writeText(p).then(function(){},function(m){console.error("Could not copy node: ",m)}),this.copyNotification=!0;const f=this;setTimeout(function(){f.copyNotification=!1},3e3)},getContentHeight(){},init(){var s,c,p,f,m,O;if(!n)throw new Error("reteNode is not defined");this.node=n,(s=this.node).namespace??(s.namespace=""),(c=this.node).category??(c.category=""),(p=this.node).title??(p.title=""),(f=this.node).summary??(f.summary=""),(m=this.node).meta??(m.meta={}),(O=this.node.data).xOmniEnabled??(O.xOmniEnabled=!0),this.showHelp=window.localStorage.getItem("omni/workbench/help_seen_"+this.node.name)==null,this.editor=u,this.bindSocket=i,this.bindControl=r}}))}createControl(e,n){return nt.$data(e)}setInnerHTML(e){if(!e)throw new Error("Invalid node passed into setInnerHtml");e._alpine.innerHTML=e.renderTemplate?Pi(e.renderTemplate):Pi("default")}updateConnections(e){e.outputs.forEach(n=>{n.connections.forEach(i=>{var r;(r=this.editor.view.connections.get(i))==null||r.update()})}),e.inputs.forEach(n=>{n.connections.forEach(i=>{var r;(r=this.editor.view.connections.get(i))==null||r.update()})})}onNodeResize(e){if(!e)throw new Error("Invalid reteNode passed to onNodeResize");this.updateConnections(e)}async update(e,n=!1){if(!e)throw new Error("Invalid reteNode passed to update");const i=nt.$data(e._alpine);return i!=null&&i.className&&(i.classNameString=i.className(e),i.tabButtonsClassString=i.classNameString),n||this.setInnerHTML(e),await new Promise(r=>{if(!e._alpine){r();return}nt.effect(()=>{requestAnimationFrame(r)})})}install(e){this.editor=e,this.editor.on("rendernode",({el:n,node:i,component:r,bindSocket:l,bindControl:u})=>{(!r.render||r.render==="alpine")&&(this.setupAlpineNode(n,i,l,u),this.setInnerHTML(i),i.update())}),this.editor.on("rendercontrol",({el:n,control:i})=>{i.render&&i.render!=="alpine"||(i._alpine=this.createControl(n,i),i.update=()=>i._alpine.update())}),this.editor.on("connectioncreated connectionremoved",n=>{n.input.node.update(),n.output.node.update()}),this.editor.on("nodeselected",n=>{var i,r;n._alpine!==((i=e.previousSelectedNode)==null?void 0:i._alpine)&&((r=e.previousSelectedNode)==null||r.update(!0),e.previousSelectedNode=n,n.update(!0))})}}document.addEventListener("alpine:init",()=>{os.status_start("Renderer Alpine Init"),nt.directive("socket",(t,{expression:e,value:n},{evaluate:i,effect:r})=>{const l=t.closest("[x-data]"),u=nt.$data(l),s=i(e),c=t.getAttribute("class");t.setAttribute("class",c+" "+s.socket.name);const p=n==="output"?"o_":"i_";l.socketDict={...l.socketDict||{},[p+s.key]:t},r(()=>{u.bindSocket(t,n,nt.raw(s))})}),nt.directive("control",(t,{expression:e,value:n},{evaluate:i,effect:r})=>{const l=t.closest("[x-data]"),u=nt.$data(l),s=i(e);r(()=>{u.bindControl(t,nt.raw(s))})})});const Lc=function(t="editor",e){const n={loaded:!1,editor:null,engine:null,isDraggingOver:!1,addOffsetX:0,addOffsetY:0,async start(){var f;this.engine=new ss("mercs@0.1.1"),this.initEditor(),this.registerClientControls();const c=new URLSearchParams(window.location.search).get("rx");if(c&&Yn.isValidUrl(c)){window.history.replaceState({},document.title,"/");const m=await Yn.fetchJSON(c);await e.loadFromJSON(m)}e.isBlank&&await e.loadFromCache(),await((f=window.client)==null?void 0:f.runScript("hasKey",{}))||(client.showTopBanner("Attention","Your Omnitool environment is missing external API keys. Use the API Key Management menu to add your keys and enable more capabilities.",{link:""}),e.showApiManagement()),this.reviewedNUX()||(e.showTutorial(!0),this.setReviewedNUX(!0))},async stopWorkflow(s){const c=s.length>0?s[0]:void 0;return(await Jt.post("/api/v1/workflow/stop",{jobId:c},{withCredentials:!0})).data},async loadWorkflowToEditor(){if(!this.editor)throw new Error("Attempt to call loadWorkflowToEditor before editor is initialized!");const s=this.loaded;if(this.loaded=!1,e==null?void 0:e.activeWorkflow){await this.editor.clear();const p=e.activeWorkflow.rete;if(p!=null&&p.nodes){const f=Array.from(new Set(Object.values(p.nodes).map(k=>k.name))),m=await window.client.blocks.getInstances(f),O=new Set(m.map(k=>k.name));Object.values(p.nodes).forEach(k=>{O.has(k.name)||(k.data["x-omni-summary"]=`The block named <b>"${k.name}"</b> is currently not installed on your system. It is likely you are missing an API or extension. Please locate and install the relevant API or extension and restart the server.`,k.missingBlockName=k.name,k.name="omnitool._block_missing")}),m.forEach(k=>{try{this.editor.getComponent(k.name)}catch{this.editor.register(k),this.engine.register(k),k.editor=this.editor,k.engine=this.engine}});try{await this.editor.fromJSON(p)}catch(k){console.error("Error loading workflow",k)}}e.activeWorkflow.rete=this.editor,this.loaded=!0}else console.log("No workflow loaded"),this.loaded=s},onEditorchange(s){if(this.loaded&&!e.isBlank)return["connectionremoved","connectioncreated","nodecreated","noderemoved","nodeupdated","nodetranslated"].includes(s)?e.canEdit&&e.activeWorkflow.setDirty():console.log("Unhandled event",s),!0},async createNodeByBlockName(s,c={}){const p=await window.client.blocks.getInstance(s);if(!p)return{error:`Can't find a block named <b>${s}</b>.`};try{n.editor.components.get(p.name)||n.editor.register(p)}catch(b){return console.error(b),{error:b.message}}const f=await p.createNode();if(!f)return{error:`Couldn't create a node for <b>${s}</b>.`};Object.keys(c).forEach(b=>{b in c&&(f.data[b]=c[b])}),await n.editor.addNode(f),f.update();const m=n.editor.view.area,O=n.editor.view.nodes,k=O.get(f).el.clientWidth,E=O.get(f).el.clientHeight;let D=n.editor.view.container.clientWidth,N=n.editor.view.container.clientHeight;D<10&&N<10&&(D=window.innerWidth*.5,N=window.innerHeight*.5);const v=(D/2-m.transform.x)/m.transform.k-k/2+n.addOffsetX,x=(N/2-m.transform.y)/m.transform.k-E/2+n.addOffsetY;return n.addOffsetX+=20,n.addOffsetY+=20,n.addOffsetX>250&&(n.addOffsetX-=261),n.addOffsetY>200&&(n.addOffsetY-=211),O.get(f).translate(v,x),{node:f,block:p}},async handlePaste(s){var m;if(e.readOnly){console.log("Workbench is read-only, unable to paste");return}const c=(m=s==null?void 0:s.clipboardData)==null?void 0:m.getData("text");if(!c){console.log("Clipboard data not found, nothing to paste");return}let p;try{p=JSON.parse(c)}catch{console.error("Invalid JSON string:",c);return}if(typeof p!="object"||!("data"in p)||!("name"in p)){console.log("Invalid paste data",p);return}const f=await this.createNodeByBlockName(p.name,p.data);f!=null&&f.error&&console.log(f.error)},onNavigateZoomToWindow(){r()},onNavigateZoomRelative(s){const c=n.editor.view.area,p=n.editor.view.container.clientWidth/2,f=n.editor.view.container.clientHeight/2;s>0?s=s/(1+c.transform.k/4):s=s/(1+.1/c.transform.k);const m=c.transform.k*Math.exp(s*.3),O=p-(p-c.transform.x)*m/c.transform.k,k=f-(f-c.transform.y)*m/c.transform.k;i(c,O,k,m,250)},wfDragOver(s){n.isDraggingOver=!0,s.preventDefault(),s.target.classList.add("dragover")},wfDragLeave(s){n.isDraggingOver=!1,s.target.classList.remove("dragover")},async wfDrop(s){var p,f,m,O,k;n.isDraggingOver=!1,s.preventDefault(),s.target.classList.remove("dragover");const c=((p=s==null?void 0:s.dataTransfer)==null?void 0:p.files)||((f=s==null?void 0:s.target)==null?void 0:f.files);if(c.length>0){const E=c[0];if(E.name.endsWith(".json")&&E.type==="application/json"){const D=await n.handleWorkflowDrop(E);D&&(D.id&&((m=D.meta)!=null&&m.name)&&((k=(O=D.rete)==null?void 0:O.id)!=null&&k.startsWith("mercs@"))?(window.client.sendSystemMessage(`Importing recipe named **${D.meta.name}** from *${E.name}*.`,"text/markdown",void 0),window.Alpine.nextTick(async()=>{var N;D.id="",await e.loadFromJSON(D),(N=e.activeWorkflow)==null||N.setDirty(),e.showRecipeHelp()})):window.client.sendSystemMessage("The imported file is not a compatible omnitool recipe.","text/plain",void 0,["error"]))}}s.target&&(s.target.value="")},reviewedNUX(){return window.localStorage.getItem("omnitool.nux")},setReviewedNUX(s){window.localStorage.setItem("omnitool.nux",s)},async handleWorkflowDrop(s){return await new Promise((c,p)=>{const f=new FileReader;f.onload=m=>{c(JSON.parse(m.target.result))},f.onerror=m=>{p(m)},f.readAsText(s)})},registerClientControls(){const s=Ht.getSingleton().getControlRegistry();Object.entries(Sc).forEach(([c,p])=>{s.add(c,p)}),console.log("Registered client controls",s)},async getComponentDefinition(){return(await Jt.get("/api/v1/mercenaries/components?includeDefinitions=true",{withCredentials:!0})).data.map(c=>c[1])},initEditor(){const s=this.$refs[t];if(!s)throw new Error(`No container found for workflow editor container: '${t}',  Please provide a valid ref to the container element.`);class c extends rs{connect(m,O){(!n.loaded||!e.readOnly)&&super.connect(m,O)}removeConnection(m){(!n.loaded||!e.readOnly)&&super.removeConnection(m)}}this.editor=new c("mercs@0.1.1",s),this.editor.view.resize=function(){s.style.width="100%",s.style.height="100%"},this.editor.bind("nodeupdated"),this.editor.bind("control_updated"),this.editor.bind("node_dynamic_update");const p=new Ic;this.editor.use(p),this.editor.use(Gl),this.editor.use(cn,{type:cn.DEFAULT,curve:cn[window.client.reteSettings.curve],options:{vertical:!1,curvature:.3},arrow:!!window.client.reteSettings.arrow}),this.editor.on("nodecreated",()=>this.onEditorchange("nodecreated")),this.editor.on("noderemoved",()=>this.onEditorchange("noderemoved")),this.editor.on("nodeselected",async f=>this.$dispatch("nodeselected",{node:f,component:await window.client.blocks.getInstance(f.name),editor:this.editor})),this.editor.on("nodetranslated",f=>this.onEditorchange("nodetranslated")),this.editor.on("connectioncreated",()=>this.onEditorchange("connectioncreated")),this.editor.on("connectionremoved",()=>this.onEditorchange("connectionremoved")),this.editor.on("process",()=>this.onEditorchange("process")),this.editor.on("nodeupdated",()=>this.onEditorchange("nodeupdated")),this.editor.on("node_dynamic_update",async function({nodeId:f,key:m,value:O}){console.log("node_dynamic_update"+f,m,O);const k=editor.nodes.find(E=>E.id===f);console.log("node_dynamic_update",k,O),this.onEditorchange("nodeupdated")})}};window.client.subscribeToGlobalEvent("workbench_workflow_loaded",async s=>{await n.loadWorkflowToEditor()}),window.client.subscribeToGlobalEvent("request_editor_resize",s=>{setTimeout(()=>{var c;(c=n.editor)==null||c.view.resize(),window.Alpine.nextTick(()=>{n.onNavigateZoomToWindow()})},1)}),window.client.subscribeToGlobalEvent("sse_message",s=>{if(s.type==="job_state"){if(s.event==="node_started"){const c=n.editor.nodes.find(p=>p.id===s.args.node_id);c!=null&&(c.active=!0,c.update())}else if(s.event==="node_finished"){const c=n.editor.nodes.find(p=>p.id===s.args.node_id);c!=null&&setTimeout(()=>{c.active=!1,c.update()},300)}}if(s.type==="control:setvalue"&&s.controlId!=null){const c=n.editor.nodes.find(p=>p.id===s.node_id);if(c!=null&&c.controls){const p=c.controls.get(s.controlId);p!=null&&p._alpine.change({target:{value:s.value}})}}});function i(s,c,p,f,m){n.startTime=Date.now()-16/m,n.startX=s.transform.x,n.startY=s.transform.y,n.startScale=s.transform.k,n.deltaX=c-n.startX,n.deltaY=p-n.startY,n.deltaScale=f-n.startScale;const O=function(E){return E<.5?4*E*E*E:1-Math.pow(-2*E+2,3)/2},k=()=>{const E=Date.now()-n.startTime,D=Math.min(1,E/m),N=O(D);s.transform.x=n.startX+n.deltaX*N,s.transform.y=n.startY+n.deltaY*N,s.transform.k=n.startScale+n.deltaScale*N,s.zoom(s.transform.k,0,0),s.update(),D<1&&setTimeout(k,16)};k()}const r=()=>{const s=n.editor;if(!s)return;const c=s.nodes,p=s.view.nodes,f=Math.min(...c.map(y=>y.position[0])),m=Math.min(...c.map(y=>y.position[1])),O=Math.max(...c.map(y=>y.position[0]+p.get(y).el.clientWidth)),k=Math.max(...c.map(y=>y.position[1]+p.get(y).el.clientHeight)),E=s.view.container.clientWidth,D=s.view.container.clientHeight,N=E/(O-f)*.8,v=D/(k-m)*.85,x=Math.min(N,v);if(!isFinite(x)||x<=0)return;const b=s.view.area,g=(E-(O-f)*x)/2-f*x,_=(D-(k-m)*x)/2-m*x;i(b,g,_,x,500)};window.client.registerClientScript("fit",async function(s){return r(),!0}),window.client.registerClientScript("zoom",async function(s){return n.onNavigateZoomRelative(parseInt(s[0]||"1")),!0}),window.client.registerClientScript("clone",async function(s){return e.remixRecipe().then(p=>p?{response:"Recipe duplicated. It's now ready to edit."}:{response:""}).catch(p=>({response:"Recipe duplication failed: "+p}))}),window.client.registerClientScript("set",async function(s){let c;return s.length>1?(window.localStorage.setItem(`settings.${s[0]}`,s[1]),c=`Set ${s[0]} to ${s[1]}. Press F5 to update UI`):s.length>0?(window.localStorage.removeItem(`settings.${s[0]}`),c=`Reset ${s[0]}. Press F5 to update UI`):c="Usage: /set <key> <value>",{response:c}}),window.client.registerClientScript("run",async function(s){var c,p,f;if(!Array.isArray(s)&&typeof s=="object"){const m=JSON.parse(JSON.stringify(s));await e.execute(m);return}if(s.length>0){let m=[],O=[],k=[];s[1]&&(Array.isArray(s[1])||(s[1]=[s[1]]),s[1].filter(D=>!!D).forEach(D=>{var N,v,x,b,g;typeof D=="object"&&((N=D.mimeType)!=null&&N.startsWith("image/"))?m.push(D):typeof D=="object"&&((v=D.mimeType)!=null&&v.startsWith("audio/")||(x=D.mimeType)!=null&&x.startsWith("application/ogg"))?O.push(D):typeof D=="object"&&((b=D.mimeType)!=null&&b.startsWith("text/plain")||(g=D.mimeType)!=null&&g.startsWith("application/pdf"))&&k.push(D)})),O=O.concat(((c=client.clipboard)==null?void 0:c.audio)||[]),m=m.concat(((p=client.clipboard)==null?void 0:p.images)||[]),k=k.concat(((f=client.clipboard)==null?void 0:f.documents)||[]);const E=JSON.parse(JSON.stringify({text:s[0]||void 0,images:m,audio:O,documents:k}));client.clipboard={},await e.execute(E)}else await e.execute();return{response:"Job started.",hide:!0}}),window.client.registerClientScript("stop",async function(s){return await n.stopWorkflow(s),{response:"Stop running recipe.",hide:!0}}),window.client.registerClientScript("new",async function(s){e.newRecipe()});function l(s){if(!s)return null;if(s.socketDict)return s.socketDict;if(s.children)for(const c in s.children){const p=l(s.children[c]);if(p)return p}return null}function u(){function s(v,x,b){var _;const g=(_=l(v==null?void 0:v._alpine))==null?void 0:_[b];if(g){const y=g.getBoundingClientRect(),S=x[v.id]||[0,0];return[y.left+S[0],y.top+S[1]]}return v.position}function c(v,x){const b=x[v.id]||[0,0];return[v.position[0]+b[0],v.position[1]+b[1]]}function p(v,x,b,g,_){const y=v._alpine.getBoundingClientRect(),S=y.width/_,I=y.height/_,$=c(v,x);let F=0;F+=.01*($[0]*$[0]+$[1]*$[1])/(_*_);for(const L of b){if(L===v)continue;const P=c(L,x),U=L._alpine.getBoundingClientRect(),Z=U.width/_,Y=U.height/_,o=$[0]+S/2-P[0]-Z/2,a=$[1]+I/2-P[1]-Y/2,h=(S+Z)/2-Math.abs(o)+g,d=(I+Y)/2-Math.abs(a)+g;if(h>0&&d>0){const w=h*d;F+=w*w}}const B=[...v.inputs.values(),...v.outputs.values()];for(const L of B)for(const P of L.connections){const U=s(P.input.node,x,"i_"+P.input.key),Z=s(P.output.node,x,"o_"+P.output.key),Y=(Z[0]-U[0])/_+120,o=(Z[1]-U[1])/_;F+=Y*Y*.25+o*o*2,Y>0&&(F+=g*g,F+=Math.abs(Y*Y)*50)}return F}const f=n.editor.view.area,m=n.editor.view.nodes,O=f.transform.k,k=500,E=50,D=Date.now()+1e3*2,N={};for(let v=0;v<k;v++)for(const x of n.editor.nodes){if(Date.now()>D)break;let b=N[x.id]||[0,0],g=p(x,N,n.editor.nodes,E,O),_=[(Math.random()-.5)*10,(Math.random()-.5)*10],y=0;for(;;){const S=[b[0]+_[0],b[1]+_[1]];N[x.id]=S;const I=p(x,N,n.editor.nodes,E,O);if(g>I){g=I,b=S,_[0]*=1.3,_[1]*=1.3;continue}N[x.id]=b;const $=.5;if(_=[-_[1]*$,_[0]*$],y++>80||_[0]*_[0]+_[1]*_[1]<2e-5)break}}for(const v of n.editor.nodes){const x=c(v,N);m.get(v).translate(...x)}for(const v of n.editor.nodes)n.editor.view.updateConnections({node:v})}return window.client.registerClientScript("arrange",async function(s){u(),r()}),window.client.registerClientScript("jobs",async function(s){let p=(await Jt.get("/api/v1/workflow/jobs",{withCredentials:!0})).data;return p.jobs&&p.jobs.length===0&&(p="No jobs are running."),console.log(p),{response:p}}),window.client.registerClientScript("add",async function(s){console.info(`client script "add" called with args: ${s}`);const c=s==null?void 0:s[0],p=s==null?void 0:s[1];if(!c)return{error:"No block name provided. Usage: <b>/add <block_name></b>"};if(e.readOnly)return{error:"Workbench is read-only, unable to add block"};const f=await n.createNodeByBlockName(c,p);return f.error?(sdk.showToast("Adding "+c+" failed!",{description:f.error,type:"danger",position:"bottom-right"}),f):(window.client.showToast(`${f.block.title} block added!`,{description:f.block.summary,type:"success",position:"bottom-right"}),{response:`Added <b>${f.block.title} (${c})</b>.`,hide:!0})}),window.client.registerClientScript("logout",async()=>{const s=client.services.get("auth");return await(s==null?void 0:s.logout()),setTimeout(function(){location.reload()},3e3),{response:"Bye!"}}),n},Rc=new URLSearchParams(window.location.search),$i=Rc.get("m"),Pc=(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||$i==="m")&&$i!=="ds";as();omnilog.wrapConsoleLogger();omnilog.level=Bi.debug;omnilog.setCustomLevel("emittery",Bi.silent);window.Alpine=nt;nt.plugin(As);nt.plugin(Gs);const $c=nt.reactive({}),Fc=nt.reactive({inputText:"",messages:[],recognition:null,recognitionAvailable:!1,recognitionRecording:!1}),Bc=nt.reactive({isMobile:Pc}),$t=nt.reactive({isConnected:!1,showDisconnectModal:!1,reason:""}),Ft=nt.reactive({hasTOS:!1}),lt=window.client=ls("vite-frontend",{},ps);lt.use(cs,{id:"auth",host:"",authUrl:"/api/v1/auth/login",logoutUrl:"/api/v1/auth/logout",userUrl:"/api/v1/auth/user"},"service");lt.use(ks,{id:"messaging"},"service");lt.use(us,{id:"chat",initialState:Fc,workbench:lt.workbench},"service");lt.use(fs,{id:"jobs",jobStorage:$c},"service");lt.use(gs,{id:"command"},"service");const Tn=document.querySelector("#chat"),kn=document.querySelector("#sidebar"),jc=new ResizeObserver(t=>{for(const e of t)document.documentElement.style.setProperty("--chat-width",`${e.contentRect.width}px`),document.documentElement.style.setProperty("--editor-width",`${window.innerWidth-kn.offsetWidth-10-e.contentRect.width}px`),document.documentElement.style.setProperty("--sidebar-width",`${kn.offsetWidth}px`)});jc.observe(Tn);const Hc=()=>{document.documentElement.style.setProperty("--doc-height",`${window.innerHeight}px`),document.documentElement.style.setProperty("--doc-width",`${window.innerWidth}px`),document.documentElement.style.setProperty("--chat-width",`${Tn.offsetWidth}px`),document.documentElement.style.setProperty("--editor-width",`${window.innerWidth-kn.offsetWidth-10-Tn.offsetWidth}px`)},Vc=()=>{Hc(),lt.emit("request_editor_resize")};window.addEventListener("resize",Vc);document.addEventListener("alpine:init",()=>{omnilog.status_start("Alpine init"),nt.data("auth",()=>({currentUser:void 0,isLogin(){return ds(this.currentUser)},isTOS(){return Ft.hasTOS},onAcceptTOS(){Jt.post("/api/v1/auth/accepttos",{accept:!0}).then(t=>{Number.parseInt(t.data.tosAccepted)>0&&(omnilog.info("Verified acceptance of TOS "+t.data.tosAccepted),Ft.hasTOS=!0)}).catch(t=>{omnilog.error(t)})},async init(){try{this.currentUser=await hs({username:null,password:null}),Ft.hasTOS=this.currentUser.tosAccepted>0}catch(t){omnilog.error(t.messages)}}})),nt.data("appState",()=>({showAdmin:!1,showUsers:!1,connectionState:$t,tosState:Ft,hideEditor:Bc,workbench:lt.workbench,chatComponent:Aa,workflowEditor:Lc("editor",lt.workbench),uiSettings:lt.uiSettings,async init(){this.$watch("tosState",()=>{omnilog.log("TOS changed "+Ft.hasTOS),Ft.hasTOS&&this.boot()}),lt.subscribeToServiceEvent("auth","authenticated",async t=>{Ft.hasTOS&&this.boot()})},async boot(){lt.subscribeToServiceEvent("messaging","connected",async()=>{$t.isConnected=!0,$t.showDisconnectModal=!1,$t.reason=""}),lt.subscribeToServiceEvent("messaging","disconnected",async({fatal:t,reason:e})=>{$t.isConnected=!1,$t.showDisconnectModal=t,$t.reason=e}),await lt.init(),await lt.load(),await lt.start(),await this.workflowEditor.start(),omnilog.status_start("Appstate Init"),window.dispatchEvent(new Event("resize"))}})),Sa(nt)});nt.start();
