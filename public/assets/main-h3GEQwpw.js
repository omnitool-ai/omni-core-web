import{S as Fi,J as Go,a as le,M as Zo,O as Qo,W as ts,p as un,C as qn,E as Ee,b as Kt,m as Xn,c as Qe,I as es,d as dn,e as ns,g as is,f as et,o as os,h as ss,U as Yn,N as rs,r as as,i as Bi,j as ls,A as cs,k as us,l as ds,n as hs,q as ps}from"./Login-FroVqCzB.js";class fs extends Fi{constructor(e,n,i){super(e,n,i||{id:e}),this.jobStorage=i.jobStorage??{}}async getJobFromId(e){let n=this.jobStorage[e];return n||(n=new Go({id:e}),this.jobStorage[e]=n,await this.app.sendSystemMessage(n.id,"omni/job",{commands:[{title:"🛑 Stop",id:"stop",args:[n.id],classes:"rounded",ctx:{job:n},show:r=>r.job.state===le.RUNNING||r.job.state===le.READY}]}),n)}getJobsforWorkflow(e){return Object.values(this.jobStorage).filter(n=>n.workflowId===e)}removeJob(e){delete this.jobStorage[e]}async handleMessages(e){var w;const n=(w=e==null?void 0:e.body)==null?void 0:w.jobId;if(!n){this.error("no jobId in job message");return}const{state:i,workflowId:r,meta:l,errors:d}=e.body,s=await this.getJobFromId(n);s.state=i,s.workflowId=r,s._meta??(s._meta=l),s.errors=d;const c=e,{activeNode:p,activeNodeName:f}=c.body;switch(s._activeNodeName=f,s._activeNode=p,p.length>0&&f&&s.setNodeName(p[0],f),i){case le.RUNNING:s._activity="Running...";break;case le.ERROR:s._activity="Failed";break;case le.FORCESTOP:s._activity="Stopping...";break;default:s._activity=`${i.charAt(0).toUpperCase()}${i.slice(1)}`;break}}create(){return this.info(`${this.id} create`),!0}async load(){return this.info(`${this.id} load`),!0}async start(){return this.info(`${this.id} start`),!0}async stop(){return this.info(`${this.id} stop`),!0}}class gs extends Fi{constructor(e,n,i){super(e,n,i||{id:e})}create(){return this.info(`${this.id} create`),!0}async load(){return this.info(`${this.id} load`),!0}async start(){return this.info(`${this.id} start`),!0}async stop(){return this.info(`${this.id} stop`),!0}async runServerScript(e,n){const i="/api/v1/mercenaries/runscript/"+e;return this.debug("executing server script",i,n),await(await fetch(i,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).json()}}async function vs(t,e){const n=t.getReader();let i;for(;!(i=await n.read()).done;)e(i.value)}function ms(t){let e,n,i,r=!1;return function(d){e===void 0?(e=d,n=0,i=-1):e=ys(e,d);const s=e.length;let c=0;for(;n<s;){r&&(e[n]===10&&(c=++n),r=!1);let p=-1;for(;n<s&&p===-1;++n)switch(e[n]){case 58:i===-1&&(i=n-c);break;case 13:r=!0;case 10:p=n;break}if(p===-1)break;t(e.subarray(c,p),i),c=n,i=-1}c===s?e=void 0:c!==0&&(e=e.subarray(c),n-=c)}}function ws(t,e,n){let i=Jn();const r=new TextDecoder;return function(d,s){if(d.length===0)n==null||n(i),i=Jn();else if(s>0){const c=r.decode(d.subarray(0,s)),p=s+(d[s+1]===32?2:1),f=r.decode(d.subarray(p));switch(c){case"data":i.data=i.data?i.data+`
`+f:f;break;case"event":i.event=f;break;case"id":t(i.id=f);break;case"retry":const w=parseInt(f,10);isNaN(w)||e(i.retry=w);break}}}}function ys(t,e){const n=new Uint8Array(t.length+e.length);return n.set(t),n.set(e,t.length),n}function Jn(){return{data:"",event:"",id:"",retry:void 0}}var bs=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n};const Re="text/event-stream",xs=1e3,Kn="last-event-id";function _s(t,e){var{signal:n,headers:i,onopen:r,onmessage:l,onclose:d,onerror:s,openWhenHidden:c,fetch:p}=e,f=bs(e,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((w,C)=>{const _=Object.assign({},i);_.accept||(_.accept=Re);let A;function D(){A.abort(),document.hidden||E()}c||document.addEventListener("visibilitychange",D);let N=xs,m=0;function x(){document.removeEventListener("visibilitychange",D),window.clearTimeout(m),A.abort()}n==null||n.addEventListener("abort",()=>{x(),w()});const b=p??window.fetch,g=r??Ts;async function E(){var y;A=new AbortController;try{const O=await b(t,Object.assign(Object.assign({},f),{headers:_,signal:A.signal}));await g(O),await vs(O.body,ms(ws(I=>{I?_[Kn]=I:delete _[Kn]},I=>{N=I},l))),d==null||d(),x(),w()}catch(O){if(!A.signal.aborted)try{const I=(y=s==null?void 0:s(O))!==null&&y!==void 0?y:N;window.clearTimeout(m),m=window.setTimeout(E,I)}catch(I){x(),C(I)}}}E()})}function Ts(t){const e=t.headers.get("content-type");if(!(e!=null&&e.startsWith(Re)))throw new Error(`Expected content-type to be ${Re}, Actual: ${e}`)}class Gn extends Error{}class tn extends Error{}class ks extends Zo{constructor(e,n,i){super(e,n,i||{id:"messaging"}),this._hadConnection=!1,this._isConnected=!1,this._isFatal=!1,this.abortController=new AbortController,this.messageHandlers=new Map,this.config=i}get isConnected(){return this._isConnected}async setConnectionState(e,n,i){this._hadConnection=this._hadConnection||e,(e!==this._isConnected||this._isFatal!==n&&n===!0)&&(this._isConnected=e,this._isFatal=n??!1,this.info("SSE Connection state changed to ",e?"connected":"disconnected",n?" (fatal)":e?"":"(retrying...) "),await this.emit(this._isConnected?"connected":"disconnected",{fatal:n===!0,reason:(i==null?void 0:i.toString())??""}))}get serviceConfig(){return this.config}async load(){this.subscribeToGlobalEvent("registerMessageHandler",this.registerMessageHandler.bind(this)),this.subscribeToGlobalEvent("send:message",this.onMessage.bind(this))}async start(){return!0}registerMessageHandler(e){if(!this.messageHandlers.has(e.type))this.messageHandlers.set(e.type,e.handler);else throw new Error(`A message handler for type '${e.type}' is already registered.`)}decodeServerMessage(e){try{const n=this.app.parse(e);return n.flags&&(n.flags=new Set(n.flags)),n}catch(n){return omnilog.error("Error decoding server message",n,e),null}}stopSSE(){this.abortController.abort()}async onMessage(e){const n=this;let i;if(e.data&&e.data.length>0?i=this.decodeServerMessage(e.data):e.type!=null&&(i=e),i){if(i.type==="close"){n.warn("SSE Connection closed by server, not retrying. Reason: ",i.body),await n.setConnectionState(!1,!0,i.body.message),n.abortController.abort();return}let r;try{if(i.type&&n.messageHandlers.has(i.type)){const d=n.messageHandlers.get(i.type);d!=null?(r="handler:"+i.type,d.call(this,i)):(r="event:"+i.type,await n.emit(i.type,i))}const l={...i.body};r="legacy:"+JSON.stringify(l),await n.emitGlobalEvent("sse_message",l)}catch(l){n.error("Error invoking SSE message handling",r,l)}}else n.warn("SSE Message was not a valid message and will be ignored",e)}async startSSE(e){if(this.isConnected)return this.warn("SSE connection is already running. Ignoring double start."),!1;const n=this;return this.info("Connecting to SSE EventSource at ",e+"/api/v1/mercenaries/listen"),(async()=>{await _s(e+`/api/v1/mercenaries/listen?reconnect=${n._hadConnection}`,{signal:n.abortController.signal,openWhenHidden:!0,async onopen(r){var l;if(r.ok&&((l=r.headers.get("content-type"))!=null&&l.startsWith(Re)))n.info("SSE Connection opened"),await n.setConnectionState(!0);else if(r.status>=400&&r.status<500&&r.status!==429){n.error("SSE Client Error - fataling",r.status);let d="A connection to the server could not be established (Error "+r.status+"). Please try again in a few minutes.";switch(r.status){case 401:d="The server responded with an authorisation error (401). The most likely reason is that your session has expired or the server was restarted. Please refresh the page to re-authenticate.";break;case 403:d="The server responded with an authentication error (403). The most likely reason is that your session has expired or the server was restarted. Please refresh the page to re-authenticate.";break;case 500:d="The server responded with an internal server error (500). Please try again in a few minutes.";break;case 502:d="The server responded with a bad gateway error (502). The most likely reason is that the server is restarting. Please refresh the page to re-authenticate.";break}throw await n.setConnectionState(!1,!0,d),new tn}else throw n.error("SSE Client Issue - retrying",r.status,r.headers),await n.setConnectionState(!1,!1),new Gn},onmessage(r){if(r.event==="FatalError")throw new tn(r.data);n.info("SSE Message",r),n.onMessage(r)},onclose(){throw n.warn("onClose() retryable"),n.setConnectionState(!1,!1),new Gn},onerror(r){if(r instanceof tn)throw n.setConnectionState(!1,!0,r.message),n.error("SSE Fatal Error",r),r;n.setConnectionState(!1,!1),n.error("SSE Retryable Error",r)}})})(),!0}}class Vt{constructor(){this.loaded=!1,this.components=new Map,this.clientComponents=new Map,this.ctors=new Map}registerCtor(e,n){this.ctors.set(e,n)}create(e,n){let i=[];return i=e.map(r=>r instanceof Qo?r:(r.type??(r.type="OAIBaseComponent"),this.ctors.has(r.type)?this.ctors.get(r.type).fromJSON(r):null)).filter(r=>r!==null),i}add(e){return this.create(e).forEach(n=>{this.components.set(n.name,n)}),this}registerClientComponent(e,n){this.clientComponents.set(e,n)}hasClientComponent(e){return this.clientComponents.has(e)}getClientComponent(e){return this.clientComponents.get(e)}get(e){return this.components.get(e)}has(e){return this.components.has(e)}getComponents(e){let n=Array.from(this.components.values());return e||(n=n.filter(i=>i.tags.includes("default"))),n}getControlRegistry(){return ts.getInstance()}static getSingleton(){return Vt.instance??(Vt.instance=new Vt),Vt.instance}}function Cs(t){t.directive("intersect",(e,{value:n,expression:i,modifiers:r},{evaluateLater:l,cleanup:d})=>{let s=l(i),c={rootMargin:Ss(r),threshold:Es(r)},p=new IntersectionObserver(f=>{f.forEach(w=>{w.isIntersecting!==(n==="leave")&&(s(),r.includes("once")&&p.disconnect())})},c);p.observe(e),d(()=>{p.disconnect()})})}function Es(t){if(t.includes("full"))return .99;if(t.includes("half"))return .5;if(!t.includes("threshold"))return 0;let e=t[t.indexOf("threshold")+1];return e==="100"?1:e==="0"?0:+`.${e}`}function Os(t){let e=t.match(/^(-?[0-9]+)(px|%)?$/);return e?e[1]+(e[2]||"px"):void 0}function Ss(t){const e="margin",n="0px 0px 0px 0px",i=t.indexOf(e);if(i===-1)return n;let r=[];for(let l=1;l<5;l++)r.push(Os(t[i+l]||""));return r=r.filter(l=>l!==void 0),r.length?r.join(" ").trim():n}var As=Cs,ji=["input","select","textarea","a[href]","button","[tabindex]:not(slot)","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details"],Pe=ji.join(","),Hi=typeof Element>"u",Ut=Hi?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,hn=!Hi&&Element.prototype.getRootNode?function(t){return t.getRootNode()}:function(t){return t.ownerDocument},Vi=function(e,n,i){var r=Array.prototype.slice.apply(e.querySelectorAll(Pe));return n&&Ut.call(e,Pe)&&r.unshift(e),r=r.filter(i),r},Wi=function t(e,n,i){for(var r=[],l=Array.from(e);l.length;){var d=l.shift();if(d.tagName==="SLOT"){var s=d.assignedElements(),c=s.length?s:d.children,p=t(c,!0,i);i.flatten?r.push.apply(r,p):r.push({scope:d,candidates:p})}else{var f=Ut.call(d,Pe);f&&i.filter(d)&&(n||!e.includes(d))&&r.push(d);var w=d.shadowRoot||typeof i.getShadowRoot=="function"&&i.getShadowRoot(d),C=!i.shadowRootFilter||i.shadowRootFilter(d);if(w&&C){var _=t(w===!0?d.children:w.children,!0,i);i.flatten?r.push.apply(r,_):r.push({scope:d,candidates:_})}else l.unshift.apply(l,d.children)}}return r},Ui=function(e,n){return e.tabIndex<0&&(n||/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||e.isContentEditable)&&isNaN(parseInt(e.getAttribute("tabindex"),10))?0:e.tabIndex},Ms=function(e,n){return e.tabIndex===n.tabIndex?e.documentOrder-n.documentOrder:e.tabIndex-n.tabIndex},zi=function(e){return e.tagName==="INPUT"},Ds=function(e){return zi(e)&&e.type==="hidden"},Ns=function(e){var n=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(i){return i.tagName==="SUMMARY"});return n},Is=function(e,n){for(var i=0;i<e.length;i++)if(e[i].checked&&e[i].form===n)return e[i]},Ls=function(e){if(!e.name)return!0;var n=e.form||hn(e),i=function(s){return n.querySelectorAll('input[type="radio"][name="'+s+'"]')},r;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")r=i(window.CSS.escape(e.name));else try{r=i(e.name)}catch(d){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",d.message),!1}var l=Is(r,e.form);return!l||l===e},Rs=function(e){return zi(e)&&e.type==="radio"},Ps=function(e){return Rs(e)&&!Ls(e)},Zn=function(e){var n=e.getBoundingClientRect(),i=n.width,r=n.height;return i===0&&r===0},$s=function(e,n){var i=n.displayCheck,r=n.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var l=Ut.call(e,"details>summary:first-of-type"),d=l?e.parentElement:e;if(Ut.call(d,"details:not([open]) *"))return!0;var s=hn(e).host,c=(s==null?void 0:s.ownerDocument.contains(s))||e.ownerDocument.contains(e);if(!i||i==="full"){if(typeof r=="function"){for(var p=e;e;){var f=e.parentElement,w=hn(e);if(f&&!f.shadowRoot&&r(f)===!0)return Zn(e);e.assignedSlot?e=e.assignedSlot:!f&&w!==e.ownerDocument?e=w.host:e=f}e=p}if(c)return!e.getClientRects().length}else if(i==="non-zero-area")return Zn(e);return!1},Fs=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var n=e.parentElement;n;){if(n.tagName==="FIELDSET"&&n.disabled){for(var i=0;i<n.children.length;i++){var r=n.children.item(i);if(r.tagName==="LEGEND")return Ut.call(n,"fieldset[disabled] *")?!0:!r.contains(e)}return!0}n=n.parentElement}return!1},$e=function(e,n){return!(n.disabled||Ds(n)||$s(n,e)||Ns(n)||Fs(n))},pn=function(e,n){return!(Ps(n)||Ui(n)<0||!$e(e,n))},Bs=function(e){var n=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(n)||n>=0)},js=function t(e){var n=[],i=[];return e.forEach(function(r,l){var d=!!r.scope,s=d?r.scope:r,c=Ui(s,d),p=d?t(r.candidates):s;c===0?d?n.push.apply(n,p):n.push(s):i.push({documentOrder:l,tabIndex:c,item:r,isScope:d,content:p})}),i.sort(Ms).reduce(function(r,l){return l.isScope?r.push.apply(r,l.content):r.push(l.content),r},[]).concat(n)},Hs=function(e,n){n=n||{};var i;return n.getShadowRoot?i=Wi([e],n.includeContainer,{filter:pn.bind(null,n),flatten:!1,getShadowRoot:n.getShadowRoot,shadowRootFilter:Bs}):i=Vi(e,n.includeContainer,pn.bind(null,n)),js(i)},qi=function(e,n){n=n||{};var i;return n.getShadowRoot?i=Wi([e],n.includeContainer,{filter:$e.bind(null,n),flatten:!0,getShadowRoot:n.getShadowRoot}):i=Vi(e,n.includeContainer,$e.bind(null,n)),i},Oe=function(e,n){if(n=n||{},!e)throw new Error("No node provided");return Ut.call(e,Pe)===!1?!1:pn(n,e)},Vs=ji.concat("iframe").join(","),Ie=function(e,n){if(n=n||{},!e)throw new Error("No node provided");return Ut.call(e,Vs)===!1?!1:$e(n,e)};function Qn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,i)}return n}function ti(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Qn(Object(n),!0).forEach(function(i){Ws(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Qn(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function Ws(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ei=function(){var t=[];return{activateTrap:function(n){if(t.length>0){var i=t[t.length-1];i!==n&&i.pause()}var r=t.indexOf(n);r===-1||t.splice(r,1),t.push(n)},deactivateTrap:function(n){var i=t.indexOf(n);i!==-1&&t.splice(i,1),t.length>0&&t[t.length-1].unpause()}}}(),Us=function(e){return e.tagName&&e.tagName.toLowerCase()==="input"&&typeof e.select=="function"},zs=function(e){return e.key==="Escape"||e.key==="Esc"||e.keyCode===27},qs=function(e){return e.key==="Tab"||e.keyCode===9},ni=function(e){return setTimeout(e,0)},ii=function(e,n){var i=-1;return e.every(function(r,l){return n(r)?(i=l,!1):!0}),i},ce=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return typeof e=="function"?e.apply(void 0,i):e},Se=function(e){return e.target.shadowRoot&&typeof e.composedPath=="function"?e.composedPath()[0]:e.target},Xs=function(e,n){var i=(n==null?void 0:n.document)||document,r=ti({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0},n),l={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0},d,s=function(y,O,I){return y&&y[O]!==void 0?y[O]:r[I||O]},c=function(y){return l.containerGroups.findIndex(function(O){var I=O.container,$=O.tabbableNodes;return I.contains(y)||$.find(function(F){return F===y})})},p=function(y){var O=r[y];if(typeof O=="function"){for(var I=arguments.length,$=new Array(I>1?I-1:0),F=1;F<I;F++)$[F-1]=arguments[F];O=O.apply(void 0,$)}if(O===!0&&(O=void 0),!O){if(O===void 0||O===!1)return O;throw new Error("`".concat(y,"` was specified but was not a node, or did not return a node"))}var j=O;if(typeof O=="string"&&(j=i.querySelector(O),!j))throw new Error("`".concat(y,"` as selector refers to no known node"));return j},f=function(){var y=p("initialFocus");if(y===!1)return!1;if(y===void 0)if(c(i.activeElement)>=0)y=i.activeElement;else{var O=l.tabbableGroups[0],I=O&&O.firstTabbableNode;y=I||p("fallbackFocus")}if(!y)throw new Error("Your focus-trap needs to have at least one focusable element");return y},w=function(){if(l.containerGroups=l.containers.map(function(y){var O=Hs(y,r.tabbableOptions),I=qi(y,r.tabbableOptions);return{container:y,tabbableNodes:O,focusableNodes:I,firstTabbableNode:O.length>0?O[0]:null,lastTabbableNode:O.length>0?O[O.length-1]:null,nextTabbableNode:function(F){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,R=I.findIndex(function(P){return P===F});if(!(R<0))return j?I.slice(R+1).find(function(P){return Oe(P,r.tabbableOptions)}):I.slice(0,R).reverse().find(function(P){return Oe(P,r.tabbableOptions)})}}}),l.tabbableGroups=l.containerGroups.filter(function(y){return y.tabbableNodes.length>0}),l.tabbableGroups.length<=0&&!p("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times")},C=function E(y){if(y!==!1&&y!==i.activeElement){if(!y||!y.focus){E(f());return}y.focus({preventScroll:!!r.preventScroll}),l.mostRecentlyFocusedNode=y,Us(y)&&y.select()}},_=function(y){var O=p("setReturnFocus",y);return O||(O===!1?!1:y)},A=function(y){var O=Se(y);if(!(c(O)>=0)){if(ce(r.clickOutsideDeactivates,y)){d.deactivate({returnFocus:r.returnFocusOnDeactivate&&!Ie(O,r.tabbableOptions)});return}ce(r.allowOutsideClick,y)||y.preventDefault()}},D=function(y){var O=Se(y),I=c(O)>=0;I||O instanceof Document?I&&(l.mostRecentlyFocusedNode=O):(y.stopImmediatePropagation(),C(l.mostRecentlyFocusedNode||f()))},N=function(y){var O=Se(y);w();var I=null;if(l.tabbableGroups.length>0){var $=c(O),F=$>=0?l.containerGroups[$]:void 0;if($<0)y.shiftKey?I=l.tabbableGroups[l.tabbableGroups.length-1].lastTabbableNode:I=l.tabbableGroups[0].firstTabbableNode;else if(y.shiftKey){var j=ii(l.tabbableGroups,function(a){var u=a.firstTabbableNode;return O===u});if(j<0&&(F.container===O||Ie(O,r.tabbableOptions)&&!Oe(O,r.tabbableOptions)&&!F.nextTabbableNode(O,!1))&&(j=$),j>=0){var R=j===0?l.tabbableGroups.length-1:j-1,P=l.tabbableGroups[R];I=P.lastTabbableNode}}else{var U=ii(l.tabbableGroups,function(a){var u=a.lastTabbableNode;return O===u});if(U<0&&(F.container===O||Ie(O,r.tabbableOptions)&&!Oe(O,r.tabbableOptions)&&!F.nextTabbableNode(O))&&(U=$),U>=0){var G=U===l.tabbableGroups.length-1?0:U+1,o=l.tabbableGroups[G];I=o.firstTabbableNode}}}else I=p("fallbackFocus");I&&(y.preventDefault(),C(I))},m=function(y){if(zs(y)&&ce(r.escapeDeactivates,y)!==!1){y.preventDefault(),d.deactivate();return}if(qs(y)){N(y);return}},x=function(y){var O=Se(y);c(O)>=0||ce(r.clickOutsideDeactivates,y)||ce(r.allowOutsideClick,y)||(y.preventDefault(),y.stopImmediatePropagation())},b=function(){if(l.active)return ei.activateTrap(d),l.delayInitialFocusTimer=r.delayInitialFocus?ni(function(){C(f())}):C(f()),i.addEventListener("focusin",D,!0),i.addEventListener("mousedown",A,{capture:!0,passive:!1}),i.addEventListener("touchstart",A,{capture:!0,passive:!1}),i.addEventListener("click",x,{capture:!0,passive:!1}),i.addEventListener("keydown",m,{capture:!0,passive:!1}),d},g=function(){if(l.active)return i.removeEventListener("focusin",D,!0),i.removeEventListener("mousedown",A,!0),i.removeEventListener("touchstart",A,!0),i.removeEventListener("click",x,!0),i.removeEventListener("keydown",m,!0),d};return d={get active(){return l.active},get paused(){return l.paused},activate:function(y){if(l.active)return this;var O=s(y,"onActivate"),I=s(y,"onPostActivate"),$=s(y,"checkCanFocusTrap");$||w(),l.active=!0,l.paused=!1,l.nodeFocusedBeforeActivation=i.activeElement,O&&O();var F=function(){$&&w(),b(),I&&I()};return $?($(l.containers.concat()).then(F,F),this):(F(),this)},deactivate:function(y){if(!l.active)return this;var O=ti({onDeactivate:r.onDeactivate,onPostDeactivate:r.onPostDeactivate,checkCanReturnFocus:r.checkCanReturnFocus},y);clearTimeout(l.delayInitialFocusTimer),l.delayInitialFocusTimer=void 0,g(),l.active=!1,l.paused=!1,ei.deactivateTrap(d);var I=s(O,"onDeactivate"),$=s(O,"onPostDeactivate"),F=s(O,"checkCanReturnFocus"),j=s(O,"returnFocus","returnFocusOnDeactivate");I&&I();var R=function(){ni(function(){j&&C(_(l.nodeFocusedBeforeActivation)),$&&$()})};return j&&F?(F(_(l.nodeFocusedBeforeActivation)).then(R,R),this):(R(),this)},pause:function(){return l.paused||!l.active?this:(l.paused=!0,g(),this)},unpause:function(){return!l.paused||!l.active?this:(l.paused=!1,w(),b(),this)},updateContainerElements:function(y){var O=[].concat(y).filter(Boolean);return l.containers=O.map(function(I){return typeof I=="string"?i.querySelector(I):I}),l.active&&w(),this}},d.updateContainerElements(e),d};function Ys(t){let e,n;window.addEventListener("focusin",()=>{e=n,n=document.activeElement}),t.magic("focus",i=>{let r=i;return{__noscroll:!1,__wrapAround:!1,within(l){return r=l,this},withoutScrolling(){return this.__noscroll=!0,this},noscroll(){return this.__noscroll=!0,this},withWrapAround(){return this.__wrapAround=!0,this},wrap(){return this.withWrapAround()},focusable(l){return Ie(l)},previouslyFocused(){return e},lastFocused(){return e},focused(){return n},focusables(){return Array.isArray(r)?r:qi(r,{displayCheck:"none"})},all(){return this.focusables()},isFirst(l){let d=this.all();return d[0]&&d[0].isSameNode(l)},isLast(l){let d=this.all();return d.length&&d.slice(-1)[0].isSameNode(l)},getFirst(){return this.all()[0]},getLast(){return this.all().slice(-1)[0]},getNext(){let l=this.all(),d=document.activeElement;if(l.indexOf(d)!==-1)return this.__wrapAround&&l.indexOf(d)===l.length-1?l[0]:l[l.indexOf(d)+1]},getPrevious(){let l=this.all(),d=document.activeElement;if(l.indexOf(d)!==-1)return this.__wrapAround&&l.indexOf(d)===0?l.slice(-1)[0]:l[l.indexOf(d)-1]},first(){this.focus(this.getFirst())},last(){this.focus(this.getLast())},next(){this.focus(this.getNext())},previous(){this.focus(this.getPrevious())},prev(){return this.previous()},focus(l){l&&setTimeout(()=>{l.hasAttribute("tabindex")||l.setAttribute("tabindex","0"),l.focus({preventScroll:this._noscroll})})}}}),t.directive("trap",t.skipDuringClone((i,{expression:r,modifiers:l},{effect:d,evaluateLater:s,cleanup:c})=>{let p=s(r),f=!1,w={escapeDeactivates:!1,allowOutsideClick:!0,fallbackFocus:()=>i};if(l.includes("noautofocus"))w.initialFocus=!1;else{let N=i.querySelector("[autofocus]");N&&(w.initialFocus=N)}let C=Xs(i,w),_=()=>{},A=()=>{};const D=()=>{_(),_=()=>{},A(),A=()=>{},C.deactivate({returnFocus:!l.includes("noreturn")})};d(()=>p(N=>{f!==N&&(N&&!f&&(l.includes("noscroll")&&(A=Js()),l.includes("inert")&&(_=oi(i)),setTimeout(()=>{C.activate()},15)),!N&&f&&D(),f=!!N)})),c(D)},(i,{expression:r,modifiers:l},{evaluate:d})=>{l.includes("inert")&&d(r)&&oi(i)}))}function oi(t){let e=[];return Xi(t,n=>{let i=n.hasAttribute("aria-hidden");n.setAttribute("aria-hidden","true"),e.push(()=>i||n.removeAttribute("aria-hidden"))}),()=>{for(;e.length;)e.pop()()}}function Xi(t,e){t.isSameNode(document.body)||!t.parentNode||Array.from(t.parentNode.children).forEach(n=>{n.isSameNode(t)?Xi(t.parentNode,e):e(n)})}function Js(){let t=document.documentElement.style.overflow,e=document.documentElement.style.paddingRight,n=window.innerWidth-document.documentElement.clientWidth;return document.documentElement.style.overflow="hidden",document.documentElement.style.paddingRight=`${n}px`,()=>{document.documentElement.style.overflow=t,document.documentElement.style.paddingRight=e}}var Ks=Ys;/*! Bundled license information:

tabbable/dist/index.esm.js:
  (*!
  * tabbable 5.3.3
  * @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
  *)

focus-trap/dist/focus-trap.esm.js:
  (*!
  * focus-trap 6.9.4
  * @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
  *)
*/var dt="top",bt="bottom",xt="right",ht="left",Cn="auto",we=[dt,bt,xt,ht],Zt="start",ve="end",Gs="clippingParents",Yi="viewport",ue="popper",Zs="reference",si=we.reduce(function(t,e){return t.concat([e+"-"+Zt,e+"-"+ve])},[]),Ji=[].concat(we,[Cn]).reduce(function(t,e){return t.concat([e,e+"-"+Zt,e+"-"+ve])},[]),Qs="beforeRead",tr="read",er="afterRead",nr="beforeMain",ir="main",or="afterMain",sr="beforeWrite",rr="write",ar="afterWrite",lr=[Qs,tr,er,nr,ir,or,sr,rr,ar];function Et(t){return t?(t.nodeName||"").toLowerCase():null}function ft(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function zt(t){var e=ft(t).Element;return t instanceof e||t instanceof Element}function yt(t){var e=ft(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function En(t){if(typeof ShadowRoot>"u")return!1;var e=ft(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function cr(t){var e=t.state;Object.keys(e.elements).forEach(function(n){var i=e.styles[n]||{},r=e.attributes[n]||{},l=e.elements[n];!yt(l)||!Et(l)||(Object.assign(l.style,i),Object.keys(r).forEach(function(d){var s=r[d];s===!1?l.removeAttribute(d):l.setAttribute(d,s===!0?"":s)}))})}function ur(t){var e=t.state,n={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,n.popper),e.styles=n,e.elements.arrow&&Object.assign(e.elements.arrow.style,n.arrow),function(){Object.keys(e.elements).forEach(function(i){var r=e.elements[i],l=e.attributes[i]||{},d=Object.keys(e.styles.hasOwnProperty(i)?e.styles[i]:n[i]),s=d.reduce(function(c,p){return c[p]="",c},{});!yt(r)||!Et(r)||(Object.assign(r.style,s),Object.keys(l).forEach(function(c){r.removeAttribute(c)}))})}}const Ki={name:"applyStyles",enabled:!0,phase:"write",fn:cr,effect:ur,requires:["computeStyles"]};function Ct(t){return t.split("-")[0]}var Wt=Math.max,Fe=Math.min,Qt=Math.round;function fn(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Gi(){return!/^((?!chrome|android).)*safari/i.test(fn())}function te(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!1);var i=t.getBoundingClientRect(),r=1,l=1;e&&yt(t)&&(r=t.offsetWidth>0&&Qt(i.width)/t.offsetWidth||1,l=t.offsetHeight>0&&Qt(i.height)/t.offsetHeight||1);var d=zt(t)?ft(t):window,s=d.visualViewport,c=!Gi()&&n,p=(i.left+(c&&s?s.offsetLeft:0))/r,f=(i.top+(c&&s?s.offsetTop:0))/l,w=i.width/r,C=i.height/l;return{width:w,height:C,top:f,right:p+w,bottom:f+C,left:p,x:p,y:f}}function On(t){var e=te(t),n=t.offsetWidth,i=t.offsetHeight;return Math.abs(e.width-n)<=1&&(n=e.width),Math.abs(e.height-i)<=1&&(i=e.height),{x:t.offsetLeft,y:t.offsetTop,width:n,height:i}}function Zi(t,e){var n=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(n&&En(n)){var i=e;do{if(i&&t.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function St(t){return ft(t).getComputedStyle(t)}function dr(t){return["table","td","th"].indexOf(Et(t))>=0}function Lt(t){return((zt(t)?t.ownerDocument:t.document)||window.document).documentElement}function ze(t){return Et(t)==="html"?t:t.assignedSlot||t.parentNode||(En(t)?t.host:null)||Lt(t)}function ri(t){return!yt(t)||St(t).position==="fixed"?null:t.offsetParent}function hr(t){var e=/firefox/i.test(fn()),n=/Trident/i.test(fn());if(n&&yt(t)){var i=St(t);if(i.position==="fixed")return null}var r=ze(t);for(En(r)&&(r=r.host);yt(r)&&["html","body"].indexOf(Et(r))<0;){var l=St(r);if(l.transform!=="none"||l.perspective!=="none"||l.contain==="paint"||["transform","perspective"].indexOf(l.willChange)!==-1||e&&l.willChange==="filter"||e&&l.filter&&l.filter!=="none")return r;r=r.parentNode}return null}function ye(t){for(var e=ft(t),n=ri(t);n&&dr(n)&&St(n).position==="static";)n=ri(n);return n&&(Et(n)==="html"||Et(n)==="body"&&St(n).position==="static")?e:n||hr(t)||e}function Sn(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function pe(t,e,n){return Wt(t,Fe(e,n))}function pr(t,e,n){var i=pe(t,e,n);return i>n?n:i}function Qi(){return{top:0,right:0,bottom:0,left:0}}function to(t){return Object.assign({},Qi(),t)}function eo(t,e){return e.reduce(function(n,i){return n[i]=t,n},{})}var fr=function(e,n){return e=typeof e=="function"?e(Object.assign({},n.rects,{placement:n.placement})):e,to(typeof e!="number"?e:eo(e,we))};function gr(t){var e,n=t.state,i=t.name,r=t.options,l=n.elements.arrow,d=n.modifiersData.popperOffsets,s=Ct(n.placement),c=Sn(s),p=[ht,xt].indexOf(s)>=0,f=p?"height":"width";if(!(!l||!d)){var w=fr(r.padding,n),C=On(l),_=c==="y"?dt:ht,A=c==="y"?bt:xt,D=n.rects.reference[f]+n.rects.reference[c]-d[c]-n.rects.popper[f],N=d[c]-n.rects.reference[c],m=ye(l),x=m?c==="y"?m.clientHeight||0:m.clientWidth||0:0,b=D/2-N/2,g=w[_],E=x-C[f]-w[A],y=x/2-C[f]/2+b,O=pe(g,y,E),I=c;n.modifiersData[i]=(e={},e[I]=O,e.centerOffset=O-y,e)}}function vr(t){var e=t.state,n=t.options,i=n.element,r=i===void 0?"[data-popper-arrow]":i;r!=null&&(typeof r=="string"&&(r=e.elements.popper.querySelector(r),!r)||Zi(e.elements.popper,r)&&(e.elements.arrow=r))}const mr={name:"arrow",enabled:!0,phase:"main",fn:gr,effect:vr,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function ee(t){return t.split("-")[1]}var wr={top:"auto",right:"auto",bottom:"auto",left:"auto"};function yr(t,e){var n=t.x,i=t.y,r=e.devicePixelRatio||1;return{x:Qt(n*r)/r||0,y:Qt(i*r)/r||0}}function ai(t){var e,n=t.popper,i=t.popperRect,r=t.placement,l=t.variation,d=t.offsets,s=t.position,c=t.gpuAcceleration,p=t.adaptive,f=t.roundOffsets,w=t.isFixed,C=d.x,_=C===void 0?0:C,A=d.y,D=A===void 0?0:A,N=typeof f=="function"?f({x:_,y:D}):{x:_,y:D};_=N.x,D=N.y;var m=d.hasOwnProperty("x"),x=d.hasOwnProperty("y"),b=ht,g=dt,E=window;if(p){var y=ye(n),O="clientHeight",I="clientWidth";if(y===ft(n)&&(y=Lt(n),St(y).position!=="static"&&s==="absolute"&&(O="scrollHeight",I="scrollWidth")),y=y,r===dt||(r===ht||r===xt)&&l===ve){g=bt;var $=w&&y===E&&E.visualViewport?E.visualViewport.height:y[O];D-=$-i.height,D*=c?1:-1}if(r===ht||(r===dt||r===bt)&&l===ve){b=xt;var F=w&&y===E&&E.visualViewport?E.visualViewport.width:y[I];_-=F-i.width,_*=c?1:-1}}var j=Object.assign({position:s},p&&wr),R=f===!0?yr({x:_,y:D},ft(n)):{x:_,y:D};if(_=R.x,D=R.y,c){var P;return Object.assign({},j,(P={},P[g]=x?"0":"",P[b]=m?"0":"",P.transform=(E.devicePixelRatio||1)<=1?"translate("+_+"px, "+D+"px)":"translate3d("+_+"px, "+D+"px, 0)",P))}return Object.assign({},j,(e={},e[g]=x?D+"px":"",e[b]=m?_+"px":"",e.transform="",e))}function br(t){var e=t.state,n=t.options,i=n.gpuAcceleration,r=i===void 0?!0:i,l=n.adaptive,d=l===void 0?!0:l,s=n.roundOffsets,c=s===void 0?!0:s,p={placement:Ct(e.placement),variation:ee(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:r,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,ai(Object.assign({},p,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:d,roundOffsets:c})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,ai(Object.assign({},p,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const xr={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:br,data:{}};var Ae={passive:!0};function _r(t){var e=t.state,n=t.instance,i=t.options,r=i.scroll,l=r===void 0?!0:r,d=i.resize,s=d===void 0?!0:d,c=ft(e.elements.popper),p=[].concat(e.scrollParents.reference,e.scrollParents.popper);return l&&p.forEach(function(f){f.addEventListener("scroll",n.update,Ae)}),s&&c.addEventListener("resize",n.update,Ae),function(){l&&p.forEach(function(f){f.removeEventListener("scroll",n.update,Ae)}),s&&c.removeEventListener("resize",n.update,Ae)}}const Tr={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:_r,data:{}};var kr={left:"right",right:"left",bottom:"top",top:"bottom"};function Le(t){return t.replace(/left|right|bottom|top/g,function(e){return kr[e]})}var Cr={start:"end",end:"start"};function li(t){return t.replace(/start|end/g,function(e){return Cr[e]})}function An(t){var e=ft(t),n=e.pageXOffset,i=e.pageYOffset;return{scrollLeft:n,scrollTop:i}}function Mn(t){return te(Lt(t)).left+An(t).scrollLeft}function Er(t,e){var n=ft(t),i=Lt(t),r=n.visualViewport,l=i.clientWidth,d=i.clientHeight,s=0,c=0;if(r){l=r.width,d=r.height;var p=Gi();(p||!p&&e==="fixed")&&(s=r.offsetLeft,c=r.offsetTop)}return{width:l,height:d,x:s+Mn(t),y:c}}function Or(t){var e,n=Lt(t),i=An(t),r=(e=t.ownerDocument)==null?void 0:e.body,l=Wt(n.scrollWidth,n.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),d=Wt(n.scrollHeight,n.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),s=-i.scrollLeft+Mn(t),c=-i.scrollTop;return St(r||n).direction==="rtl"&&(s+=Wt(n.clientWidth,r?r.clientWidth:0)-l),{width:l,height:d,x:s,y:c}}function Dn(t){var e=St(t),n=e.overflow,i=e.overflowX,r=e.overflowY;return/auto|scroll|overlay|hidden/.test(n+r+i)}function no(t){return["html","body","#document"].indexOf(Et(t))>=0?t.ownerDocument.body:yt(t)&&Dn(t)?t:no(ze(t))}function fe(t,e){var n;e===void 0&&(e=[]);var i=no(t),r=i===((n=t.ownerDocument)==null?void 0:n.body),l=ft(i),d=r?[l].concat(l.visualViewport||[],Dn(i)?i:[]):i,s=e.concat(d);return r?s:s.concat(fe(ze(d)))}function gn(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function Sr(t,e){var n=te(t,!1,e==="fixed");return n.top=n.top+t.clientTop,n.left=n.left+t.clientLeft,n.bottom=n.top+t.clientHeight,n.right=n.left+t.clientWidth,n.width=t.clientWidth,n.height=t.clientHeight,n.x=n.left,n.y=n.top,n}function ci(t,e,n){return e===Yi?gn(Er(t,n)):zt(e)?Sr(e,n):gn(Or(Lt(t)))}function Ar(t){var e=fe(ze(t)),n=["absolute","fixed"].indexOf(St(t).position)>=0,i=n&&yt(t)?ye(t):t;return zt(i)?e.filter(function(r){return zt(r)&&Zi(r,i)&&Et(r)!=="body"}):[]}function Mr(t,e,n,i){var r=e==="clippingParents"?Ar(t):[].concat(e),l=[].concat(r,[n]),d=l[0],s=l.reduce(function(c,p){var f=ci(t,p,i);return c.top=Wt(f.top,c.top),c.right=Fe(f.right,c.right),c.bottom=Fe(f.bottom,c.bottom),c.left=Wt(f.left,c.left),c},ci(t,d,i));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function io(t){var e=t.reference,n=t.element,i=t.placement,r=i?Ct(i):null,l=i?ee(i):null,d=e.x+e.width/2-n.width/2,s=e.y+e.height/2-n.height/2,c;switch(r){case dt:c={x:d,y:e.y-n.height};break;case bt:c={x:d,y:e.y+e.height};break;case xt:c={x:e.x+e.width,y:s};break;case ht:c={x:e.x-n.width,y:s};break;default:c={x:e.x,y:e.y}}var p=r?Sn(r):null;if(p!=null){var f=p==="y"?"height":"width";switch(l){case Zt:c[p]=c[p]-(e[f]/2-n[f]/2);break;case ve:c[p]=c[p]+(e[f]/2-n[f]/2);break}}return c}function me(t,e){e===void 0&&(e={});var n=e,i=n.placement,r=i===void 0?t.placement:i,l=n.strategy,d=l===void 0?t.strategy:l,s=n.boundary,c=s===void 0?Gs:s,p=n.rootBoundary,f=p===void 0?Yi:p,w=n.elementContext,C=w===void 0?ue:w,_=n.altBoundary,A=_===void 0?!1:_,D=n.padding,N=D===void 0?0:D,m=to(typeof N!="number"?N:eo(N,we)),x=C===ue?Zs:ue,b=t.rects.popper,g=t.elements[A?x:C],E=Mr(zt(g)?g:g.contextElement||Lt(t.elements.popper),c,f,d),y=te(t.elements.reference),O=io({reference:y,element:b,strategy:"absolute",placement:r}),I=gn(Object.assign({},b,O)),$=C===ue?I:y,F={top:E.top-$.top+m.top,bottom:$.bottom-E.bottom+m.bottom,left:E.left-$.left+m.left,right:$.right-E.right+m.right},j=t.modifiersData.offset;if(C===ue&&j){var R=j[r];Object.keys(F).forEach(function(P){var U=[xt,bt].indexOf(P)>=0?1:-1,G=[dt,bt].indexOf(P)>=0?"y":"x";F[P]+=R[G]*U})}return F}function Dr(t,e){e===void 0&&(e={});var n=e,i=n.placement,r=n.boundary,l=n.rootBoundary,d=n.padding,s=n.flipVariations,c=n.allowedAutoPlacements,p=c===void 0?Ji:c,f=ee(i),w=f?s?si:si.filter(function(A){return ee(A)===f}):we,C=w.filter(function(A){return p.indexOf(A)>=0});C.length===0&&(C=w);var _=C.reduce(function(A,D){return A[D]=me(t,{placement:D,boundary:r,rootBoundary:l,padding:d})[Ct(D)],A},{});return Object.keys(_).sort(function(A,D){return _[A]-_[D]})}function Nr(t){if(Ct(t)===Cn)return[];var e=Le(t);return[li(t),e,li(e)]}function Ir(t){var e=t.state,n=t.options,i=t.name;if(!e.modifiersData[i]._skip){for(var r=n.mainAxis,l=r===void 0?!0:r,d=n.altAxis,s=d===void 0?!0:d,c=n.fallbackPlacements,p=n.padding,f=n.boundary,w=n.rootBoundary,C=n.altBoundary,_=n.flipVariations,A=_===void 0?!0:_,D=n.allowedAutoPlacements,N=e.options.placement,m=Ct(N),x=m===N,b=c||(x||!A?[Le(N)]:Nr(N)),g=[N].concat(b).reduce(function(L,B){return L.concat(Ct(B)===Cn?Dr(e,{placement:B,boundary:f,rootBoundary:w,padding:p,flipVariations:A,allowedAutoPlacements:D}):B)},[]),E=e.rects.reference,y=e.rects.popper,O=new Map,I=!0,$=g[0],F=0;F<g.length;F++){var j=g[F],R=Ct(j),P=ee(j)===Zt,U=[dt,bt].indexOf(R)>=0,G=U?"width":"height",o=me(e,{placement:j,boundary:f,rootBoundary:w,altBoundary:C,padding:p}),a=U?P?xt:ht:P?bt:dt;E[G]>y[G]&&(a=Le(a));var u=Le(a),h=[];if(l&&h.push(o[R]<=0),s&&h.push(o[a]<=0,o[u]<=0),h.every(function(L){return L})){$=j,I=!1;break}O.set(j,h)}if(I)for(var v=A?3:1,k=function(B){var V=g.find(function(W){var Y=O.get(W);if(Y)return Y.slice(0,B).every(function(q){return q})});if(V)return $=V,"break"},T=v;T>0;T--){var S=k(T);if(S==="break")break}e.placement!==$&&(e.modifiersData[i]._skip=!0,e.placement=$,e.reset=!0)}}const Lr={name:"flip",enabled:!0,phase:"main",fn:Ir,requiresIfExists:["offset"],data:{_skip:!1}};function ui(t,e,n){return n===void 0&&(n={x:0,y:0}),{top:t.top-e.height-n.y,right:t.right-e.width+n.x,bottom:t.bottom-e.height+n.y,left:t.left-e.width-n.x}}function di(t){return[dt,xt,bt,ht].some(function(e){return t[e]>=0})}function Rr(t){var e=t.state,n=t.name,i=e.rects.reference,r=e.rects.popper,l=e.modifiersData.preventOverflow,d=me(e,{elementContext:"reference"}),s=me(e,{altBoundary:!0}),c=ui(d,i),p=ui(s,r,l),f=di(c),w=di(p);e.modifiersData[n]={referenceClippingOffsets:c,popperEscapeOffsets:p,isReferenceHidden:f,hasPopperEscaped:w},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":f,"data-popper-escaped":w})}const Pr={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Rr};function $r(t,e,n){var i=Ct(t),r=[ht,dt].indexOf(i)>=0?-1:1,l=typeof n=="function"?n(Object.assign({},e,{placement:t})):n,d=l[0],s=l[1];return d=d||0,s=(s||0)*r,[ht,xt].indexOf(i)>=0?{x:s,y:d}:{x:d,y:s}}function Fr(t){var e=t.state,n=t.options,i=t.name,r=n.offset,l=r===void 0?[0,0]:r,d=Ji.reduce(function(f,w){return f[w]=$r(w,e.rects,l),f},{}),s=d[e.placement],c=s.x,p=s.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=c,e.modifiersData.popperOffsets.y+=p),e.modifiersData[i]=d}const Br={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Fr};function jr(t){var e=t.state,n=t.name;e.modifiersData[n]=io({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const Hr={name:"popperOffsets",enabled:!0,phase:"read",fn:jr,data:{}};function Vr(t){return t==="x"?"y":"x"}function Wr(t){var e=t.state,n=t.options,i=t.name,r=n.mainAxis,l=r===void 0?!0:r,d=n.altAxis,s=d===void 0?!1:d,c=n.boundary,p=n.rootBoundary,f=n.altBoundary,w=n.padding,C=n.tether,_=C===void 0?!0:C,A=n.tetherOffset,D=A===void 0?0:A,N=me(e,{boundary:c,rootBoundary:p,padding:w,altBoundary:f}),m=Ct(e.placement),x=ee(e.placement),b=!x,g=Sn(m),E=Vr(g),y=e.modifiersData.popperOffsets,O=e.rects.reference,I=e.rects.popper,$=typeof D=="function"?D(Object.assign({},e.rects,{placement:e.placement})):D,F=typeof $=="number"?{mainAxis:$,altAxis:$}:Object.assign({mainAxis:0,altAxis:0},$),j=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,R={x:0,y:0};if(y){if(l){var P,U=g==="y"?dt:ht,G=g==="y"?bt:xt,o=g==="y"?"height":"width",a=y[g],u=a+N[U],h=a-N[G],v=_?-I[o]/2:0,k=x===Zt?O[o]:I[o],T=x===Zt?-I[o]:-O[o],S=e.elements.arrow,L=_&&S?On(S):{width:0,height:0},B=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Qi(),V=B[U],W=B[G],Y=pe(0,O[o],L[o]),q=b?O[o]/2-v-Y-V-F.mainAxis:k-Y-V-F.mainAxis,J=b?-O[o]/2+v+Y+W+F.mainAxis:T+Y+W+F.mainAxis,K=e.elements.arrow&&ye(e.elements.arrow),tt=K?g==="y"?K.clientTop||0:K.clientLeft||0:0,ot=(P=j==null?void 0:j[g])!=null?P:0,gt=a+q-ot-tt,it=a+J-ot,nt=pe(_?Fe(u,gt):u,a,_?Wt(h,it):h);y[g]=nt,R[g]=nt-a}if(s){var st,At=g==="x"?dt:ht,Ot=g==="x"?bt:xt,ut=y[E],Mt=E==="y"?"height":"width",re=ut+N[At],Rt=ut-N[Ot],ae=[dt,ht].indexOf(m)!==-1,be=(st=j==null?void 0:j[E])!=null?st:0,xe=ae?re:ut-O[Mt]-I[Mt]-be+F.altAxis,_e=ae?ut+O[Mt]+I[Mt]-be-F.altAxis:Rt,Te=_&&ae?pr(xe,ut,_e):pe(_?xe:re,ut,_?_e:Rt);y[E]=Te,R[E]=Te-ut}e.modifiersData[i]=R}}const Ur={name:"preventOverflow",enabled:!0,phase:"main",fn:Wr,requiresIfExists:["offset"]};function zr(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function qr(t){return t===ft(t)||!yt(t)?An(t):zr(t)}function Xr(t){var e=t.getBoundingClientRect(),n=Qt(e.width)/t.offsetWidth||1,i=Qt(e.height)/t.offsetHeight||1;return n!==1||i!==1}function Yr(t,e,n){n===void 0&&(n=!1);var i=yt(e),r=yt(e)&&Xr(e),l=Lt(e),d=te(t,r,n),s={scrollLeft:0,scrollTop:0},c={x:0,y:0};return(i||!i&&!n)&&((Et(e)!=="body"||Dn(l))&&(s=qr(e)),yt(e)?(c=te(e,!0),c.x+=e.clientLeft,c.y+=e.clientTop):l&&(c.x=Mn(l))),{x:d.left+s.scrollLeft-c.x,y:d.top+s.scrollTop-c.y,width:d.width,height:d.height}}function Jr(t){var e=new Map,n=new Set,i=[];t.forEach(function(l){e.set(l.name,l)});function r(l){n.add(l.name);var d=[].concat(l.requires||[],l.requiresIfExists||[]);d.forEach(function(s){if(!n.has(s)){var c=e.get(s);c&&r(c)}}),i.push(l)}return t.forEach(function(l){n.has(l.name)||r(l)}),i}function Kr(t){var e=Jr(t);return lr.reduce(function(n,i){return n.concat(e.filter(function(r){return r.phase===i}))},[])}function Gr(t){var e;return function(){return e||(e=new Promise(function(n){Promise.resolve().then(function(){e=void 0,n(t())})})),e}}function Zr(t){var e=t.reduce(function(n,i){var r=n[i.name];return n[i.name]=r?Object.assign({},r,i,{options:Object.assign({},r.options,i.options),data:Object.assign({},r.data,i.data)}):i,n},{});return Object.keys(e).map(function(n){return e[n]})}var hi={placement:"bottom",modifiers:[],strategy:"absolute"};function pi(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return!e.some(function(i){return!(i&&typeof i.getBoundingClientRect=="function")})}function Qr(t){t===void 0&&(t={});var e=t,n=e.defaultModifiers,i=n===void 0?[]:n,r=e.defaultOptions,l=r===void 0?hi:r;return function(s,c,p){p===void 0&&(p=l);var f={placement:"bottom",orderedModifiers:[],options:Object.assign({},hi,l),modifiersData:{},elements:{reference:s,popper:c},attributes:{},styles:{}},w=[],C=!1,_={state:f,setOptions:function(m){var x=typeof m=="function"?m(f.options):m;D(),f.options=Object.assign({},l,f.options,x),f.scrollParents={reference:zt(s)?fe(s):s.contextElement?fe(s.contextElement):[],popper:fe(c)};var b=Kr(Zr([].concat(i,f.options.modifiers)));return f.orderedModifiers=b.filter(function(g){return g.enabled}),A(),_.update()},forceUpdate:function(){if(!C){var m=f.elements,x=m.reference,b=m.popper;if(pi(x,b)){f.rects={reference:Yr(x,ye(b),f.options.strategy==="fixed"),popper:On(b)},f.reset=!1,f.placement=f.options.placement,f.orderedModifiers.forEach(function(F){return f.modifiersData[F.name]=Object.assign({},F.data)});for(var g=0;g<f.orderedModifiers.length;g++){if(f.reset===!0){f.reset=!1,g=-1;continue}var E=f.orderedModifiers[g],y=E.fn,O=E.options,I=O===void 0?{}:O,$=E.name;typeof y=="function"&&(f=y({state:f,options:I,name:$,instance:_})||f)}}}},update:Gr(function(){return new Promise(function(N){_.forceUpdate(),N(f)})}),destroy:function(){D(),C=!0}};if(!pi(s,c))return _;_.setOptions(p).then(function(N){!C&&p.onFirstUpdate&&p.onFirstUpdate(N)});function A(){f.orderedModifiers.forEach(function(N){var m=N.name,x=N.options,b=x===void 0?{}:x,g=N.effect;if(typeof g=="function"){var E=g({state:f,name:m,instance:_,options:b}),y=function(){};w.push(E||y)}})}function D(){w.forEach(function(N){return N()}),w=[]}return _}}var ta=[Tr,Hr,xr,Ki,Br,Lr,Ur,mr,Pr],ea=Qr({defaultModifiers:ta}),na="tippy-box",oo="tippy-content",ia="tippy-backdrop",so="tippy-arrow",ro="tippy-svg-arrow",jt={passive:!0,capture:!0},ao=function(){return document.body};function en(t,e,n){if(Array.isArray(t)){var i=t[e];return i??(Array.isArray(n)?n[e]:n)}return t}function Nn(t,e){var n={}.toString.call(t);return n.indexOf("[object")===0&&n.indexOf(e+"]")>-1}function lo(t,e){return typeof t=="function"?t.apply(void 0,e):t}function fi(t,e){if(e===0)return t;var n;return function(i){clearTimeout(n),n=setTimeout(function(){t(i)},e)}}function oa(t){return t.split(/\s+/).filter(Boolean)}function Yt(t){return[].concat(t)}function gi(t,e){t.indexOf(e)===-1&&t.push(e)}function sa(t){return t.filter(function(e,n){return t.indexOf(e)===n})}function ra(t){return t.split("-")[0]}function Be(t){return[].slice.call(t)}function vi(t){return Object.keys(t).reduce(function(e,n){return t[n]!==void 0&&(e[n]=t[n]),e},{})}function ge(){return document.createElement("div")}function qe(t){return["Element","Fragment"].some(function(e){return Nn(t,e)})}function aa(t){return Nn(t,"NodeList")}function la(t){return Nn(t,"MouseEvent")}function ca(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function ua(t){return qe(t)?[t]:aa(t)?Be(t):Array.isArray(t)?t:Be(document.querySelectorAll(t))}function nn(t,e){t.forEach(function(n){n&&(n.style.transitionDuration=e+"ms")})}function mi(t,e){t.forEach(function(n){n&&n.setAttribute("data-state",e)})}function da(t){var e,n=Yt(t),i=n[0];return i!=null&&(e=i.ownerDocument)!=null&&e.body?i.ownerDocument:document}function ha(t,e){var n=e.clientX,i=e.clientY;return t.every(function(r){var l=r.popperRect,d=r.popperState,s=r.props,c=s.interactiveBorder,p=ra(d.placement),f=d.modifiersData.offset;if(!f)return!0;var w=p==="bottom"?f.top.y:0,C=p==="top"?f.bottom.y:0,_=p==="right"?f.left.x:0,A=p==="left"?f.right.x:0,D=l.top-i+w>c,N=i-l.bottom-C>c,m=l.left-n+_>c,x=n-l.right-A>c;return D||N||m||x})}function on(t,e,n){var i=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(r){t[i](r,n)})}function wi(t,e){for(var n=e;n;){var i;if(t.contains(n))return!0;n=n.getRootNode==null||(i=n.getRootNode())==null?void 0:i.host}return!1}var kt={isTouch:!1},yi=0;function pa(){kt.isTouch||(kt.isTouch=!0,window.performance&&document.addEventListener("mousemove",co))}function co(){var t=performance.now();t-yi<20&&(kt.isTouch=!1,document.removeEventListener("mousemove",co)),yi=t}function fa(){var t=document.activeElement;if(ca(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function ga(){document.addEventListener("touchstart",pa,jt),window.addEventListener("blur",fa)}var va=typeof window<"u"&&typeof document<"u",ma=va?!!window.msCrypto:!1,wa={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},ya={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},_t=Object.assign({appendTo:ao,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},wa,ya),ba=Object.keys(_t),xa=function(e){var n=Object.keys(e);n.forEach(function(i){_t[i]=e[i]})};function uo(t){var e=t.plugins||[],n=e.reduce(function(i,r){var l=r.name,d=r.defaultValue;if(l){var s;i[l]=t[l]!==void 0?t[l]:(s=_t[l])!=null?s:d}return i},{});return Object.assign({},t,n)}function _a(t,e){var n=e?Object.keys(uo(Object.assign({},_t,{plugins:e}))):ba,i=n.reduce(function(r,l){var d=(t.getAttribute("data-tippy-"+l)||"").trim();if(!d)return r;if(l==="content")r[l]=d;else try{r[l]=JSON.parse(d)}catch{r[l]=d}return r},{});return i}function bi(t,e){var n=Object.assign({},e,{content:lo(e.content,[t])},e.ignoreAttributes?{}:_a(t,e.plugins));return n.aria=Object.assign({},_t.aria,n.aria),n.aria={expanded:n.aria.expanded==="auto"?e.interactive:n.aria.expanded,content:n.aria.content==="auto"?e.interactive?null:"describedby":n.aria.content},n}var Ta=function(){return"innerHTML"};function vn(t,e){t[Ta()]=e}function xi(t){var e=ge();return t===!0?e.className=so:(e.className=ro,qe(t)?e.appendChild(t):vn(e,t)),e}function _i(t,e){qe(e.content)?(vn(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?vn(t,e.content):t.textContent=e.content)}function mn(t){var e=t.firstElementChild,n=Be(e.children);return{box:e,content:n.find(function(i){return i.classList.contains(oo)}),arrow:n.find(function(i){return i.classList.contains(so)||i.classList.contains(ro)}),backdrop:n.find(function(i){return i.classList.contains(ia)})}}function ho(t){var e=ge(),n=ge();n.className=na,n.setAttribute("data-state","hidden"),n.setAttribute("tabindex","-1");var i=ge();i.className=oo,i.setAttribute("data-state","hidden"),_i(i,t.props),e.appendChild(n),n.appendChild(i),r(t.props,t.props);function r(l,d){var s=mn(e),c=s.box,p=s.content,f=s.arrow;d.theme?c.setAttribute("data-theme",d.theme):c.removeAttribute("data-theme"),typeof d.animation=="string"?c.setAttribute("data-animation",d.animation):c.removeAttribute("data-animation"),d.inertia?c.setAttribute("data-inertia",""):c.removeAttribute("data-inertia"),c.style.maxWidth=typeof d.maxWidth=="number"?d.maxWidth+"px":d.maxWidth,d.role?c.setAttribute("role",d.role):c.removeAttribute("role"),(l.content!==d.content||l.allowHTML!==d.allowHTML)&&_i(p,t.props),d.arrow?f?l.arrow!==d.arrow&&(c.removeChild(f),c.appendChild(xi(d.arrow))):c.appendChild(xi(d.arrow)):f&&c.removeChild(f)}return{popper:e,onUpdate:r}}ho.$$tippy=!0;var ka=1,Me=[],sn=[];function Ca(t,e){var n=bi(t,Object.assign({},_t,uo(vi(e)))),i,r,l,d=!1,s=!1,c=!1,p=!1,f,w,C,_=[],A=fi(gt,n.interactiveDebounce),D,N=ka++,m=null,x=sa(n.plugins),b={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},g={id:N,reference:t,popper:ge(),popperInstance:m,props:n,state:b,plugins:x,clearDelayTimeouts:xe,setProps:_e,setContent:Te,show:zo,hide:qo,hideWithInteractivity:Xo,enable:ae,disable:be,unmount:Yo,destroy:Jo};if(!n.render)return g;var E=n.render(g),y=E.popper,O=E.onUpdate;y.setAttribute("data-tippy-root",""),y.id="tippy-"+g.id,g.popper=y,t._tippy=g,y._tippy=g;var I=x.map(function(M){return M.fn(g)}),$=t.hasAttribute("aria-expanded");return K(),v(),a(),u("onCreate",[g]),n.showOnCreate&&re(),y.addEventListener("mouseenter",function(){g.props.interactive&&g.state.isVisible&&g.clearDelayTimeouts()}),y.addEventListener("mouseleave",function(){g.props.interactive&&g.props.trigger.indexOf("mouseenter")>=0&&U().addEventListener("mousemove",A)}),g;function F(){var M=g.props.touch;return Array.isArray(M)?M:[M,0]}function j(){return F()[0]==="hold"}function R(){var M;return!!((M=g.props.render)!=null&&M.$$tippy)}function P(){return D||t}function U(){var M=P().parentNode;return M?da(M):document}function G(){return mn(y)}function o(M){return g.state.isMounted&&!g.state.isVisible||kt.isTouch||f&&f.type==="focus"?0:en(g.props.delay,M?0:1,_t.delay)}function a(M){M===void 0&&(M=!1),y.style.pointerEvents=g.props.interactive&&!M?"":"none",y.style.zIndex=""+g.props.zIndex}function u(M,H,z){if(z===void 0&&(z=!0),I.forEach(function(Z){Z[M]&&Z[M].apply(Z,H)}),z){var Q;(Q=g.props)[M].apply(Q,H)}}function h(){var M=g.props.aria;if(M.content){var H="aria-"+M.content,z=y.id,Q=Yt(g.props.triggerTarget||t);Q.forEach(function(Z){var ct=Z.getAttribute(H);if(g.state.isVisible)Z.setAttribute(H,ct?ct+" "+z:z);else{var vt=ct&&ct.replace(z,"").trim();vt?Z.setAttribute(H,vt):Z.removeAttribute(H)}})}}function v(){if(!($||!g.props.aria.expanded)){var M=Yt(g.props.triggerTarget||t);M.forEach(function(H){g.props.interactive?H.setAttribute("aria-expanded",g.state.isVisible&&H===P()?"true":"false"):H.removeAttribute("aria-expanded")})}}function k(){U().removeEventListener("mousemove",A),Me=Me.filter(function(M){return M!==A})}function T(M){if(!(kt.isTouch&&(c||M.type==="mousedown"))){var H=M.composedPath&&M.composedPath()[0]||M.target;if(!(g.props.interactive&&wi(y,H))){if(Yt(g.props.triggerTarget||t).some(function(z){return wi(z,H)})){if(kt.isTouch||g.state.isVisible&&g.props.trigger.indexOf("click")>=0)return}else u("onClickOutside",[g,M]);g.props.hideOnClick===!0&&(g.clearDelayTimeouts(),g.hide(),s=!0,setTimeout(function(){s=!1}),g.state.isMounted||V())}}}function S(){c=!0}function L(){c=!1}function B(){var M=U();M.addEventListener("mousedown",T,!0),M.addEventListener("touchend",T,jt),M.addEventListener("touchstart",L,jt),M.addEventListener("touchmove",S,jt)}function V(){var M=U();M.removeEventListener("mousedown",T,!0),M.removeEventListener("touchend",T,jt),M.removeEventListener("touchstart",L,jt),M.removeEventListener("touchmove",S,jt)}function W(M,H){q(M,function(){!g.state.isVisible&&y.parentNode&&y.parentNode.contains(y)&&H()})}function Y(M,H){q(M,H)}function q(M,H){var z=G().box;function Q(Z){Z.target===z&&(on(z,"remove",Q),H())}if(M===0)return H();on(z,"remove",w),on(z,"add",Q),w=Q}function J(M,H,z){z===void 0&&(z=!1);var Q=Yt(g.props.triggerTarget||t);Q.forEach(function(Z){Z.addEventListener(M,H,z),_.push({node:Z,eventType:M,handler:H,options:z})})}function K(){j()&&(J("touchstart",ot,{passive:!0}),J("touchend",it,{passive:!0})),oa(g.props.trigger).forEach(function(M){if(M!=="manual")switch(J(M,ot),M){case"mouseenter":J("mouseleave",it);break;case"focus":J(ma?"focusout":"blur",nt);break;case"focusin":J("focusout",nt);break}})}function tt(){_.forEach(function(M){var H=M.node,z=M.eventType,Q=M.handler,Z=M.options;H.removeEventListener(z,Q,Z)}),_=[]}function ot(M){var H,z=!1;if(!(!g.state.isEnabled||st(M)||s)){var Q=((H=f)==null?void 0:H.type)==="focus";f=M,D=M.currentTarget,v(),!g.state.isVisible&&la(M)&&Me.forEach(function(Z){return Z(M)}),M.type==="click"&&(g.props.trigger.indexOf("mouseenter")<0||d)&&g.props.hideOnClick!==!1&&g.state.isVisible?z=!0:re(M),M.type==="click"&&(d=!z),z&&!Q&&Rt(M)}}function gt(M){var H=M.target,z=P().contains(H)||y.contains(H);if(!(M.type==="mousemove"&&z)){var Q=Mt().concat(y).map(function(Z){var ct,vt=Z._tippy,qt=(ct=vt.popperInstance)==null?void 0:ct.state;return qt?{popperRect:Z.getBoundingClientRect(),popperState:qt,props:n}:null}).filter(Boolean);ha(Q,M)&&(k(),Rt(M))}}function it(M){var H=st(M)||g.props.trigger.indexOf("click")>=0&&d;if(!H){if(g.props.interactive){g.hideWithInteractivity(M);return}Rt(M)}}function nt(M){g.props.trigger.indexOf("focusin")<0&&M.target!==P()||g.props.interactive&&M.relatedTarget&&y.contains(M.relatedTarget)||Rt(M)}function st(M){return kt.isTouch?j()!==M.type.indexOf("touch")>=0:!1}function At(){Ot();var M=g.props,H=M.popperOptions,z=M.placement,Q=M.offset,Z=M.getReferenceClientRect,ct=M.moveTransition,vt=R()?mn(y).arrow:null,qt=Z?{getBoundingClientRect:Z,contextElement:Z.contextElement||P()}:t,zn={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(ke){var Xt=ke.state;if(R()){var Ko=G(),Ze=Ko.box;["placement","reference-hidden","escaped"].forEach(function(Ce){Ce==="placement"?Ze.setAttribute("data-placement",Xt.placement):Xt.attributes.popper["data-popper-"+Ce]?Ze.setAttribute("data-"+Ce,""):Ze.removeAttribute("data-"+Ce)}),Xt.attributes.popper={}}}},Pt=[{name:"offset",options:{offset:Q}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!ct}},zn];R()&&vt&&Pt.push({name:"arrow",options:{element:vt,padding:3}}),Pt.push.apply(Pt,(H==null?void 0:H.modifiers)||[]),g.popperInstance=ea(qt,y,Object.assign({},H,{placement:z,onFirstUpdate:C,modifiers:Pt}))}function Ot(){g.popperInstance&&(g.popperInstance.destroy(),g.popperInstance=null)}function ut(){var M=g.props.appendTo,H,z=P();g.props.interactive&&M===ao||M==="parent"?H=z.parentNode:H=lo(M,[z]),H.contains(y)||H.appendChild(y),g.state.isMounted=!0,At()}function Mt(){return Be(y.querySelectorAll("[data-tippy-root]"))}function re(M){g.clearDelayTimeouts(),M&&u("onTrigger",[g,M]),B();var H=o(!0),z=F(),Q=z[0],Z=z[1];kt.isTouch&&Q==="hold"&&Z&&(H=Z),H?i=setTimeout(function(){g.show()},H):g.show()}function Rt(M){if(g.clearDelayTimeouts(),u("onUntrigger",[g,M]),!g.state.isVisible){V();return}if(!(g.props.trigger.indexOf("mouseenter")>=0&&g.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(M.type)>=0&&d)){var H=o(!1);H?r=setTimeout(function(){g.state.isVisible&&g.hide()},H):l=requestAnimationFrame(function(){g.hide()})}}function ae(){g.state.isEnabled=!0}function be(){g.hide(),g.state.isEnabled=!1}function xe(){clearTimeout(i),clearTimeout(r),cancelAnimationFrame(l)}function _e(M){if(!g.state.isDestroyed){u("onBeforeUpdate",[g,M]),tt();var H=g.props,z=bi(t,Object.assign({},H,vi(M),{ignoreAttributes:!0}));g.props=z,K(),H.interactiveDebounce!==z.interactiveDebounce&&(k(),A=fi(gt,z.interactiveDebounce)),H.triggerTarget&&!z.triggerTarget?Yt(H.triggerTarget).forEach(function(Q){Q.removeAttribute("aria-expanded")}):z.triggerTarget&&t.removeAttribute("aria-expanded"),v(),a(),O&&O(H,z),g.popperInstance&&(At(),Mt().forEach(function(Q){requestAnimationFrame(Q._tippy.popperInstance.forceUpdate)})),u("onAfterUpdate",[g,M])}}function Te(M){g.setProps({content:M})}function zo(){var M=g.state.isVisible,H=g.state.isDestroyed,z=!g.state.isEnabled,Q=kt.isTouch&&!g.props.touch,Z=en(g.props.duration,0,_t.duration);if(!(M||H||z||Q)&&!P().hasAttribute("disabled")&&(u("onShow",[g],!1),g.props.onShow(g)!==!1)){if(g.state.isVisible=!0,R()&&(y.style.visibility="visible"),a(),B(),g.state.isMounted||(y.style.transition="none"),R()){var ct=G(),vt=ct.box,qt=ct.content;nn([vt,qt],0)}C=function(){var Pt;if(!(!g.state.isVisible||p)){if(p=!0,y.offsetHeight,y.style.transition=g.props.moveTransition,R()&&g.props.animation){var Ge=G(),ke=Ge.box,Xt=Ge.content;nn([ke,Xt],Z),mi([ke,Xt],"visible")}h(),v(),gi(sn,g),(Pt=g.popperInstance)==null||Pt.forceUpdate(),u("onMount",[g]),g.props.animation&&R()&&Y(Z,function(){g.state.isShown=!0,u("onShown",[g])})}},ut()}}function qo(){var M=!g.state.isVisible,H=g.state.isDestroyed,z=!g.state.isEnabled,Q=en(g.props.duration,1,_t.duration);if(!(M||H||z)&&(u("onHide",[g],!1),g.props.onHide(g)!==!1)){if(g.state.isVisible=!1,g.state.isShown=!1,p=!1,d=!1,R()&&(y.style.visibility="hidden"),k(),V(),a(!0),R()){var Z=G(),ct=Z.box,vt=Z.content;g.props.animation&&(nn([ct,vt],Q),mi([ct,vt],"hidden"))}h(),v(),g.props.animation?R()&&W(Q,g.unmount):g.unmount()}}function Xo(M){U().addEventListener("mousemove",A),gi(Me,A),A(M)}function Yo(){g.state.isVisible&&g.hide(),g.state.isMounted&&(Ot(),Mt().forEach(function(M){M._tippy.unmount()}),y.parentNode&&y.parentNode.removeChild(y),sn=sn.filter(function(M){return M!==g}),g.state.isMounted=!1,u("onHidden",[g]))}function Jo(){g.state.isDestroyed||(g.clearDelayTimeouts(),g.unmount(),tt(),delete t._tippy,g.state.isDestroyed=!0,u("onDestroy",[g]))}}function ne(t,e){e===void 0&&(e={});var n=_t.plugins.concat(e.plugins||[]);ga();var i=Object.assign({},e,{plugins:n}),r=ua(t),l=r.reduce(function(d,s){var c=s&&Ca(s,i);return c&&d.push(c),d},[]);return qe(t)?l[0]:l}ne.defaultProps=_t;ne.setDefaultProps=xa;ne.currentInput=kt;Object.assign({},Ki,{effect:function(e){var n=e.state,i={popper:{position:n.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(n.elements.popper.style,i.popper),n.styles=i,n.elements.arrow&&Object.assign(n.elements.arrow.style,i.arrow)}});ne.setDefaultProps({render:ho});const Ea=function(){return{skip:1,atBeginning:!1,atEnd:!1,next(){this.to((t,e)=>t+e*this.skip)},prev(){this.to((t,e)=>t-e*this.skip)},to(t){const e=this.$refs.slider,n=e.scrollLeft,i=e.getBoundingClientRect().width;e.scrollTo({left:t(n,i),behavior:"smooth"})},focusableWhenVisible:{"x-intersect:enter"(){this.$el.removeAttribute("tabindex")},"x-intersect:leave"(){this.$el.setAttribute("tabindex","-1")}},disableNextAndPreviousButtons:{"x-intersect:enter.threshold.05"(){var e,n;if(!((n=(e=this.$el)==null?void 0:e.parentElement)!=null&&n.children)){this.atBeginning=!0,this.atEnd=!0;return}const t=this.$el.parentElement.children;t[0]===this.$el?this.atBeginning=!0:t[t.length-1]===this.$el&&(this.atEnd=!0)},"x-intersect:leave.threshold.05"(){var e,n;if(!((n=(e=this.$el)==null?void 0:e.parentElement)!=null&&n.children)){this.atBeginning=!0,this.atEnd=!0;return}const t=this.$el.parentElement.children;t[0]===this.$el?this.atBeginning=!1:t[t.length-1]===this.$el&&(this.atEnd=!1)}}}},Oa=function(){return{playlist:null,setPlaylist(t){this.playlist=t}}};function Sa(t){t.data("inputUtils",()=>({textareaAutoResize(e){e.style.height="auto",e.style.height=Math.min(e.scrollHeight,400)+"px"},scrollBottom(e){e.scrollTop=e.scrollHeight}})),t.data("gallery",()=>Ea()),t.data("audioPlayer",()=>Oa()),t.magic("tooltip",e=>n=>{const i=ne(e,{content:n,trigger:"manual"});i.show(),setTimeout(()=>{i.hide(),setTimeout(()=>i.destroy(),150)},2e3)}),t.directive("tooltip",(e,{value:n,expression:i},{evaluate:r})=>{let l=i;n==="reactive"&&(l=r(i)),ne(e,{content:un.sanitize(l,{ALLOWED_TAGS:[]})})})}const Aa=function(t){const e=window.client,n=window.client.chat.state,i=()=>new Intl.DateTimeFormat("en-US",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date),r=async m=>{const x=escapeHtmlSpecialChars(m),b=un.sanitize(x);return Xn.parse(b,{mangle:!1,headerIds:!1})},l=m=>{const x=/(?:[^\s"]+|"[^"]*")+/g,b=m.match(x),[g,...E]=b.map(y=>y.replace(/^"(.+(?="$))"$/,"$1"));return[g,E]},d=({message:m,sender:x,embeds:b,workflowId:g})=>{var E,y,O,I;if(b??(b={}),b.audio??(b.audio=[]),b.commands??(b.commands=[]),b.images??(b.images=[]),b.object??(b.object=[]),b.videos??(b.videos=[]),m||((E=b==null?void 0:b.images)==null?void 0:E.length)>0||((y=b==null?void 0:b.audio)==null?void 0:y.length)>0||((O=b==null?void 0:b.videos)==null?void 0:O.length)>0||b.object){m??(m="");const $=typeof m=="object"?"```  \n"+JSON.stringify(m,null,2)+"  \n```":m,F=Xn.parse($,{mangle:!1,headerIds:!1}),j={sender:x||"omni",text:F,whenText:i(),attachments:0,workflowId:g??((I=t.activeWorkflow)==null?void 0:I.id)};let R=0;return b&&(b.audio=b.audio.filter(P=>P.expires===Number.MAX_SAFE_INTEGER||P.expires>Date.now()),b.images=b.images.map(P=>(P.expires===Number.MAX_SAFE_INTEGER||P.expires>Date.now()||(P.url="/expired.png"),P)),b.audio&&b.audio.length>0&&(j.audio=b.audio,R+=b.audio.length),b.images&&b.images.length>0&&(j.images=b.images,R+=b.images.length),b.videos&&b.videos.length>0&&(j.videos=b.videos,R+=b.videos.length),b.commands&&b.commands.length>0&&(j.commands=b.commands,R+=b.commands.length),b.object&&b.object.length>0&&(j.objects=b.object,R+=b.object.length)),j.attachments=R,n.messages.push(j),j}else return console.warn("empty message",{message:m,sender:x}),null},s=(m,x)=>{},c=async({message:m,sender:x,embeds:b})=>{d({message:m,sender:x,embeds:b})!==null&&t!==null&&t.activeWorkflow!==null&&await e.chat.updateChatServer({message:m,sender:x,embeds:b},Date.now())},p=async()=>{let m=n.inputText.trim();if(n.inputText="",(m==null?void 0:m.length)>0){await c({message:m,sender:"me"}),m==="?"&&(m="/help");try{if(m[0]!=="/"&&m[0]!=="@"){if(!e.workbench.canExecute){window.client.sendSystemMessage("Please load a recipe first.","text/plain");return}m="@omni "+m}let x="console",b={input:m},g=!1;if(m[0]==="/"||m[0]==="@"){m.length<=1&&(m="/help");const[y,O]=l(m);if(x=y.substring(1).replace(/[\W_]+/g,""),b=O||[],m[0]==="@"){const I=x;x="run",b=b.join(" "),b=[I,b],g=!0}}console.log("script",x,"args",b);let E;if(x==="run"){const[y,O]=b;let I=O.length?{text:O}:void 0;if(g)if(O.length>0)E=await t.executeByName(y,I);else{if(n.messages.length>2){I={};const $=n.messages[n.messages.length-2];I={text:$.text||$.html,images:$.images,audio:$.audio}}E=await t.executeByName(y,I)}else{const $=JSON.parse(y);E=await t.executeById($.id,I)}}else E=await window.client.runScript(x,b,{fromChatWindow:!0});if(console.log(JSON.stringify(E)),!E)return;if(E!=null&&E.error)throw E.error;E.response&&!E.hide&&await c({message:E.response,sender:E.sender||"omni",embeds:E.embeds})}catch(x){typeof x=="object"?x=x.message??JSON.stringify(x,null,2):console.error(x),await c({message:'<div class="w-full text-red-500font-semibold">❌ Error</div><div>'+x+"</div>",sender:"omni"})}}};let f=!1;const w=()=>{f=!0},C=()=>{f=!1},_=async m=>{n.messages.length=0;const x=`/api/v1/chat/${e.chat.activeContextId}`,g=(await Kt.get(x,{withCredentials:!0})).data.result.result;for(let E=0;E<g.length;++E){const y=g[E];if(y.version===0)switch(qn.GetMessageStorageType(y.msgstore)){case Qe.User:d(y.msgstore);break;case Qe.Omni:e.chat._onChatMessage(y.msgstore);break;case Qe.AsyncJob:{const O={sender:"omni",text:y.msgstore.message,whenText:y.msgstore.ts,attachments:0,flags:new Set,workflowId:y.msgstore.workflowId};n.messages.push(O);break}}}t!==null&&!t.canEdit&&t.activeWorkflow&&e.sendSystemMessage("ℹ️  This recipe is a **read-only** template. Use the remix button below to create a copy you can edit freely.",void 0,{commands:[{title:"Remix Recipe",id:"clone",args:[],classes:["btn btn-secondary"]}]})};e.subscribeToGlobalEvent("workbench_workflow_loaded",async m=>{await _()}),e.registerClientScript("clear",async function(m){return n.messages.length=0,await e.chat.clearChat(),{response:"Chat history cleared."}}),e.subscribeToGlobalEvent("sse_message",async m=>{if(m.type==="chat_message"){await c(m);return}m.type==="error"&&await c({message:"<div class='w-full'><span class='text-red-500 font-bold'>Error!</span> "+(m.componentKey?`A block returned an error with <span class='font-mono'>componentKey:&nbsp;"`+m.componentKey+'"</span>':"A block with a missing componentKey returned an error.")+"</div><div>Details: <pre class='font-mono' style='white-space: pre-wrap;'>"+N(m.error)+"</pre></div>"})});const A=window.SpeechRecognition||window.webkitSpeechRecognition;A?(n.recognition=new A,n.recognition.continuous=!0,n.recognition.interimResults=!0,n.recognition.lang="en-US",n.recognition.onresult=m=>{let x="";for(let b=m.resultIndex;b<m.results.length;++b)m.results[b].isFinal||(x+=m.results[b][0].transcript);x&&(n.inputText=x)},n.recognitionAvailable=!0):console.log("Speech recognition is not supported in this browser. Please try using Google Chrome.");const D=function(m){const x=document.createElement("div");return x.innerHTML=m,x.innerText.trim()},N=function(m){let x=m;if(typeof m=="string")try{x=JSON.parse(m)}catch{}else typeof m=="object"&&(x=m);return JSON.stringify(x,null,2)};return{isDraggingOver:!1,openCameraModal:!1,loadCameraModal:!1,streaming:!1,state:n,workbench:t,onChatMessage:c,onAsyncJobStatusEffectHandler:s,sendMessage:p,handleCompositionStart:w,handleCompositionEnd:C,renderMarkdown:r,ChatUtils:qn,onClickCopy(m){const x=un.sanitize(D(m.text));navigator.clipboard.writeText(x).then(function(){},function(g){console.error("Could not copy text: ",g)}),this.copyNotification=!0;const b=this;setTimeout(function(){b.copyNotification=!1},3e3)},async startMicrophoneInput(){n.recognition&&(n.recognition.start(),n.recognitionRecording=!0)},async stopMicrophoneInput(){n.recognition&&(n.recognitionRecording=!1,n.recognition.stop())},showViewerExtension(m){var x;m.fileType==="document"||m.mimeType==="application/pdf"||(x=m.mimeType)!=null&&x.startsWith("text/")?m.mimeType==="application/pdf"?t.showExtension("omni-core-viewers",{file:m},"pdf",{winbox:{title:m.fileName}}):t.showExtension("omni-core-viewers",{file:m},"markdown",{winbox:{title:m.fileName}}):m.fileType==="image"||m.mimeType.startsWith("image")?t.showExtension("omni-core-filemanager",{focusedObject:m},void 0,{winbox:{title:m.fileName}}):(m.fileType==="audio"||m.mimeType.startsWith("audio")||m.mimeType==="application/ogg")&&t.showExtension("omni-core-filemanager",{focusedObject:m},void 0,{winbox:{title:m.fileName}})},async startCamera(){console.log("startCamera"),this.loadCameraModal=!0;const m=document.getElementById("video"),x=await navigator.mediaDevices.getUserMedia({video:!0});m.srcObject=x,await new Promise(b=>{m.onloadedmetadata=b}),m.play(),this.loadCameraModal=!1,this.openCameraModal=!0,this.streaming=!0},takePhoto(){const m=document.getElementById("video"),x=document.getElementById("canvas"),b=x.getContext("2d"),g=Math.min(m.videoWidth,m.videoHeight),E=(m.videoWidth-g)/2,y=(m.videoHeight-g)/2;b.drawImage(m,E,y,g,g,0,0,x.width,x.height),x.toBlob(async O=>{var F;const I=new File([O],"photo.jpg",{type:"image/jpeg",lastModified:Date.now()}),$=await this.uploadFiles([I]);e.clipboard??(e.clipboard={}),(F=e.clipboard).images??(F.images=[]),e.clipboard.images=e.clipboard.images.concat($),e.sdkHost.sendChatMessage("Files uploaded: "+$.length,"text/plain",{images:$}),this.stopCamera()},"image/jpeg")},stopCamera(){const m=document.getElementById("video");m==null||m.srcObject.getTracks().forEach(x=>x.stop()),this.streaming=!1,this.openCameraModal=!1},async resendMessage(m){n.inputText=D(m.text),await this.sendMessage()},chatDragOver(){this.isDraggingOver=!0},chatDragLeave(){this.isDraggingOver=!1},async chatHandlePaste(m){const x=(m.clipboardData||m.originalEvent.clipboardData).items;x[0].kind==="string"||x[0].kind==="number"||await this.genericFileUpload(Array.from(x).filter(b=>b.kind==="file").map(b=>b.getAsFile()))},async chatEnterKeydown(m){m.shiftKey||!m.shiftKey&&!f&&(m.preventDefault(),m.target.value.trim()!==""&&(m.target.blur(),await p(),m.target.focus()))},async chatDrop(m){var x,b;this.isDraggingOver=!1,await this.genericFileUpload(((x=m==null?void 0:m.dataTransfer)==null?void 0:x.files)||((b=m==null?void 0:m.target)==null?void 0:b.files),m)},async onUploadFileChange(m){var x,b;await this.genericFileUpload(((x=m==null?void 0:m.dataTransfer)==null?void 0:x.files)||((b=m==null?void 0:m.target)==null?void 0:b.files),m)},async genericFileUpload(m,x){var F,j,R,P;await c({message:"Uploading files...",sender:"omni"});const b=await this.uploadFiles(m),g=b.filter(U=>U.fileType===Ee.audio),E=b.filter(U=>U.fileType===Ee.image),y=b.filter(U=>U.fileType===Ee.video),O=b.filter(U=>U.fileType===Ee.document);e.clipboard??(e.clipboard={}),(F=e.clipboard).images??(F.images=[]),(j=e.clipboard).audio??(j.audio=[]),(R=e.clipboard).video??(R.video=[]),(P=e.clipboard).documents??(P.documents=[]),e.clipboard.audio=e.clipboard.audio.concat(g),e.clipboard.images=e.clipboard.images.concat(E),e.clipboard.documents=e.clipboard.documents.concat(O),e.clipboard.videos=e.clipboard.video.concat(y);let I="Files uploaded: "+b.length;if(b.length>0)for(let U=0;U<b.length;U++)I+=`
`+b[U].url;const $=[...e.clipboard.images,...e.clipboard.videos,...e.clipboard.documents,...e.clipboard.audio].filter(U=>U);e.sdkHost.sendChatMessage(I,"text/markdown",{audio:g,images:E,documents:O,commands:[{id:"run",title:"Run",args:[null,$]}]},["no-picture"]),x.target&&(x.target.value="")},async fileToDataUrl(m){return await new Promise(function(x,b){const g=new FileReader;g.onload=E=>{x(E.target.result)},g.readAsDataURL(m)})},async uploadFiles(m){if((m==null?void 0:m.length)>0){let x=await Promise.all(Array.from(m).map(async b=>{const g=new FormData;g.append("file",b,b.name||Date.now().toString()),this.imageUrl=await this.fileToDataUrl(b);const E=await Kt.post("/fid",g,{responseType:"json",headers:{"content-type":"multipart/form-data"}});return E.data&&E.data.length>0&&E.data[0].ticket&&E.data[0].fid?E.data[0]:(console.warn("Failed to upload file",{result:E,file:b}),null)}));return x=x.filter(b=>b),x}return[]}}};var wn=Math.PI,yn=2*wn,Ht=1e-6,Ma=yn-Ht;function bn(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function se(){return new bn}bn.prototype=se.prototype={constructor:bn,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,i){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(t,e,n,i,r,l){this._+="C"+ +t+","+ +e+","+ +n+","+ +i+","+(this._x1=+r)+","+(this._y1=+l)},arcTo:function(t,e,n,i,r){t=+t,e=+e,n=+n,i=+i,r=+r;var l=this._x1,d=this._y1,s=n-t,c=i-e,p=l-t,f=d-e,w=p*p+f*f;if(r<0)throw new Error("negative radius: "+r);if(this._x1===null)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(w>Ht)if(!(Math.abs(f*s-c*p)>Ht)||!r)this._+="L"+(this._x1=t)+","+(this._y1=e);else{var C=n-l,_=i-d,A=s*s+c*c,D=C*C+_*_,N=Math.sqrt(A),m=Math.sqrt(w),x=r*Math.tan((wn-Math.acos((A+w-D)/(2*N*m)))/2),b=x/m,g=x/N;Math.abs(b-1)>Ht&&(this._+="L"+(t+b*p)+","+(e+b*f)),this._+="A"+r+","+r+",0,0,"+ +(f*C>p*_)+","+(this._x1=t+g*s)+","+(this._y1=e+g*c)}},arc:function(t,e,n,i,r,l){t=+t,e=+e,n=+n,l=!!l;var d=n*Math.cos(i),s=n*Math.sin(i),c=t+d,p=e+s,f=1^l,w=l?i-r:r-i;if(n<0)throw new Error("negative radius: "+n);this._x1===null?this._+="M"+c+","+p:(Math.abs(this._x1-c)>Ht||Math.abs(this._y1-p)>Ht)&&(this._+="L"+c+","+p),n&&(w<0&&(w=w%yn+yn),w>Ma?this._+="A"+n+","+n+",0,1,"+f+","+(t-d)+","+(e-s)+"A"+n+","+n+",0,1,"+f+","+(this._x1=c)+","+(this._y1=p):w>Ht&&(this._+="A"+n+","+n+",0,"+ +(w>=wn)+","+f+","+(this._x1=t+n*Math.cos(r))+","+(this._y1=e+n*Math.sin(r))))},rect:function(t,e,n,i){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}};function X(t){return function(){return t}}var Ti=Math.abs,rt=Math.atan2,$t=Math.cos,Da=Math.max,rn=Math.min,Tt=Math.sin,Jt=Math.sqrt,at=1e-12,Nt=Math.PI,je=Nt/2,Dt=2*Nt;function Na(t){return t>1?0:t<-1?Nt:Math.acos(t)}function ki(t){return t>=1?je:t<=-1?-je:Math.asin(t)}function Ia(t){return t.innerRadius}function La(t){return t.outerRadius}function Ra(t){return t.startAngle}function Pa(t){return t.endAngle}function $a(t){return t&&t.padAngle}function Fa(t,e,n,i,r,l,d,s){var c=n-t,p=i-e,f=d-r,w=s-l,C=w*c-f*p;if(!(C*C<at))return C=(f*(e-l)-w*(t-r))/C,[t+C*c,e+C*p]}function De(t,e,n,i,r,l,d){var s=t-n,c=e-i,p=(d?l:-l)/Jt(s*s+c*c),f=p*c,w=-p*s,C=t+f,_=e+w,A=n+f,D=i+w,N=(C+A)/2,m=(_+D)/2,x=A-C,b=D-_,g=x*x+b*b,E=r-l,y=C*D-A*_,O=(b<0?-1:1)*Jt(Da(0,E*E*g-y*y)),I=(y*b-x*O)/g,$=(-y*x-b*O)/g,F=(y*b+x*O)/g,j=(-y*x+b*O)/g,R=I-N,P=$-m,U=F-N,G=j-m;return R*R+P*P>U*U+G*G&&(I=F,$=j),{cx:I,cy:$,x01:-f,y01:-w,x11:I*(r/E-1),y11:$*(r/E-1)}}function Ba(){var t=Ia,e=La,n=X(0),i=null,r=Ra,l=Pa,d=$a,s=null;function c(){var p,f,w=+t.apply(this,arguments),C=+e.apply(this,arguments),_=r.apply(this,arguments)-je,A=l.apply(this,arguments)-je,D=Ti(A-_),N=A>_;if(s||(s=p=se()),C<w&&(f=C,C=w,w=f),!(C>at))s.moveTo(0,0);else if(D>Dt-at)s.moveTo(C*$t(_),C*Tt(_)),s.arc(0,0,C,_,A,!N),w>at&&(s.moveTo(w*$t(A),w*Tt(A)),s.arc(0,0,w,A,_,N));else{var m=_,x=A,b=_,g=A,E=D,y=D,O=d.apply(this,arguments)/2,I=O>at&&(i?+i.apply(this,arguments):Jt(w*w+C*C)),$=rn(Ti(C-w)/2,+n.apply(this,arguments)),F=$,j=$,R,P;if(I>at){var U=ki(I/w*Tt(O)),G=ki(I/C*Tt(O));(E-=U*2)>at?(U*=N?1:-1,b+=U,g-=U):(E=0,b=g=(_+A)/2),(y-=G*2)>at?(G*=N?1:-1,m+=G,x-=G):(y=0,m=x=(_+A)/2)}var o=C*$t(m),a=C*Tt(m),u=w*$t(g),h=w*Tt(g);if($>at){var v=C*$t(x),k=C*Tt(x),T=w*$t(b),S=w*Tt(b),L;if(D<Nt&&(L=Fa(o,a,T,S,v,k,u,h))){var B=o-L[0],V=a-L[1],W=v-L[0],Y=k-L[1],q=1/Tt(Na((B*W+V*Y)/(Jt(B*B+V*V)*Jt(W*W+Y*Y)))/2),J=Jt(L[0]*L[0]+L[1]*L[1]);F=rn($,(w-J)/(q-1)),j=rn($,(C-J)/(q+1))}}y>at?j>at?(R=De(T,S,o,a,C,j,N),P=De(v,k,u,h,C,j,N),s.moveTo(R.cx+R.x01,R.cy+R.y01),j<$?s.arc(R.cx,R.cy,j,rt(R.y01,R.x01),rt(P.y01,P.x01),!N):(s.arc(R.cx,R.cy,j,rt(R.y01,R.x01),rt(R.y11,R.x11),!N),s.arc(0,0,C,rt(R.cy+R.y11,R.cx+R.x11),rt(P.cy+P.y11,P.cx+P.x11),!N),s.arc(P.cx,P.cy,j,rt(P.y11,P.x11),rt(P.y01,P.x01),!N))):(s.moveTo(o,a),s.arc(0,0,C,m,x,!N)):s.moveTo(o,a),!(w>at)||!(E>at)?s.lineTo(u,h):F>at?(R=De(u,h,v,k,w,-F,N),P=De(o,a,T,S,w,-F,N),s.lineTo(R.cx+R.x01,R.cy+R.y01),F<$?s.arc(R.cx,R.cy,F,rt(R.y01,R.x01),rt(P.y01,P.x01),!N):(s.arc(R.cx,R.cy,F,rt(R.y01,R.x01),rt(R.y11,R.x11),!N),s.arc(0,0,w,rt(R.cy+R.y11,R.cx+R.x11),rt(P.cy+P.y11,P.cx+P.x11),N),s.arc(P.cx,P.cy,F,rt(P.y11,P.x11),rt(P.y01,P.x01),!N))):s.arc(0,0,w,g,b,N)}if(s.closePath(),p)return s=null,p+""||null}return c.centroid=function(){var p=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,f=(+r.apply(this,arguments)+ +l.apply(this,arguments))/2-Nt/2;return[$t(f)*p,Tt(f)*p]},c.innerRadius=function(p){return arguments.length?(t=typeof p=="function"?p:X(+p),c):t},c.outerRadius=function(p){return arguments.length?(e=typeof p=="function"?p:X(+p),c):e},c.cornerRadius=function(p){return arguments.length?(n=typeof p=="function"?p:X(+p),c):n},c.padRadius=function(p){return arguments.length?(i=p==null?null:typeof p=="function"?p:X(+p),c):i},c.startAngle=function(p){return arguments.length?(r=typeof p=="function"?p:X(+p),c):r},c.endAngle=function(p){return arguments.length?(l=typeof p=="function"?p:X(+p),c):l},c.padAngle=function(p){return arguments.length?(d=typeof p=="function"?p:X(+p),c):d},c.context=function(p){return arguments.length?(s=p??null,c):s},c}function po(t){this._context=t}po.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e);break}}};function Xe(t){return new po(t)}function In(t){return t[0]}function Ln(t){return t[1]}function Ye(){var t=In,e=Ln,n=X(!0),i=null,r=Xe,l=null;function d(s){var c,p=s.length,f,w=!1,C;for(i==null&&(l=r(C=se())),c=0;c<=p;++c)!(c<p&&n(f=s[c],c,s))===w&&((w=!w)?l.lineStart():l.lineEnd()),w&&l.point(+t(f,c,s),+e(f,c,s));if(C)return l=null,C+""||null}return d.x=function(s){return arguments.length?(t=typeof s=="function"?s:X(+s),d):t},d.y=function(s){return arguments.length?(e=typeof s=="function"?s:X(+s),d):e},d.defined=function(s){return arguments.length?(n=typeof s=="function"?s:X(!!s),d):n},d.curve=function(s){return arguments.length?(r=s,i!=null&&(l=r(i)),d):r},d.context=function(s){return arguments.length?(s==null?i=l=null:l=r(i=s),d):i},d}function fo(){var t=In,e=null,n=X(0),i=Ln,r=X(!0),l=null,d=Xe,s=null;function c(f){var w,C,_,A=f.length,D,N=!1,m,x=new Array(A),b=new Array(A);for(l==null&&(s=d(m=se())),w=0;w<=A;++w){if(!(w<A&&r(D=f[w],w,f))===N)if(N=!N)C=w,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),_=w-1;_>=C;--_)s.point(x[_],b[_]);s.lineEnd(),s.areaEnd()}N&&(x[w]=+t(D,w,f),b[w]=+n(D,w,f),s.point(e?+e(D,w,f):x[w],i?+i(D,w,f):b[w]))}if(m)return s=null,m+""||null}function p(){return Ye().defined(r).curve(d).context(l)}return c.x=function(f){return arguments.length?(t=typeof f=="function"?f:X(+f),e=null,c):t},c.x0=function(f){return arguments.length?(t=typeof f=="function"?f:X(+f),c):t},c.x1=function(f){return arguments.length?(e=f==null?null:typeof f=="function"?f:X(+f),c):e},c.y=function(f){return arguments.length?(n=typeof f=="function"?f:X(+f),i=null,c):n},c.y0=function(f){return arguments.length?(n=typeof f=="function"?f:X(+f),c):n},c.y1=function(f){return arguments.length?(i=f==null?null:typeof f=="function"?f:X(+f),c):i},c.lineX0=c.lineY0=function(){return p().x(t).y(n)},c.lineY1=function(){return p().x(t).y(i)},c.lineX1=function(){return p().x(e).y(n)},c.defined=function(f){return arguments.length?(r=typeof f=="function"?f:X(!!f),c):r},c.curve=function(f){return arguments.length?(d=f,l!=null&&(s=d(l)),c):d},c.context=function(f){return arguments.length?(f==null?l=s=null:s=d(l=f),c):l},c}function ja(t,e){return e<t?-1:e>t?1:e>=t?0:NaN}function Ha(t){return t}function Va(){var t=Ha,e=ja,n=null,i=X(0),r=X(Dt),l=X(0);function d(s){var c,p=s.length,f,w,C=0,_=new Array(p),A=new Array(p),D=+i.apply(this,arguments),N=Math.min(Dt,Math.max(-Dt,r.apply(this,arguments)-D)),m,x=Math.min(Math.abs(N)/p,l.apply(this,arguments)),b=x*(N<0?-1:1),g;for(c=0;c<p;++c)(g=A[_[c]=c]=+t(s[c],c,s))>0&&(C+=g);for(e!=null?_.sort(function(E,y){return e(A[E],A[y])}):n!=null&&_.sort(function(E,y){return n(s[E],s[y])}),c=0,w=C?(N-p*b)/C:0;c<p;++c,D=m)f=_[c],g=A[f],m=D+(g>0?g*w:0)+b,A[f]={data:s[f],index:c,value:g,startAngle:D,endAngle:m,padAngle:x};return A}return d.value=function(s){return arguments.length?(t=typeof s=="function"?s:X(+s),d):t},d.sortValues=function(s){return arguments.length?(e=s,n=null,d):e},d.sort=function(s){return arguments.length?(n=s,e=null,d):n},d.startAngle=function(s){return arguments.length?(i=typeof s=="function"?s:X(+s),d):i},d.endAngle=function(s){return arguments.length?(r=typeof s=="function"?s:X(+s),d):r},d.padAngle=function(s){return arguments.length?(l=typeof s=="function"?s:X(+s),d):l},d}var go=Rn(Xe);function vo(t){this._curve=t}vo.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(t,e){this._curve.point(e*Math.sin(t),e*-Math.cos(t))}};function Rn(t){function e(n){return new vo(t(n))}return e._curve=t,e}function de(t){var e=t.curve;return t.angle=t.x,delete t.x,t.radius=t.y,delete t.y,t.curve=function(n){return arguments.length?e(Rn(n)):e()._curve},t}function Ci(){return de(Ye().curve(go))}function Ei(){var t=fo().curve(go),e=t.curve,n=t.lineX0,i=t.lineX1,r=t.lineY0,l=t.lineY1;return t.angle=t.x,delete t.x,t.startAngle=t.x0,delete t.x0,t.endAngle=t.x1,delete t.x1,t.radius=t.y,delete t.y,t.innerRadius=t.y0,delete t.y0,t.outerRadius=t.y1,delete t.y1,t.lineStartAngle=function(){return de(n())},delete t.lineX0,t.lineEndAngle=function(){return de(i())},delete t.lineX1,t.lineInnerRadius=function(){return de(r())},delete t.lineY0,t.lineOuterRadius=function(){return de(l())},delete t.lineY1,t.curve=function(d){return arguments.length?e(Rn(d)):e()._curve},t}function he(t,e){return[(e=+e)*Math.cos(t-=Math.PI/2),e*Math.sin(t)]}var xn=Array.prototype.slice;function Wa(t){return t.source}function Ua(t){return t.target}function Pn(t){var e=Wa,n=Ua,i=In,r=Ln,l=null;function d(){var s,c=xn.call(arguments),p=e.apply(this,c),f=n.apply(this,c);if(l||(l=s=se()),t(l,+i.apply(this,(c[0]=p,c)),+r.apply(this,c),+i.apply(this,(c[0]=f,c)),+r.apply(this,c)),s)return l=null,s+""||null}return d.source=function(s){return arguments.length?(e=s,d):e},d.target=function(s){return arguments.length?(n=s,d):n},d.x=function(s){return arguments.length?(i=typeof s=="function"?s:X(+s),d):i},d.y=function(s){return arguments.length?(r=typeof s=="function"?s:X(+s),d):r},d.context=function(s){return arguments.length?(l=s??null,d):l},d}function za(t,e,n,i,r){t.moveTo(e,n),t.bezierCurveTo(e=(e+i)/2,n,e,r,i,r)}function qa(t,e,n,i,r){t.moveTo(e,n),t.bezierCurveTo(e,n=(n+r)/2,i,n,i,r)}function Xa(t,e,n,i,r){var l=he(e,n),d=he(e,n=(n+r)/2),s=he(i,n),c=he(i,r);t.moveTo(l[0],l[1]),t.bezierCurveTo(d[0],d[1],s[0],s[1],c[0],c[1])}function Ya(){return Pn(za)}function Ja(){return Pn(qa)}function Ka(){var t=Pn(Xa);return t.angle=t.x,delete t.x,t.radius=t.y,delete t.y,t}const $n={draw:function(t,e){var n=Math.sqrt(e/Nt);t.moveTo(n,0),t.arc(0,0,n,0,Dt)}},mo={draw:function(t,e){var n=Math.sqrt(e/5)/2;t.moveTo(-3*n,-n),t.lineTo(-n,-n),t.lineTo(-n,-3*n),t.lineTo(n,-3*n),t.lineTo(n,-n),t.lineTo(3*n,-n),t.lineTo(3*n,n),t.lineTo(n,n),t.lineTo(n,3*n),t.lineTo(-n,3*n),t.lineTo(-n,n),t.lineTo(-3*n,n),t.closePath()}};var wo=Math.sqrt(1/3),Ga=wo*2;const yo={draw:function(t,e){var n=Math.sqrt(e/Ga),i=n*wo;t.moveTo(0,-n),t.lineTo(i,0),t.lineTo(0,n),t.lineTo(-i,0),t.closePath()}};var Za=.8908130915292852,bo=Math.sin(Nt/10)/Math.sin(7*Nt/10),Qa=Math.sin(Dt/10)*bo,tl=-Math.cos(Dt/10)*bo;const xo={draw:function(t,e){var n=Math.sqrt(e*Za),i=Qa*n,r=tl*n;t.moveTo(0,-n),t.lineTo(i,r);for(var l=1;l<5;++l){var d=Dt*l/5,s=Math.cos(d),c=Math.sin(d);t.lineTo(c*n,-s*n),t.lineTo(s*i-c*r,c*i+s*r)}t.closePath()}},_o={draw:function(t,e){var n=Math.sqrt(e),i=-n/2;t.rect(i,i,n,n)}};var an=Math.sqrt(3);const To={draw:function(t,e){var n=-Math.sqrt(e/(an*3));t.moveTo(0,n*2),t.lineTo(-an*n,-n),t.lineTo(an*n,-n),t.closePath()}};var mt=-.5,wt=Math.sqrt(3)/2,_n=1/Math.sqrt(12),el=(_n/2+1)*3;const ko={draw:function(t,e){var n=Math.sqrt(e/el),i=n/2,r=n*_n,l=i,d=n*_n+n,s=-l,c=d;t.moveTo(i,r),t.lineTo(l,d),t.lineTo(s,c),t.lineTo(mt*i-wt*r,wt*i+mt*r),t.lineTo(mt*l-wt*d,wt*l+mt*d),t.lineTo(mt*s-wt*c,wt*s+mt*c),t.lineTo(mt*i+wt*r,mt*r-wt*i),t.lineTo(mt*l+wt*d,mt*d-wt*l),t.lineTo(mt*s+wt*c,mt*c-wt*s),t.closePath()}};var nl=[$n,mo,yo,_o,xo,To,ko];function il(){var t=X($n),e=X(64),n=null;function i(){var r;if(n||(n=r=se()),t.apply(this,arguments).draw(n,+e.apply(this,arguments)),r)return n=null,r+""||null}return i.type=function(r){return arguments.length?(t=typeof r=="function"?r:X(r),i):t},i.size=function(r){return arguments.length?(e=typeof r=="function"?r:X(+r),i):e},i.context=function(r){return arguments.length?(n=r??null,i):n},i}function It(){}function He(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function Je(t){this._context=t}Je.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:He(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:He(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function Co(t){return new Je(t)}function Eo(t){this._context=t}Eo.prototype={areaStart:It,areaEnd:It,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:He(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function ol(t){return new Eo(t)}function Oo(t){this._context=t}Oo.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+t)/6,i=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 3:this._point=4;default:He(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function sl(t){return new Oo(t)}function So(t,e){this._basis=new Je(t),this._beta=e}So.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,n=t.length-1;if(n>0)for(var i=t[0],r=e[0],l=t[n]-i,d=e[n]-r,s=-1,c;++s<=n;)c=s/n,this._basis.point(this._beta*t[s]+(1-this._beta)*(i+c*l),this._beta*e[s]+(1-this._beta)*(r+c*d));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}};const rl=function t(e){function n(i){return e===1?new Je(i):new So(i,e)}return n.beta=function(i){return t(+i)},n}(.85);function Ve(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function Fn(t,e){this._context=t,this._k=(1-e)/6}Fn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Ve(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:Ve(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const al=function t(e){function n(i){return new Fn(i,e)}return n.tension=function(i){return t(+i)},n}(0);function Bn(t,e){this._context=t,this._k=(1-e)/6}Bn.prototype={areaStart:It,areaEnd:It,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:Ve(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const ll=function t(e){function n(i){return new Bn(i,e)}return n.tension=function(i){return t(+i)},n}(0);function jn(t,e){this._context=t,this._k=(1-e)/6}jn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Ve(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const cl=function t(e){function n(i){return new jn(i,e)}return n.tension=function(i){return t(+i)},n}(0);function Hn(t,e,n){var i=t._x1,r=t._y1,l=t._x2,d=t._y2;if(t._l01_a>at){var s=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,c=3*t._l01_a*(t._l01_a+t._l12_a);i=(i*s-t._x0*t._l12_2a+t._x2*t._l01_2a)/c,r=(r*s-t._y0*t._l12_2a+t._y2*t._l01_2a)/c}if(t._l23_a>at){var p=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,f=3*t._l23_a*(t._l23_a+t._l12_a);l=(l*p+t._x1*t._l23_2a-e*t._l12_2a)/f,d=(d*p+t._y1*t._l23_2a-n*t._l12_2a)/f}t._context.bezierCurveTo(i,r,l,d,t._x2,t._y2)}function Ao(t,e){this._context=t,this._alpha=e}Ao.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:Hn(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const ul=function t(e){function n(i){return e?new Ao(i,e):new Fn(i,0)}return n.alpha=function(i){return t(+i)},n}(.5);function Mo(t,e){this._context=t,this._alpha=e}Mo.prototype={areaStart:It,areaEnd:It,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:Hn(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const dl=function t(e){function n(i){return e?new Mo(i,e):new Bn(i,0)}return n.alpha=function(i){return t(+i)},n}(.5);function Do(t,e){this._context=t,this._alpha=e}Do.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Hn(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};const hl=function t(e){function n(i){return e?new Do(i,e):new jn(i,0)}return n.alpha=function(i){return t(+i)},n}(.5);function No(t){this._context=t}No.prototype={areaStart:It,areaEnd:It,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}};function pl(t){return new No(t)}function Oi(t){return t<0?-1:1}function Si(t,e,n){var i=t._x1-t._x0,r=e-t._x1,l=(t._y1-t._y0)/(i||r<0&&-0),d=(n-t._y1)/(r||i<0&&-0),s=(l*r+d*i)/(i+r);return(Oi(l)+Oi(d))*Math.min(Math.abs(l),Math.abs(d),.5*Math.abs(s))||0}function Ai(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function ln(t,e,n){var i=t._x0,r=t._y0,l=t._x1,d=t._y1,s=(l-i)/3;t._context.bezierCurveTo(i+s,r+s*e,l-s,d-s*n,l,d)}function We(t){this._context=t}We.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:ln(this,this._t0,Ai(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(t=+t,e=+e,!(t===this._x1&&e===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,ln(this,Ai(this,n=Si(this,t,e)),n);break;default:ln(this,this._t0,n=Si(this,t,e));break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}};function Io(t){this._context=new Lo(t)}(Io.prototype=Object.create(We.prototype)).point=function(t,e){We.prototype.point.call(this,e,t)};function Lo(t){this._context=t}Lo.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,i,r,l){this._context.bezierCurveTo(e,t,i,n,l,r)}};function fl(t){return new We(t)}function gl(t){return new Io(t)}function Ro(t){this._context=t}Ro.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,n=t.length;if(n)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),n===2)this._context.lineTo(t[1],e[1]);else for(var i=Mi(t),r=Mi(e),l=0,d=1;d<n;++l,++d)this._context.bezierCurveTo(i[0][l],r[0][l],i[1][l],r[1][l],t[d],e[d]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}};function Mi(t){var e,n=t.length-1,i,r=new Array(n),l=new Array(n),d=new Array(n);for(r[0]=0,l[0]=2,d[0]=t[0]+2*t[1],e=1;e<n-1;++e)r[e]=1,l[e]=4,d[e]=4*t[e]+2*t[e+1];for(r[n-1]=2,l[n-1]=7,d[n-1]=8*t[n-1]+t[n],e=1;e<n;++e)i=r[e]/l[e-1],l[e]-=i,d[e]-=i*d[e-1];for(r[n-1]=d[n-1]/l[n-1],e=n-2;e>=0;--e)r[e]=(d[e]-r[e+1])/l[e];for(l[n-1]=(t[n]+r[n-1])/2,e=0;e<n-1;++e)l[e]=2*t[e+1]-r[e+1];return[r,l]}function vl(t){return new Ro(t)}function Ke(t,e){this._context=t,this._t=e}Ke.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}break}}this._x=t,this._y=e}};function ml(t){return new Ke(t,.5)}function wl(t){return new Ke(t,0)}function yl(t){return new Ke(t,1)}function ie(t,e){if((d=t.length)>1)for(var n=1,i,r,l=t[e[0]],d,s=l.length;n<d;++n)for(r=l,l=t[e[n]],i=0;i<s;++i)l[i][1]+=l[i][0]=isNaN(r[i][1])?r[i][0]:r[i][1]}function oe(t){for(var e=t.length,n=new Array(e);--e>=0;)n[e]=e;return n}function bl(t,e){return t[e]}function xl(){var t=X([]),e=oe,n=ie,i=bl;function r(l){var d=t.apply(this,arguments),s,c=l.length,p=d.length,f=new Array(p),w;for(s=0;s<p;++s){for(var C=d[s],_=f[s]=new Array(c),A=0,D;A<c;++A)_[A]=D=[0,+i(l[A],C,A,l)],D.data=l[A];_.key=C}for(s=0,w=e(f);s<p;++s)f[w[s]].index=s;return n(f,w),f}return r.keys=function(l){return arguments.length?(t=typeof l=="function"?l:X(xn.call(l)),r):t},r.value=function(l){return arguments.length?(i=typeof l=="function"?l:X(+l),r):i},r.order=function(l){return arguments.length?(e=l==null?oe:typeof l=="function"?l:X(xn.call(l)),r):e},r.offset=function(l){return arguments.length?(n=l??ie,r):n},r}function _l(t,e){if((i=t.length)>0){for(var n,i,r=0,l=t[0].length,d;r<l;++r){for(d=n=0;n<i;++n)d+=t[n][r][1]||0;if(d)for(n=0;n<i;++n)t[n][r][1]/=d}ie(t,e)}}function Tl(t,e){if((c=t.length)>0)for(var n,i=0,r,l,d,s,c,p=t[e[0]].length;i<p;++i)for(d=s=0,n=0;n<c;++n)(l=(r=t[e[n]][i])[1]-r[0])>0?(r[0]=d,r[1]=d+=l):l<0?(r[1]=s,r[0]=s+=l):(r[0]=0,r[1]=l)}function kl(t,e){if((r=t.length)>0){for(var n=0,i=t[e[0]],r,l=i.length;n<l;++n){for(var d=0,s=0;d<r;++d)s+=t[d][n][1]||0;i[n][1]+=i[n][0]=-s/2}ie(t,e)}}function Cl(t,e){if(!(!((d=t.length)>0)||!((l=(r=t[e[0]]).length)>0))){for(var n=0,i=1,r,l,d;i<l;++i){for(var s=0,c=0,p=0;s<d;++s){for(var f=t[e[s]],w=f[i][1]||0,C=f[i-1][1]||0,_=(w-C)/2,A=0;A<s;++A){var D=t[e[A]],N=D[i][1]||0,m=D[i-1][1]||0;_+=N-m}c+=w,p+=_*w}r[i-1][1]+=r[i-1][0]=n,c&&(n-=p/c)}r[i-1][1]+=r[i-1][0]=n,ie(t,e)}}function Po(t){var e=t.map(El);return oe(t).sort(function(n,i){return e[n]-e[i]})}function El(t){for(var e=-1,n=0,i=t.length,r,l=-1/0;++e<i;)(r=+t[e][1])>l&&(l=r,n=e);return n}function $o(t){var e=t.map(Fo);return oe(t).sort(function(n,i){return e[n]-e[i]})}function Fo(t){for(var e=0,n=-1,i=t.length,r;++n<i;)(r=+t[n][1])&&(e+=r);return e}function Ol(t){return $o(t).reverse()}function Sl(t){var e=t.length,n,i,r=t.map(Fo),l=Po(t),d=0,s=0,c=[],p=[];for(n=0;n<e;++n)i=l[n],d<s?(d+=r[i],c.push(i)):(s+=r[i],p.push(i));return p.reverse().concat(c)}function Al(t){return oe(t).reverse()}const Ml=Object.freeze(Object.defineProperty({__proto__:null,arc:Ba,area:fo,areaRadial:Ei,curveBasis:Co,curveBasisClosed:ol,curveBasisOpen:sl,curveBundle:rl,curveCardinal:al,curveCardinalClosed:ll,curveCardinalOpen:cl,curveCatmullRom:ul,curveCatmullRomClosed:dl,curveCatmullRomOpen:hl,curveLinear:Xe,curveLinearClosed:pl,curveMonotoneX:fl,curveMonotoneY:gl,curveNatural:vl,curveStep:ml,curveStepAfter:yl,curveStepBefore:wl,line:Ye,lineRadial:Ci,linkHorizontal:Ya,linkRadial:Ka,linkVertical:Ja,pie:Va,pointRadial:he,radialArea:Ei,radialLine:Ci,stack:xl,stackOffsetDiverging:Tl,stackOffsetExpand:_l,stackOffsetNone:ie,stackOffsetSilhouette:kl,stackOffsetWiggle:Cl,stackOrderAppearance:Po,stackOrderAscending:$o,stackOrderDescending:Ol,stackOrderInsideOut:Sl,stackOrderNone:oe,stackOrderReverse:Al,symbol:il,symbolCircle:$n,symbolCross:mo,symbolDiamond:yo,symbolSquare:_o,symbolStar:xo,symbolTriangle:To,symbolWye:ko,symbols:nl},Symbol.toStringTag,{value:"Module"}));/*!
* rete-connection-path-plugin v0.3.1 
* (c) 2019 Vitaliy Stoliarov 
* Released under the MIT license.
*/function Dl(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Di(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Nl(t,e,n){return e&&Di(t.prototype,e),n&&Di(t,n),t}function Il(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ll(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{},i=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(r){return Object.getOwnPropertyDescriptor(n,r).enumerable}))),i.forEach(function(r){Il(t,r,n[r])})}return t}function Ni(t,e){return Rl(t)||Pl(t,e)||$l()}function Rl(t){if(Array.isArray(t))return t}function Pl(t,e){var n=[],i=!0,r=!1,l=void 0;try{for(var d=t[Symbol.iterator](),s;!(i=(s=d.next()).done)&&(n.push(s.value),!(e&&n.length===e));i=!0);}catch(c){r=!0,l=c}finally{try{!i&&d.return!=null&&d.return()}finally{if(r)throw l}}return n}function $l(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var Fl=function(){function t(e,n){Dl(this,t),this.points=e,this.curve=n}return Nl(t,[{key:"line",value:function(n){var i=n(this.points);return Ye().x(function(r){return r[0]}).y(function(r){return r[1]}).curve(this.curve)(i)}},{key:"getData",value:function(n,i){return this.line(n(i))}}]),t}(),Ii={LINEAR:function(){return function(e){var n=Ni(e,4),i=n[0],r=n[1],l=n[2],d=n[3];return[[i,r],[l,d]]}},DEFAULT:function(e){var n=e.vertical,i=n===void 0?!1:n,r=e.curvature,l=r===void 0?.4:r;return function(d){var s=Ni(d,4),c=s[0],p=s[1],f=s[2],w=s[3],C=[c,p],_=[f,w];if(i){var A=[p,c];c=A[0],p=A[1];var D=[w,f];f=D[0],w=D[1]}var N=c+Math.abs(f-c)*l,m=f-Math.abs(f-c)*l,x=i?[p,N]:[N,p],b=i?[w,m]:[m,w];return[C,x,b,_]}}},Bo={DEFAULT:"DEFAULT",LINEAR:"LINEAR"};function Bl(t,e){var n=t.x,i=t.y,r=e.x,l=e.y,d=n-r,s=i-l;return 180*Math.atan2(s,d)/Math.PI}function Li(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,r=t.getTotalLength()*n,l=t.getPointAtLength(r+e),d=t.getPointAtLength(r),s=180+(i?Bl(l,d):0);return"translate(".concat(l.x,", ").concat(l.y,") rotate(").concat(s,")")}function jl(t,e){var n=e.type,i=e.transformer,r=e.arrow,l=e.curve,d=e.options,s=d===void 0?{}:d;if(n=n||Bo.DEFAULT,l=l||Co,i&&typeof i!="function")throw new Error("transformer property must be a function");if(!Ii[n])throw new Error("transformer with type ".concat(n," doesn't exist"));t.on("connectionpath",function(c){var p=c.points,f=new Fl(p,l);c.d=f.getData(i||Ii[n],s)}),r&&(t.on("renderconnection",function(c){var p=c.el,f=p.querySelector("path"),w=document.createElementNS("http://www.w3.org/2000/svg","path");p.querySelector("svg").appendChild(w),w.classList.add("marker"),w.setAttribute("fill",r.color||"steelblue"),w.setAttribute("d",r.marker||"M-5,-10 L-5,10 L20,0 z"),w.setAttribute("transform",Li(f,-25))}),t.on("updateconnection",function(c){var p=c.el,f=p.querySelector("path"),w=p.querySelector(".marker");w.setAttribute("transform",Li(f,-25))}))}var cn=Ll({install:jl},Ml,Bo);/*!
* rete-connection-plugin v0.9.0 
* (c) 2019 Vitaliy Stoliarov 
* Released under the MIT license.
*/function Hl(t){if(t&&!(typeof window>"u")){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}function Vn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ri(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Wn(t,e,n){return e&&Ri(t.prototype,e),n&&Ri(t,n),t}function Gt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function jo(t,e){return Vl(t)||Wl(t,e)||Ul()}function Vl(t){if(Array.isArray(t))return t}function Wl(t,e){var n=[],i=!0,r=!1,l=void 0;try{for(var d=t[Symbol.iterator](),s;!(i=(s=d.next()).done)&&(n.push(s.value),!(e&&n.length===e));i=!0);}catch(c){r=!0,l=c}finally{try{!i&&d.return!=null&&d.return()}finally{if(r)throw l}}return n}function Ul(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function Ne(t){return t.toLowerCase().replace(/ /g,"-")}function Ho(t,e){return t.get(e)||(e.parentElement?Ho(t,e.parentElement):null)}function zl(t,e){var n=jo(t,4),i=n[0],r=n[1],l=n[2],d=n[3],s=i+Math.abs(l-i)*e,c=l-Math.abs(l-i)*e;return"M ".concat(i," ").concat(r," C ").concat(s," ").concat(r," ").concat(c," ").concat(d," ").concat(l," ").concat(d)}function Ue(t,e,n){var i={points:e,connection:n,d:""};return t.trigger("connectionpath",i),i.d||zl(e,.4)}function Un(t){var e=t.el,n=t.d,i=e.querySelector(".connection path");if(!i)throw new Error("Path of connection was broken");i.setAttribute("d",n)}function Vo(t){var e,n=t.el,i=t.d,r=t.connection,l=r?["input-"+Ne(r.input.name),"output-"+Ne(r.output.name),"socket-input-"+Ne(r.input.socket.name),"socket-output-"+Ne(r.output.socket.name)]:[],d=document.createElementNS("http://www.w3.org/2000/svg","svg"),s=document.createElementNS("http://www.w3.org/2000/svg","path");(e=d.classList).add.apply(e,["connection"].concat(l)),s.classList.add("main-path"),s.setAttribute("d",i),d.appendChild(s),n.appendChild(d),Un({el:n,d:i})}var ql=function(){function t(e,n){Vn(this,t),this.emitter=e,this.editorView=n,Gt(this,"el",void 0),this.el=document.createElement("div"),this.el.style.position="absolute",this.editorView.area.appendChild(this.el)}return Wn(t,[{key:"updatePseudoConnection",value:function(n){n!==null?this.renderConnection(n):this.el.parentElement&&(this.el.innerHTML="")}},{key:"getPoints",value:function(n){var i=this.editorView.area.mouse;if(!n.node)throw new Error("Node in output/input not found");var r=this.editorView.nodes.get(n.node);if(!r)throw new Error("Node view not found");var l=r.getSocketPosition(n),d=jo(l,2),s=d[0],c=d[1];return n instanceof dn?[s,c,i.x,i.y]:[i.x,i.y,s,c]}},{key:"updateConnection",value:function(n){var i=Ue(this.emitter,this.getPoints(n));Un({el:this.el,d:i})}},{key:"renderConnection",value:function(n){var i=Ue(this.emitter,this.getPoints(n));Vo({el:this.el,d:i})}}]),t}(),Xl=function(){function t(e){var n=this;Vn(this,t),Gt(this,"editor",void 0),Gt(this,"_io",null),Gt(this,"view",void 0),this.editor=e,this.view=new ql(e,e.view),e.on("mousemove",function(){return n.io&&n.view.updateConnection(n.io)})}return Wn(t,[{key:"reset",value:function(){this.io=null}},{key:"pickOutput",value:function(n){if(this.editor.trigger("connectionpick",n)){if(this.io instanceof es){!n.multipleConnections&&n.hasConnection()&&this.editor.removeConnection(n.connections[0]),this.editor.connect(n,this.io),this.reset();return}this.io&&this.reset(),this.io=n}}},{key:"pickInput",value:function(n){var i=this;if(this.editor.trigger("connectionpick",n)){if(this.io===null)return n.hasConnection()?(this.io=n.connections[0].output,this.editor.removeConnection(n.connections[0])):this.io=n,!0;if(!n.multipleConnections&&n.hasConnection()&&this.editor.removeConnection(n.connections[0]),!this.io.multipleConnections&&this.io.hasConnection()&&this.editor.removeConnection(this.io.connections[0]),this.io instanceof dn&&this.io.connectedTo(n)){var r=n.connections.find(function(l){return l.output===i.io});r&&this.editor.removeConnection(r)}this.io instanceof dn&&(this.editor.connect(this.io,n),this.reset())}}},{key:"pickConnection",value:function(n){var i=n.output;this.editor.removeConnection(n),this.io=i}},{key:"io",get:function(){return this._io},set:function(n){this._io=n,this.view.updatePseudoConnection(n)}}]),t}(),Yl=function(){function t(e){Vn(this,t),Gt(this,"picker",void 0),Gt(this,"target",void 0),this.picker=e,this.target=null}return Wn(t,[{key:"act",value:function(n){var i=n.input,r=n.output;this.unlock(i||r)||(i?this.picker.pickInput(i):r?this.picker.pickOutput(r):this.picker.reset())}},{key:"start",value:function(n,i){this.act(n),this.target=i}},{key:"complete",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.act(n)}},{key:"hasTarget",value:function(){return!!this.target}},{key:"unlock",value:function(n){var i=this.target;return this.target=null,i&&i===n}}]),t}();Hl(`.connection {
  overflow: visible !important;
  position: absolute;
  z-index: -1;
  pointer-events: none; }
  .connection > * {
    pointer-events: all; }
  .connection .main-path {
    fill: none;
    stroke-width: 5px;
    stroke: steelblue; }
`);function Jl(t){t.bind("connectionpath"),t.bind("connectiondrop"),t.bind("connectionpick"),t.bind("resetconnection");var e=new Xl(t),n=new Yl(e),i=new WeakMap;function r(d){var s=i.get(this);if(s){var c=s.input,p=s.output;t.view.container.dispatchEvent(new PointerEvent("pointermove",d)),d.preventDefault(),d.stopPropagation(),n.start({input:c,output:p},c||p)}}function l(d){var s=document.elementFromPoint(d.clientX,d.clientY);e.io&&t.trigger("connectiondrop",e.io),s&&n.complete(Ho(i,s)||{})}t.on("resetconnection",function(){return n.complete()}),t.on("rendersocket",function(d){var s=d.el,c=d.input,p=d.output;i.set(s,{input:c,output:p}),s.removeEventListener("pointerdown",r),s.addEventListener("pointerdown",r)}),window.addEventListener("pointerup",l),t.on("renderconnection",function(d){var s=d.el,c=d.connection,p=d.points,f=Ue(t,p,c);Vo({el:s,d:f,connection:c})}),t.on("updateconnection",function(d){var s=d.el,c=d.connection,p=d.points,f=Ue(t,p,c);Un({el:s,d:f})}),t.on("destroy",function(){window.removeEventListener("pointerup",l)})}var Kl={name:"connection",install:Jl};const Gl=`<div class="input-control-div" x-tooltip:reactive="control.description">
  <input
    type="checkbox"
    :style="opts.readonly ? 'background-color: #ccc; color: white;' : 'color:black;'"
    :disabled="opts.readonly"
    x-model="value"
    @change="change"
    @dblclick.stop
    @wheel.stop
    @pointerdown.stop
    @pointermove.stop
  />
  <label
    x-show="name"
    class="input-control-label"
    x-text="title + ': ' + (value ? 'yes' : 'no')"
  ></label>
</div>`,Zl=`<div class="input-control-div p-2" x-tooltip:reactive="control.description">
  <button
    type="button"
    class="btn btn-primary p-2 w-full"
    :disabled="opts.readonly"
    @click="runButtonAction(custom('buttonValue'), custom('buttonArgs'))"
    @dblclick.stop
    @wheel.stop
    @pointerdown.stopbtn
    @pointermove.stop
    x-text="title"
  >
</button>
</div>`,Ql=`<div
  class="input-control-div"
  x-tooltip:reactive="tooltip"
>
  <div
    x-show="error"
    x-text="error"
    class="flex text-white bg-red-500 w-full text-xs"
  ></div>
  <label
    :for="controlUid"
    class="sr-only text-xs text-gray-500"
    x-text="title"
  ></label>
  <textarea
    x-data="inputUtils"
    x-init="textareaAutoResize($el)"
    @input="textareaAutoResize($el)"
    :id="controlUid"
    :disabled="opts.readonly"
    :value="value && typeof(value) !== 'string'? JSON.stringify(value, null, 2).trim() : null"
    :placeholder="opts.placeholder || title"
    @blur="change($event)"
    @dblclick.stop="$event"
    @pointerdown.stop="$event"
    @pointermove.stop="$event"
    class="h-7 min-h-7 w-full font-mono text-xs rounded-md border-gray-300 shadow-sm focus:border-primary-400 focus:ring-opacity-50 disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500"
    :class="{
          'ring-red-300 ring-2': required && !hasValue(),
         } "
  />

</div>`,tc=`<div class="input-control-div">
  <label
    :for="controlUid"
    class="sr-only text-xs text-gray-400"
    x-text="title"
  ></label>
  <div class="flex flex-grow flex-nowrap h-5">
  <div
    class="w-10 h-5 cursor-default rounded-l-md"
    x-tooltip="Color Preview"
    :style="{
      'background-color': value,
    }"
    >
    </div>

  <textarea
    x-data="inputUtils"
    x-init="textareaAutoResize($el)"
    @input="textareaAutoResize($el)"
    :id="controlUid"
    :disabled="opts.readonly"
    :value="value"
    :placeholder="opts.placeholder || title"
    maxlength="20"
    aria-multiline="false"
    cols="1"
    rows="1"
    res
    @blur="change($event)"
    @dblclick.stop="$event"
    @pointerdown.stop="$event"
    @pointermove.stop="$event"
    class="h-6 min-h-7 resize-none w-full text-xs rounded-md rounded-l-none border-gray-300 shadow-sm focus:border-primary-400 focus:ring-opacity-50 disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500"
    :class="{
         'ring-red-300 ring-2': required && !hasValue(),
        } "

  />
  </div>

</div>`,ec=`<div
  class="input-control-div"
  x-tooltip:reactive="tooltip"
>
  <div
    x-show="error"
    x-text="error"
    class="flex text-white bg-red-500 w-full text-xs"
  ></div>
  <label
    :for="controlUid"
    class="sr-only text-xs text-gray-500"
    x-text="title"
  ></label>
  <textarea
    x-data="inputUtils"
    x-init="textareaAutoResize($el)"
    @input="textareaAutoResize($el)"
    :id="controlUid"
    :disabled="opts.readonly"
    :value="value && typeof(value) !== 'string'? JSON.stringify(value, null, 2).trim() : null"
    :placeholder="opts.placeholder || title"
    @blur="change($event)"
    @dblclick.stop="$event"
    @pointerdown.stop="$event"
    @pointermove.stop="$event"
    class="h-7 min-h-7 w-full font-mono text-xs rounded-md border-gray-300 shadow-sm focus:border-primary-400 focus:ring-opacity-50 disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500"
  />

</div>`,nc=`<div class="relative flex"><div
    x-data="gallery"
    class="flex w-full justify-center"
  >
    <div
      x-show="value?.length > 0"
      x-on:keydown.right="next"
      x-on:keydown.left="prev"
      tabindex="0"
      role="region"
      aria-labelledby="carousel-label"
      class="flex"
    >
      <h2 id="carousel-label" class="sr-only" hidden>Carousel</h2>
      <div class="flex justify-center items-center">
        <!-- Prev Button -->
        <button
          x-on:click="prev"
          x-show="value?.length > 1"
          class="absolute left-0 top-1/2 transform -translate-y-1/2 text-6xl"
          :aria-disabled="atBeginning"
          :tabindex="atEnd ? -1 : 0"
          :class="{ 'opacity-50 cursor-not-allowed': atBeginning }"
        >
          <span aria-hidden="true">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-8 w-8 text-gray-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="3"
            ><path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M15 19l-7-7 7-7"
              /></svg>
          </span>
          <span class="sr-only">Skip to previous slide page</span>
        </button>
        <!-- Next Button -->
        <button
          x-on:click="next"
          x-show="value?.length > 1"
          class="absolute right-0 top-1/2 transform -translate-y-1/2 text-6xl"
          :aria-disabled="atEnd"
          :tabindex="atEnd ? -1 : 0"
          :class="{ 'opacity-50 cursor-not-allowed': atEnd }"
        >
          <span aria-hidden="true">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-8 w-8 text-gray-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="3"
            ><path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9 5l7 7-7 7"
              /></svg>
          </span>
          <span class="sr-only">Skip to next slide page</span>
        </button>

        <span id="carousel-content-label" class="sr-only" hidden>Carousel</span>
        <ul
          x-ref="slider"
          tabindex="0"
          role="listbox"
          aria-labelledby="carousel-content-label"
          class="flex w-full snap-x snap-mandatory overflow-x-scroll"
        >
          <template x-for="(image, index) in value" :key="index">
            <li
              x-bind="disableNextAndPreviousButtons"
              class="flex w-full shrink-0 snap-start flex-col items-center justify-center"
              role="option"
              @click="workbench.showExtension('omni-core-filemanager',{focusedObject:image})"
            >

              <img
                class="w-full"
                :src="'/fid/'+(image.fid || image.ticket?.fid) + '?width=256&height=256&fit=contain'"
                x-show="'/fid/'+(image.fid)"
                @error="$event.target.dataset.failedOnce ? console.error('missing error.jpg') : ($event.target.dataset.failedOnce = true, $event.target.src = 'error.jpg')"
              />
              <button x-bind="focusableWhenVisible" class="text-sm"></button>
            </li>
          </template>
        </ul>
      </div>
    </div>
  </div>
</div>`,ic=`<div class="input-control-div text-xs" x-tooltip:reactive="control.description">
  <span
    x-text="title"
    class="input-title"
  ></span>
</div>`,oc=`<div class="input-control-div">
  <div
    class="input-control-label"
    x-tooltip:reactive="tooltip"
  >
    <label
      :for="controlUid"
      x-text="title"
    ></label>
  </div>

  <input
    type="number"
    :id="controlUid"
    :id="controlUid"
    :disabled="opts.readonly"
    :placeholder="opts.placeholder"
    :value="value"
    @input="change($event)"
    @dblclick.stop="$event"
    @pointerdown.stop="$event"
    @pointermove.stop="$event"
    class="w-full text-xs text-right focus:text-center rounded-md border-gray-300 focus:border-primary-400 focus:ring-opacity-50 disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500"
    :class="{
        'ring-red-300 ring-2': required && !hasValue(),
        } "
  />
</div>`,sc=`<div class="input-control-div" 
>
  <div class="input-control-label">
  <label
    :for="controlUid"
    x-text="title" x-tooltip:reactive="tooltip"
  ></label>
  </div>
  <div class="flex flex-grow-0 w-full items-center justify-between">
    <input
      type="range"
      :id="controlUid"
      :disabled="opts.readonly"
      @blur="change($event)"
      @pointerdown.stop="change($event)"
      @pointermove.stop="$event"
      x-model.number="value"
      class="h-2 cursor-pointer appearance-none rounded-full bg-gray-100 flex-shrink-0"
      :min="opts.minimum"
      :max="opts.maximum"
      :step="opts.step"
    />
  <input
    :placeholder="opts.placeholder"
    type="number"
    @blur="change($event)"
    :step="opts.step"
    class="w-16 border text-right text-xs pl-18 rounded-md"
    x-model.number="value"
  />
  </div>
  </div>`,rc=`<div class="input-control-div">
  <label
    :for="controlUid"
    class="sr-only text-xs text-gray-400"
    x-text="title"
  ></label>
</div>
<div class="input-control-div" x-tooltip:reactive="tooltip">
  <input
    type="password"
    x-data="inputUtils"
    :id="controlUid"
    :disabled="opts.readonly"
    :value="value"
    :placeholder="opts.placeholder ?? title"
    @blur="change($event)"
    @dblclick.stop="$event"
    @pointerdown.stop="$event"
    @pointermove.stop="$event"
    @paste.stop="$event"
    class="text-sm bg-white border rounded-md border-neutral-300 w-full ring-offset-background placeholder:text-neutral-500 focus:border-neutral-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-neutral-400 disabled:cursor-not-allowed disabled:opacity-50"
    :class="{
         'ring-red-300 ring-2': required && !hasValue(),
        }"
  />
</div>
`,ac=`<div class="input-control-div" >
  <div
    class="input-control-label"
  >
  <label x-tooltip:reactive="description"
    :for="controlUid"
    class="text-xs select-none pointer-events-none"
    x-text="title"
  ></label>
  </div>
  <div class="input-control-div">
  <input
    class="w-full rounded-md text-xs bg-white border-gray-300 shadow-sm disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500 mr-1"
    :name="controlUid"
    :id="controlUid"
    :disabled="opts.readonly"
    type="text"
    :placeholder="opts.placeholder"
    x-data="{}"
    x-init="tagify($el)"
    x-model="value"
  />
</div>
</div>`,lc=`<div
  class="input-control-div"
  x-tooltip:reactive="tooltip"
>
  <div
    class="input-control-label"
  >
    <label
      :for="controlUid"
      x-text="title"
    ></label>
  </div>
  <select
    :id="controlUid"
    :disabled="opts.readonly"
    x-model="value"
    :placeholder="opts.placeholder"
    @input="change($event)"
    @dblclick.stop="$event"
    @pointerdown.stop="$event"
    @pointermove.stop="$event"
    class="peer flex w-full text-xs text-right rounded-md border-gray-300 shadow-sm disabled:cursor-not-allowed disabled:bg-gray-50 disabled:text-gray-500"
  >
    <template x-for="option, index in (opts.choices)" :key="index">
      <option
        class="text-black"
        :value="option.value"
        x-title="option.title"
        x-text="option.title + (opts.default === option.value ? ' (Default)' : '')"
        :selected="value === option.value.toString()"
      ></option>
    </template>
  </select>
  <div
    class="visible z-50 has-tt wrap cursor-help"
    x-show="selectedChoice()?.description"
  >&nbsp;ⓘ<div
      class="float-right absolute inline-block w-32 text-xs bg-yellow-100 p-1 tt drop-shadow-md"
      text="selectedChoice()?.title + ': ' + selectedChoice()?.description"
    />
  </div>
</div>`,cc=`<div class="input-control-div">
  <label
    :for="controlUid"
    class="sr-only text-xs text-gray-400"
    x-text="title"
  ></label>

</div>
<div class="input-control-div" x-tooltip:reactive="tooltip">
  <textarea
    x-data="inputUtils"
    x-init="textareaAutoResize($el)"
    @input="textareaAutoResize($el)"
    :id="controlUid"
    :disabled="opts.readonly"
    :value="value"
    :placeholder="opts.placeholder || title"
    @blur="change($event)"
    @dblclick.stop="$event"
    @pointerdown.stop="$event"
    @pointermove.stop="$event"
    @paste.stop="$event"
    class="text-sm bg-white border rounded-md border-neutral-300 ring-offset-background placeholder:text-neutral-500 focus:border-neutral-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-neutral-400 disabled:cursor-not-allowed disabled:opacity-50    "
    :class="{
         'ring-red-300 ring-2': required && !hasValue(),
        } "
  />
</div>`,uc=`<div class="text-left max-w-sm">
  <label
    :for="controlUid"
    class="relative inline-flex cursor-pointer items-center align-middle"
  >
   <span
      class=" input-control-label"
      x-text="title"
      x-tooltip:reactive="tooltip"
    ></span>
    <input
      type="checkbox"
      :id="controlUid"
      :checked="value"
      class="peer sr-only"
      :disabled="opts.readonly"
      @change="change"
    />
    <div
      class="relative h-6 w-11 rounded-full bg-gray-300 after:absolute after:top-0.5 after:left-0.5 after:h-5 after:w-5 after:rounded-full after:bg-white after:shadow after:transition-all after:content-[''] hover:bg-gray-300 peer-checked:bg-gray-500 peer-checked:after:translate-x-full peer-checked:after:border-white peer-focus:ring-1 peer-focus:ring-neutral-200 peer-disabled:cursor-not-allowed peer-disabled:bg-gray-100 peer-disabled:after:bg-gray-50"
    ></div>

  </label>
</div>`;var Wo={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(ns,function(){function n(o,a){var u=Object.keys(o);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(o);a&&(h=h.filter(function(v){return Object.getOwnPropertyDescriptor(o,v).enumerable})),u.push.apply(u,h)}return u}function i(o){for(var a=1;a<arguments.length;a++){var u=arguments[a]!=null?arguments[a]:{};a%2?n(Object(u),!0).forEach(function(h){r(o,h,u[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(u)):n(Object(u)).forEach(function(h){Object.defineProperty(o,h,Object.getOwnPropertyDescriptor(u,h))})}return o}function r(o,a,u){return(a=function(h){var v=function(k,T){if(typeof k!="object"||k===null)return k;var S=k[Symbol.toPrimitive];if(S!==void 0){var L=S.call(k,T||"default");if(typeof L!="object")return L;throw new TypeError("@@toPrimitive must return a primitive value.")}return(T==="string"?String:Number)(k)}(h,"string");return typeof v=="symbol"?v:String(v)}(a))in o?Object.defineProperty(o,a,{value:u,enumerable:!0,configurable:!0,writable:!0}):o[a]=u,o}const l=(o,a,u,h)=>(o=""+o,a=""+a,h&&(o=o.trim(),a=a.trim()),u?o==a:o.toLowerCase()==a.toLowerCase()),d=(o,a)=>o&&Array.isArray(o)&&o.map(u=>s(u,a));function s(o,a){var u,h={};for(u in o)a.indexOf(u)<0&&(h[u]=o[u]);return h}function c(o){var a=document.createElement("div");return o.replace(/\&#?[0-9a-z]+;/gi,function(u){return a.innerHTML=u,a.innerText})}function p(o){return new DOMParser().parseFromString(o.trim(),"text/html").body.firstElementChild}function f(o,a){for(a=a||"previous";o=o[a+"Sibling"];)if(o.nodeType==3)return o}function w(o){return typeof o=="string"?o.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/`|'/g,"&#039;"):o}function C(o){var a=Object.prototype.toString.call(o).split(" ")[1].slice(0,-1);return o===Object(o)&&a!="Array"&&a!="Function"&&a!="RegExp"&&a!="HTMLUnknownElement"}function _(o,a,u){function h(v,k){for(var T in k)if(k.hasOwnProperty(T)){if(C(k[T])){C(v[T])?h(v[T],k[T]):v[T]=Object.assign({},k[T]);continue}if(Array.isArray(k[T])){v[T]=Object.assign([],k[T]);continue}v[T]=k[T]}}return o instanceof Object||(o={}),h(o,a),u&&h(o,u),o}function A(){const o=[],a={};for(let u of arguments)for(let h of u)C(h)?a[h.value]||(o.push(h),a[h.value]=1):o.includes(h)||o.push(h);return o}function D(o){return String.prototype.normalize?typeof o=="string"?o.normalize("NFD").replace(/[\u0300-\u036f]/g,""):void 0:o}var N=()=>/(?=.*chrome)(?=.*android)/i.test(navigator.userAgent);function m(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,o=>(o^crypto.getRandomValues(new Uint8Array(1))[0]&15>>o/4).toString(16))}function x(o){return o&&o.classList&&o.classList.contains(this.settings.classNames.tag)}function b(o,a){var u=window.getSelection();return a=a||u.getRangeAt(0),typeof o=="string"&&(o=document.createTextNode(o)),a&&(a.deleteContents(),a.insertNode(o)),o}function g(o,a,u){return o?(a&&(o.__tagifyTagData=u?a:_({},o.__tagifyTagData||{},a)),o.__tagifyTagData):(console.warn("tag element doesn't exist",o,a),a)}function E(o){if(o&&o.parentNode){var a=o,u=window.getSelection(),h=u.getRangeAt(0);u.rangeCount&&(h.setStartAfter(a),h.collapse(!0),u.removeAllRanges(),u.addRange(h))}}function y(o,a){o.forEach(u=>{if(g(u.previousSibling)||!u.previousSibling){var h=document.createTextNode("​");u.before(h),a&&E(h)}})}var O={delimiters:",",pattern:null,tagTextProp:"value",maxTags:1/0,callbacks:{},addTagOnBlur:!0,addTagOn:["blur","tab","enter"],onChangeAfterBlur:!0,duplicates:!1,whitelist:[],blacklist:[],enforceWhitelist:!1,userInput:!0,keepInvalidTags:!1,createInvalidTags:!0,mixTagsAllowedAfter:/,|\.|\:|\s/,mixTagsInterpolator:["[[","]]"],backspace:!0,skipInvalid:!1,pasteAsTags:!0,editTags:{clicks:2,keepInvalid:!0},transformTag:()=>{},trim:!0,a11y:{focusableTags:!1},mixMode:{insertAfterTag:" "},autoComplete:{enabled:!0,rightKey:!1,tabKey:!1},classNames:{namespace:"tagify",mixMode:"tagify--mix",selectMode:"tagify--select",input:"tagify__input",focus:"tagify--focus",tagNoAnimation:"tagify--noAnim",tagInvalid:"tagify--invalid",tagNotAllowed:"tagify--notAllowed",scopeLoading:"tagify--loading",hasMaxTags:"tagify--hasMaxTags",hasNoTags:"tagify--noTags",empty:"tagify--empty",inputInvalid:"tagify__input--invalid",dropdown:"tagify__dropdown",dropdownWrapper:"tagify__dropdown__wrapper",dropdownHeader:"tagify__dropdown__header",dropdownFooter:"tagify__dropdown__footer",dropdownItem:"tagify__dropdown__item",dropdownItemActive:"tagify__dropdown__item--active",dropdownItemHidden:"tagify__dropdown__item--hidden",dropdownInital:"tagify__dropdown--initial",tag:"tagify__tag",tagText:"tagify__tag-text",tagX:"tagify__tag__removeBtn",tagLoading:"tagify__tag--loading",tagEditing:"tagify__tag--editable",tagFlash:"tagify__tag--flash",tagHide:"tagify__tag--hide"},dropdown:{classname:"",enabled:2,maxItems:10,searchKeys:["value","searchBy"],fuzzySearch:!0,caseSensitive:!1,accentedSearch:!0,includeSelectedTags:!1,escapeHTML:!0,highlightFirst:!1,closeOnSelect:!0,clearOnSelect:!0,position:"all",appendTarget:null},hooks:{beforeRemoveTag:()=>Promise.resolve(),beforePaste:()=>Promise.resolve(),suggestionClick:()=>Promise.resolve(),beforeKeyDown:()=>Promise.resolve()}};function I(){this.dropdown={};for(let o in this._dropdown)this.dropdown[o]=typeof this._dropdown[o]=="function"?this._dropdown[o].bind(this):this._dropdown[o];this.dropdown.refs()}var $={refs(){this.DOM.dropdown=this.parseTemplate("dropdown",[this.settings]),this.DOM.dropdown.content=this.DOM.dropdown.querySelector("[data-selector='tagify-suggestions-wrapper']")},getHeaderRef(){return this.DOM.dropdown.querySelector("[data-selector='tagify-suggestions-header']")},getFooterRef(){return this.DOM.dropdown.querySelector("[data-selector='tagify-suggestions-footer']")},getAllSuggestionsRefs(){return[...this.DOM.dropdown.content.querySelectorAll(this.settings.classNames.dropdownItemSelector)]},show(o){var a,u,h,v=this.settings,k=v.mode=="mix"&&!v.enforceWhitelist,T=!v.whitelist||!v.whitelist.length,S=v.dropdown.position=="manual";if(o=o===void 0?this.state.inputText:o,!(T&&!k&&!v.templates.dropdownItemNoMatch||v.dropdown.enable===!1||this.state.isLoading||this.settings.readonly)){if(clearTimeout(this.dropdownHide__bindEventsTimeout),this.suggestedListItems=this.dropdown.filterListItems(o),o&&!this.suggestedListItems.length&&(this.trigger("dropdown:noMatch",o),v.templates.dropdownItemNoMatch&&(h=v.templates.dropdownItemNoMatch.call(this,{value:o}))),!h){if(this.suggestedListItems.length)o&&k&&!this.state.editing.scope&&!l(this.suggestedListItems[0].value,o)&&this.suggestedListItems.unshift({value:o});else{if(!o||!k||this.state.editing.scope)return this.input.autocomplete.suggest.call(this),void this.dropdown.hide();this.suggestedListItems=[{value:o}]}u=""+(C(a=this.suggestedListItems[0])?a.value:a),v.autoComplete&&u&&u.indexOf(o)==0&&this.input.autocomplete.suggest.call(this,a)}this.dropdown.fill(h),v.dropdown.highlightFirst&&this.dropdown.highlightOption(this.DOM.dropdown.content.querySelector(v.classNames.dropdownItemSelector)),this.state.dropdown.visible||setTimeout(this.dropdown.events.binding.bind(this)),this.state.dropdown.visible=o||!0,this.state.dropdown.query=o,this.setStateSelection(),S||setTimeout(()=>{this.dropdown.position(),this.dropdown.render()}),setTimeout(()=>{this.trigger("dropdown:show",this.DOM.dropdown)})}},hide(o){var a=this.DOM,u=a.scope,h=a.dropdown,v=this.settings.dropdown.position=="manual"&&!o;if(h&&document.body.contains(h)&&!v)return window.removeEventListener("resize",this.dropdown.position),this.dropdown.events.binding.call(this,!1),u.setAttribute("aria-expanded",!1),h.parentNode.removeChild(h),setTimeout(()=>{this.state.dropdown.visible=!1},100),this.state.dropdown.query=this.state.ddItemData=this.state.ddItemElm=this.state.selection=null,this.state.tag&&this.state.tag.value.length&&(this.state.flaggedTags[this.state.tag.baseOffset]=this.state.tag),this.trigger("dropdown:hide",h),this},toggle(o){this.dropdown[this.state.dropdown.visible&&!o?"hide":"show"]()},render(){var o,a,u,h=(o=this.DOM.dropdown,(u=o.cloneNode(!0)).style.cssText="position:fixed; top:-9999px; opacity:0",document.body.appendChild(u),a=u.clientHeight,u.parentNode.removeChild(u),a),v=this.settings;return typeof v.dropdown.enabled=="number"&&v.dropdown.enabled>=0?(this.DOM.scope.setAttribute("aria-expanded",!0),document.body.contains(this.DOM.dropdown)||(this.DOM.dropdown.classList.add(v.classNames.dropdownInital),this.dropdown.position(h),v.dropdown.appendTarget.appendChild(this.DOM.dropdown),setTimeout(()=>this.DOM.dropdown.classList.remove(v.classNames.dropdownInital))),this):this},fill(o){o=typeof o=="string"?o:this.dropdown.createListHTML(o||this.suggestedListItems);var a,u=this.settings.templates.dropdownContent.call(this,o);this.DOM.dropdown.content.innerHTML=(a=u)?a.replace(/\>[\r\n ]+\</g,"><").split(/>\s+</).join("><").trim():""},fillHeaderFooter(){var o=this.dropdown.filterListItems(this.state.dropdown.query),a=this.parseTemplate("dropdownHeader",[o]),u=this.parseTemplate("dropdownFooter",[o]),h=this.dropdown.getHeaderRef(),v=this.dropdown.getFooterRef();a&&(h==null||h.parentNode.replaceChild(a,h)),u&&(v==null||v.parentNode.replaceChild(u,v))},refilter(o){o=o||this.state.dropdown.query||"",this.suggestedListItems=this.dropdown.filterListItems(o),this.dropdown.fill(),this.suggestedListItems.length||this.dropdown.hide(),this.trigger("dropdown:updated",this.DOM.dropdown)},position(o){var a=this.settings.dropdown;if(a.position!="manual"){var u,h,v,k,T,S,L,B,V,W=this.DOM.dropdown,Y=a.RTL,q=a.appendTarget===document.body,J=q?window.pageYOffset:a.appendTarget.scrollTop,K=document.fullscreenElement||document.webkitFullscreenElement||document.documentElement,tt=K.clientHeight,ot=Math.max(K.clientWidth||0,window.innerWidth||0)>480?a.position:"all",gt=this.DOM[ot=="input"?"input":"scope"];if(o=o||W.clientHeight,this.state.dropdown.visible){if(ot=="text"?(v=(u=function(){const it=document.getSelection();if(it.rangeCount){const nt=it.getRangeAt(0),st=nt.startContainer,At=nt.startOffset;let Ot,ut;if(At>0)return ut=document.createRange(),ut.setStart(st,At-1),ut.setEnd(st,At),Ot=ut.getBoundingClientRect(),{left:Ot.right,top:Ot.top,bottom:Ot.bottom};if(st.getBoundingClientRect)return st.getBoundingClientRect()}return{left:-9999,top:-9999}}()).bottom,h=u.top,k=u.left,T="auto"):(S=function(it){for(var nt=0,st=0;it&&it!=K;)nt+=it.offsetTop||0,st+=it.offsetLeft||0,it=it.parentNode;return{top:nt,left:st}}(a.appendTarget),h=(u=gt.getBoundingClientRect()).top-S.top,v=u.bottom-1-S.top,k=u.left-S.left,T=u.width+"px"),!q){let it=function(){for(var nt=0,st=a.appendTarget.parentNode;st;)nt+=st.scrollTop||0,st=st.parentNode;return nt}();h+=it,v+=it}h=Math.floor(h),v=Math.ceil(v),B=((L=a.placeAbove??tt-u.bottom<o)?h:v)+J,V=`left: ${k+(Y&&u.width||0)+window.pageXOffset}px;`,W.style.cssText=`${V}; top: ${B}px; min-width: ${T}; max-width: ${T}`,W.setAttribute("placement",L?"top":"bottom"),W.setAttribute("position",ot)}}},events:{binding(){let o=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];var a=this.dropdown.events.callbacks,u=this.listeners.dropdown=this.listeners.dropdown||{position:this.dropdown.position.bind(this,null),onKeyDown:a.onKeyDown.bind(this),onMouseOver:a.onMouseOver.bind(this),onMouseLeave:a.onMouseLeave.bind(this),onClick:a.onClick.bind(this),onScroll:a.onScroll.bind(this)},h=o?"addEventListener":"removeEventListener";this.settings.dropdown.position!="manual"&&(document[h]("scroll",u.position,!0),window[h]("resize",u.position),window[h]("keydown",u.onKeyDown)),this.DOM.dropdown[h]("mouseover",u.onMouseOver),this.DOM.dropdown[h]("mouseleave",u.onMouseLeave),this.DOM.dropdown[h]("mousedown",u.onClick),this.DOM.dropdown.content[h]("scroll",u.onScroll)},callbacks:{onKeyDown(o){if(this.state.hasFocus&&!this.state.composing){var a=this.settings,u=this.DOM.dropdown.querySelector(a.classNames.dropdownItemActiveSelector),h=this.dropdown.getSuggestionDataByNode(u),v=a.mode=="mix";a.hooks.beforeKeyDown(o,{tagify:this}).then(k=>{switch(o.key){case"ArrowDown":case"ArrowUp":case"Down":case"Up":o.preventDefault();var T=this.dropdown.getAllSuggestionsRefs(),S=o.key=="ArrowUp"||o.key=="Up";u&&(u=this.dropdown.getNextOrPrevOption(u,!S)),u&&u.matches(a.classNames.dropdownItemSelector)||(u=T[S?T.length-1:0]),this.dropdown.highlightOption(u,!0);break;case"Escape":case"Esc":this.dropdown.hide();break;case"ArrowRight":if(this.state.actions.ArrowLeft)return;case"Tab":{let B=!a.autoComplete.rightKey||!a.autoComplete.tabKey;if(!v&&u&&B&&!this.state.editing){o.preventDefault();var L=this.dropdown.getMappedValue(h);return this.input.autocomplete.set.call(this,L),!1}return!0}case"Enter":o.preventDefault(),a.hooks.suggestionClick(o,{tagify:this,tagData:h,suggestionElm:u}).then(()=>{if(u)return this.dropdown.selectOption(u),u=this.dropdown.getNextOrPrevOption(u,!S),void this.dropdown.highlightOption(u);this.dropdown.hide(),v||this.addTags(this.state.inputText.trim(),!0)}).catch(B=>B);break;case"Backspace":{if(v||this.state.editing.scope)return;const B=this.input.raw.call(this);B!=""&&B.charCodeAt(0)!=8203||(a.backspace===!0?this.removeTags():a.backspace=="edit"&&setTimeout(this.editTag.bind(this),0))}}})}},onMouseOver(o){var a=o.target.closest(this.settings.classNames.dropdownItemSelector);this.dropdown.highlightOption(a)},onMouseLeave(o){this.dropdown.highlightOption()},onClick(o){if(o.button==0&&o.target!=this.DOM.dropdown&&o.target!=this.DOM.dropdown.content){var a=o.target.closest(this.settings.classNames.dropdownItemSelector),u=this.dropdown.getSuggestionDataByNode(a);this.state.actions.selectOption=!0,setTimeout(()=>this.state.actions.selectOption=!1,50),this.settings.hooks.suggestionClick(o,{tagify:this,tagData:u,suggestionElm:a}).then(()=>{a?this.dropdown.selectOption(a,o):this.dropdown.hide()}).catch(h=>console.warn(h))}},onScroll(o){var a=o.target,u=a.scrollTop/(a.scrollHeight-a.parentNode.clientHeight)*100;this.trigger("dropdown:scroll",{percentage:Math.round(u)})}}},getSuggestionDataByNode(o){var a=o&&o.getAttribute("value");return this.suggestedListItems.find(u=>u.value==a)||null},getNextOrPrevOption(o){let a=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];var u=this.dropdown.getAllSuggestionsRefs(),h=u.findIndex(v=>v===o);return a?u[h+1]:u[h-1]},highlightOption(o,a){var u,h=this.settings.classNames.dropdownItemActive;if(this.state.ddItemElm&&(this.state.ddItemElm.classList.remove(h),this.state.ddItemElm.removeAttribute("aria-selected")),!o)return this.state.ddItemData=null,this.state.ddItemElm=null,void this.input.autocomplete.suggest.call(this);u=this.dropdown.getSuggestionDataByNode(o),this.state.ddItemData=u,this.state.ddItemElm=o,o.classList.add(h),o.setAttribute("aria-selected",!0),a&&(o.parentNode.scrollTop=o.clientHeight+o.offsetTop-o.parentNode.clientHeight),this.settings.autoComplete&&(this.input.autocomplete.suggest.call(this,u),this.dropdown.position())},selectOption(o,a){var u=this.settings,h=u.dropdown,v=h.clearOnSelect,k=h.closeOnSelect;if(!o)return this.addTags(this.state.inputText,!0),void(k&&this.dropdown.hide());a=a||{};var T=o.getAttribute("value"),S=T=="noMatch",L=this.suggestedListItems.find(B=>(B.value??B)==T);if(this.trigger("dropdown:select",{data:L,elm:o,event:a}),T&&(L||S)){if(this.state.editing){let B=this.normalizeTags([L])[0];L=u.transformTag.call(this,B)||B,this.onEditTagDone(null,_({__isValid:!0},L))}else this[u.mode=="mix"?"addMixTags":"addTags"]([L||this.input.raw.call(this)],v);this.DOM.input.parentNode&&(setTimeout(()=>{this.DOM.input.focus(),this.toggleFocusClass(!0)}),k&&setTimeout(this.dropdown.hide.bind(this)),o.addEventListener("transitionend",()=>{this.dropdown.fillHeaderFooter(),setTimeout(()=>o.remove(),100)},{once:!0}),o.classList.add(this.settings.classNames.dropdownItemHidden))}else k&&setTimeout(this.dropdown.hide.bind(this))},selectAll(o){this.suggestedListItems.length=0,this.dropdown.hide(),this.dropdown.filterListItems("");var a=this.dropdown.filterListItems("");return o||(a=this.state.dropdown.suggestions),this.addTags(a,!0),this},filterListItems(o,a){var u,h,v,k,T,S=this.settings,L=S.dropdown,B=(a=a||{},[]),V=[],W=S.whitelist,Y=L.maxItems>=0?L.maxItems:1/0,q=L.searchKeys,J=0;if(!(o=S.mode=="select"&&this.value.length&&this.value[0][S.tagTextProp]==o?"":o)||!q.length)return B=L.includeSelectedTags?W:W.filter(tt=>!this.isTagDuplicate(C(tt)?tt.value:tt)),this.state.dropdown.suggestions=B,B.slice(0,Y);function K(tt,ot){return ot.toLowerCase().split(" ").every(gt=>tt.includes(gt.toLowerCase()))}for(T=L.caseSensitive?""+o:(""+o).toLowerCase();J<W.length;J++){let tt,ot;u=W[J]instanceof Object?W[J]:{value:W[J]};let gt=Object.keys(u).some(it=>q.includes(it))?q:["value"];L.fuzzySearch&&!a.exact?(v=gt.reduce((it,nt)=>it+" "+(u[nt]||""),"").toLowerCase().trim(),L.accentedSearch&&(v=D(v),T=D(T)),tt=v.indexOf(T)==0,ot=v===T,h=K(v,T)):(tt=!0,h=gt.some(it=>{var nt=""+(u[it]||"");return L.accentedSearch&&(nt=D(nt),T=D(T)),L.caseSensitive||(nt=nt.toLowerCase()),ot=nt===T,a.exact?nt===T:nt.indexOf(T)==0})),k=!L.includeSelectedTags&&this.isTagDuplicate(C(u)?u.value:u),h&&!k&&(ot&&tt?V.push(u):L.sortby=="startsWith"&&tt?B.unshift(u):B.push(u))}return this.state.dropdown.suggestions=V.concat(B),typeof L.sortby=="function"?L.sortby(V.concat(B),T):V.concat(B).slice(0,Y)},getMappedValue(o){var a=this.settings.dropdown.mapValueTo;return a?typeof a=="function"?a(o):o[a]||o.value:o.value},createListHTML(o){return _([],o).map((a,u)=>{typeof a!="string"&&typeof a!="number"||(a={value:a});var h=this.dropdown.getMappedValue(a);return h=typeof h=="string"&&this.settings.dropdown.escapeHTML?w(h):h,this.settings.templates.dropdownItem.apply(this,[i(i({},a),{},{mappedValue:h}),this])}).join("")}};const F="@yaireo/tagify/";var j,R={empty:"empty",exceed:"number of tags exceeded",pattern:"pattern mismatch",duplicate:"already exists",notAllowed:"not allowed"},P={wrapper:(o,a)=>`<tags class="${a.classNames.namespace} ${a.mode?`${a.classNames[a.mode+"Mode"]}`:""} ${o.className}"
                    ${a.readonly?"readonly":""}
                    ${a.disabled?"disabled":""}
                    ${a.required?"required":""}
                    ${a.mode==="select"?"spellcheck='false'":""}
                    tabIndex="-1">
            <span ${!a.readonly&&a.userInput?"contenteditable":""} tabIndex="0" data-placeholder="${a.placeholder||"&#8203;"}" aria-placeholder="${a.placeholder||""}"
                class="${a.classNames.input}"
                role="textbox"
                aria-autocomplete="both"
                aria-multiline="${a.mode=="mix"}"></span>
                &#8203;
        </tags>`,tag(o,a){let u=a.settings;return`<tag title="${o.title||o.value}"
                    contenteditable='false'
                    spellcheck='false'
                    tabIndex="${u.a11y.focusableTags?0:-1}"
                    class="${u.classNames.tag} ${o.class||""}"
                    ${this.getAttributes(o)}>
            <x title='' class="${u.classNames.tagX}" role='button' aria-label='remove tag'></x>
            <div>
                <span class="${u.classNames.tagText}">${o[u.tagTextProp]||o.value}</span>
            </div>
        </tag>`},dropdown(o){var a=o.dropdown;return`<div class="${a.position=="manual"?"":o.classNames.dropdown} ${a.classname}" role="listbox" aria-labelledby="dropdown" dir="${a.RTL?"rtl":""}">
                    <div data-selector='tagify-suggestions-wrapper' class="${o.classNames.dropdownWrapper}"></div>
                </div>`},dropdownContent(o){var a=this.settings.templates,u=this.state.dropdown.suggestions;return`
            ${a.dropdownHeader.call(this,u)}
            ${o}
            ${a.dropdownFooter.call(this,u)}
        `},dropdownItem(o){return`<div ${this.getAttributes(o)}
                    class='${this.settings.classNames.dropdownItem} ${o.class||""}'
                    tabindex="0"
                    role="option">${o.mappedValue||o.value}</div>`},dropdownHeader(o){return`<header data-selector='tagify-suggestions-header' class="${this.settings.classNames.dropdownHeader}"></header>`},dropdownFooter(o){var a=o.length-this.settings.dropdown.maxItems;return a>0?`<footer data-selector='tagify-suggestions-footer' class="${this.settings.classNames.dropdownFooter}">
                ${a} more items. Refine your search.
            </footer>`:""},dropdownItemNoMatch:null},U={customBinding(){this.customEventsList.forEach(o=>{this.on(o,this.settings.callbacks[o])})},binding(){let o=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];var a,u=this.events.callbacks,h=o?"addEventListener":"removeEventListener";if(!this.state.mainEvents||!o){for(var v in this.state.mainEvents=o,o&&!this.listeners.main&&(this.events.bindGlobal.call(this),this.settings.isJQueryPlugin&&jQuery(this.DOM.originalInput).on("tagify.removeAllTags",this.removeAllTags.bind(this))),a=this.listeners.main=this.listeners.main||{focus:["input",u.onFocusBlur.bind(this)],keydown:["input",u.onKeydown.bind(this)],click:["scope",u.onClickScope.bind(this)],dblclick:["scope",u.onDoubleClickScope.bind(this)],paste:["input",u.onPaste.bind(this)],drop:["input",u.onDrop.bind(this)],compositionstart:["input",u.onCompositionStart.bind(this)],compositionend:["input",u.onCompositionEnd.bind(this)]})this.DOM[a[v][0]][h](v,a[v][1]);clearInterval(this.listeners.main.originalInputValueObserverInterval),this.listeners.main.originalInputValueObserverInterval=setInterval(u.observeOriginalInputValue.bind(this),500);var k=this.listeners.main.inputMutationObserver||new MutationObserver(u.onInputDOMChange.bind(this));k.disconnect(),this.settings.mode=="mix"&&k.observe(this.DOM.input,{childList:!0})}},bindGlobal(o){var a,u=this.events.callbacks,h=o?"removeEventListener":"addEventListener";if(this.listeners&&(o||!this.listeners.global))for(a of(this.listeners.global=this.listeners.global||[{type:this.isIE?"keydown":"input",target:this.DOM.input,cb:u[this.isIE?"onInputIE":"onInput"].bind(this)},{type:"keydown",target:window,cb:u.onWindowKeyDown.bind(this)},{type:"blur",target:this.DOM.input,cb:u.onFocusBlur.bind(this)},{type:"click",target:document,cb:u.onClickAnywhere.bind(this)}],this.listeners.global))a.target[h](a.type,a.cb)},unbindGlobal(){this.events.bindGlobal.call(this,!0)},callbacks:{onFocusBlur(o){var V,W;var a=this.settings,u=o.target?this.trim(o.target.textContent):"",h=(W=(V=this.value)==null?void 0:V[0])==null?void 0:W[a.tagTextProp],v=o.type,k=a.dropdown.enabled>=0,T={relatedTarget:o.relatedTarget},S=this.state.actions.selectOption&&(k||!a.dropdown.closeOnSelect),L=this.state.actions.addNew&&k,B=o.relatedTarget&&x.call(this,o.relatedTarget)&&this.DOM.scope.contains(o.relatedTarget);if(v=="blur"){if(o.relatedTarget===this.DOM.scope)return this.dropdown.hide(),void this.DOM.input.focus();this.postUpdate(),a.onChangeAfterBlur&&this.triggerChangeEvent()}if(!S&&!L)if(this.state.hasFocus=v=="focus"&&+new Date,this.toggleFocusClass(this.state.hasFocus),a.mode!="mix"){if(v=="focus")return this.trigger("focus",T),void(a.dropdown.enabled!==0&&a.userInput||this.dropdown.show(this.value.length?"":void 0));v=="blur"&&(this.trigger("blur",T),this.loading(!1),a.mode=="select"&&(B&&(this.removeTags(),u=""),h===u&&(u="")),u&&!this.state.actions.selectOption&&a.addTagOnBlur&&a.addTagOn.includes("blur")&&this.addTags(u,!0)),this.DOM.input.removeAttribute("style"),this.dropdown.hide()}else v=="focus"?this.trigger("focus",T):o.type=="blur"&&(this.trigger("blur",T),this.loading(!1),this.dropdown.hide(),this.state.dropdown.visible=void 0,this.setStateSelection())},onCompositionStart(o){this.state.composing=!0},onCompositionEnd(o){this.state.composing=!1},onWindowKeyDown(o){var a,u=document.activeElement,h=x.call(this,u)&&this.DOM.scope.contains(document.activeElement),v=h&&u.hasAttribute("readonly");if(h&&!v)switch(a=u.nextElementSibling,o.key){case"Backspace":this.settings.readonly||(this.removeTags(u),(a||this.DOM.input).focus());break;case"Enter":setTimeout(this.editTag.bind(this),0,u)}},onKeydown(o){var a=this.settings;if(!this.state.composing&&a.userInput){a.mode=="select"&&a.enforceWhitelist&&this.value.length&&o.key!="Tab"&&o.preventDefault();var u=this.trim(o.target.textContent);this.trigger("keydown",{event:o}),a.hooks.beforeKeyDown(o,{tagify:this}).then(h=>{if(a.mode=="mix"){switch(o.key){case"Left":case"ArrowLeft":this.state.actions.ArrowLeft=!0;break;case"Delete":case"Backspace":if(this.state.editing)return;var v=document.getSelection(),k=o.key=="Delete"&&v.anchorOffset==(v.anchorNode.length||0),T=v.anchorNode.previousSibling,S=v.anchorNode.nodeType==1||!v.anchorOffset&&T&&T.nodeType==1&&v.anchorNode.previousSibling;c(this.DOM.input.innerHTML);var L,B,V,W=this.getTagElms(),Y=v.anchorNode.length===1&&v.anchorNode.nodeValue=="​";if(a.backspace=="edit"&&S)return L=v.anchorNode.nodeType==1?null:v.anchorNode.previousElementSibling,setTimeout(this.editTag.bind(this),0,L),void o.preventDefault();if(N()&&S instanceof Element)return V=f(S),S.hasAttribute("readonly")||S.remove(),this.DOM.input.focus(),void setTimeout(()=>{E(V),this.DOM.input.click()});if(v.anchorNode.nodeName=="BR")return;if((k||S)&&v.anchorNode.nodeType==1?B=v.anchorOffset==0?k?W[0]:null:W[Math.min(W.length,v.anchorOffset)-1]:k?B=v.anchorNode.nextElementSibling:S instanceof Element&&(B=S),v.anchorNode.nodeType==3&&!v.anchorNode.nodeValue&&v.anchorNode.previousElementSibling&&o.preventDefault(),(S||k)&&!a.backspace||v.type!="Range"&&!v.anchorOffset&&v.anchorNode==this.DOM.input&&o.key!="Delete")return void o.preventDefault();if(v.type!="Range"&&B&&B.hasAttribute("readonly"))return void E(f(B));o.key=="Delete"&&Y&&g(v.anchorNode.nextSibling)&&this.removeTags(v.anchorNode.nextSibling),clearTimeout(j),j=setTimeout(()=>{var J=document.getSelection();c(this.DOM.input.innerHTML),!k&&J.anchorNode.previousSibling,this.value=[].map.call(W,(K,tt)=>{var ot=g(K);if(K.parentNode||ot.readonly)return ot;this.trigger("remove",{tag:K,index:tt,data:ot})}).filter(K=>K)},20)}return!0}var q=a.dropdown.position=="manual";switch(o.key){case"Backspace":a.mode=="select"&&a.enforceWhitelist&&this.value.length?this.removeTags():this.state.dropdown.visible&&a.dropdown.position!="manual"||o.target.textContent!=""&&u.charCodeAt(0)!=8203||(a.backspace===!0?this.removeTags():a.backspace=="edit"&&setTimeout(this.editTag.bind(this),0));break;case"Esc":case"Escape":if(this.state.dropdown.visible)return;o.target.blur();break;case"Down":case"ArrowDown":this.state.dropdown.visible||this.dropdown.show();break;case"ArrowRight":{let J=this.state.inputSuggestion||this.state.ddItemData;if(J&&a.autoComplete.rightKey)return void this.addTags([J],!0);break}case"Tab":{let J=a.mode=="select";if(!u||J)return!0;o.preventDefault()}case"Enter":if(this.state.dropdown.visible&&!q)return;o.preventDefault(),setTimeout(()=>{this.state.dropdown.visible&&!q||this.state.actions.selectOption||!a.addTagOn.includes(o.key.toLowerCase())||this.addTags(u,!0)})}}).catch(h=>h)}},onInput(o){this.postUpdate();var a=this.settings;if(a.mode=="mix")return this.events.callbacks.onMixTagsInput.call(this,o);var u=this.input.normalize.call(this,void 0,{trim:!1}),h=u.length>=a.dropdown.enabled,v={value:u,inputElm:this.DOM.input},k=this.validateTag({value:u});a.mode=="select"&&this.toggleScopeValidation(k),v.isValid=k,this.state.inputText!=u&&(this.input.set.call(this,u,!1),u.search(a.delimiters)!=-1?this.addTags(u)&&this.input.set.call(this):a.dropdown.enabled>=0&&this.dropdown[h?"show":"hide"](u),this.trigger("input",v))},onMixTagsInput(o){var a,u,h,v,k,T,S,L,B=this.settings,V=this.value.length,W=this.getTagElms(),Y=document.createDocumentFragment(),q=window.getSelection().getRangeAt(0),J=[].map.call(W,K=>g(K).value);if(o.inputType=="deleteContentBackward"&&N()&&this.events.callbacks.onKeydown.call(this,{target:o.target,key:"Backspace"}),y(this.getTagElms()),this.value.slice().forEach(K=>{K.readonly&&!J.includes(K.value)&&Y.appendChild(this.createTagElem(K))}),Y.childNodes.length&&(q.insertNode(Y),this.setRangeAtStartEnd(!1,Y.lastChild)),W.length!=V)return this.value=[].map.call(this.getTagElms(),K=>g(K)),void this.update({withoutChangeEvent:!0});if(this.hasMaxTags())return!0;if(window.getSelection&&(T=window.getSelection()).rangeCount>0&&T.anchorNode.nodeType==3){if((q=T.getRangeAt(0).cloneRange()).collapse(!0),q.setStart(T.focusNode,0),h=(a=q.toString().slice(0,q.endOffset)).split(B.pattern).length-1,(u=a.match(B.pattern))&&(v=a.slice(a.lastIndexOf(u[u.length-1]))),v){if(this.state.actions.ArrowLeft=!1,this.state.tag={prefix:v.match(B.pattern)[0],value:v.replace(B.pattern,"")},this.state.tag.baseOffset=T.baseOffset-this.state.tag.value.length,L=this.state.tag.value.match(B.delimiters))return this.state.tag.value=this.state.tag.value.replace(B.delimiters,""),this.state.tag.delimiters=L[0],this.addTags(this.state.tag.value,B.dropdown.clearOnSelect),void this.dropdown.hide();k=this.state.tag.value.length>=B.dropdown.enabled;try{S=(S=this.state.flaggedTags[this.state.tag.baseOffset]).prefix==this.state.tag.prefix&&S.value[0]==this.state.tag.value[0],this.state.flaggedTags[this.state.tag.baseOffset]&&!this.state.tag.value&&delete this.state.flaggedTags[this.state.tag.baseOffset]}catch{}(S||h<this.state.mixMode.matchedPatternCount)&&(k=!1)}else this.state.flaggedTags={};this.state.mixMode.matchedPatternCount=h}setTimeout(()=>{this.update({withoutChangeEvent:!0}),this.trigger("input",_({},this.state.tag,{textContent:this.DOM.input.textContent})),this.state.tag&&this.dropdown[k?"show":"hide"](this.state.tag.value)},10)},onInputIE(o){var a=this;setTimeout(function(){a.events.callbacks.onInput.call(a,o)})},observeOriginalInputValue(){this.DOM.originalInput.parentNode||this.destroy(),this.DOM.originalInput.value!=this.DOM.originalInput.tagifyValue&&this.loadOriginalValues()},onClickAnywhere(o){o.target==this.DOM.scope||this.DOM.scope.contains(o.target)||(this.toggleFocusClass(!1),this.state.hasFocus=!1)},onClickScope(o){var a=this.settings,u=o.target.closest("."+a.classNames.tag),h=+new Date-this.state.hasFocus;if(o.target!=this.DOM.scope){if(!o.target.classList.contains(a.classNames.tagX))return u?(this.trigger("click",{tag:u,index:this.getNodeIndex(u),data:g(u),event:o}),void(a.editTags!==1&&a.editTags.clicks!==1||this.events.callbacks.onDoubleClickScope.call(this,o))):void(o.target==this.DOM.input&&(a.mode=="mix"&&this.fixFirefoxLastTagNoCaret(),h>500)?this.state.dropdown.visible?this.dropdown.hide():a.dropdown.enabled===0&&a.mode!="mix"&&this.dropdown.show(this.value.length?"":void 0):a.mode!="select"||a.dropdown.enabled!==0||this.state.dropdown.visible||this.dropdown.show());this.removeTags(o.target.parentNode)}else this.DOM.input.focus()},onPaste(o){o.preventDefault();var a,u,h=this.settings;if(h.mode=="select"&&h.enforceWhitelist||!h.userInput)return!1;h.readonly||(a=o.clipboardData||window.clipboardData,u=a.getData("Text"),h.hooks.beforePaste(o,{tagify:this,pastedText:u,clipboardData:a}).then(v=>{v===void 0&&(v=u),v&&(this.injectAtCaret(v,window.getSelection().getRangeAt(0)),this.settings.mode=="mix"?this.events.callbacks.onMixTagsInput.call(this,o):this.settings.pasteAsTags?this.addTags(this.state.inputText+v,!0):(this.state.inputText=v,this.dropdown.show(v)))}).catch(v=>v))},onDrop(o){o.preventDefault()},onEditTagInput(o,a){var u=o.closest("."+this.settings.classNames.tag),h=this.getNodeIndex(u),v=g(u),k=this.input.normalize.call(this,o),T={[this.settings.tagTextProp]:k,__tagId:v.__tagId},S=this.validateTag(T);this.editTagChangeDetected(_(v,T))||o.originalIsValid!==!0||(S=!0),u.classList.toggle(this.settings.classNames.tagInvalid,S!==!0),v.__isValid=S,u.title=S===!0?v.title||v.value:S,k.length>=this.settings.dropdown.enabled&&(this.state.editing&&(this.state.editing.value=k),this.dropdown.show(k)),this.trigger("edit:input",{tag:u,index:h,data:_({},this.value[h],{newValue:k}),event:a})},onEditTagPaste(o,a){var u=(a.clipboardData||window.clipboardData).getData("Text");a.preventDefault();var h=b(u);this.setRangeAtStartEnd(!1,h)},onEditTagFocus(o){this.state.editing={scope:o,input:o.querySelector("[contenteditable]")}},onEditTagBlur(o){if(this.state.editing&&(this.state.hasFocus||this.toggleFocusClass(),this.DOM.scope.contains(o))){var a,u,h=this.settings,v=o.closest("."+h.classNames.tag),k=g(v),T=this.input.normalize.call(this,o),S={[h.tagTextProp]:T,__tagId:k.__tagId},L=k.__originalData,B=this.editTagChangeDetected(_(k,S)),V=this.validateTag(S);if(T)if(B){if(a=this.hasMaxTags(),u=_({},L,{[h.tagTextProp]:this.trim(T),__isValid:V}),h.transformTag.call(this,u,L),(V=(!a||L.__isValid===!0)&&this.validateTag(u))!==!0){if(this.trigger("invalid",{data:u,tag:v,message:V}),h.editTags.keepInvalid)return;h.keepInvalidTags?u.__isValid=V:u=L}else h.keepInvalidTags&&(delete u.title,delete u["aria-invalid"],delete u.class);this.onEditTagDone(v,u)}else this.onEditTagDone(v,L);else this.onEditTagDone(v)}},onEditTagkeydown(o,a){if(!this.state.composing)switch(this.trigger("edit:keydown",{event:o}),o.key){case"Esc":case"Escape":this.state.editing=!1,a.__tagifyTagData.__originalData.value?a.parentNode.replaceChild(a.__tagifyTagData.__originalHTML,a):a.remove();break;case"Enter":case"Tab":o.preventDefault(),o.target.blur()}},onDoubleClickScope(o){var a,u,h=o.target.closest("."+this.settings.classNames.tag),v=g(h),k=this.settings;h&&k.userInput&&v.editable!==!1&&(a=h.classList.contains(this.settings.classNames.tagEditing),u=h.hasAttribute("readonly"),k.mode=="select"||k.readonly||a||u||!this.settings.editTags||this.editTag(h),this.toggleFocusClass(!0),this.trigger("dblclick",{tag:h,index:this.getNodeIndex(h),data:g(h)}))},onInputDOMChange(o){o.forEach(u=>{u.addedNodes.forEach(h=>{var v;if(h.outerHTML=="<div><br></div>")h.replaceWith(document.createElement("br"));else if(h.nodeType==1&&h.querySelector(this.settings.classNames.tagSelector)){let k=document.createTextNode("");h.childNodes[0].nodeType==3&&h.previousSibling.nodeName!="BR"&&(k=document.createTextNode(`
`)),h.replaceWith(k,...[...h.childNodes].slice(0,-1)),E(k)}else if(x.call(this,h))if(((v=h.previousSibling)==null?void 0:v.nodeType)!=3||h.previousSibling.textContent||h.previousSibling.remove(),h.previousSibling&&h.previousSibling.nodeName=="BR"){h.previousSibling.replaceWith(`
​`);let k=h.nextSibling,T="";for(;k;)T+=k.textContent,k=k.nextSibling;T.trim()&&E(h.previousSibling)}else h.previousSibling&&!g(h.previousSibling)||h.before("​")}),u.removedNodes.forEach(h=>{h&&h.nodeName=="BR"&&x.call(this,a)&&(this.removeTags(a),this.fixFirefoxLastTagNoCaret())})});var a=this.DOM.input.lastChild;a&&a.nodeValue==""&&a.remove(),a&&a.nodeName=="BR"||this.DOM.input.appendChild(document.createElement("br"))}}};function G(o,a){if(!o){console.warn("Tagify:","input element not found",o);const h=new Proxy(this,{get:()=>()=>h});return h}if(o.__tagify)return console.warn("Tagify: ","input element is already Tagified - Same instance is returned.",o),o.__tagify;var u;_(this,function(h){var v=document.createTextNode("");function k(T,S,L){L&&S.split(/\s+/g).forEach(B=>v[T+"EventListener"].call(v,B,L))}return{off(T,S){return k("remove",T,S),this},on(T,S){return S&&typeof S=="function"&&k("add",T,S),this},trigger(T,S,L){var B;if(L=L||{cloneData:!0},T)if(h.settings.isJQueryPlugin)T=="remove"&&(T="removeTag"),jQuery(h.DOM.originalInput).triggerHandler(T,[S]);else{try{var V=typeof S=="object"?S:{value:S};if((V=L.cloneData?_({},V):V).tagify=this,S.event&&(V.event=this.cloneEvent(S.event)),S instanceof Object)for(var W in S)S[W]instanceof HTMLElement&&(V[W]=S[W]);B=new CustomEvent(T,{detail:V})}catch(Y){console.warn(Y)}v.dispatchEvent(B)}}}}(this)),this.isFirefox=/firefox|fxios/i.test(navigator.userAgent)&&!/seamonkey/i.test(navigator.userAgent),this.isIE=window.document.documentMode,a=a||{},this.getPersistedData=(u=a.id,h=>{let v,k="/"+h;if(localStorage.getItem(F+u+"/v",1)==1)try{v=JSON.parse(localStorage[F+u+k])}catch{}return v}),this.setPersistedData=(h=>h?(localStorage.setItem(F+h+"/v",1),(v,k)=>{let T="/"+k,S=JSON.stringify(v);v&&k&&(localStorage.setItem(F+h+T,S),dispatchEvent(new Event("storage")))}):()=>{})(a.id),this.clearPersistedData=(h=>v=>{const k=F+"/"+h+"/";if(v)localStorage.removeItem(k+v);else for(let T in localStorage)T.includes(k)&&localStorage.removeItem(T)})(a.id),this.applySettings(o,a),this.state={inputText:"",editing:!1,composing:!1,actions:{},mixMode:{},dropdown:{},flaggedTags:{}},this.value=[],this.listeners={},this.DOM={},this.build(o),I.call(this),this.getCSSVars(),this.loadOriginalValues(),this.events.customBinding.call(this),this.events.binding.call(this),o.autofocus&&this.DOM.input.focus(),o.__tagify=this}return G.prototype={_dropdown:$,placeCaretAfterNode:E,getSetTagData:g,helpers:{sameStr:l,removeCollectionProp:d,omit:s,isObject:C,parseHTML:p,escapeHTML:w,extend:_,concatWithoutDups:A,getUID:m,isNodeTag:x},customEventsList:["change","add","remove","invalid","input","click","keydown","focus","blur","edit:input","edit:beforeUpdate","edit:updated","edit:start","edit:keydown","dropdown:show","dropdown:hide","dropdown:select","dropdown:updated","dropdown:noMatch","dropdown:scroll"],dataProps:["__isValid","__removed","__originalData","__originalHTML","__tagId"],trim(o){return this.settings.trim&&o&&typeof o=="string"?o.trim():o},parseHTML:p,templates:P,parseTemplate(o,a){return p((o=this.settings.templates[o]||o).apply(this,a))},set whitelist(o){const a=o&&Array.isArray(o);this.settings.whitelist=a?o:[],this.setPersistedData(a?o:[],"whitelist")},get whitelist(){return this.settings.whitelist},generateClassSelectors(o){for(let a in o){let u=a;Object.defineProperty(o,u+"Selector",{get(){return"."+this[u].split(" ")[0]}})}},applySettings(o,a){var k,T;O.templates=this.templates;var u=_({},O,a.mode=="mix"?{dropdown:{position:"text"}}:{}),h=this.settings=_({},u,a);if(h.disabled=o.hasAttribute("disabled"),h.readonly=h.readonly||o.hasAttribute("readonly"),h.placeholder=w(o.getAttribute("placeholder")||h.placeholder||""),h.required=o.hasAttribute("required"),this.generateClassSelectors(h.classNames),h.dropdown.includeSelectedTags===void 0&&(h.dropdown.includeSelectedTags=h.duplicates),this.isIE&&(h.autoComplete=!1),["whitelist","blacklist"].forEach(S=>{var L=o.getAttribute("data-"+S);L&&(L=L.split(h.delimiters))instanceof Array&&(h[S]=L)}),"autoComplete"in a&&!C(a.autoComplete)&&(h.autoComplete=O.autoComplete,h.autoComplete.enabled=a.autoComplete),h.mode=="mix"&&(h.pattern=h.pattern||/@/,h.autoComplete.rightKey=!0,h.delimiters=a.delimiters||null,h.tagTextProp&&!h.dropdown.searchKeys.includes(h.tagTextProp)&&h.dropdown.searchKeys.push(h.tagTextProp)),o.pattern)try{h.pattern=new RegExp(o.pattern)}catch{}if(h.delimiters){h._delimiters=h.delimiters;try{h.delimiters=new RegExp(this.settings.delimiters,"g")}catch{}}h.disabled&&(h.userInput=!1),this.TEXTS=i(i({},R),h.texts||{}),(h.mode!="select"||(k=a.dropdown)!=null&&k.enabled)&&h.userInput||(h.dropdown.enabled=0),h.dropdown.appendTarget=((T=a.dropdown)==null?void 0:T.appendTarget)||document.body;let v=this.getPersistedData("whitelist");Array.isArray(v)&&(this.whitelist=Array.isArray(h.whitelist)?A(h.whitelist,v):v)},getAttributes(o){var a,u=this.getCustomAttributes(o),h="";for(a in u)h+=" "+a+(o[a]!==void 0?`="${u[a]}"`:"");return h},getCustomAttributes(o){if(!C(o))return"";var a,u={};for(a in o)a.slice(0,2)!="__"&&a!="class"&&o.hasOwnProperty(a)&&o[a]!==void 0&&(u[a]=w(o[a]));return u},setStateSelection(){var o=window.getSelection(),a={anchorOffset:o.anchorOffset,anchorNode:o.anchorNode,range:o.getRangeAt&&o.rangeCount&&o.getRangeAt(0)};return this.state.selection=a,a},getCSSVars(){var o=getComputedStyle(this.DOM.scope,null),a;this.CSSVars={tagHideTransition:(u=>{let h=u.value;return u.unit=="s"?1e3*h:h})(function(u){if(!u)return{};var h=(u=u.trim().split(" ")[0]).split(/\d+/g).filter(v=>v).pop().trim();return{value:+u.split(h).filter(v=>v)[0].trim(),unit:h}}((a="tag-hide-transition",o.getPropertyValue("--"+a))))}},build(o){var a=this.DOM;this.settings.mixMode.integrated?(a.originalInput=null,a.scope=o,a.input=o):(a.originalInput=o,a.originalInput_tabIndex=o.tabIndex,a.scope=this.parseTemplate("wrapper",[o,this.settings]),a.input=a.scope.querySelector(this.settings.classNames.inputSelector),o.parentNode.insertBefore(a.scope,o),o.tabIndex=-1)},destroy(){this.events.unbindGlobal.call(this),this.DOM.scope.parentNode.removeChild(this.DOM.scope),this.DOM.originalInput.tabIndex=this.DOM.originalInput_tabIndex,delete this.DOM.originalInput.__tagify,this.dropdown.hide(!0),clearTimeout(this.dropdownHide__bindEventsTimeout),clearInterval(this.listeners.main.originalInputValueObserverInterval)},loadOriginalValues(o){var a,u=this.settings;if(this.state.blockChangeEvent=!0,o===void 0){const h=this.getPersistedData("value");o=h&&!this.DOM.originalInput.value?h:u.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value}if(this.removeAllTags(),o)if(u.mode=="mix")this.parseMixTags(o),(a=this.DOM.input.lastChild)&&a.tagName=="BR"||this.DOM.input.insertAdjacentHTML("beforeend","<br>");else{try{JSON.parse(o)instanceof Array&&(o=JSON.parse(o))}catch{}this.addTags(o,!0).forEach(h=>h&&h.classList.add(u.classNames.tagNoAnimation))}else this.postUpdate();this.state.lastOriginalValueReported=u.mixMode.integrated?"":this.DOM.originalInput.value},cloneEvent(o){var a={};for(var u in o)u!="path"&&(a[u]=o[u]);return a},loading(o){return this.state.isLoading=o,this.DOM.scope.classList[o?"add":"remove"](this.settings.classNames.scopeLoading),this},tagLoading(o,a){return o&&o.classList[a?"add":"remove"](this.settings.classNames.tagLoading),this},toggleClass(o,a){typeof o=="string"&&this.DOM.scope.classList.toggle(o,a)},toggleScopeValidation(o){var a=o===!0||o===void 0;!this.settings.required&&o&&o===this.TEXTS.empty&&(a=!0),this.toggleClass(this.settings.classNames.tagInvalid,!a),this.DOM.scope.title=a?"":o},toggleFocusClass(o){this.toggleClass(this.settings.classNames.focus,!!o)},triggerChangeEvent:function(){if(!this.settings.mixMode.integrated){var o=this.DOM.originalInput,a=this.state.lastOriginalValueReported!==o.value,u=new CustomEvent("change",{bubbles:!0});a&&(this.state.lastOriginalValueReported=o.value,u.simulated=!0,o._valueTracker&&o._valueTracker.setValue(Math.random()),o.dispatchEvent(u),this.trigger("change",this.state.lastOriginalValueReported),o.value=this.state.lastOriginalValueReported)}},events:U,fixFirefoxLastTagNoCaret(){},setRangeAtStartEnd(o,a){if(a){o=typeof o=="number"?o:!!o,a=a.lastChild||a;var u=document.getSelection();if(u.focusNode instanceof Element&&!this.DOM.input.contains(u.focusNode))return!0;try{u.rangeCount>=1&&["Start","End"].forEach(h=>u.getRangeAt(0)["set"+h](a,o||a.length))}catch(h){console.warn("Tagify: ",h)}}},insertAfterTag(o,a){if(a=a||this.settings.mixMode.insertAfterTag,o&&o.parentNode&&a)return a=typeof a=="string"?document.createTextNode(a):a,o.parentNode.insertBefore(a,o.nextSibling),a},editTagChangeDetected(o){var a=o.__originalData;for(var u in a)if(!this.dataProps.includes(u)&&o[u]!=a[u])return!0;return!1},getTagTextNode(o){return o.querySelector(this.settings.classNames.tagTextSelector)},setTagTextNode(o,a){this.getTagTextNode(o).innerHTML=w(a)},editTag(o,a){o=o||this.getLastTag(),a=a||{},this.dropdown.hide();var u=this.settings,h=this.getTagTextNode(o),v=this.getNodeIndex(o),k=g(o),T=this.events.callbacks,S=!0;if(h){if(!(k instanceof Object&&"editable"in k)||k.editable)return k=g(o,{__originalData:_({},k),__originalHTML:o.cloneNode(!0)}),g(k.__originalHTML,k.__originalData),h.setAttribute("contenteditable",!0),o.classList.add(u.classNames.tagEditing),h.addEventListener("focus",T.onEditTagFocus.bind(this,o)),h.addEventListener("blur",T.onEditTagBlur.bind(this,this.getTagTextNode(o))),h.addEventListener("input",T.onEditTagInput.bind(this,h)),h.addEventListener("paste",T.onEditTagPaste.bind(this,h)),h.addEventListener("keydown",L=>T.onEditTagkeydown.call(this,L,o)),h.addEventListener("compositionstart",T.onCompositionStart.bind(this)),h.addEventListener("compositionend",T.onCompositionEnd.bind(this)),a.skipValidation||(S=this.editTagToggleValidity(o)),h.originalIsValid=S,this.trigger("edit:start",{tag:o,index:v,data:k,isValid:S}),h.focus(),this.setRangeAtStartEnd(!1,h),this}else console.warn("Cannot find element in Tag template: .",u.classNames.tagTextSelector)},editTagToggleValidity(o,a){var u;if(a=a||g(o))return(u=!("__isValid"in a)||a.__isValid===!0)||this.removeTagsFromValue(o),this.update(),o.classList.toggle(this.settings.classNames.tagNotAllowed,!u),a.__isValid=u,a.__isValid;console.warn("tag has no data: ",o,a)},onEditTagDone(o,a){o=o||this.state.editing.scope,a=a||{};var u,h={tag:o,index:this.getNodeIndex(o),previousData:g(o),data:a},v=this.settings;this.trigger("edit:beforeUpdate",h,{cloneData:!1}),this.state.editing=!1,delete a.__originalData,delete a.__originalHTML,o&&((u=a[v.tagTextProp])?u.trim()&&u:!(v.tagTextProp in a)&&a.value)?(o=this.replaceTag(o,a),this.editTagToggleValidity(o,a),v.a11y.focusableTags?o.focus():E(o)):o&&this.removeTags(o),this.trigger("edit:updated",h),this.dropdown.hide(),this.settings.keepInvalidTags&&this.reCheckInvalidTags()},replaceTag(o,a){a&&a.value||(a=o.__tagifyTagData),a.__isValid&&a.__isValid!=1&&_(a,this.getInvalidTagAttrs(a,a.__isValid));var u=this.createTagElem(a);return o.parentNode.replaceChild(u,o),this.updateValueByDOMTags(),u},updateValueByDOMTags(){this.value.length=0,[].forEach.call(this.getTagElms(),o=>{o.classList.contains(this.settings.classNames.tagNotAllowed.split(" ")[0])||this.value.push(g(o))}),this.update()},injectAtCaret(o,a){var h;if(!(a=a||((h=this.state.selection)==null?void 0:h.range))&&o)return this.appendMixTags(o),this;let u=b(o,a);return this.setRangeAtStartEnd(!1,u),this.updateValueByDOMTags(),this.update(),this},input:{set(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",a=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];var u=this.settings.dropdown.closeOnSelect;this.state.inputText=o,a&&(this.DOM.input.innerHTML=w(""+o)),!o&&u&&this.dropdown.hide.bind(this),this.input.autocomplete.suggest.call(this),this.input.validate.call(this)},raw(){return this.DOM.input.textContent},validate(){var o=!this.state.inputText||this.validateTag({value:this.state.inputText})===!0;return this.DOM.input.classList.toggle(this.settings.classNames.inputInvalid,!o),o},normalize(o,a){var u=o||this.DOM.input,h=[];u.childNodes.forEach(v=>v.nodeType==3&&h.push(v.nodeValue)),h=h.join(`
`);try{h=h.replace(/(?:\r\n|\r|\n)/g,this.settings.delimiters.source.charAt(0))}catch{}return h=h.replace(/\s/g," "),a!=null&&a.trim?this.trim(h):h},autocomplete:{suggest(o){if(this.settings.autoComplete.enabled){typeof(o=o||{value:""})=="string"&&(o={value:o});var a=this.dropdown.getMappedValue(o);if(typeof a!="number"){var u=a.substr(0,this.state.inputText.length).toLowerCase(),h=a.substring(this.state.inputText.length);a&&this.state.inputText&&u==this.state.inputText.toLowerCase()?(this.DOM.input.setAttribute("data-suggest",h),this.state.inputSuggestion=o):(this.DOM.input.removeAttribute("data-suggest"),delete this.state.inputSuggestion)}}},set(o){var a=this.DOM.input.getAttribute("data-suggest"),u=o||(a?this.state.inputText+a:null);return!!u&&(this.settings.mode=="mix"?this.replaceTextWithNode(document.createTextNode(this.state.tag.prefix+u)):(this.input.set.call(this,u),this.setRangeAtStartEnd(!1,this.DOM.input)),this.input.autocomplete.suggest.call(this),this.dropdown.hide(),!0)}}},getTagIdx(o){return this.value.findIndex(a=>a.__tagId==(o||{}).__tagId)},getNodeIndex(o){var a=0;if(o)for(;o=o.previousElementSibling;)a++;return a},getTagElms(){for(var o=arguments.length,a=new Array(o),u=0;u<o;u++)a[u]=arguments[u];var h="."+[...this.settings.classNames.tag.split(" "),...a].join(".");return[].slice.call(this.DOM.scope.querySelectorAll(h))},getLastTag(){var o=this.DOM.scope.querySelectorAll(`${this.settings.classNames.tagSelector}:not(.${this.settings.classNames.tagHide}):not([readonly])`);return o[o.length-1]},isTagDuplicate(o,a,u){var h=0;if(this.settings.mode=="select")return!1;for(let v of this.value)l(this.trim(""+o),v.value,a)&&u!=v.__tagId&&h++;return h},getTagIndexByValue(o){var a=[],u=this.settings.dropdown.caseSensitive;return this.getTagElms().forEach((h,v)=>{h.__tagifyTagData&&l(this.trim(h.__tagifyTagData.value),o,u)&&a.push(v)}),a},getTagElmByValue(o){var a=this.getTagIndexByValue(o)[0];return this.getTagElms()[a]},flashTag(o){o&&(o.classList.add(this.settings.classNames.tagFlash),setTimeout(()=>{o.classList.remove(this.settings.classNames.tagFlash)},100))},isTagBlacklisted(o){return o=this.trim(o.toLowerCase()),this.settings.blacklist.filter(a=>(""+a).toLowerCase()==o).length},isTagWhitelisted(o){return!!this.getWhitelistItem(o)},getWhitelistItem(o,a,u){a=a||"value";var h,v=this.settings;return(u=u||v.whitelist).some(k=>{var T=typeof k=="string"?k:k[a]||k.value;if(l(T,o,v.dropdown.caseSensitive,v.trim))return h=typeof k=="string"?{value:k}:k,!0}),h||a!="value"||v.tagTextProp=="value"||(h=this.getWhitelistItem(o,v.tagTextProp,u)),h},validateTag(o){var a=this.settings,u="value"in o?"value":a.tagTextProp,h=this.trim(o[u]+"");return(o[u]+"").trim()?a.mode!="mix"&&a.pattern&&a.pattern instanceof RegExp&&!a.pattern.test(h)?this.TEXTS.pattern:!a.duplicates&&this.isTagDuplicate(h,a.dropdown.caseSensitive,o.__tagId)?this.TEXTS.duplicate:this.isTagBlacklisted(h)||a.enforceWhitelist&&!this.isTagWhitelisted(h)?this.TEXTS.notAllowed:!a.validate||a.validate(o):this.TEXTS.empty},getInvalidTagAttrs(o,a){return{"aria-invalid":!0,class:`${o.class||""} ${this.settings.classNames.tagNotAllowed}`.trim(),title:a}},hasMaxTags(){return this.value.length>=this.settings.maxTags&&this.TEXTS.exceed},setReadonly(o,a){var u=this.settings;document.activeElement.blur(),u[a||"readonly"]=o,this.DOM.scope[(o?"set":"remove")+"Attribute"](a||"readonly",!0),this.settings.userInput=!0,this.setContentEditable(!o)},setContentEditable(o){this.settings.userInput&&(this.DOM.input.contentEditable=o,this.DOM.input.tabIndex=o?0:-1)},setDisabled(o){this.setReadonly(o,"disabled")},normalizeTags(o){var a=this.settings,u=a.whitelist,h=a.delimiters,v=a.mode,k=a.tagTextProp,T=[],S=!!u&&u[0]instanceof Object,L=Array.isArray(o),B=L&&o[0].value,V=W=>(W+"").split(h).filter(Y=>Y).map(Y=>({[k]:this.trim(Y),value:this.trim(Y)}));if(typeof o=="number"&&(o=o.toString()),typeof o=="string"){if(!o.trim())return[];o=V(o)}else L&&(o=[].concat(...o.map(W=>W.value!=null?W:V(W))));return S&&!B&&(o.forEach(W=>{var Y=T.map(K=>K.value),q=this.dropdown.filterListItems.call(this,W[k],{exact:!0});this.settings.duplicates||(q=q.filter(K=>!Y.includes(K.value)));var J=q.length>1?this.getWhitelistItem(W[k],k,q):q[0];J&&J instanceof Object?T.push(J):v!="mix"&&(W.value==null&&(W.value=W[k]),T.push(W))}),T.length&&(o=T)),o},parseMixTags(o){var a=this.settings,u=a.mixTagsInterpolator,h=a.duplicates,v=a.transformTag,k=a.enforceWhitelist,T=a.maxTags,S=a.tagTextProp,L=[];o=o.split(u[0]).map((V,W)=>{var Y,q,J,K=V.split(u[1]),tt=K[0],ot=L.length==T;try{if(tt==+tt)throw Error;q=JSON.parse(tt)}catch{q=this.normalizeTags(tt)[0]||{value:tt}}if(v.call(this,q),ot||!(K.length>1)||k&&!this.isTagWhitelisted(q.value)||!h&&this.isTagDuplicate(q.value)){if(V)return W?u[0]+V:V}else q[Y=q[S]?S:"value"]=this.trim(q[Y]),J=this.createTagElem(q),L.push(q),J.classList.add(this.settings.classNames.tagNoAnimation),K[0]=J.outerHTML,this.value.push(q);return K.join("")}).join(""),this.DOM.input.innerHTML=o,this.DOM.input.appendChild(document.createTextNode("")),this.DOM.input.normalize();var B=this.getTagElms();return B.forEach((V,W)=>g(V,L[W])),this.update({withoutChangeEvent:!0}),y(B,this.state.hasFocus),o},replaceTextWithNode(o,a){if(this.state.tag||a){a=a||this.state.tag.prefix+this.state.tag.value;var u,h,v=this.state.selection||window.getSelection(),k=v.anchorNode,T=this.state.tag.delimiters?this.state.tag.delimiters.length:0;return k.splitText(v.anchorOffset-T),(u=k.nodeValue.lastIndexOf(a))==-1||(h=k.splitText(u),o&&k.parentNode.replaceChild(o,h)),!0}},selectTag(o,a){var u=this.settings;if(!u.enforceWhitelist||this.isTagWhitelisted(a.value)){this.input.set.call(this,a[u.tagTextProp]||a.value,!0),this.state.actions.selectOption&&setTimeout(()=>this.setRangeAtStartEnd(!1,this.DOM.input));var h=this.getLastTag();return h?this.replaceTag(h,a):this.appendTag(o),this.value[0]=a,this.update(),this.trigger("add",{tag:o,data:a}),[o]}},addEmptyTag(o){var a=_({value:""},o||{}),u=this.createTagElem(a);g(u,a),this.appendTag(u),this.editTag(u,{skipValidation:!0})},addTags(o,a,u){var h=[],v=this.settings,k=[],T=document.createDocumentFragment();if(u=u||v.skipInvalid,!o||o.length==0)return h;switch(o=this.normalizeTags(o),v.mode){case"mix":return this.addMixTags(o);case"select":a=!1,this.removeAllTags()}return this.DOM.input.removeAttribute("style"),o.forEach(S=>{var L,B={},V=Object.assign({},S,{value:S.value+""});if(S=Object.assign({},V),v.transformTag.call(this,S),S.__isValid=this.hasMaxTags()||this.validateTag(S),S.__isValid!==!0){if(u)return;if(_(B,this.getInvalidTagAttrs(S,S.__isValid),{__preInvalidData:V}),S.__isValid==this.TEXTS.duplicate&&this.flashTag(this.getTagElmByValue(S.value)),!v.createInvalidTags)return void k.push(S.value)}if("readonly"in S&&(S.readonly?B["aria-readonly"]=!0:delete S.readonly),L=this.createTagElem(S,B),h.push(L),v.mode=="select")return this.selectTag(L,S);T.appendChild(L),S.__isValid&&S.__isValid===!0?(this.value.push(S),this.trigger("add",{tag:L,index:this.value.length-1,data:S})):(this.trigger("invalid",{data:S,index:this.value.length,tag:L,message:S.__isValid}),v.keepInvalidTags||setTimeout(()=>this.removeTags(L,!0),1e3)),this.dropdown.position()}),this.appendTag(T),this.update(),o.length&&a&&(this.input.set.call(this,v.createInvalidTags?"":k.join(v._delimiters)),this.setRangeAtStartEnd(!1,this.DOM.input)),v.dropdown.enabled&&this.dropdown.refilter(),h},addMixTags(o){if((o=this.normalizeTags(o))[0].prefix||this.state.tag)return this.prefixedTextToTag(o[0]);var a=document.createDocumentFragment();return o.forEach(u=>{var h=this.createTagElem(u);a.appendChild(h)}),this.appendMixTags(a),a},appendMixTags(o){var a=!!this.state.selection;a?this.injectAtCaret(o):(this.DOM.input.focus(),(a=this.setStateSelection()).range.setStart(this.DOM.input,a.range.endOffset),a.range.setEnd(this.DOM.input,a.range.endOffset),this.DOM.input.appendChild(o),this.updateValueByDOMTags(),this.update())},prefixedTextToTag(o){var a,u=this.settings,h=this.state.tag.delimiters;if(u.transformTag.call(this,o),o.prefix=o.prefix||this.state.tag?this.state.tag.prefix:(u.pattern.source||u.pattern)[0],a=this.createTagElem(o),this.replaceTextWithNode(a)||this.DOM.input.appendChild(a),setTimeout(()=>a.classList.add(this.settings.classNames.tagNoAnimation),300),this.value.push(o),this.update(),!h){var v=this.insertAfterTag(a)||a;setTimeout(E,0,v)}return this.state.tag=null,this.trigger("add",_({},{tag:a},{data:o})),a},appendTag(o){var a=this.DOM,u=a.input;a.scope.insertBefore(o,u)},createTagElem(o,a){o.__tagId=m();var u,h=_({},o,i({value:w(o.value+"")},a));return function(v){for(var k,T=document.createNodeIterator(v,NodeFilter.SHOW_TEXT,null,!1);k=T.nextNode();)k.textContent.trim()||k.parentNode.removeChild(k)}(u=this.parseTemplate("tag",[h,this])),g(u,o),u},reCheckInvalidTags(){var o=this.settings;this.getTagElms(o.classNames.tagNotAllowed).forEach((a,u)=>{var h=g(a),v=this.hasMaxTags(),k=this.validateTag(h),T=k===!0&&!v;if(o.mode=="select"&&this.toggleScopeValidation(k),T)return h=h.__preInvalidData?h.__preInvalidData:{value:h.value},this.replaceTag(a,h);a.title=v||k})},removeTags(o,a,u){var h,v=this.settings;if(o=o&&o instanceof HTMLElement?[o]:o instanceof Array?o:o?[o]:[this.getLastTag()],h=o.reduce((k,T)=>{T&&typeof T=="string"&&(T=this.getTagElmByValue(T));var S=g(T);return T&&S&&!S.readonly&&k.push({node:T,idx:this.getTagIdx(S),data:g(T,{__removed:!0})}),k},[]),u=typeof u=="number"?u:this.CSSVars.tagHideTransition,v.mode=="select"&&(u=0,this.input.set.call(this)),h.length==1&&v.mode!="select"&&h[0].node.classList.contains(v.classNames.tagNotAllowed)&&(a=!0),h.length)return v.hooks.beforeRemoveTag(h,{tagify:this}).then(()=>{function k(T){T.node.parentNode&&(T.node.parentNode.removeChild(T.node),a?v.keepInvalidTags&&this.trigger("remove",{tag:T.node,index:T.idx}):(this.trigger("remove",{tag:T.node,index:T.idx,data:T.data}),this.dropdown.refilter(),this.dropdown.position(),this.DOM.input.normalize(),v.keepInvalidTags&&this.reCheckInvalidTags()))}u&&u>10&&h.length==1?(function(T){T.node.style.width=parseFloat(window.getComputedStyle(T.node).width)+"px",document.body.clientTop,T.node.classList.add(v.classNames.tagHide),setTimeout(k.bind(this),u,T)}).call(this,h[0]):h.forEach(k.bind(this)),a||(this.removeTagsFromValue(h.map(T=>T.node)),this.update(),v.mode=="select"&&this.setContentEditable(!0))}).catch(k=>{})},removeTagsFromDOM(){[].slice.call(this.getTagElms()).forEach(o=>o.parentNode.removeChild(o))},removeTagsFromValue(o){(o=Array.isArray(o)?o:[o]).forEach(a=>{var u=g(a),h=this.getTagIdx(u);h>-1&&this.value.splice(h,1)})},removeAllTags(o){o=o||{},this.value=[],this.settings.mode=="mix"?this.DOM.input.innerHTML="":this.removeTagsFromDOM(),this.dropdown.refilter(),this.dropdown.position(),this.state.dropdown.visible&&setTimeout(()=>{this.DOM.input.focus()}),this.settings.mode=="select"&&(this.input.set.call(this),this.setContentEditable(!0)),this.update(o)},postUpdate(){var h,v;this.state.blockChangeEvent=!1;var o=this.settings,a=o.classNames,u=o.mode=="mix"?o.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value.trim():this.value.length+this.input.raw.call(this).length;this.toggleClass(a.hasMaxTags,this.value.length>=o.maxTags),this.toggleClass(a.hasNoTags,!this.value.length),this.toggleClass(a.empty,!u),o.mode=="select"&&this.toggleScopeValidation((v=(h=this.value)==null?void 0:h[0])==null?void 0:v.__isValid)},setOriginalInputValue(o){var a=this.DOM.originalInput;this.settings.mixMode.integrated||(a.value=o,a.tagifyValue=a.value,this.setPersistedData(o,"value"))},update(o){clearTimeout(this.debouncedUpdateTimeout),this.debouncedUpdateTimeout=setTimeout((function(){var a=this.getInputValue();this.setOriginalInputValue(a),this.settings.onChangeAfterBlur&&(o||{}).withoutChangeEvent||this.state.blockChangeEvent||this.triggerChangeEvent(),this.postUpdate()}).bind(this),100)},getInputValue(){var o=this.getCleanValue();return this.settings.mode=="mix"?this.getMixedTagsAsString(o):o.length?this.settings.originalInputValueFormat?this.settings.originalInputValueFormat(o):JSON.stringify(o):""},getCleanValue(o){return d(o||this.value,this.dataProps)},getMixedTagsAsString(){var o="",a=this,u=this.settings,h=u.originalInputValueFormat||JSON.stringify,v=u.mixTagsInterpolator;return function k(T){T.childNodes.forEach(S=>{if(S.nodeType==1){const L=g(S);if(S.tagName=="BR"&&(o+=`\r
`),L&&x.call(a,S)){if(L.__removed)return;o+=v[0]+h(s(L,a.dataProps))+v[1]}else S.getAttribute("style")||["B","I","U"].includes(S.tagName)?o+=S.textContent:S.tagName!="DIV"&&S.tagName!="P"||(o+=`\r
`,k(S))}else o+=S.textContent})}(this.DOM.input),o}},G.prototype.removeTag=G.prototype.removeTags,G})})(Wo);var dc=Wo.exports;const hc=is(dc),pc=Object.assign({"./BoolControl.hbs":Gl,"./ButtonControl.hbs":Zl,"./CodeMirrorControl.hbs":Ql,"./ColorControl.hbs":tc,"./DynamicInputControl.hbs":ec,"./ImageGalleryControl.hbs":nc,"./LabelControl.hbs":ic,"./NumControl.hbs":oc,"./NumWithSliderControl.hbs":sc,"./PasswordControl.hbs":rc,"./Select2TagControl.hbs":ac,"./SelectControl.hbs":lc,"./TextControl.hbs":cc,"./ToggleControl.hbs":uc});function pt(t,e,n,i){return{value:t,previousValue:t,key:"",title:"",opts:{readonly:!1,placeholder:t,default:t,choices:["(default)"]},control:null,error:null,controlUid:"",required:!1,tooltip:"",change(r){let l=r.target.value;if(typeof this.value=="number"&&(l=+r.target.value,console.log("changeNumber",Date.now(),r,l)),i&&this.value!=null)try{l=i(l)}catch(d){this.error="Error: "+d.message,console.warn("Formatter failed to parse value",l,this.value);return}this.error=null,this.value=l},updateConstraints(){this.value==="(Default)"&&(this.value=this.opts.default??t),typeof t=="number"&&(this.opts.minimum!==void 0&&this.value<this.opts.minimum&&(this.value=this.opts.minimum),this.opts.maximum!==void 0&&this.value>this.opts.maximum&&(this.value=this.opts.maximum)),typeof t=="string"&&(this.value=typeof this.value=="string"?this.value.trim():"")},update(){this.updateConstraints(),this.key&&(this.control.putData(this.key,this.value),this.previousValue!==this.value&&(this.previousValue=this.value,this.emitter.trigger("nodeupdated",this)))},async getInputTemplate(){const r=pc[n];return r===void 0?n:r},hasValue(){var r;return this.value!==null&&this.value!==void 0&&this.value!==""&&((r=this.value)==null?void 0:r.length)!==0},custom(r){return this.control.custom(r)},init(){var r;this.control=e,this.required=this.control.required,this.key=this.control.key,this.title=this.control.title,this.description=this.control.description??this.control.summary,this.tooltip=this.title!==this.description?(this.title??"")+": "+(this.description??""):this.title??"",this.controlUid=this.key+Date.now(),this.opts=this.control.opts,this.opts.readonly=this.control.opts.readonly||!client.workbench.canEdit,this.value=this.control.getData(this.key)??this.control.opts.default??t,this.previousValue=this.value,this.emitter=this.control.emitter,this.error=null,(r=this._customInit)==null||r.call(this),this.update()}}}const fc=t=>({...pt(t.opts.default==="inf"?1/0:t.opts.default,t,"./NumControl.hbs",parseFloat)}),gc=t=>({...pt(t.opts.default||"",t,"./TextControl.hbs")}),vc=t=>({...pt(t.opts.default||"",t,"./PasswordControl.hbs")}),mc=t=>({...pt(t.opts.default||"",t,"./ButtonControl.hbs"),runButtonAction(e,n){this.custom("buttonAction")==="script"?window.client.runScript(e,n):alert("Button action "+this.custom("buttonAction")+"not implemented")}}),wc=t=>({...pt("",t,"./ColorControl.hbs")}),yc=t=>({_customInit(){this.choices??(this.choices=[])},...pt("",t,"./SelectControl.hbs"),selectedChoice(){var e,n;return this.choices?(n=(e=this.choices).find)==null?void 0:n.call(e,i=>i.toString()===this.value.toString()):{value:this.default,title:"(default)",description:null}}}),bc=t=>({...pt([],t,"./Select2TagControl.hbs"),tagify(e){e.value=this.value,new hc(e,{callbacks:{add:n=>{this.updateTag(n)},remove:n=>{this.updateTag(n)}}})},updateTag(e){const n=e.detail.tagify.value.map(i=>i.value[0]==="#"?i.value:"#"+i.value);this.value=n,console.log("updateTag",n,this.value)}}),xc=t=>pt(!1,t,"./BoolControl.hbs",e=>!!e),_c=t=>({...pt(!1,t,"./ToggleControl.hbs"),change(e){this.value=e.target.checked}}),Tc=t=>({...pt(0,t,"./NumWithSliderControl.hbs",parseFloat)}),kc=t=>pt("",t,"./LabelControl.hbs"),Cc=t=>({...pt(null,t,"./CodeMirrorControl.hbs",e=>{if(e!=null){let n;return typeof e=="string"?n=JSON.parse(e):typeof e=="object"?n=window.Alpine.raw(e):n=null,n}})}),Ec=t=>({doChange(e){const n=this,i=n.control.parent.id;this.change(e),window.Alpine.nextTick(()=>{n.emitter.trigger("node_dynamic_update",{nodeId:i,key:n.key,value:n.value})})},...pt(null,t,"./DynamicInputControl.hbs",e=>{if(e!=null){let n;return typeof e=="string"?n=JSON.parse(e):typeof e=="object"?n=window.Alpine.raw(e):n=null,n}})}),Oc=t=>({...pt([],t,"./ImageGalleryControl.hbs"),hasValidImage(){},update(){this.key&&(this.value=this.control.getData(this.key))}}),Sc=Object.freeze(Object.defineProperty({__proto__:null,AlpineBoolComponent:xc,AlpineButtonComponent:mc,AlpineCodeMirrorComponent:Cc,AlpineColorComponent:wc,AlpineDynamicInputComponent:Ec,AlpineImageGalleryComponent:Oc,AlpineLabelComponent:kc,AlpineNumComponent:fc,AlpineNumWithSliderComponent:Tc,AlpinePasswordComponent:vc,AlpineSelect2TagComponent:bc,AlpineSelectComponent:yc,AlpineTextComponent:gc,AlpineToggleComponent:_c},Symbol.toStringTag,{value:"Module"})),Ac=`<div class="flex">
  <div class="flex flex-col h-full bg-opacity-0 border-0" >
    <div class="rete-block">
    <div class='block-header flex flex-row h-8 p-2 ' :class="
      {
        '!bg-blue-500 animate-pulse progress-bar': node.active,
          'blur-xs': !node.data.xOmniEnabled
      }
      ">
      <!-- Copy button -->
      <div class="relative z-20 flex items-center" x-tooltip='Copy' x-show='client.workbench.canEdit'>
        <div x-show="copyNotification" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 translate-x-2" x-transition:enter-end="opacity-100 translate-x-0" x-transition:leave="transition ease-in duration-300" x-transition:leave-start="opacity-100 translate-x-0" x-transition:leave-end="opacity-0 translate-x-2" class="absolute left-0" x-cloak>
        <div class="px-3 h-7 -ml-1.5 items-center flex text-xs bg-black border-r border-black -translate-x-full text-white rounded">
            <span>Copied!</span>
            <div class="absolute right-0 inline-block h-full -mt-px overflow-hidden translate-x-3 -translate-y-2 top-1/2">
                <div class="w-3 h-3 origin-top-left transform rotate-45 bg-black border border-transparent"></div>
            </div>
        </div>
    </div>
    <button @click.stop="onClickCopy(node);" class="flex items-center justify-center w-5 h-5 py-1 text-xs rounded-md cursor-pointer focus:outline-none hover:animate-pulse group">
        <svg x-show="!copyNotification" class="w-5 h-5 stroke-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="white" class="w-5 h-5"><path stroke="white"  stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" /></svg>
        <svg x-show="copyNotification" class="pl-2 w-5 h-5 stroke-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="white" x-cloak><path stroke="white"  stroke-linecap="round" stroke-linejoin="round" d="M11.35 3.836c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m8.9-4.414c.376.023.75.05 1.124.08 1.131.094 1.976 1.057 1.976 2.192V16.5A2.25 2.25 0 0118 18.75h-2.25m-7.5-10.5H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V18.75m-7.5-10.5h6.375c.621 0 1.125.504 1.125 1.125v9.375m-8.25-3l1.5 1.5 3-3.75" /></svg>
    </button>

</div>
      <div class='block-title flex-grow p-1 mx-1' x-text='getTitle()' x-tooltip="Right-Click to rename" @contextmenu.stop.prevent='if (await rename()){workbench.activeRecipe.setDirty()}'></div>
      <!-- close button -->
      <button class='pr-2 text-lg cursor-pointer text-white hover:stroke-red-500 stroke-white' x-tooltip="Restore Defaults Values" @click.stop.prevent='window.confirm("Restore Block default values?") ? (node.data = { xOmniEnabled: true}) && node.update() : null ;'>
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"  stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash">
          <polyline xmlns="http://www.w3.org/2000/svg" points="23 4 23 10 17 10"/><polyline xmlns="http://www.w3.org/2000/svg" points="1 20 1 14 7 14"/><path xmlns="http://www.w3.org/2000/svg" d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
          </button>
      <div x-show='workbench.canEdit' class='hover:animate-pulse  ' @click.stop.prevent='onClickClose(node);' x-tooltip='Remove'>
        <svg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='1.5' stroke='currentColor' class='h-5 w-5'>
          <path stroke='#ffffff' stroke-linecap='round' stroke-linejoin='round' d='M6 18L18 6M6 6l12 12' />
        </svg>
      </div>

    </div>
    <div id='block-content'
    class='relative flex items-center justify-center w-full h-full text-xs text-gray-400 content '>
      <div class='block_content' :class='classNameString' :title='node.title'>
        <div :class="
        {
          'blur-xs grayscale': !node.data.xOmniEnabled
        }">

          <!-- Inputs -->
          <template x-for='(input, index) in (inputs(node)||[])' :key='input.name'>
            <div class='input' x-show='client.workbench.canEdit || input?.connections?.length' x-id="['input-socket']">
              <div x-socket:input='input' :id="$id('input-socket')" class='socket input relative' type='input' :title='input.socket.name'></div>
              <div x-show='!input.showControl()' class='input-title' x-text='input.name.charAt(0).toUpperCase() + input.name.slice(1)  ' :for="$id('input-socket')"></div>
              <div x-show='input.showControl()' class='input-control' :for="$id('input-socket')" type='input.control.controlType' :value='value' x-control='input.control' x-data='input.control.component(input.control)' x-html='getInputTemplate()' x-effect="$watch('value', (value) => update())"></div>
            </div>
          </template>
          <template x-for='(control, index) in controls(node)'>
            <div class='control' :key='index' :value='value' x-control='control' x-data='control.component(control)' x-html='getInputTemplate()' x-effect="$watch('value', (value) => update())"></div>
          </template>
          <!-- Outputs -->
          <template x-for='(output) in (outputs(node)||[])'>
            <div class='output' x-show='client.workbench.canEdit || output.connections?.length' :key='output.name' x-id="['output-socket']">
              <div class='output-title' x-text='output.name.charAt(0).toUpperCase() + output.name.slice(1)' :for="$id('output-socket')"></div>
              <div x-socket:output='output' :id="$id('output-socket')" class='socket output' type='output.control.controlType' :title='output.socket.name'></div>
            </div>
          </template>
        </div>
        <div class="flex-grow"></div>
        <div class='block-footer'>
          <div x-show="!client.workbench.readOnly" x-id="['node.data.xOmniEnabled']" class="flex justify-center" x-tooltip="Enable/Disable" @change="client.workbench.activeRecipe.setDirty()">
            <label :for="$id('node.data.xOmniEnabled')" class="relative h-6 w-10 cursor-pointer">
              <input x-model="node.data.xOmniEnabled" type="checkbox" :id="$id('node.data.xOmniEnabled')" class="peer sr-only" />
              <span :class="{ 'bg-gray-400': !node.data.xOmniEnabled, 'bg-gray-400': node.data.xOmniEnabled }" class="absolute inset-0 rounded-full transition"></span>
              <span :class="{ 'text-red-600 start-0': !node.data.xOmniEnabled, 'start-4 text-green-600': node.data.xOmniEnabled }" class="absolute inset-y-0 m-1 inline-flex h-4 w-4 items-center justify-center rounded-full bg-white transition-all">
                <svg xmlns="http://www.w3.org/2000/svg" x-show="!node.data.xOmniEnabled" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" x-show="node.data.xOmniEnabled" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                </svg>
              </span>
            </label>
          </div>
          <div class="flex-grow"></div>
          <!-- info button -->
          <div class='block-footer block-category-color'
           x-text='node.namespace' x-show='node.namespace' x-tooltip='Show all blocks in this package.' @click.stop.prevent='workbench.showExtension("omni-core-collectionmanager", {type:"block", filter: node.namespace})'>
          </div>
          <div class='block-footer block-category-color' x-tooltip='Show all blocks in this category.' x-text='node.category' x-show='node.category' :class="node.category?.toLowerCase().replace(/ /g,'-') !== 'input' ? node.category?.toLowerCase().replace(/ /g,'-') : ''" @click.stop.prevent='workbench.showExtension("omni-core-collectionmanager", {type:"block", filter: node.category})'>
          </div>
          <div class='text-lg cursor-pointer text-white' x-tooltip="Show Help" @click.stop.prevent='toggleInfo(node);' :class="{
      'stroke-yellow-500 fill-yellow-500': showHelp,
      'stroke-green-800 fill-green-900': !showHelp
    }">
            <svg class='w-5 h-5 ' stroke="current" fill='current' viewBox='0 0 56 56' xmlns='http://www.w3.org/2000/svg'>
              <path d='M 27.9999 51.9063 C 41.0546 51.9063 51.9063 41.0781 51.9063 28 C 51.9063 14.9453 41.0312 4.0937 27.9765 4.0937 C 14.8983 4.0937 4.0937 14.9453 4.0937 28 C 4.0937 41.0781 14.9218 51.9063 27.9999 51.9063 Z M 27.9999 47.9219 C 16.9374 47.9219 8.1014 39.0625 8.1014 28 C 8.1014 16.9609 16.9140 8.0781 27.9765 8.0781 C 39.0155 8.0781 47.8983 16.9609 47.9219 28 C 47.9454 39.0625 39.0390 47.9219 27.9999 47.9219 Z M 27.7890 19.6563 C 29.4999 19.6563 30.8358 18.2968 30.8358 16.6094 C 30.8358 14.8984 29.4999 13.5390 27.7890 13.5390 C 26.0780 13.5390 24.7421 14.8984 24.7421 16.6094 C 24.7421 18.2968 26.0780 19.6563 27.7890 19.6563 Z M 23.8749 40.8906 L 33.4374 40.8906 C 34.3983 40.8906 35.1483 40.2109 35.1483 39.25 C 35.1483 38.3359 34.3983 37.6094 33.4374 37.6094 L 30.5312 37.6094 L 30.5312 25.6797 C 30.5312 24.4141 29.8749 23.5703 28.7030 23.5703 L 24.2733 23.5703 C 23.3358 23.5703 22.5858 24.2968 22.5858 25.2109 C 22.5858 26.1719 23.3358 26.8516 24.2733 26.8516 L 26.8046 26.8516 L 26.8046 37.6094 L 23.8749 37.6094 C 22.9374 37.6094 22.1874 38.3359 22.1874 39.25 C 22.1874 40.2109 22.9374 40.8906 23.8749 40.8906 Z'>
              </path>
            </svg>
          </div>




        </div>
      </div>
    </div>
    </div>
    <div x-show='showHelp' x-data="{editComment: false}" style="min-height: 100px; min-width: 350px"
    class="mt-3 rounded-md bg-yellow-100 drop-shadow-lg border-gray-400 bg-opacity-50 hover:bg-opacity-95 h-full"
    :class="
        {
          'blur-xs grayscale': !node.data.xOmniEnabled
        }">


      <div class="flex flex-row float-right absolute right-2 top-2 ">
        <svg x-show="!editComment" class='w-3 h-3 cursor-pointer mt-0.5 border-0' x-tooltip='Edit'
        @click="editComment=true;await startEditComment($el) " viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
          </svg>
          <svg x-show="editComment" class='w-3 h-3 mt-0.5 cursor-pointer ' x-tooltip='Accept'
          @click="if (await setComment($el)){client.workbench.activeRecipe.setDirty()};editComment=false" viewBox="0 0 24 24" fill="none" stroke="darkgreen" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 11 12 14 22 4" />
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
            <polyline points="9 11 12 14 22 4" />
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
      </svg>
      <div @click.stop.prevent="toggleInfo(node);"  class="cursor-pointer "> <svg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='1.5' stroke='currentColor' class='h-4 w-4'>
          <path stroke='black' stroke-linecap='round' stroke-linejoin='round' d='M6 18L18 6M6 6l12 12' />
        </svg></div>

      </div>
      <h3 class="p-2 pr-4 first-letter:h-full w-full font-semibold">
        <span x-text="node.title"></span>
      </h3>
      <div :id="'comment_'+node.id"
            @paste.stop.prevent="document.execCommand('insertText', false, ($event.originalEvent || $event).clipboardData.getData('text/plain'))"
       class="p-2 h-full"  x-html="getHelpText(node)" :contenteditable="editComment" :class="{
        'bg-white border-2': editComment,
      }"></div>
    </div>
  </div>

</div>`,Mc=`<div class="block-header flex flex-row h-8 p-2" >
  <!-- Copy button -->

  <!-- close button -->
  <div class="block-title flex-grow" x-text="node.title"></div>
  <div x-show="workbench.canEdit" class=" hover:animate-pulse" @click.stop.prevent="onClickClose(node);" x-tooltip="Remove">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6">
      <path stroke="#ffffff" stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
    </svg>
  </div>
</div>

<div id='block-content' class="relative flex items-center justify-center w-full text-xs content   bg-gray-100 bg-opacity-100 text-center p-4" style="min-height: 200px;">
  <div x-html="node.summary" class="text-red-500"></div>

</div>
`,Dc=`<div class="flex ">
  <div class="flex  h-full bg-opacity-0 border-0 flex-row" >
    <div class="rete-block">
    <div class='block-header flex flex-row h-8 !bg-slate-500'>
      <!-- close button -->
      <div class='block-title flex-grow mx-1 p-1' x-text='getTitle()' x-tooltip='Right-Click to rename' @contextmenu.prevent='if (await rename()){workbench.activeRecipe.setDirty()}'></div>
      <div x-show='workbench.canEdit ' class='hover:animate-pulse mr-1' @click.stop.prevent='onClickClose(node);' x-tooltip='Remove'>
        <svg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='1.5' stroke='currentColor' class='h-5 w-5'>
          <path stroke='#ffffff' stroke-linecap='round' stroke-linejoin='round' d='M6 18L18 6M6 6l12 12' />
        </svg>
      </div>
    </div>
    <div>
      <div id='block-content ' class='relative flex items-center justify-center flex-grow  w-full text-xs text-gray-400 content h-full bg-transparent'>
        <div class='block_content flex-row h-full' :class='classNameString' :title='node.title'>
          <div>
            <!-- Inputs -->
            <template x-for='(input, index) in (inputs(node))'>
              <div class='input' :key='input.key' x-show='client.workbench.canEdit || input?.connections?.length' x-id="['input-socket']">
                <div x-socket:input='input' :id="$id('input-socket')" class='socket input relative' type='input' :title='input.socket.name'></div>
                <div x-show='!input.showControl()' class='input-title' x-text='input.title | input.name' :for="$id('input-socket')"></div>
                <div x-show='input.showControl()' class='input-control' :for="$id('input-socket')" type='input.control.controlType' :value='value' x-control='input.control' x-data='input.control.component(input.control)' x-html='getInputTemplate()' x-effect="$watch('value', (value) => update())"></div>
              </div>
            </template>
            <!-- Outputs -->
            <template x-for='(output) in (outputs(node)||[])'>
              <div class='output' :key='output.key' x-id="['output-socket']">
                <div class='output-title' x-text='output.name' :for="$id('output-socket')"></div>
                <div x-socket:output='output' :id="$id('output-socket')" class='socket output' type='output.control.controlType' :title='output.socket.name'></div>
              </div>
            </template>
            <div class="flex flex-grow"> </div>
            <template x-for='(control, index) in controls(node)'>
              <div class='control' :key='index' :value='value' x-control='control' x-data='control.component(control)' x-html='getInputTemplate()' x-effect="$watch('value', (value) => update())"></div>
            </template>
          </div>
        </div>

      </div>
      <div class='bg-slate-500 rounded-b-md p-1 flex flex-row'>
        <div class="flex-grow"></div>

                <div class='text-lg cursor-pointer text-white ' x-tooltip="Show Help" @click.stop.prevent='toggleInfo(node);' :class="{
      'stroke-yellow-500 fill-yellow-500': showHelp,
      'stroke-white fill-white': !showHelp
    }">
            <svg class='w-5 h-5 ' stroke="current" fill='current' viewBox='0 0 56 56' xmlns='http://www.w3.org/2000/svg'>
              <path d='M 27.9999 51.9063 C 41.0546 51.9063 51.9063 41.0781 51.9063 28 C 51.9063 14.9453 41.0312 4.0937 27.9765 4.0937 C 14.8983 4.0937 4.0937 14.9453 4.0937 28 C 4.0937 41.0781 14.9218 51.9063 27.9999 51.9063 Z M 27.9999 47.9219 C 16.9374 47.9219 8.1014 39.0625 8.1014 28 C 8.1014 16.9609 16.9140 8.0781 27.9765 8.0781 C 39.0155 8.0781 47.8983 16.9609 47.9219 28 C 47.9454 39.0625 39.0390 47.9219 27.9999 47.9219 Z M 27.7890 19.6563 C 29.4999 19.6563 30.8358 18.2968 30.8358 16.6094 C 30.8358 14.8984 29.4999 13.5390 27.7890 13.5390 C 26.0780 13.5390 24.7421 14.8984 24.7421 16.6094 C 24.7421 18.2968 26.0780 19.6563 27.7890 19.6563 Z M 23.8749 40.8906 L 33.4374 40.8906 C 34.3983 40.8906 35.1483 40.2109 35.1483 39.25 C 35.1483 38.3359 34.3983 37.6094 33.4374 37.6094 L 30.5312 37.6094 L 30.5312 25.6797 C 30.5312 24.4141 29.8749 23.5703 28.7030 23.5703 L 24.2733 23.5703 C 23.3358 23.5703 22.5858 24.2968 22.5858 25.2109 C 22.5858 26.1719 23.3358 26.8516 24.2733 26.8516 L 26.8046 26.8516 L 26.8046 37.6094 L 23.8749 37.6094 C 22.9374 37.6094 22.1874 38.3359 22.1874 39.25 C 22.1874 40.2109 22.9374 40.8906 23.8749 40.8906 Z'>
              </path>
            </svg>
          </div>
          </div>
    </div>
  </div>
  </div>

  </div>
  <div x-show='showHelp' x-data="{editComment: false}" style="min-height: 100px; min-width: 350px"
    class="mt-3 rounded-md bg-yellow-100 drop-shadow-lg border-gray-400 bg-opacity-50 hover:bg-opacity-95 h-full"  >

      <div class="flex flex-row float-right absolute right-2 top-2 ">
        <svg x-show="!editComment" class='w-3 h-3 cursor-pointer mt-0.5 border-0' x-tooltip='Edit'
        @click="editComment=true;await startEditComment($el) " viewBox="0 0 24 24" fill="none" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
          </svg>
          <svg x-show="editComment" class='w-3 h-3 mt-0.5 cursor-pointer ' x-tooltip='Accept'
          @click="if (await setComment($el)){client.workbench.activeRecipe.setDirty()};editComment=false" viewBox="0 0 24 24" fill="none" stroke="darkgreen" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 11 12 14 22 4" />
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
            <polyline points="9 11 12 14 22 4" />
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
      </svg>
      <div @click.stop.prevent="toggleInfo(node);"  class="cursor-pointer "> <svg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='1.5' stroke='currentColor' class='h-4 w-4'>
          <path stroke='black' stroke-linecap='round' stroke-linejoin='round' d='M6 18L18 6M6 6l12 12' />
        </svg></div>

      </div>
      <h3 class="p-2 pr-4 first-letter:h-full w-full font-semibold">
        <span x-text="node.title"></span>
      </h3>
      <div :id="'comment_'+node.id"
        @paste.stop.prevent="document.execCommand('insertText', false, ($event.originalEvent || $event).clipboardData.getData('text/plain'))"
      class="p-2 h-full"  x-html="getHelpText(node)" :contenteditable="editComment" :class="{
        'bg-white border-2': editComment,
      }"></div>
    </div>
</div>`,Uo=Object.assign({"./default.hbs":Ac,"./error.hbs":Mc,"./simple.hbs":Dc});Uo["./default.hbs"];const Pi=t=>Uo[`./${t}.hbs`];window.Alpine=et;function Nc(t){const e=n=>n.toLowerCase().replace(/ /g,"-");return Array.isArray(t)?t.map(e):e(t)}class Ic{constructor(e={}){this.name="alpine-render",this.options=e,this.editor=null}setupAlpineNode(e,n,i,r){if(n==null)throw new Error("Invalid Rete Node (null)");n._alpine=e;const l="retenode"+n.id;e.setAttribute("x-data",l),e.setAttribute("id",l),new ResizeObserver(()=>{this.onNodeResize(n)}).observe(e),n.update=async s=>await this.update(n,s);const d=this.editor;et.data(l,()=>({node:null,editor:null,bindSocket:null,bindControl:null,showEditor:!1,classNameString:"",tabButtonsClassString:"",showHelp:!0,copyNotification:!1,getTitle(){return this.node.title||this.node.name},selected(s){var c;return(c=this.editor)!=null&&c.selected.contains(s)?"selected":""},className(s){return Nc(["rete-block",this.selected(s),s.name,s.errors.length?"error":"",s.active?"active":""])},async rename(){const s=prompt("New Name",this.node.title)||"";if(s===this.title){delete this.node.data["x-omni-title"];return}const c=this.node.data["x-omni-title"]||"";return this.node.data["x-omni-title"]=s||void 0,this.node.title=this.node.data["x-omni-title"]||this.title,c!==s},async startEditComment(s){const c=document.getElementById(`comment_${this.node.id}`);c.innerText=this.node.data["x-omni-comment"]||this.node.summary},async getHelpText(s){return window.client.markdownEngine.render(this.node.data["x-omni-comment"]||this.node.summary)},async setComment(s){const c=document.getElementById(`comment_${this.node.id}`),p=c.innerText.trim(),f=this.node.data["x-omni-comment"]||"";return p?this.node.data["x-omni-comment"]=p:delete this.node.data["x-omni-comment"],c.innerHTML=await window.client.markdownEngine.render(this.node.data["x-omni-comment"]||this.node.summary),f!==p},outputs(s){var c,p;return!s||!s.outputs?[]:Array.from(((p=(c=s==null?void 0:s.outputs)==null?void 0:c.values)==null?void 0:p.call(c))||[])},inputs(s){var c,p;return!s||!s.inputs?[]:Array.from(((p=(c=s==null?void 0:s.inputs)==null?void 0:c.values)==null?void 0:p.call(c))||[]).filter(f=>f!=null)},controls(s){var c,p;return Array.from(((p=(c=s==null?void 0:s.controls)==null?void 0:c.values)==null?void 0:p.call(c))||[]).filter(f=>f==null?(console.warn("Null control for node - skipping render",s),!1):f.component==null?(console.warn("Invalid component for control - skipping render",et.raw(s),et.raw(f)),!1):!0)},onClickClose(s){this.editor.removeNode(s)},toggleInfo(s){var c;this.showHelp=!this.showHelp,this.showHelp?window.localStorage.removeItem("omni/workbench/help_seen_"+s.name):window.localStorage.setItem("omni/workbench/help_seen_"+s.name,1),window.client.sendSystemMessage(Object.assign({name:s.name,title:s.title},s.meta||{},((c=s.patch)==null?void 0:c.meta)||{}),"omni/component-meta",{commands:[{title:"Add to Workbench",id:"add",args:[s.name]}]},["no-picture"])},onClickCopy(s){const c={data:s.data,name:s.name},p=JSON.stringify(c);navigator.clipboard.writeText(p).then(function(){},function(w){console.error("Could not copy node: ",w)}),this.copyNotification=!0;const f=this;setTimeout(function(){f.copyNotification=!1},3e3)},getContentHeight(){},init(){var s,c,p,f,w,C;if(!n)throw new Error("reteNode is not defined");this.node=n,(s=this.node).namespace??(s.namespace=""),(c=this.node).category??(c.category=""),(p=this.node).title??(p.title=""),(f=this.node).summary??(f.summary=""),(w=this.node).meta??(w.meta={}),(C=this.node.data).xOmniEnabled??(C.xOmniEnabled=!0),this.showHelp=window.localStorage.getItem("omni/workbench/help_seen_"+this.node.name)==null,this.editor=d,this.bindSocket=i,this.bindControl=r}}))}createControl(e,n){return et.$data(e)}setInnerHTML(e){if(!e)throw new Error("Invalid node passed into setInnerHtml");e._alpine.innerHTML=e.renderTemplate?Pi(e.renderTemplate):Pi("default")}updateConnections(e){e.outputs.forEach(n=>{n.connections.forEach(i=>{var r;(r=this.editor.view.connections.get(i))==null||r.update()})}),e.inputs.forEach(n=>{n.connections.forEach(i=>{var r;(r=this.editor.view.connections.get(i))==null||r.update()})})}onNodeResize(e){if(!e)throw new Error("Invalid reteNode passed to onNodeResize");this.updateConnections(e)}async update(e,n=!1){if(!e)throw new Error("Invalid reteNode passed to update");const i=et.$data(e._alpine);return i!=null&&i.className&&(i.classNameString=i.className(e),i.tabButtonsClassString=i.classNameString),n||this.setInnerHTML(e),await new Promise(r=>{if(!e._alpine){r();return}et.effect(()=>{requestAnimationFrame(r)})})}install(e){this.editor=e,this.editor.on("rendernode",({el:n,node:i,component:r,bindSocket:l,bindControl:d})=>{(!r.render||r.render==="alpine")&&(this.setupAlpineNode(n,i,l,d),this.setInnerHTML(i),i.update())}),this.editor.on("rendercontrol",({el:n,control:i})=>{i.render&&i.render!=="alpine"||(i._alpine=this.createControl(n,i),i.update=()=>i._alpine.update())}),this.editor.on("connectioncreated connectionremoved",n=>{n.input.node.update(),n.output.node.update()}),this.editor.on("nodeselected",n=>{var i,r;n._alpine!==((i=e.previousSelectedNode)==null?void 0:i._alpine)&&((r=e.previousSelectedNode)==null||r.update(!0),e.previousSelectedNode=n,n.update(!0))})}}document.addEventListener("alpine:init",()=>{os.status_start("Renderer Alpine Init"),et.directive("socket",(t,{expression:e,value:n},{evaluate:i,effect:r})=>{const l=t.closest("[x-data]"),d=et.$data(l),s=i(e),c=t.getAttribute("class");t.setAttribute("class",c+" "+s.socket.name);const p=n==="output"?"o_":"i_";l.socketDict={...l.socketDict||{},[p+s.key]:t},r(()=>{d.bindSocket(t,n,et.raw(s))})}),et.directive("control",(t,{expression:e,value:n},{evaluate:i,effect:r})=>{const l=t.closest("[x-data]"),d=et.$data(l),s=i(e);r(()=>{d.bindControl(t,et.raw(s))})})});const Lc=function(t="editor",e){const n={loaded:!1,editor:null,engine:null,isDraggingOver:!1,addOffsetX:0,addOffsetY:0,async start(){var f;this.engine=new ss("mercs@0.1.1"),this.initEditor(),this.registerClientControls();const c=new URLSearchParams(window.location.search).get("rx");if(c&&Yn.isValidUrl(c)){window.history.replaceState({},document.title,"/");const w=await Yn.fetchJSON(c);await e.loadFromJSON(w)}e.isBlank&&await e.loadFromCache(),await((f=window.client)==null?void 0:f.runScript("hasKey",{}))||(client.showTopBanner("Attention","Your Omnitool environment is missing external API keys. Use the API Key Management menu to add your keys and enable more capabilities.",{link:""}),e.showApiManagement()),this.reviewedNUX()||(e.showTutorial(!0),this.setReviewedNUX(!0))},async stopWorkflow(s){const c=s.length>0?s[0]:void 0;return(await Kt.post("/api/v1/workflow/stop",{jobId:c},{withCredentials:!0})).data},async loadWorkflowToEditor(){if(!this.editor)throw new Error("Attempt to call loadWorkflowToEditor before editor is initialized!");const s=this.loaded;if(this.loaded=!1,e==null?void 0:e.activeWorkflow){await this.editor.clear();const p=e.activeWorkflow.rete;if(p!=null&&p.nodes){const f=Array.from(new Set(Object.values(p.nodes).map(_=>_.name))),w=await window.client.blocks.getInstances(f),C=new Set(w.map(_=>_.name));Object.values(p.nodes).forEach(_=>{C.has(_.name)||(_.data["x-omni-summary"]=`The block named <b>"${_.name}"</b> is currently not installed on your system. It is likely you are missing an API or extension. Please locate and install the relevant API or extension and restart the server.`,_.missingBlockName=_.name,_.name="omnitool._block_missing")}),w.forEach(_=>{try{this.editor.getComponent(_.name)}catch{this.editor.register(_),this.engine.register(_),_.editor=this.editor,_.engine=this.engine}});try{await this.editor.fromJSON(p)}catch(_){console.error("Error loading workflow",_)}}e.activeWorkflow.rete=this.editor,this.loaded=!0}else console.log("No workflow loaded"),this.loaded=s},onEditorchange(s){if(this.loaded&&!e.isBlank)return["connectionremoved","connectioncreated","nodecreated","noderemoved","nodeupdated","nodetranslated"].includes(s)?e.canEdit&&e.activeWorkflow.setDirty():console.log("Unhandled event",s),!0},async createNodeByBlockName(s,c={}){const p=await window.client.blocks.getInstance(s);if(!p)return{error:`Can't find a block named <b>${s}</b>.`};try{n.editor.components.get(p.name)||n.editor.register(p)}catch(b){return console.error(b),{error:b.message}}const f=await p.createNode();if(!f)return{error:`Couldn't create a node for <b>${s}</b>.`};Object.keys(c).forEach(b=>{b in c&&(f.data[b]=c[b])}),await n.editor.addNode(f),f.update();const w=n.editor.view.area,C=n.editor.view.nodes,_=C.get(f).el.clientWidth,A=C.get(f).el.clientHeight;let D=n.editor.view.container.clientWidth,N=n.editor.view.container.clientHeight;D<10&&N<10&&(D=window.innerWidth*.5,N=window.innerHeight*.5);const m=(D/2-w.transform.x)/w.transform.k-_/2+n.addOffsetX,x=(N/2-w.transform.y)/w.transform.k-A/2+n.addOffsetY;return n.addOffsetX+=20,n.addOffsetY+=20,n.addOffsetX>250&&(n.addOffsetX-=261),n.addOffsetY>200&&(n.addOffsetY-=211),C.get(f).translate(m,x),{node:f,block:p}},async handlePaste(s){var w;if(e.readOnly){console.log("Workbench is read-only, unable to paste");return}const c=(w=s==null?void 0:s.clipboardData)==null?void 0:w.getData("text");if(!c){console.log("Clipboard data not found, nothing to paste");return}let p;try{p=JSON.parse(c)}catch{console.error("Invalid JSON string:",c);return}if(typeof p!="object"||!("data"in p)||!("name"in p)){console.log("Invalid paste data",p);return}const f=await this.createNodeByBlockName(p.name,p.data);f!=null&&f.error&&console.log(f.error)},onNavigateZoomToWindow(){r()},onNavigateZoomRelative(s){const c=n.editor.view.area,p=n.editor.view.container.clientWidth/2,f=n.editor.view.container.clientHeight/2;s>0?s=s/(1+c.transform.k/4):s=s/(1+.1/c.transform.k);const w=c.transform.k*Math.exp(s*.3),C=p-(p-c.transform.x)*w/c.transform.k,_=f-(f-c.transform.y)*w/c.transform.k;i(c,C,_,w,250)},wfDragOver(s){n.isDraggingOver=!0,s.preventDefault(),s.target.classList.add("dragover")},wfDragLeave(s){n.isDraggingOver=!1,s.target.classList.remove("dragover")},async wfDrop(s){var p,f,w,C,_;n.isDraggingOver=!1,s.preventDefault(),s.target.classList.remove("dragover");const c=((p=s==null?void 0:s.dataTransfer)==null?void 0:p.files)||((f=s==null?void 0:s.target)==null?void 0:f.files);if(c.length>0){const A=c[0];if(A.name.endsWith(".json")&&A.type==="application/json"){const D=await n.handleWorkflowDrop(A);D&&(D.id&&((w=D.meta)!=null&&w.name)&&((_=(C=D.rete)==null?void 0:C.id)!=null&&_.startsWith("mercs@"))?(window.client.sendSystemMessage(`Importing recipe named **${D.meta.name}** from *${A.name}*.`,"text/markdown",void 0),window.Alpine.nextTick(async()=>{var N;D.id="",await e.loadFromJSON(D),(N=e.activeWorkflow)==null||N.setDirty(),e.showRecipeHelp()})):window.client.sendSystemMessage("The imported file is not a compatible omnitool recipe.","text/plain",void 0,["error"]))}}s.target&&(s.target.value="")},reviewedNUX(){return window.localStorage.getItem("omnitool.nux")},setReviewedNUX(s){window.localStorage.setItem("omnitool.nux",s)},async handleWorkflowDrop(s){return await new Promise((c,p)=>{const f=new FileReader;f.onload=w=>{c(JSON.parse(w.target.result))},f.onerror=w=>{p(w)},f.readAsText(s)})},registerClientControls(){const s=Vt.getSingleton().getControlRegistry();Object.entries(Sc).forEach(([c,p])=>{s.add(c,p)}),console.log("Registered client controls",s)},async getComponentDefinition(){return(await Kt.get("/api/v1/mercenaries/components?includeDefinitions=true",{withCredentials:!0})).data.map(c=>c[1])},initEditor(){const s=this.$refs[t];if(!s)throw new Error(`No container found for workflow editor container: '${t}',  Please provide a valid ref to the container element.`);class c extends rs{connect(w,C){(!n.loaded||!e.readOnly)&&super.connect(w,C)}removeConnection(w){(!n.loaded||!e.readOnly)&&super.removeConnection(w)}}this.editor=new c("mercs@0.1.1",s),this.editor.view.resize=function(){s.style.width="100%",s.style.height="100%"},this.editor.bind("nodeupdated"),this.editor.bind("control_updated"),this.editor.bind("node_dynamic_update");const p=new Ic;this.editor.use(p),this.editor.use(Kl),this.editor.use(cn,{type:cn.DEFAULT,curve:cn[window.client.reteSettings.curve],options:{vertical:!1,curvature:.3},arrow:!!window.client.reteSettings.arrow}),this.editor.on("nodecreated",()=>this.onEditorchange("nodecreated")),this.editor.on("noderemoved",()=>this.onEditorchange("noderemoved")),this.editor.on("nodeselected",async f=>this.$dispatch("nodeselected",{node:f,component:await window.client.blocks.getInstance(f.name),editor:this.editor})),this.editor.on("nodetranslated",f=>this.onEditorchange("nodetranslated")),this.editor.on("connectioncreated",()=>this.onEditorchange("connectioncreated")),this.editor.on("connectionremoved",()=>this.onEditorchange("connectionremoved")),this.editor.on("process",()=>this.onEditorchange("process")),this.editor.on("nodeupdated",()=>this.onEditorchange("nodeupdated")),this.editor.on("node_dynamic_update",async function({nodeId:f,key:w,value:C}){console.log("node_dynamic_update"+f,w,C);const _=editor.nodes.find(A=>A.id===f);console.log("node_dynamic_update",_,C),this.onEditorchange("nodeupdated")})}};window.client.subscribeToGlobalEvent("workbench_workflow_loaded",async s=>{await n.loadWorkflowToEditor()}),window.client.subscribeToGlobalEvent("request_editor_resize",s=>{setTimeout(()=>{var c;(c=n.editor)==null||c.view.resize(),window.Alpine.nextTick(()=>{n.onNavigateZoomToWindow()})},1)}),window.client.subscribeToGlobalEvent("sse_message",s=>{if(s.type==="job_state"){if(s.event==="node_started"){const c=n.editor.nodes.find(p=>p.id===s.args.node_id);c!=null&&(c.active=!0,c.update())}else if(s.event==="node_finished"){const c=n.editor.nodes.find(p=>p.id===s.args.node_id);c!=null&&setTimeout(()=>{c.active=!1,c.update()},300)}}if(s.type==="control:setvalue"&&s.controlId!=null){const c=n.editor.nodes.find(p=>p.id===s.node_id);if(c!=null&&c.controls){const p=c.controls.get(s.controlId);p!=null&&p._alpine.change({target:{value:s.value}})}}});function i(s,c,p,f,w){n.startTime=Date.now()-16/w,n.startX=s.transform.x,n.startY=s.transform.y,n.startScale=s.transform.k,n.deltaX=c-n.startX,n.deltaY=p-n.startY,n.deltaScale=f-n.startScale;const C=function(A){return A<.5?4*A*A*A:1-Math.pow(-2*A+2,3)/2},_=()=>{const A=Date.now()-n.startTime,D=Math.min(1,A/w),N=C(D);s.transform.x=n.startX+n.deltaX*N,s.transform.y=n.startY+n.deltaY*N,s.transform.k=n.startScale+n.deltaScale*N,s.zoom(s.transform.k,0,0),s.update(),D<1&&setTimeout(_,16)};_()}const r=()=>{const s=n.editor;if(!s)return;const c=s.nodes,p=s.view.nodes,f=Math.min(...c.map(y=>y.position[0])),w=Math.min(...c.map(y=>y.position[1])),C=Math.max(...c.map(y=>y.position[0]+p.get(y).el.clientWidth)),_=Math.max(...c.map(y=>y.position[1]+p.get(y).el.clientHeight)),A=s.view.container.clientWidth,D=s.view.container.clientHeight,N=A/(C-f)*.8,m=D/(_-w)*.85,x=Math.min(N,m);if(!isFinite(x)||x<=0)return;const b=s.view.area,g=(A-(C-f)*x)/2-f*x,E=(D-(_-w)*x)/2-w*x;i(b,g,E,x,500)};window.client.registerClientScript("fit",async function(s){return r(),!0}),window.client.registerClientScript("zoom",async function(s){return n.onNavigateZoomRelative(parseInt(s[0]||"1")),!0}),window.client.registerClientScript("clone",async function(s){return e.remixRecipe().then(p=>p?{response:"Recipe duplicated. It's now ready to edit."}:{response:""}).catch(p=>({response:"Recipe duplication failed: "+p}))}),window.client.registerClientScript("set",async function(s){let c;return s.length>1?(window.localStorage.setItem(`settings.${s[0]}`,s[1]),c=`Set ${s[0]} to ${s[1]}. Press F5 to update UI`):s.length>0?(window.localStorage.removeItem(`settings.${s[0]}`),c=`Reset ${s[0]}. Press F5 to update UI`):c="Usage: /set <key> <value>",{response:c}}),window.client.registerClientScript("run",async function(s){var c,p,f;if(!Array.isArray(s)&&typeof s=="object"){const w=JSON.parse(JSON.stringify(s));await e.execute(w);return}if(s.length>0){let w=[],C=[],_=[];s[1]&&(Array.isArray(s[1])||(s[1]=[s[1]]),s[1].filter(D=>!!D).forEach(D=>{var N,m,x,b,g;typeof D=="object"&&((N=D.mimeType)!=null&&N.startsWith("image/"))?w.push(D):typeof D=="object"&&((m=D.mimeType)!=null&&m.startsWith("audio/")||(x=D.mimeType)!=null&&x.startsWith("application/ogg"))?C.push(D):typeof D=="object"&&((b=D.mimeType)!=null&&b.startsWith("text/plain")||(g=D.mimeType)!=null&&g.startsWith("application/pdf"))&&_.push(D)})),C=C.concat(((c=client.clipboard)==null?void 0:c.audio)||[]),w=w.concat(((p=client.clipboard)==null?void 0:p.images)||[]),_=_.concat(((f=client.clipboard)==null?void 0:f.documents)||[]);const A=JSON.parse(JSON.stringify({text:s[0]||void 0,images:w,audio:C,documents:_}));client.clipboard={},await e.execute(A)}else await e.execute();return{response:"Job started.",hide:!0}}),window.client.registerClientScript("stop",async function(s){return await n.stopWorkflow(s),{response:"Stop running recipe.",hide:!0}}),window.client.registerClientScript("new",async function(s){e.newRecipe()});function l(s){if(!s)return null;if(s.socketDict)return s.socketDict;if(s.children)for(const c in s.children){const p=l(s.children[c]);if(p)return p}return null}function d(){function s(m,x,b){var E;const g=(E=l(m==null?void 0:m._alpine))==null?void 0:E[b];if(g){const y=g.getBoundingClientRect(),O=x[m.id]||[0,0];return[y.left+O[0],y.top+O[1]]}return m.position}function c(m,x){const b=x[m.id]||[0,0];return[m.position[0]+b[0],m.position[1]+b[1]]}function p(m,x,b,g,E){const y=m._alpine.getBoundingClientRect(),O=y.width/E,I=y.height/E,$=c(m,x);let F=0;F+=.01*($[0]*$[0]+$[1]*$[1])/(E*E);for(const R of b){if(R===m)continue;const P=c(R,x),U=R._alpine.getBoundingClientRect(),G=U.width/E,o=U.height/E,a=$[0]+O/2-P[0]-G/2,u=$[1]+I/2-P[1]-o/2,h=(O+G)/2-Math.abs(a)+g,v=(I+o)/2-Math.abs(u)+g;if(h>0&&v>0){const k=h*v;F+=k*k}}const j=[...m.inputs.values(),...m.outputs.values()];for(const R of j)for(const P of R.connections){const U=s(P.input.node,x,"i_"+P.input.key),G=s(P.output.node,x,"o_"+P.output.key),o=(G[0]-U[0])/E+120,a=(G[1]-U[1])/E;F+=o*o*.25+a*a*2,o>0&&(F+=g*g,F+=Math.abs(o*o)*50)}return F}const f=n.editor.view.area,w=n.editor.view.nodes,C=f.transform.k,_=500,A=50,D=Date.now()+1e3*2,N={};for(let m=0;m<_;m++)for(const x of n.editor.nodes){if(Date.now()>D)break;let b=N[x.id]||[0,0],g=p(x,N,n.editor.nodes,A,C),E=[(Math.random()-.5)*10,(Math.random()-.5)*10],y=0;for(;;){const O=[b[0]+E[0],b[1]+E[1]];N[x.id]=O;const I=p(x,N,n.editor.nodes,A,C);if(g>I){g=I,b=O,E[0]*=1.3,E[1]*=1.3;continue}N[x.id]=b;const $=.5;if(E=[-E[1]*$,E[0]*$],y++>80||E[0]*E[0]+E[1]*E[1]<2e-5)break}}for(const m of n.editor.nodes){const x=c(m,N);w.get(m).translate(...x)}for(const m of n.editor.nodes)n.editor.view.updateConnections({node:m})}return window.client.registerClientScript("arrange",async function(s){d(),r()}),window.client.registerClientScript("jobs",async function(s){let p=(await Kt.get("/api/v1/workflow/jobs",{withCredentials:!0})).data;return p.jobs&&p.jobs.length===0&&(p="No jobs are running."),console.log(p),{response:p}}),window.client.registerClientScript("add",async function(s){console.info(`client script "add" called with args: ${s}`);const c=s==null?void 0:s[0],p=s==null?void 0:s[1];if(!c)return{error:"No block name provided. Usage: <b>/add <block_name></b>"};if(e.readOnly)return{error:"Workbench is read-only, unable to add block"};const f=await n.createNodeByBlockName(c,p);return f.error?(sdk.showToast("Adding "+c+" failed!",{description:f.error,type:"danger",position:"bottom-right"}),f):(window.client.showToast(`${f.block.title} block added!`,{description:f.block.summary,type:"success",position:"bottom-right"}),{response:`Added <b>${f.block.title} (${c})</b>.`,hide:!0})}),window.client.registerClientScript("logout",async()=>{const s=client.services.get("auth");return await(s==null?void 0:s.logout()),setTimeout(function(){location.reload()},3e3),{response:"Bye!"}}),n},Rc=new URLSearchParams(window.location.search),$i=Rc.get("m"),Pc=(/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||$i==="m")&&$i!=="ds";as();omnilog.wrapConsoleLogger();omnilog.level=Bi.debug;omnilog.setCustomLevel("emittery",Bi.silent);window.Alpine=et;et.plugin(As);et.plugin(Ks);const $c=et.reactive({}),Fc=et.reactive({inputText:"",messages:[],recognition:null,recognitionAvailable:!1,recognitionRecording:!1}),Bc=et.reactive({isMobile:Pc}),Ft=et.reactive({isConnected:!1,showDisconnectModal:!1,reason:""}),Bt=et.reactive({hasTOS:!1}),lt=window.client=ls("vite-frontend",{},ps);lt.use(cs,{id:"auth",host:"",authUrl:"/api/v1/auth/login",logoutUrl:"/api/v1/auth/logout",userUrl:"/api/v1/auth/user"},"service");lt.use(ks,{id:"messaging"},"service");lt.use(us,{id:"chat",initialState:Fc,workbench:lt.workbench},"service");lt.use(fs,{id:"jobs",jobStorage:$c},"service");lt.use(gs,{id:"command"},"service");const Tn=document.querySelector("#chat"),kn=document.querySelector("#sidebar"),jc=new ResizeObserver(t=>{for(const e of t)document.documentElement.style.setProperty("--chat-width",`${e.contentRect.width}px`),document.documentElement.style.setProperty("--editor-width",`${window.innerWidth-kn.offsetWidth-10-e.contentRect.width}px`),document.documentElement.style.setProperty("--sidebar-width",`${kn.offsetWidth}px`)});jc.observe(Tn);const Hc=()=>{document.documentElement.style.setProperty("--doc-height",`${window.innerHeight}px`),document.documentElement.style.setProperty("--doc-width",`${window.innerWidth}px`),document.documentElement.style.setProperty("--chat-width",`${Tn.offsetWidth}px`),document.documentElement.style.setProperty("--editor-width",`${window.innerWidth-kn.offsetWidth-10-Tn.offsetWidth}px`)},Vc=()=>{Hc(),lt.emit("request_editor_resize")};window.addEventListener("resize",Vc);document.addEventListener("alpine:init",()=>{omnilog.status_start("Alpine init"),et.data("auth",()=>({currentUser:void 0,isLogin(){return ds(this.currentUser)},isTOS(){return Bt.hasTOS},onAcceptTOS(){Kt.post("/api/v1/auth/accepttos",{accept:!0}).then(t=>{Number.parseInt(t.data.tosAccepted)>0&&(omnilog.info("Verified acceptance of TOS "+t.data.tosAccepted),Bt.hasTOS=!0)}).catch(t=>{omnilog.error(t)})},async init(){try{this.currentUser=await hs({username:null,password:null}),Bt.hasTOS=this.currentUser.tosAccepted>0}catch(t){omnilog.error(t.messages)}}})),et.data("appState",()=>({showAdmin:!1,showUsers:!1,connectionState:Ft,tosState:Bt,hideEditor:Bc,workbench:lt.workbench,chatComponent:Aa,workflowEditor:Lc("editor",lt.workbench),uiSettings:lt.uiSettings,async init(){this.$watch("tosState",()=>{omnilog.log("TOS changed "+Bt.hasTOS),Bt.hasTOS&&this.boot()}),lt.subscribeToServiceEvent("auth","authenticated",async t=>{Bt.hasTOS&&this.boot()})},async boot(){lt.subscribeToServiceEvent("messaging","connected",async()=>{Ft.isConnected=!0,Ft.showDisconnectModal=!1,Ft.reason=""}),lt.subscribeToServiceEvent("messaging","disconnected",async({fatal:t,reason:e})=>{Ft.isConnected=!1,Ft.showDisconnectModal=t,Ft.reason=e}),await lt.init(),await lt.load(),await lt.start(),await this.workflowEditor.start(),omnilog.status_start("Appstate Init"),window.dispatchEvent(new Event("resize"))}})),Sa(et)});et.start();
