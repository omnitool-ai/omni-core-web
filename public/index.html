<!doctype html>
<html lang="en" class="h-screen">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/jpg" href="/favicon.jpg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

    <title>omnitool.ai</title>
    <style>
      [x-cloak] {
        display: none !important;
      }
    </style>
    <script type="module" crossorigin src="/assets/main-LZeZj8Yw.js"></script>
    <link rel="modulepreload" crossorigin href="/assets/Login--FBfI1vJ.js">
    <link rel="stylesheet" crossorigin href="/assets/Login-i8TdwbcP.css">
    <link rel="stylesheet" crossorigin href="/assets/main-0Th-co0X.css">
  </head>

  <body
    @keydown.window.prevent.stop.ctrl.shift.p="window.client.workbench.showExtension('omni-extension-commandbar', {})"
    @keydown.window.prevent.stop.ctrl.shift.f="window.client.workbench.activeExtension ? window.client.workbench.hideExtension() :  window.client.workbench.showExtension('omni-core-filemanager', {})"
    class="h-screen w-full overflow-hidden"
    x-data="auth"
    x-init="$watch('currentUser', value => {  if (!isLogin()) window.location.href='/login.html'; })">
    <div x-data="appState" class="w-screen h-screen" id="appState" x-cloak>
      <div class="flex h-full w-full items-center justify-center" x-show="isLogin() && !isTOS()" x-cloak>
         <!-- TOS -->
        <div class="TOScontainer" x-data="{ acceptEnabled: false, licenseText: '' }" x-init="fetch('TOS.txt')
                     .then(response => { 
                         if (!response.ok) { 
                             throw new Error('Network response was not ok' + response.statusText);
                         }
                         return response.text();
                     })
                     .then(data => { 
                         licenseText = data;
                     })
                     .catch((error) => { 
                         licenseText = 'Failed to load license text.';
                         console.error('Error:', error);
                     })">
            <h1 class="TOStitle">Terms of Service</h1>
            <div x-ref="licenseBox"
                @scroll="acceptEnabled = ($refs.licenseBox.scrollTop + $refs.licenseBox.clientHeight >= $refs.licenseBox.scrollHeight * 0.9);"
                class="TOSlicenseBox">
                <p x-text="licenseText">
                <!-- License text will be injected here -->
                </p>
            </div>
        
            <div class="TOSbuttonContainer">
                <button class="btn-large" :disabled="!acceptEnabled"
                    @click="onAcceptTOS()">Accept</button>
                <button class="btn-large" @click="window.location.href = 'https://www.omnitool.ai'">Decline</button>
            </div>
        </div>      </div>
      <div class="flex grow h-full" x-show="isLogin() && isTOS()" x-cloak>
         
        <div
          class="flex justify-center z-50"
          x-data="connectionState"
        >
          <!-- Modal -->
        
          <div
            class="fixed right-1 top-1 h-1 w-1 z-10"
            :class="{ 'bg-red-500' : !isConnected ,  'bg-green-500' : isConnected  } "
          >
          </div>
          <div
            x-show="showDisconnectModal"
            style="display: none"
            role="dialog"
            aria-modal="true"
            x-id="['modal-title']"
            :aria-labelledby="$id('modal-title')"
            class="fixed inset-0 z-20 overflow-y-auto"
          >
            <!-- Overlay -->
            <div
              x-show="showDisconnectModal"
              x-transition.opacity
              class="fixed inset-0 bg-black bg-opacity-50"
            ></div>
        
            <!-- Panel -->
            <div class="grid place-items-center h-full">
              <div
                x-show="showDisconnectModal"
                x-transition
                class="p-4 bg-neutral-100 rounded min-h-fit w-1/4 min-w-250 z-30 "
              >
                <h1 class="font-bold text-red-700 drop-shadow-sm bg-neutral-100 border-none text-center"> Your connection to the server was lost</h1>
                <samp
                  class="text-xs monospace text-gray-500 pt-4 line-clamp-5 px-2"
                  x-text='reason'
                > </samp>
                <p class="pt-4 text-md text-xs"> Omnitool currently does not support multiple browser tabs in the same session, please <a
                    class="text-blue-400 hover:text-blue-600 cursor-pointer"
                    href="javascript:window.location.reload()"
                  >click here</a> to reload the page if you want to continue in this tab. </p>
              </div>
            </div>
          </div>
        </div>
        <!-- Main Content -->
        <div x-data="{
                menuBarMenu: ''
            }" class='sidebar' @click.away="menuBarMenu=''" id='sidebar'>
          <div class='sidebarItem' @click="menuBarMenu=(menuBarMenu==='menu')?'':'menu'">
            <!-- Burger Menu -->
            <button x-tooltip='Menu'>
              <svg xmlns='http://www.w3.org/2000/svg' class="w-6 h-6" width='24' height='18' viewBox='0 0 24 18' fill='none' :class="
                {
                  'active': menuBarMenu==='menu',
                }">
                <path d='M1 17H23M1 9H23M1 1H23' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round' />
              </svg>
            </button>
          </div>
          <div x-show="menuBarMenu==='menu'" x-tooltip="About" class="sidebarItem sidebarItem-sub" x-transition
            @click="window.client.workbench.showExtension('omni-core-viewers', {url: '/README.md'}, 'markdown.html', {singletonHash:'HelpNotice'})">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" :class="{
                  'active': workbench.isSingletonActive('HelpNotice'),
                  'refreshTS': workbench.refreshTS,
                }">
              <path
                d="M12.6667 12.9567C12.6667 11.6969 11.7553 10.0725 10.3333 10.0725H5.66667C4.24467 10.0725 3.33333 11.6969 3.33333 12.9567M1 7.73914C1 3.87314 4.13401 0.739136 8 0.739136C11.866 0.739136 15 3.87314 15 7.73914C15 11.6052 11.866 14.7391 8 14.7391C4.13401 14.7391 1 11.6052 1 7.73914ZM10.3333 5.4058C10.3333 6.6945 9.2887 7.73914 8 7.73914C6.7113 7.73914 5.66667 6.6945 5.66667 5.4058C5.66667 4.11714 6.7113 3.07247 8 3.07247C9.2887 3.07247 10.3333 4.11714 10.3333 5.4058Z"
                stroke-width="1.5" />
            </svg>
            <span>About</span>
          </div>
          <div x-show="menuBarMenu==='menu'" x-tooltip="Third Party Notice" class="sidebarItem sidebarItem-sub" x-transition
            @click="window.client.workbench.showExtension('omni-core-viewers', {url: '/THIRD_PARTY.md'}, 'markdown.html', {singletonHash:'ThirdPartyNotice'})">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" :class="{
                  'active': workbench.isSingletonActive('ThirdPartyNotice'),
                  'refreshTS': workbench.refreshTS,
                }">
              <path
                d="M10.3333 0.739136V13.1836M10.3333 0.739136L5.66667 2.29469M10.3333 0.739136L15 2.29469V14.7391L10.3333 13.1836M10.3333 13.1836L5.66667 14.7391M5.66667 2.29469V14.7391M5.66667 2.29469L1 0.739136V13.1836L5.66667 14.7391"
                stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span class="justify-center align-center">Notice</span>
          </div>
          <div x-show="menuBarMenu==='menu'" x-tooltip="Quickstart Video" class="sidebarItem sidebarItem-sub" x-transition
            @click="window.client.workbench.showTutorial(false)">
            <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 26 26" fill="none" :class="{
                  'active': workbench.isSingletonActive('Quickstart'),
                  'refreshTS': workbench.refreshTS,
                }">
              <path
                d="M25 13C25 19.628 19.628 25 13 25C6.372 25 1 19.628 1 13C1 6.372 6.372 1 13 1C19.628 1 25 6.372 25 13ZM9.46 19.548V7.052L19.876 13.3L9.46 19.548Z"
                stroke="#F5F5F5" stroke-width="2" stroke-miterlimit="133.333" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span>Quickstart</span>
          </div>
        
          <div class="hidden">
            <div x-show="menuBarMenu==='menu'" @click="window.client.runScript('logout')" x-transition
              class="sidebarItem sidebarItem-sub" x-tooltip="Logout">
              <svg xmlns="http://www.w3.org/2000/svg" width="15" height="14" viewBox="0 0 15 14" fill="none">
                <path
                  d="M9.625 0.583374H12.25C13.2165 0.583374 14 1.36688 14 2.33337V11.6667C14 12.6332 13.2165 13.4167 12.25 13.4167H9.625M6.125 3.50004L2.625 7.00004M2.625 7.00004L6.125 10.5M2.625 7.00004H10.5"
                  stroke="#DEDEDF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              <span>Logout</span>
            </div>
          </div>
        
          <!-- End Burger Menu -->
        
          <div class='sidebarItem'
            @click="workbench.showExtension('omni-core-collectionmanager', {type:'api'}, undefined, {winbox: {title: 'API Management', modal: true}, singletonHash: 'omni-core-collectionmanager-api'})"
            x-tooltip='API Key Management'>
            <!-- API Management -->
            <button>
              <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 justify-center" width="25" height="25" viewBox="0 0 25 25" fill="none" :class="{
                  'active': workbench.isSingletonActive('omni-core-collectionmanager-api'),
                  'refreshTS': workbench.refreshTS,
                }">
                <path
                  d="M19.9411 5.05879L22.6469 7.76465L18.5881 11.8234L15.8823 9.11759M11.4061 13.5939L24 1M13.1764 17.9116C13.1764 21.2714 10.4504 23.9998 7.08655 23.9998C3.72596 23.9998 1 21.2714 1 17.9116C1 14.5519 3.72596 11.8234 7.08655 11.8234C10.4504 11.8234 13.1764 14.5519 13.1764 17.9116Z"
                  stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
            </button>
            <!-- End API Management -->
          </div>
        
          <div @click='workbench.showExtension("omni-core-filemanager")' class='sidebarItem'
            x-tooltip='File Manager (CTRL-SHIFT-F)'>
            <button>
              <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" width="28" height="26" viewBox="0 0 28 26" fill="none" :class="
                {
                  'active': workbench.isSingletonActive('omni-core-filemanager'),
                  'refreshTS': workbench.refreshTS,
                }">
                <path
                  d="M14.4907 3.2348H23.9778C25.6395 3.2348 26.9896 4.85769 26.9896 6.85509V11.9797M25.2241 8.09098H15.3371L14.5998 4.60177C14.0026 2.03636 12.694 1.19995 11.3907 1.19995H3.37308C2.0697 1.19995 1.01558 2.46705 1.01558 4.03376V9.7573C1.00519 9.84468 1 10.1321 1 10.2257V22.8652C1 24.0449 1.79449 25 2.77591 25H25.2241C26.2055 25 27 24.0449 27 22.8652V10.2257C27 9.05223 26.2055 8.09098 25.2241 8.09098Z"
                  stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
            </button>
          </div>
          <div class='sidebarItem'
            @click="workbench.showExtension('omni-core-collectionmanager', {type:'extension'}, undefined, {winbox: {title: 'Extensions', modal: false}, singletonHash: 'omni-core-collectionmanager-ext'})"
            x-tooltip='Extensions'>
            <!-- Extension -->
            <button>
              <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" width="26" height="26" viewBox="0 0 26 26" fill="none" :class="{
                  'active': workbench.isSingletonActive('omni-core-collectionmanager-ext'),
                  'refreshTS': workbench.refreshTS,
                }">
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M3.00155 6.58026H6.94142C8.04123 6.58026 8.93821 5.68778 8.93821 4.58345V2.99681C8.93821 1.89699 9.83068 1 10.935 1H12.4811C13.5809 1 14.4778 1.89248 14.4778 2.99681V4.58345C14.4778 5.68327 15.3703 6.58026 16.4746 6.58026H22.3877C23.4876 6.58026 24.3845 7.47274 24.3845 8.57708V10.5299C24.3845 11.6298 23.4921 12.5268 22.3877 12.5268H20.8011C19.7013 12.5268 18.8043 13.4192 18.8043 14.5236V16.1102C18.8043 17.21 19.6968 18.107 20.8011 18.107H22.3832C23.483 18.107 24.38 18.9995 24.38 20.1038V22.9034C24.38 23.0032 24.38 25 22.3832 25H16.4701C15.3703 25 14.4733 24.1075 14.4733 23.0032V22.4481C14.4733 21.3483 13.5809 19.4513 12.4765 19.4513H10.9305C9.83068 19.4513 8.9337 21.3438 8.9337 22.4481V22.9942C8.9337 24.094 8.04123 24.991 6.93691 24.991H2.99704C1.89722 24.991 1.00024 24.0985 1.00024 22.9942V8.57708C1.00926 7.47274 1.90173 6.58026 3.00155 6.58026Z"
                  stroke-width="1.5" stroke-miterlimit="133.333" />
              </svg>
            </button>
            <!-- End Extension -->
        
          </div>
          <div class='sidebarItem' @click='window.client.workbench.toggleDevTool()' x-tooltip='Developer Tool' x-show="window.client.extensions.has('omni-extension-log-viewer')"
          >
            <button>
              <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" width="37" height="22" viewBox="0 0 37 22" fill="none">
        <path d="M25.5 19L35.5 11L25.5 3M11 3L1 11L11 19M21 1L15 21" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
            </button>
          </div>
          <div class="sidebarItem" x-tooltip="Local APIs" @click="window.client.runScript('local', ['templates'])">
            <button>
              <svg class="w-6 h-6 stroke-white" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M15 11C15 12.6569 13.6569 14 12 14C10.3431 14 9 12.6569 9 11M20 7L18 3H6L4 7M20 7H4M20 7V18C20 19.1046 19.1046 20 18 20H6C4.89543 20 4 19.1046 4 18V7" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
              </svg>
            </button>
          </div>
        
          <!-- End menu Button -->
          <template x-for="(extension,idx) in window.client.extensions.all().filter(e=>!!e.pinned)" :key="idx">
        
            <div class="flex cursor-pointer justify-center">
              <span @click="window.client.workbench.showExtension(extension.id,{})">
                <img :src="'/extensions/'+extension.id+'/logo.png'" width="32px" height="32px" />
              </span>
            </div>
          </template>
        
        
        
          <div class='flex-grow'> </div>
          <div class='sidebarItem' x-tooltip='Toggle Chat' @click='uiSettings.toggleMinimized()'>
            <button>
              <!-- Chat  -->
              <svg xmlns="http://www.w3.org/2000/svg" width="27" height="27" viewBox="0 0 27 27" fill="none" :class="
                {
                  'active': !uiSettings.chatMinimized,
                }">
                <path d="M5.6875 25.1463V17.5H1V1H26V17.5H13.5L5.6875 25.1463Z" stroke-width="2" stroke-linecap="round"
                  stroke-linejoin="round" />
              </svg>
            </button>
          </div>
        
          <div class='sidebarItem' x-tooltip='Discord Community'>
            <a href="https://tinyurl.com/omnitool-discord" target="_blank">
              <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 127.14 96.36">
                <path fill="white"
                  d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.7,77.7,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22h0C129.24,52.84,122.09,29.11,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z" />
              </svg>
            </a>
          </div>
          <div class='-rotate-90 origin-left whitespace-nowrap fixed left-5 bottom-20 items-center' 
            x-data="{version: ''}"
            x-init="version = await (await fetch('/version')).text()"
          >
            <span class="text-2xl text-gray-400">OMNITOOL&nbsp;</span>
            <span class="text-md text-gray-300" x-text="version"></span>
            <span class="text-md text-gray-300">&nbsp;(EARLY ACCESS)</span>
          </div>
        
        </div>        <div
          id="app"
          class="flex h-full w-full gap-0.5"
          x-show="!showAdmin && !showUsers"
          :class="{'flex-row': uiSettings.chatSide === 'left',
          'flex-row-reverse': uiSettings.chatSide === 'right',

        }"
          x-cloak>
          <div
            id="chat"
            class="chatContainer"
            x-show="!uiSettings.chatMinimized"
            x-data="chatComponent(workbench)"
            x-cloak
            :class="{'chat-right' : uiSettings.chatSide === 'right',
            'chat-left' : uiSettings.chatSide === 'left'}">
            <!-- Mercenary selection bar -->
            <div class="chatTabBar" x-show="uiSettings.tabBarStyle == 'tabs'">
              <div class="chatTabContent" x-text="workbench.displayName" :class="{
                  'justify-right': uiSettings.chatSide == 'left' ,
                  'justify-left': uiSettings.chatSide == 'right'
                }">
              </div>
              <div class="chatTabCommand">
                <div @click="uiSettings.toggleMinimized()" class="cursor-pointer rounded hover:text-gray-700" x-tooltip="Minimize">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="2" viewBox="0 0 14 2" fill="none">
            <path d="M12.6667 1H1.79175" stroke="white" stroke-width="2" stroke-linecap="round"/>
            </svg>
                </div>
                <div x-show="uiSettings.chatSide === 'right' " @click="uiSettings.toggleSide()"
                  class="cursor-pointer rounded  hover:text-gray-700">
                  <svg class="h-4 fill-white" xmlns="http://www.w3.org/2000/svg" id="Outline" viewBox="0 0 24 24">
                    <path stroke-width="2" stroke-linecap="round"
                      d="M17.17,24a1,1,0,0,1-.71-.29L8.29,15.54a5,5,0,0,1,0-7.08L16.46.29a1,1,0,1,1,1.42,1.42L9.71,9.88a3,3,0,0,0,0,4.24l8.17,8.17a1,1,0,0,1,0,1.42A1,1,0,0,1,17.17,24Z" />
                  </svg>
                </div>
                <div x-show=" uiSettings.chatSide === 'left' " @click="uiSettings.toggleSide()"
                  class="cursor-pointer rounded  hover:text-gray-700">
                  <svg class="h-4 fill-white" xmlns="http://www.w3.org/2000/svg" id="Outline" viewBox="0 0 24 24">
                    <path stroke-width="2" stroke-linecap="round"
                      d="M7,24a1,1,0,0,1-.71-.29,1,1,0,0,1,0-1.42l8.17-8.17a3,3,0,0,0,0-4.24L6.29,1.71A1,1,0,0,1,7.71.29l8.17,8.17a5,5,0,0,1,0,7.08L7.71,23.71A1,1,0,0,1,7,24Z" />
                  </svg>
                </div>
            
              </div>
            </div>            <!-- Right panel content -->
            <!--div class="bg-slate-800 text-white font-semibold drop-shadow-sm p-1 text-center">Chat</div -->
            <div
              x-data="inputUtils" x-intersect="scrollBottom($el)" x-init="$watch('state.messages', value => scrollBottom($el))" x-ref="chatWindow"
              class="chatWindow"
              @dragover.prevent="chatDragOver"
              @dragleave.prevent="chatDragLeave"
            >
              <template x-for="(message, index) in state.messages" :key="index">
                <div
                  x-data="{hover: false, editing: false, fromMe: message.sender === 'me', messageContent: (message.text || message.html || '') }"
                  @mouseenter="hover = true" @mouseleave="hover = false" class="flex flex-wrap select-none justify-end">
                  <div class="chatMessage markdown-body" :class="{'mine': fromMe,}">
                    <!-- header -->
                    <div class="chatMessageHeader">
                      <span x-text="message.sender"></span>
                      <span x-show="hover">
                        <div x-tooltip='Copy' x-show="!editing" x-data="{copyNotification: false}">
                          <button @click="onClickCopy(message);" class="flex items-center justify-center text-xs rounded-md cursor-pointer focus:outline-none hover:animate-pulse group">
                              <svg x-show="!copyNotification" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="black" class=""><path stroke="black"  stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" /></svg>                  
                              <svg x-show="copyNotification" class=" stroke-green" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" x-cloak><path stroke="black"  stroke-linecap="round" stroke-linejoin="round" d="M11.35 3.836c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m8.9-4.414c.376.023.75.05 1.124.08 1.131.094 1.976 1.057 1.976 2.192V16.5A2.25 2.25 0 0118 18.75h-2.25m-7.5-10.5H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V18.75m-7.5-10.5h6.375c.621 0 1.125.504 1.125 1.125v9.375m-8.25-3l1.5 1.5 3-3.75" /></svg>
                          </button>
                      </div>
                        <svg x-show="!editing && fromMe" x-tooltip='Edit' @click="editing=true" viewBox="0 0 24 24" fill="none"
                          stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                        </svg>
                        <svg x-show="editing && fromMe" x-tooltip='Accept' @click="alert('not implemented yet')" viewBox="0 0 24 24"
                          fill="none" stroke="darkgreen" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                          <polyline points="9 11 12 14 22 4" />
                          <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
                          <polyline points="9 11 12 14 22 4" />
                          <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
                        </svg>
                        <svg x-show="editing && fromMe" x-tooltip='Cancel' @click="editing=false;" viewBox="0 0 24 24" fill="none"
                          stroke="maroon" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                          <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                          <line x1="9" y1="9" x2="15" y2="15" />
                          <line x1="15" y1="9" x2="9" y2="15" />
                        </svg>
                        <svg x-show="fromMe" x-tooltip='Resend' @click="resendMessage(message)" viewBox="0 0 24 24" fill="none"
                          stroke="darkgreen" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                          <polyline points="17 1 21 5 17 9" />
                          <path d="M3 11V9a4 4 0 0 1 4-4h14" />
                          <polyline points="7 23 3 19 7 15" />
                          <path d="M21 13v2a4 4 0 0 1-4 4H3" />
                        </svg>
                      </span>
                    </div>
                    <!-- main text -->
                    <div>
                      <div class=" pr-1  w-10  cursor-pointer  flex grow-0 items-center">
                        <img class="h-10  w-full rounded border-yellow-300 border-1  object-cover object-center"
                          :src='message.sender + ".png"' x-show="(message.flags?.has && message.flags?.has('picture'))" alt=""
                          @load="scrollBottom($refs.chatWindow)" />
                      </div>
                      <div x-html="messageContent" class="select-text break-words" :contenteditable="editing" :class="
                      {
                        'border-2 border-green-700 bg-gray-200': editing,
              
                      }"></div>
                    </div>
                    <!-- attachments -->
                    <div class="chatMessageAttachment" x-show="message.attachments" :class="{
                        'border-t-2': messageContent.length
                    }">
              
                      <template x-if="message.images?.length >= 1" >
                        <template x-for="(image, idx) in message.images" :key="idx">
                          <div class="p-0 m-0 " :class="{
                              'justify-left': !fromMe,
                              'justify-right': fromMe,
                          }">
                            <div style="max-width: 128px; max-height:128px" class="shadow-lg">
                              <img class=" cursor-pointer object-contain object-center" :src="image.url + '?width=128px'"
                                alt="image.url" @load="scrollBottom($refs.chatWindow)" @click="showViewerExtension(image)">
                            </div>
                          </div>
                        </template>
                      </template>
              
                      <template x-if="message.videos?.length >= 1">
                        <div style="max-width: 256px; max-height:256px" class="shadow-lg">
                          <video controls>
                            <template x-for="(video, idx) in message.videos" :key="idx">
                              <source :src="video.url" x-type="video.mimeType" />
                            </template>
                            <p>
                              Your browser doesn't support HTML video. Here is a
                              <a :href="video.url">link to the video</a> instead.
                            </p>
                          </video>
                        </div>
                      </template>
              
                      <template x-if="message.documents">
                        <div class="w-full">
                          <template x-for="(doc,idx) in message.documents" :key="idx">
                            <div>
              
                              <span @click="showViewerExtension(doc)" x-text="doc.fileName"
                                class="font-mono font-semibold cursor-pointer" x-tooltip="View Document"></span>
              
                              <button @click="showViewerExtension(doc)" class="h-10 w-10 mr-1" x-tooltip="View Document">
                                <span>
                                  📄
                                </span>
                                <a :href="doc.url + '?download=1'" target="_blank" rel="noopener noreferrer" class="px-1"
                                  x-tooltip="Download Document">↓</a>
                                </a>
                              </button>
                            </div>
                          </template>
                        </div>
                      </template>
                      <template x-if="message.object">
                        <div
                          class="flex-wrap overflow-y-auto  font-mono whitespace-break-spaces select-text text-xs  border-slate-600 bg-neutral-300 p-2 w-full z-1 text-left ">
                          <div x-html="JSON.stringify(message.object||[], null, 2)"></div>
                        </div>
                      </template>
                      <template x-if="message.audio && message.audio.length > 0">
                        <div x-data="audioPlayer" x-init="setPlaylist(message.audio)"
                          class="flex w-full flex-col">
                          <template x-for="(track, index) in playlist" :key="index">
                            <div class="flex w-full mt-1 items-center justify-center gap-1">
                            <audio controls name="media" preload="auto" class="w-full rounded-lg " >
                              <source :src="track.url + '?download=1'" type="audio/mpeg">
                            </audio>
                            <button @click="showViewerExtension(track)" class="h-5 w-5" x-tooltip="Open in File Manager">
                              <span>
                                📁
                              </span>
                            </button>
                            </div>
                          </template>
                        </div>
                      </template>
                      <template x-if="message.files && message.files.length > 0">
                        <div class="w-full">
                          <template x-for="(file,idx) in message.files" :key="idx">
                            <div>
              
                              <span @click="showViewerExtension(file)" x-text="file.fileName"
                                class="font-mono font-semibold cursor-pointer" x-tooltip="View File"></span>
              
                              <button @click="showViewerExtension(file)" class="h-10 w-10 mr-1">
                                <a :href="file.url + '?download=1'" target="_blank" rel="noopener noreferrer" class="px-1"
                                  x-tooltip="Download File">↓</a>
                                </a>
                              </button>
                            </div>
                          </template>
                        </div>
                      </template>
                      <div class="w-full  text-right mt-0.5 bg-gradient-to-b from-gray-100 to-gray-50">
                        <template x-for="(command, idx) in message.commands || []" :key="idx">
                          <button class="btn btn-command2" style="min-width: 100px;" :class="command.classes"
                            x-show="command.show?.(command.ctx) ?? true"
                            x-on:click="window.client.runScript(command.id, command.args)" x-text="command.title">
                          </button>
                        </template>
                      </div>
                    </div>
                  </div>
                </div>
              </template>
              <div x-show="loadCameraModal" class="text-center text-gray-500 text-sm">
                Loading Camera...
              </div>
              <div x-show="openCameraModal" class="modal">
                <video id="video" width="500" height="400" autoplay x-show="streaming"></video>
                <canvas id="canvas" width="512" height="512" x-show="!streaming"></canvas>
                <button @click="takePhoto" class="btn btn-command2">Take&nbsp;Photo</button>
                <button @click="stopCamera" class="btn btn-delete">Cancel</button>
              </div>
            
            </div>
            
            <div
              class="chatWindowInput"
              @dragover.prevent="chatDragOver"
              @dragleave.prevent="chatDragLeave"
              :disabled="!connectionState.isConnected"
              @paste.stop="chatHandlePaste"
            >
            
            
              <textarea
                x-model="state.inputText"
                :disabled="!connectionState.isConnected"
                id="chatInput"
                @compositionstart="handleCompositionStart"
                @compositionend="handleCompositionEnd"
                @keydown.enter="chatEnterKeydown($event);"
                x-data="inputUtils"
                x-init="textareaAutoResize($el)"
                @input="textareaAutoResize($el)"
                @change="state.inputText = state.inputText.trim();"
                class="flex-auto mr-2 p-1.5 min-h-8 border border-gray-300 rounded text-black text-xs resize-none overflow-y-auto"
                placeholder="Send a message..."
                rows="1"
              ></textarea>
            <div class="relative group select-none" x-show="workbench.nicknames">
              <button
                class="btn-icon-dark"
            
              >
                <svg viewBox="0 0 24 24" class="w-5 h-5" stroke="currentColor" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 9H15M9 9V15M9 9V6C9 4.34315 7.65685 3 6 3C4.34315 3 3 4.34315 3 6C3 7.65685 4.34315 9 6 9H9ZM15 9V15M15 9H18C19.6569 9 21 7.65685 21 6C21 4.34315 19.6569 3 18 3C16.3431 3 15 4.34315 15 6V9ZM15 15H9M15 15V18C15 19.6569 16.3431 21 18 21C19.6569 21 21 19.6569 21 18C21 16.3431 19.6569 15 18 15H15ZM9 15L6 15C4.34315 15 3 16.3431 3 18C3 19.6569 4.34315 21 6 21C7.65685 21 9 19.6569 9 18V15Z" stroke-width="1.5"></path></svg>
                </button>
                <div class="chatCommandMenu">
                  <template x-for="(id, nickname) in workbench.nicknames">
                    <div class="chatCommandItem nickname" @click="state.inputText='@'+nickname " >
                      <span  x-text="'@'+nickname"></span>
                    </div>
                  </template>
            
                <template x-for="(commandTitle, commandId) in {'help': 'Show Commands', 'clear': 'Clear Chat'}" :key="commandId">
                  <div class="chatCommandItem" @click="window.client.runScript(commandId,[])" >
                    <div x-text="commandTitle"></div>
                  </div>
                </template>
              </div>
            </div>
            
              <button
                x-show="state.recognitionAvailable"
                class="btn-icon-dark"
                @mousedown="startMicrophoneInput"
                @mouseup="stopMicrophoneInput"
                @mouseleave="stopMicrophoneInput"
                :class="{'px-4': state.recognitionRecording }"
                x-tooltip="Hold down for Speech-to-Text"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  class="w-5 h-5"
                >
                  <path
                    fill="currentColor"
                    d="M11.999 14.942c2.001 0 3.531-1.53 3.531-3.531V4.35c0-2.001-1.53-3.531-3.531-3.531S8.469 2.35 8.469 4.35v7.061c0 2.001 1.53 3.531 3.53 3.531zm6.238-3.53c0 3.531-2.942 6.002-6.237 6.002s-6.237-2.471-6.237-6.002H3.761c0 4.001 3.178 7.297 7.061 7.885v3.884h2.354v-3.884c3.884-.588 7.061-3.884 7.061-7.885h-2z"
                  >
                  </path>
                </svg>
              </button>
            
              <button @click="startCamera()" class="btn-icon-dark" x-tooltip="Take Photo">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                  stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                  <circle cx="12" cy="13" r="4"></circle>
                </svg>
              </button>
            
              <label class="btn-icon-dark" x-tooltip="Upload File">
                <input
                  style="display:none"
                  type="file"
                  accept="image/*,audio/*,application/*,text/*"
                  multiple
                  @change="onUploadFileChange($event)"
                >
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"
                  >
                  </path>
                </svg>
              </label>
            </div>
            
          </div>
          <!--div
            class="ui-primary-bg h-full overflow-hidden flex -mx-0.5 gap-0 m-0 flex-col w-4 rounded-r-md"
            x-show="isLogin()"
          ></div-->
          
          <div class="h-full w-full flex-grow-0 gap-0.5" x-show="!hideEditor.isMobile">
            <div x-data="{
                    bannerVisible: true,
                    bannerVisibleAfter: 300,
                    bannerTitle: '',
                    bannerDescription: '',
                    linkTitle: ' here',
                    link: ''
                }" @top-banner-show.window="
                    bannerTitle = event.detail.bannerTitle
                    bannerDescription = event.detail.bannerDescription
                    link = event.detail.link
                    setTimeout(()=>{ bannerVisible = true }, bannerVisibleAfter)
                "
                x-show="bannerVisible === true && bannerTitle !== '' && bannerDescription !== ''"
                x-transition:enter="transition ease-out duration-500"
                x-transition:enter-start="-translate-y-10"
                x-transition:enter-end="translate-y-0"
                x-transition:leave="transition ease-in duration-300"
                x-transition:leave-start="translate-y-0"
                x-transition:leave-end="-translate-y-10"
                class="fixed top-0 left-0 w-full h-auto py-2 duration-300 ease-out bg-yellow-200 shadow-sm sm:py-0 sm:h-10 z-50" x-cloak>
                <div class="flex items-center justify-between w-full h-full px-3 mx-auto ">
                    <div class="flex flex-col w-full h-full text-xs leading-6 text-black duration-150 ease-out sm:flex-row sm:items-center opacity-80 hover:opacity-100">
                        <span class="flex items-center">
                            <svg class="w-[18px] h-[18px] mr-1.5 -ml-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM12 9C12.5523 9 13 8.55228 13 8C13 7.44772 12.5523 7 12 7C11.4477 7 11 7.44772 11 8C11 8.55228 11.4477 9 12 9ZM13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12V16C11 16.5523 11.4477 17 12 17C12.5523 17 13 16.5523 13 16V12Z" fill="currentColor"></path>
                          </svg>
                            
                            <span class="font-semibold text-black" x-text="bannerTitle"></span><span class="hidden w-px h-4 mx-3 rounded-full sm:block bg-neutral-200"></span>
                        </span>
                        <span class="block pt-1 pb-2 leading-none sm:inline sm:pt-0 sm:pb-0 text-black" x-text="bannerDescription"></span>
                        <button @click="bannerVisible=false" class="flex items-center flex-shrink-0 translate-x-1 ease-out duration-150 justify-center w-6 h-6 p-1.5 text-black rounded-full hover:bg-neutral-100">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-full h-full"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                        <!--<a :href="link" target="_blank"><span class="block pt-1 pb-2 leading-none sm:inline sm:pt-0 sm:pb-0 text-red"></span></a>-->
                    </div>
                </div>
            </div>            <!-- Workflow Editor -->
            <div
              class="relative flex h-full w-full"
              id="editor"
              x-ref="editor"
              x-show="isLogin()"
              x-cloak
              x-data="workflowEditor"
              @paste.stop="handlePaste($event)"
              @dragover.prevent="wfDragOver"
              @drop.prevent="wfDrop"
              @dragleave.prevent="wfDragLeave"
              :class="{
            
            
                }"
            >
            <div class="tutorial">
            <div class="drop-shadow-lg" x-show="!workbench.canExecute" x-cloak>
                Let's get started by creating a new recipe or loading a recipe from the 'Assets' menu.
            </div>
            <div x-show="workbench.isLoading" x-cloak>
                Loading...
            </div>
            </div>  <!--
                Without the empty image which follows, onpaste() never gets called.
              -->
              <img style="position:absolute" />
              <!--    See 6c08c2c4b36033e4c3df2ba2cadf60d48c3f6054 -->
            
            
            </div>            <div class="editorTopMenuContainer" @keydown.window.prevent.stop.ctrl.b="workbench.canEdit ? workbench.showExtension('omni-core-collectionmanager', {type:'block'}, undefined, {winbox: {title: 'Add Blocks'}}) : null"
                @keydown.window.prevent.stop.ctrl.k="workbench.newRecipe()"
                @keydown.window.prevent.stop.ctrl.r="workbench.showExtension('omni-core-collectionmanager', {type:'recipe'}, undefined, {winbox: {title: 'Load Recipe'}})"
                @keydown.window.prevent.stop.ctrl.shift.d="workbench.toggleDevTool()">
                <nav x-data="{
                    navigationMenuOpen: false,
                    navigationMenu: '',
                    navigationMenuCloseDelay: 200,
                    navigationMenuCloseTimeout: null,
                    navigationMenuLeave() {
                        let that = this;
                        this.navigationMenuCloseTimeout = setTimeout(() => {
                            that.navigationMenuClose();
                        }, this.navigationMenuCloseDelay);
                    },
                    navigationMenuReposition(navElement) {
                        this.navigationMenuClearCloseTimeout();
                        this.$refs.navigationDropdown.style.left = navElement.offsetLeft + 'px';
                        this.$refs.navigationDropdown.style.marginLeft = (navElement.offsetWidth/2) + 'px';
                    },
                    navigationMenuClearCloseTimeout(){
                        clearTimeout(this.navigationMenuCloseTimeout);
                    },
                    navigationMenuClose(){
                        this.navigationMenuOpen = false;
                        this.navigationMenu = '';
                    }
                }" class="relative z-50 w-auto">
                    <div class="editorTopMenu z-50" x-data="{
                        isFavorite: workbench.isFavorite,
                        toggleFavorite() {
                            let key = 'fav-recipe' + workbench.activeRecipeId;
                            window.client.runScript('toggleFavorite', [key])
                            this.isFavorite = !this.isFavorite;
                        }}" x-effect="isFavorite = workbench.isFavorite">
                        <!-- Run Button -->
                        <button x-tooltip="Run Recipe" :disabled="!workbench.canExecute"
                            x-show="workbench.canExecute && !workbench.isRunningActiveWorkflow()"
                            @click="workbench.canExecute ? workbench.execute() : null">
                            <svg xmlns="http://www.w3.org/2000/svg" width="19" height="22" viewBox="0 0 19 22" fill="none">
                                <path
                                    d="M17.3442 9.22382C18.6904 10.0253 18.6904 11.9747 17.3442 12.7762L3.2973 21.1396C1.91939 21.96 0.172634 20.9671 0.172634 19.3634V2.63657C0.172634 1.03292 1.91939 0.0400064 3.29731 0.860407L17.3442 9.22382Z"
                                    fill="#67BE61" />
                            </svg>
                        </button>
                        <!-- Stop Button -->
                        <button x-show="workbench.isRunningActiveWorkflow()" @click="window.client.runScript('stop')"
                            x-tooltip="Stop">
                            <svg class="fill-red-500" width="20" height="20" viewBox="0 0 20 20" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <rect x="0" y="0" width="20" height="20" stroke-width="1.5" stroke-linecap="round"
                                    stroke-linejoin="round"></rect>
                            </svg>
                        </button>
            
                        <div class="editorTopMenuItem">
                            <button @mouseover="navigationMenuOpen=true; navigationMenuReposition($el); navigationMenu='assets'"
                                @mouseleave="navigationMenuLeave()" class="transition-colors group">
                                <svg xmlns="http://www.w3.org/2000/svg" width="17" height="16" viewBox="0 0 17 16" fill="none">
                                    <path d="M8.32739 3V13M3.32739 8H13.3274" stroke="white" stroke-width="1.6"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                <span>Assets</span>
                                <svg :class="{ '-rotate-180' : navigationMenuOpen==true && navigationMenu == 'assets' }"
                                    class="relative top-[1px] ml-1 h-3 w-3 ease-out duration-300" xmlns="http://www.w3.org/2000/svg"
                                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" aria-hidden="true">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                        </div>
                        <div class="editorTopMenuItem">
                            <button @mouseover="navigationMenuOpen=true; navigationMenuReposition($el); navigationMenu='save'"
                                @mouseleave="navigationMenuLeave()" class="transition-colors group">
                                <svg xmlns="http://www.w3.org/2000/svg" width="17" height="16" viewBox="0 0 17 16" fill="none">
                                    <path
                                        d="M11.3373 15.36V10.76H5.81728V15.36M14.0973 15.36H3.05729C2.04108 15.36 1.21729 14.5362 1.21729 13.52V2.48001C1.21729 1.46381 2.04108 0.640015 3.05729 0.640015H10.5752C11.0631 0.640015 11.5311 0.833868 11.8762 1.17894L15.3983 4.70109C15.7434 5.04616 15.9373 5.51417 15.9373 6.00217V13.52C15.9373 14.5362 15.1135 15.36 14.0973 15.36Z"
                                        stroke="white" stroke-width="1.28" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                <span>Save</span>
                                <svg :class="{ '-rotate-180' : navigationMenuOpen==true && navigationMenu == 'save' }"
                                    class="relative top-[1px] ml-1 h-3 w-3 ease-out duration-300" xmlns="http://www.w3.org/2000/svg"
                                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" aria-hidden="true">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                        </div>
            
                        <!-- Explain Button -->
                        <button x-show="workbench.canExecute" x-tooltip="Explain This Recipe"
                            @click="window.client.runScript('explain')">
                            <svg width="23" height="22" viewBox="0 0 23 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <g clip-path="url(#clip0_986_3320)">
                                    <path
                                        d="M11.6546 16.6411V16.6331M11.6546 14.2234C11.6546 10.5972 15.0392 11.4029 15.0392 8.58245C15.0392 6.8022 13.5238 5.35901 11.6546 5.35901C10.1391 5.35901 8.85619 6.30764 8.4249 7.61542M21.8084 11C21.8084 16.6079 17.2624 21.1539 11.6546 21.1539C6.04677 21.1539 1.50073 16.6079 1.50073 11C1.50073 5.39223 6.04677 0.846191 11.6546 0.846191C17.2624 0.846191 21.8084 5.39223 21.8084 11Z"
                                        stroke="white" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" />
                                </g>
                                <defs>
                                    <clipPath id="clip0_986_3320">
                                        <rect width="22" height="22" fill="white" transform="translate(0.654785)" />
                                    </clipPath>
                                </defs>
                            </svg>
                        </button>
                        <!-- Add to favorite -->
                        <button x-show="workbench.canFavorite" x-tooltip="Favorite This Recipe"
                            @click="toggleFavorite()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="17" height="15" viewBox="0 0 17 15" fill="none">
                                        <path :class="{
                                                  'fill-red-600 stroke-white': isFavorite,
                                                  'stroke-white': !isFavorite
                                                }"
                                          d="M2.1095 7.70617L8.5 14.3333L14.8905 7.70617C15.6009 6.96942 16 5.97024 16 4.92838C16 2.75879 14.304 1 12.2119 1C11.2073 1 10.2437 1.41388 9.53333 2.15059L8.5 3.22222L7.46667 2.15059C6.75624 1.41388 5.79273 1 4.78807 1C2.69597 1 1 2.75879 1 4.92838C1 5.97024 1.3991 6.96942 2.1095 7.70617Z"
                                          stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" />
                                      </svg>
                        </button>
                    </div>
                    <div x-ref="navigationDropdown" x-show="navigationMenuOpen"
                        x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0 scale-90"
                        x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-100"
                        x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-90"
                        @mouseover="navigationMenuClearCloseTimeout()" @mouseleave="navigationMenuLeave()"
                        class="absolute top-0 duration-200 ease-out -translate-x-1/2 translate-y-11" x-cloak>
                        <div class="editorTopMenuDropdown" x-show="navigationMenu == 'assets'">
                            <div class="editorTopMenuDropdownItem"
                                @click="navigationMenuClose(); workbench.canEdit ? workbench.showExtension('omni-core-collectionmanager', {type:'block'}, undefined, {winbox: {title: 'Add Blocks'}}) : null">
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="17" height="18" viewBox="0 0 17 18" fill="none">
                                        <path
                                            d="M13.5683 7.55356L13.5683 3.52977C13.5683 2.13263 12.4429 1.00002 11.0547 1.00001L3.51373 1C2.12547 0.999997 1.00006 2.13261 1.00006 3.52975L1 10.9107C0.999997 12.3078 2.1254 13.4405 3.51366 13.4405H7.71039M10.8033 13.4405H13.5683M13.5683 13.4405H16.3333M13.5683 13.4405V10.6577M13.5683 13.4405V16.7291"
                                            stroke="white" stroke-width="1.28" stroke-linecap="round" />
                                    </svg>
                                    <span :class="workbench.canEdit ? '' : 'unavailable text-left'">Add Blocks</span>
                                </div>
                                <span class="shortcut text-right">Ctrl+B</span>
                            </div>
                            <div class="editorTopMenuDropdownItem" @click="navigationMenuClose();workbench.newRecipe()">
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="17" viewBox="0 0 14 17" fill="none">
                                        <path
                                            d="M7.52368 0.666626H0.666504V16H12.6666V5.77776M7.52368 0.666626H8.38082L12.6666 4.9259V5.77776M7.52368 0.666626V4.07405C7.52368 4.9259 8.38082 5.77776 9.23797 5.77776H12.6666"
                                            stroke="white" stroke-width="1.28" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                    <span class="text-left">New Recipe</span>
                                </div>
                                <span class="shortcut text-right">Ctrl+K</span>
                            </div>
                            <div class="editorTopMenuDropdownItem"
                                @click="navigationMenuClose(); workbench.showExtension('omni-core-collectionmanager', {type:'recipe'},undefined, {winbox: {modal: true, title: 'Load Recipe'}})">
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="18" viewBox="0 0 14 18" fill="none">
                                        <path
                                            d="M6.14545 5.61956V9.86502C6.14811 10.0538 6.25713 10.2372 6.42465 10.3236C6.58951 10.4099 6.80223 10.3964 6.95645 10.2885L8.37635 9.27702L9.79626 10.2885C9.94782 10.3964 10.1605 10.4099 10.3281 10.3236C10.4929 10.2372 10.6046 10.0538 10.6072 9.86502V5.61956M12.3728 1.07739H3.05806C1.93863 1.07739 1 2.02952 1 3.16506V14.9866C1 15.9415 1.77377 16.7264 2.71505 16.7264H12.3728C12.6414 16.7264 12.886 16.4782 12.886 16.2058V5.61956H2.9065C2.9065 5.61956 0.936184 5.37141 1.05584 3.11921C1.15688 1.22574 3.05806 1.08009 3.05806 1.08009M11.8251 1.07739C11.8251 1.07739 10.7296 1.99985 10.7296 3.21092C10.7296 4.42198 11.8251 5.34444 11.8251 5.34444"
                                            stroke="white" stroke-width="1.28" stroke-miterlimit="133.333" stroke-linecap="round"
                                            stroke-linejoin="round" />
                                    </svg>
                                    <span class="text-left">Load Recipe</span>
                                </div>
                                <span class="shortcut text-right">Ctrl+R</span>
                            </div>
                            <label class="editorTopMenuDropdownItem">
                                <input
                                style="display:none"
                                type="file"
                                @change="navigationMenuClose(); workbench.onLoadRecipeFromFileChange($event)"
                                >
                                    <div class="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="18" viewBox="0 0 14 18" fill="none">
                                            <path
                                                d="M6.14545 5.61956V9.86502C6.14811 10.0538 6.25713 10.2372 6.42465 10.3236C6.58951 10.4099 6.80223 10.3964 6.95645 10.2885L8.37635 9.27702L9.79626 10.2885C9.94782 10.3964 10.1605 10.4099 10.3281 10.3236C10.4929 10.2372 10.6046 10.0538 10.6072 9.86502V5.61956M12.3728 1.07739H3.05806C1.93863 1.07739 1 2.02952 1 3.16506V14.9866C1 15.9415 1.77377 16.7264 2.71505 16.7264H12.3728C12.6414 16.7264 12.886 16.4782 12.886 16.2058V5.61956H2.9065C2.9065 5.61956 0.936184 5.37141 1.05584 3.11921C1.15688 1.22574 3.05806 1.08009 3.05806 1.08009M11.8251 1.07739C11.8251 1.07739 10.7296 1.99985 10.7296 3.21092C10.7296 4.42198 11.8251 5.34444 11.8251 5.34444"
                                                stroke="white" stroke-width="1.28" stroke-miterlimit="133.333" stroke-linecap="round"
                                                stroke-linejoin="round" />
                                        </svg>
                                        <span class="text-left">Load Recipe From File</span>
                                    </div>
                                </input>
                            </label>
                        </div>
                        <div class="editorTopMenuDropdown" x-show="navigationMenu == 'save'">
                            <div class="editorTopMenuDropdownItem"
                                @click="navigationMenuClose(); workbench.forceSave()">
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="none"
                                        :class="workbench.canSave ? '' : 'unavailable'">
                                        <path
                                            d="M10.7599 15.36V10.76H5.23989V15.36M13.5199 15.36H2.47989C1.46369 15.36 0.639893 14.5362 0.639893 13.52V2.48001C0.639893 1.46381 1.46369 0.640015 2.47989 0.640015H9.99776C10.4857 0.640015 10.9537 0.833868 11.2988 1.17894L14.821 4.70109C15.166 5.04616 15.3599 5.51417 15.3599 6.00217V13.52C15.3599 14.5362 14.5361 15.36 13.5199 15.36Z"
                                            stroke="white" stroke-width="1.28" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                    <span :class="'text-left' + (workbench.canSave ? '' : ' unavailable')">
                                        Save
                                    </span>
                                </div>
                                <span class="shortcut text-right">Ctrl+S</span>
                            </div>
                            <div class="editorTopMenuDropdownItem"
                                @click="navigationMenuClose(); workbench.saveAs()">
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="none"
                                        :class="workbench.canSaveAs ? '' : 'unavailable'">
                                        <path
                                            d="M10.1199 15.36C10.1199 15.7135 10.4064 16 10.7599 16C11.1134 16 11.3999 15.7135 11.3999 15.36H10.1199ZM10.7599 10.76H11.3999C11.3999 10.4066 11.1134 10.12 10.7599 10.12V10.76ZM5.23989 10.76V10.12C4.88643 10.12 4.59989 10.4066 4.59989 10.76H5.23989ZM4.59989 15.36C4.59989 15.7135 4.88643 16 5.23989 16C5.59335 16 5.87989 15.7135 5.87989 15.36H4.59989ZM11.2988 1.17894L11.7514 0.726395L11.7514 0.726381L11.2988 1.17894ZM14.821 4.70109L14.3684 5.15363L14.3684 5.15365L14.821 4.70109ZM3.28949 4.41587C2.93603 4.41587 2.64949 4.70241 2.64949 5.05587C2.64949 5.40933 2.93603 5.69587 3.28949 5.69587V4.41587ZM6.82229 5.69587C7.17575 5.69587 7.46229 5.40933 7.46229 5.05587C7.46229 4.70241 7.17575 4.41587 6.82229 4.41587V5.69587ZM5.79403 3.28947C5.79403 2.93601 5.50749 2.64947 5.15403 2.64947C4.80056 2.64947 4.51403 2.93601 4.51403 3.28947H5.79403ZM4.51403 6.82227C4.51403 7.17573 4.80056 7.46227 5.15403 7.46227C5.50749 7.46227 5.79403 7.17573 5.79403 6.82227H4.51403ZM11.3999 15.36V10.76H10.1199V15.36H11.3999ZM10.7599 10.12H5.23989V11.4H10.7599V10.12ZM4.59989 10.76V15.36H5.87989V10.76H4.59989ZM13.5199 14.72H2.47989V16H13.5199V14.72ZM2.47989 14.72C1.81714 14.72 1.27989 14.1828 1.27989 13.52H-0.000107408C-0.000107408 14.8897 1.11023 16 2.47989 16V14.72ZM1.27989 13.52V2.48001H-0.000107408V13.52H1.27989ZM1.27989 2.48001C1.27989 1.81727 1.81715 1.28001 2.47989 1.28001V1.46627e-05C1.11023 1.46627e-05 -0.000107408 1.11035 -0.000107408 2.48001H1.27989ZM2.47989 1.28001H9.99776V1.46627e-05H2.47989V1.28001ZM9.99776 1.28001C10.316 1.28001 10.6212 1.40643 10.8463 1.6315L11.7514 0.726381C11.2863 0.261303 10.6555 1.46627e-05 9.99776 1.46627e-05V1.28001ZM10.8463 1.63149L14.3684 5.15363L15.2735 4.24854L11.7514 0.726395L10.8463 1.63149ZM14.3684 5.15365C14.5935 5.37869 14.7199 5.6839 14.7199 6.00217H15.9999C15.9999 5.34443 15.7386 4.71363 15.2735 4.24853L14.3684 5.15365ZM14.7199 6.00217V13.52H15.9999V6.00217H14.7199ZM14.7199 13.52C14.7199 14.1828 14.1827 14.72 13.5199 14.72V16C14.8896 16 15.9999 14.8897 15.9999 13.52H14.7199ZM3.28949 5.69587H5.15403V4.41587H3.28949V5.69587ZM5.15403 5.69587H6.82229V4.41587H5.15403V5.69587ZM4.51403 3.28947V5.05587H5.79403V3.28947H4.51403ZM4.51403 5.05587V6.82227H5.79403V5.05587H4.51403Z"
                                            fill="white" />
                                    </svg>
                                    <span :class="'text-left' + (workbench.canSaveAs ? '' : ' unavailable')">
                                        Save&nbsp;As
                                    </span>
                                </div>
                                <span class="shortcut text-right">Shift+S</span>
                            </div>
                            <div class="editorTopMenuDropdownItem" @click="window.client.runScript('dump'); navigationMenuClose()">
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="none"
                                        :class="workbench.canExport ? '' : 'unavailable'">
                                        <path
                                            d="M15.3599 8.92001V13.52C15.3599 14.5362 14.5361 15.36 13.5199 15.36H2.47989C1.46369 15.36 0.639893 14.5362 0.639893 13.52V8.92001M11.6799 4.32001L7.99989 0.640015M7.99989 0.640015L4.31989 4.32001M7.99989 0.640015V11.68"
                                            stroke="white" stroke-width="1.28" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                    <span :class="'text-left' + (workbench.canExport ? '' : ' unavailable')">
                                        Export
                                    </span>
                                </div>
                                <span class="shortcut text-right">Ctrl+E</span>
                            </div>
                        </div>
                    </div>
                </nav>
            </div>            <div class="editorSideMenuContainer">
                <div class="editorSideMenu"
                    :class="{'chat-left': uiSettings.chatSide === 'left', 'chat-right':  uiSettings.chatSide === 'right'}">
                    <button @click.prevent="window.client.runScript('fit')" @mouseover="menuBarMenu='fit'"
                        x-tooltip="Fit into view">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6.55007 1.59991H0.800095L0.800049 7.34993M19.2 7.34993V1.59995L13.45 1.59991M13.45 19.1999H19.2V13.4499M0.800049 13.4499V19.1999H6.55007" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
            </svg> 
                    </button>
                    <!-- Arrange Button -->
                    <button @click.prevent="window.client.runScript('arrange')" @mouseover="menuBarMenu='arrange'"
                        x-tooltip="Arrange">
                        <svg width="22" height="21" viewBox="0 0 22 21" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M10.9999 0.999939C10.9999 6.30187 15.2979 10.5999 20.5999 10.5999C15.2979 10.5999 10.9999 14.898 10.9999 20.1999C10.9999 14.898 6.70183 10.5999 1.3999 10.5999C6.70183 10.5999 10.9999 6.30187 10.9999 0.999939Z" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
            </svg> 
                    </button>
                    <!--Divider -->
                    <!--
                    <svg width="22" height="2" viewBox="0 0 22 2" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="0.999853" y="1.19991" width="0.8" height="20" rx="0.4" transform="rotate(-90 0.999853 1.19991)" stroke="white" stroke-width="0.8"/>
            </svg> 
                    -->
                    <!-- Zoom out Button -->
                    <button @click.prevent="window.client.runScript('zoom',[-1])" @mouseover="menuBarMenu='zoomout'"
                        x-tooltip="Zoom Out">
                        <svg width="22" height="23" viewBox="0 0 22 23" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6.55556 11.4H15.4444M21 11.4C21 16.9229 16.5229 21.4 11 21.4C5.47716 21.4 1 16.9229 1 11.4C1 5.87712 5.47716 1.39996 11 1.39996C16.5229 1.39996 21 5.87712 21 11.4Z" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
            </svg> 
                    </button>
                    <!-- Zoom in Button -->
                    <button @click.prevent="window.client.runScript('zoom',[1])" @mouseover="menuBarMenu='zoomin'"
                        x-tooltip="Zoom In">
                        <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M11 5.6444V16.7555M5.44444 11.2H16.5556M21 11.2C21 16.7228 16.5229 21.1999 11 21.1999C5.47716 21.1999 1 16.7228 1 11.2C1 5.67711 5.47716 1.19995 11 1.19995C16.5229 1.19995 21 5.67711 21 11.2Z" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
            </svg> 
                    </button>
                </div>
            </div>          </div>
        </div>
        <ul x-data="{
                        toasts: [],
                        toastsHovered: false,
                        expanded: false,
                        layout: 'default',
                        position: 'top-center',
                        paddingBetweenToasts: 15,
                        deleteToastWithId (id){
                            for(let i = 0; i < this.toasts.length; i++){
                                if(this.toasts[i].id === id){
                                    this.toasts.splice(i, 1);
                                    break;
                                }
                            }
                        },
                        burnToast(id){
                            burnToast = this.getToastWithId(id);
                            burnToastElement = document.getElementById(burnToast.id);
                            if(burnToastElement){
                                if(this.toasts.length == 1){
                                    if(this.layout=='default'){
                                        this.expanded = false;
                                    }
                                    burnToastElement.classList.remove('translate-y-0');
                                    if(this.position.includes('bottom')){
                                        burnToastElement.classList.add('translate-y-full');
                                    } else {
                                        burnToastElement.classList.add('-translate-y-full');
                                    }
                                    burnToastElement.classList.add('-translate-y-full');
                                }
                                burnToastElement.classList.add('opacity-0');
                                let that = this;
                                setTimeout(function(){
                                    that.deleteToastWithId(id);
                                    setTimeout(function(){
                                        that.stackToasts();
                                    }, 1)
                                }, 300);
                            }
                        },
                        getToastWithId(id){
                            for(let i = 0; i < this.toasts.length; i++){
                                if(this.toasts[i].id === id){
                                    return this.toasts[i];
                                }
                            }
                        },
                        stackToasts(){
                            this.positionToasts();
                            this.calculateHeightOfToastsContainer();
                            let that = this;
                            setTimeout(function(){
                                that.calculateHeightOfToastsContainer();
                            }, 300);
                        },
                        positionToasts(){
                            if(this.toasts.length == 0) return;
                            let topToast = document.getElementById( this.toasts[0].id );
                            topToast.style.zIndex = 100;
                            if(this.expanded){
                                if(this.position.includes('bottom')){
                                    topToast.style.top = 'auto';
                                    topToast.style.bottom = '0px';
                                } else {
                                    topToast.style.top = '0px';
                                }
                            }
        
                            let bottomPositionOfFirstToast = this.getBottomPositionOfElement(topToast);
        
                            if(this.toasts.length == 1) return;
                            let middleToast = document.getElementById( this.toasts[1].id );
                            middleToast.style.zIndex = 90;
        
                            if(this.expanded){
                                middleToastPosition = topToast.getBoundingClientRect().height +
                                                        this.paddingBetweenToasts + 'px';
        
                                if(this.position.includes('bottom')){
                                    middleToast.style.top = 'auto';
                                    middleToast.style.bottom = middleToastPosition;
                                } else {
                                    middleToast.style.top = middleToastPosition;
                                }
        
                                middleToast.style.scale = '100%';
                                middleToast.style.transform = 'translateY(0px)';
        
                            } else {
                                middleToast.style.scale = '94%';
                                if(this.position.includes('bottom')){
                                    middleToast.style.transform = 'translateY(-16px)';
                                } else {
                                    this.alignBottom(topToast, middleToast);
                                    middleToast.style.transform = 'translateY(16px)';
                                }
                            }
        
        
                            if(this.toasts.length == 2) return;
                            let bottomToast = document.getElementById( this.toasts[2].id );
                            bottomToast.style.zIndex = 80;
                            if(this.expanded){
                                bottomToastPosition = topToast.getBoundingClientRect().height +
                                                        this.paddingBetweenToasts +
                                                        middleToast.getBoundingClientRect().height +
                                                        this.paddingBetweenToasts + 'px';
        
                                if(this.position.includes('bottom')){
                                    bottomToast.style.top = 'auto';
                                    bottomToast.style.bottom = bottomToastPosition;
                                } else {
                                    bottomToast.style.top = bottomToastPosition;
                                }
        
                                bottomToast.style.scale = '100%';
                                bottomToast.style.transform = 'translateY(0px)';
                            } else {
                                bottomToast.style.scale = '88%';
                                if(this.position.includes('bottom')){
                                    bottomToast.style.transform = 'translateY(-32px)';
                                } else {
                                    this.alignBottom(topToast, bottomToast);
                                    bottomToast.style.transform = 'translateY(32px)';
                                }
                            }
        
        
        
                            if(this.toasts.length == 3) return;
                            let burnToast = document.getElementById( this.toasts[3].id );
                            burnToast.style.zIndex = 70;
                            if(this.expanded){
                                burnToastPosition = topToast.getBoundingClientRect().height +
                                                        this.paddingBetweenToasts +
                                                        middleToast.getBoundingClientRect().height +
                                                        this.paddingBetweenToasts +
                                                        bottomToast.getBoundingClientRect().height +
                                                        this.paddingBetweenToasts + 'px';
        
                                if(this.position.includes('bottom')){
                                    burnToast.style.top = 'auto';
                                    burnToast.style.bottom = burnToastPosition;
                                } else {
                                    burnToast.style.top = burnToastPosition;
                                }
        
                                burnToast.style.scale = '100%';
                                burnToast.style.transform = 'translateY(0px)';
                            } else {
                                burnToast.style.scale = '82%';
                                this.alignBottom(topToast, burnToast);
                                burnToast.style.transform = 'translateY(48px)';
                            }
        
                            burnToast.firstElementChild.classList.remove('opacity-100');
                            burnToast.firstElementChild.classList.add('opacity-0');
        
                            let that = this;
                            // Burn 🔥 (remove) last toast
                            setTimeout(function(){
                                    that.toasts.pop();
                                }, 300);
        
                            if(this.position.includes('bottom')){
                                    middleToast.style.top = 'auto';
                            }
        
                            return;
                        },
                        alignBottom(element1, element2) {
                            // Get the top position and height of the first element
                            let top1 = element1.offsetTop;
                            let height1 = element1.offsetHeight;
        
                            // Get the height of the second element
                            let height2 = element2.offsetHeight;
        
                            // Calculate the top position for the second element
                            let top2 = top1 + (height1 - height2);
        
                            // Apply the calculated top position to the second element
                            element2.style.top = top2 + 'px';
                        },
                        alignTop(element1, element2) {
                            // Get the top position of the first element
                            let top1 = element1.offsetTop;
        
                            // Apply the same top position to the second element
                            element2.style.top = top1 + 'px';
                        },
                        resetBottom(){
                            for(let i = 0; i < this.toasts.length; i++){
                                if(document.getElementById( this.toasts[i].id )){
                                    let toastElement = document.getElementById( this.toasts[i].id );
                                    toastElement.style.bottom = '0px';
                                }
                            }
                        },
                        resetTop(){
                            for(let i = 0; i < this.toasts.length; i++){
                                if(document.getElementById( this.toasts[i].id )){
                                    let toastElement = document.getElementById( this.toasts[i].id );
                                    toastElement.style.top = '0px';
                                }
                            }
                        },
                        getBottomPositionOfElement(el){
                            return (el.getBoundingClientRect().height + el.getBoundingClientRect().top);
                        },
                        calculateHeightOfToastsContainer(){
                            if(this.toasts.length == 0){
                                $el.style.height = '0px';
                                return;
                            }
        
                            lastToast = this.toasts[this.toasts.length - 1];
                            lastToastRectangle = document.getElementById(lastToast.id).getBoundingClientRect();
        
                            firstToast = this.toasts[0];
                            firstToastRectangle = document.getElementById(firstToast.id).getBoundingClientRect();
        
                            if(this.toastsHovered){
                                if(this.position.includes('bottom')){
                                    $el.style.height = ((firstToastRectangle.top + firstToastRectangle.height) - lastToastRectangle.top) + 'px';
                                } else {
                                    $el.style.height = ((lastToastRectangle.top + lastToastRectangle.height) - firstToastRectangle.top) + 'px';
                                }
                            } else {
                                $el.style.height = firstToastRectangle.height + 'px';
                            }
                        }
                    }" @set-toasts-layout.window="
                        layout=event.detail.layout;
                        if(layout == 'expanded'){
                            expanded=true;
                        } else {
                            expanded=false;
                        }
                        stackToasts();
                    " @toast-show.window="
                        event.stopPropagation();
                        if(event.detail.position){
                            position = event.detail.position;
                        }
                        toasts.unshift({
                            id: 'toast-' + Math.random().toString(16).slice(2),
                            show: false,
                            message: event.detail.message,
                            description: event.detail.description,
                            type: event.detail.type,
                            html: event.detail.html
                        });
                    " @mouseenter="toastsHovered=true;" @mouseleave="toastsHovered=false" x-init="
                        if(layout == 'expanded'){
                            expanded = true;
                        }
                        stackToasts();
                        $watch('toastsHovered', function(value){
        
                            if(layout == 'default'){
                                if(position.includes('bottom')){
                                    resetBottom();
                                } else {
                                    resetTop();
                                }
        
                                if(value){
                                    // calculate the new positions
                                    expanded = true;
                                    if(layout == 'default'){
                                        stackToasts();
                                    }
                                } else {
                                    if(layout == 'default'){
                                        expanded = false;
                                        //setTimeout(function(){
                                        stackToasts();
                                    //}, 10);
                                        setTimeout(function(){
                                            stackToasts();
                                        }, 10)
                                    }
                                }
                            }
                        });
                    " class="fixed block w-full group z-[99] sm:max-w-xs" :class="{ 'right-0 top-0 sm:mt-6 sm:mr-6': position=='top-right', 'left-0 top-0 sm:mt-6 sm:ml-6': position=='top-left', 'left-1/2 -translate-x-1/2 top-0 sm:mt-6': position=='top-center', 'right-0 bottom-0 sm:mr-6 sm:mb-6': position=='bottom-right', 'left-0 bottom-0 sm:ml-6 sm:mb-6': position=='bottom-left', 'left-1/2 -translate-x-1/2 bottom-0 sm:mb-6': position=='bottom-center' }" x-cloak>
          <template x-for="(toast, index) in toasts" :key="toast.id">
            <li :id="toast.id" x-data="{
                                toastHovered: false
                            }" x-init="
        
                                if(position.includes('bottom')){
                                    $el.firstElementChild.classList.add('toast-bottom');
                                    $el.firstElementChild.classList.add('opacity-0', 'translate-y-full');
                                } else {
                                    $el.firstElementChild.classList.add('opacity-0', '-translate-y-full');
                                }
                                setTimeout(function(){
        
                                    setTimeout(function(){
                                        if(position.includes('bottom')){
                                            $el.firstElementChild.classList.remove('opacity-0', 'translate-y-full');
                                        } else {
                                            $el.firstElementChild.classList.remove('opacity-0', '-translate-y-full');
                                        }
                                        $el.firstElementChild.classList.add('opacity-100', 'translate-y-0');
        
                                        setTimeout(function(){
                                            stackToasts();
                                        }, 10);
                                    }, 5);
                                }, 50);
        
                                setTimeout(function(){
                                    setTimeout(function(){
                                        $el.firstElementChild.classList.remove('opacity-100');
                                        $el.firstElementChild.classList.add('opacity-0');
                                        if(toasts.length == 1){
                                            $el.firstElementChild.classList.remove('translate-y-0');
                                            $el.firstElementChild.classList.add('-translate-y-full');
                                        }
                                        setTimeout(function(){
                                            deleteToastWithId(toast.id)
                                        }, 300);
                                    }, 5);
                                }, 4000);
                            " @mouseover="toastHovered=true" @mouseout="toastHovered=false" class="absolute w-full duration-300 ease-out select-none sm:max-w-xs" :class="{ 'toast-no-description': !toast.description }">
              <span class="relative flex flex-col items-start shadow-[0_5px_15px_-3px_rgb(0_0_0_/_0.08)] w-full transition-all duration-300 ease-out bg-white border border-gray-100 sm:rounded-md sm:max-w-xs group" :class="{ 'p-4' : !toast.html, 'p-0' : toast.html }">
                <template x-if="!toast.html">
                  <div class="relative">
                    <div class="flex items-center" :class="{ 'text-green-500' : toast.type=='success', 'text-blue-500' : toast.type=='info', 'text-orange-400' : toast.type=='warning', 'text-red-500' : toast.type=='danger', 'text-gray-800' : toast.type=='default' }">
                      <svg x-show="toast.type=='success'" class="w-[18px] h-[18px] mr-1.5 -ml-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM16.7744 9.63269C17.1238 9.20501 17.0604 8.57503 16.6327 8.22559C16.2051 7.87615 15.5751 7.93957 15.2256 8.36725L10.6321 13.9892L8.65936 12.2524C8.24484 11.8874 7.61295 11.9276 7.248 12.3421C6.88304 12.7566 6.92322 13.3885 7.33774 13.7535L9.31046 15.4903C10.1612 16.2393 11.4637 16.1324 12.1808 15.2547L16.7744 9.63269Z" fill="currentColor"></path>
                      </svg>
                      <svg x-show="toast.type=='info'" class="w-[18px] h-[18px] mr-1.5 -ml-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM12 9C12.5523 9 13 8.55228 13 8C13 7.44772 12.5523 7 12 7C11.4477 7 11 7.44772 11 8C11 8.55228 11.4477 9 12 9ZM13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12V16C11 16.5523 11.4477 17 12 17C12.5523 17 13 16.5523 13 16V12Z" fill="currentColor"></path>
                      </svg>
                      <svg x-show="toast.type=='warning'" class="w-[18px] h-[18px] mr-1.5 -ml-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M9.44829 4.46472C10.5836 2.51208 13.4105 2.51168 14.5464 4.46401L21.5988 16.5855C22.7423 18.5509 21.3145 21 19.05 21L4.94967 21C2.68547 21 1.25762 18.5516 2.4004 16.5862L9.44829 4.46472ZM11.9995 8C12.5518 8 12.9995 8.44772 12.9995 9V13C12.9995 13.5523 12.5518 14 11.9995 14C11.4473 14 10.9995 13.5523 10.9995 13V9C10.9995 8.44772 11.4473 8 11.9995 8ZM12.0009 15.99C11.4486 15.9892 11.0003 16.4363 10.9995 16.9886L10.9995 16.9986C10.9987 17.5509 11.4458 17.9992 11.9981 18C12.5504 18.0008 12.9987 17.5537 12.9995 17.0014L12.9995 16.9914C13.0003 16.4391 12.5532 15.9908 12.0009 15.99Z" fill="currentColor"></path>
                      </svg>
                      <svg x-show="toast.type=='danger'" class="w-[18px] h-[18px] mr-1.5 -ml-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12ZM11.9996 7C12.5519 7 12.9996 7.44772 12.9996 8V12C12.9996 12.5523 12.5519 13 11.9996 13C11.4474 13 10.9996 12.5523 10.9996 12V8C10.9996 7.44772 11.4474 7 11.9996 7ZM12.001 14.99C11.4488 14.9892 11.0004 15.4363 10.9997 15.9886L10.9996 15.9986C10.9989 16.5509 11.446 16.9992 11.9982 17C12.5505 17.0008 12.9989 16.5537 12.9996 16.0014L12.9996 15.9914C13.0004 15.4391 12.5533 14.9908 12.001 14.99Z" fill="currentColor"></path>
                      </svg>
                      <p class="text-[13px] font-medium leading-none text-gray-800" x-text="toast.message"></p>
                    </div>
                    <p x-show="toast.description" :class="{ 'pl-5' : toast.type!='default' }" class="mt-1.5 text-xs leading-none opacity-70" x-text="toast.description"></p>
                  </div>
                </template>
                <template x-if="toast.html">
                  <div x-html="toast.html"></div>
                </template>
                <span @click="burnToast(toast.id)" class="absolute right-0 p-1.5 mr-2.5 text-gray-400 duration-100 ease-in-out rounded-full opacity-0 cursor-pointer hover:bg-gray-50 hover:text-gray-500" :class="{ 'top-1/2 -translate-y-1/2' : !toast.description && !toast.html, 'top-0 mt-2.5' : (toast.description || toast.html), 'opacity-100' : toastHovered, 'opacity-0' : !toastHovered }">
                  <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                  </svg>
                </span>
              </span>
            </li>
          </template>
        </ul>      </div>
    </div>

  </body>
</html>
